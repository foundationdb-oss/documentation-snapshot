{
  "post_stream": {
    "posts": [
      {
        "id": 6988,
        "name": "Seph Gentle",
        "username": "josephg",
        "avatar_template": "/user_avatar/forums.foundationdb.org/josephg/{size}/84_2.png",
        "created_at": "2020-05-12T23:48:30.139Z",
        "cooked": "<p>I care a lot about realtime editing and I think all application should default to showing a \u2018live\u2019 view of the data you\u2019re looking at. Right now this is really hard to do on top of foundationdb, and I have some ideas on how to fix it but I\u2019d be interested in some other people\u2019s thoughts.</p>\n<p>As an example, I want to be able to write a tool which can show you a (live) view of all the directories in foundationdb and let a user drill in and see the documents inside each fdb directory. And I want that view to update live as documents are inserted, removed, or updated. And ideally, I\u2019d like to be able to implement this sort of thing without changing application code (or the directory layer) - because the directory layer is pretty complicated.</p>\n<p>You could see live changes to the directory layer if you had a feature to watch ranges of keys. But ideally I\u2019d also like to be able to also associate metadata with those changes - like, information about the user / service which made that change, so any clients which are viewing the change can show that.</p>\n<p>I could do this in a layer which sits under the API that things like the directory layer consume. I\u2019m imagining something like this:</p>\n<ul>\n<li>We specify a directory (eventually, ideally it should be moved to \\xff\\xff or something). This directory contains documents which specify watched key ranges.</li>\n<li>For each watched range, we have a configuration document that specifies some properties - a prefix for log entries themselves and expiry times.</li>\n<li>Every time a client commits a transaction, if that transaction modifies any documents inside a watched range, the commit will also append a log entry for that watched range listing the keys that were changed with associated metadata (if any).</li>\n<li>I\u2019m imagining two kinds of watched ranges: ranges which are per-client (and should be deleted automatically if the client goes away), and watched ranges that are expected to be shared by multiple clients. (For these, we can specify a ttl on the log entries themselves - so the log is a sliding window of the last 10 minutes of changes or something). Not sure if the TTL should be specified as a time, or specified using version numbers.</li>\n<li>If the expiry time on any log elapses, any client can delete (garbage collect) it.</li>\n</ul>\n<p>For per-client range watches, the expiry time on the log itself is there so if the client crashes, we don\u2019t end up with a buildup of crap in the database. Each client can periodically advance the expiry time of all their own range watches to keep them active. And clients should delete log entries as they consume them.</p>\n<p>A naive implementation of this would need to fetch the configuration information in each commit - which is pretty slow. But we can do better than that by having all clients watch the configuration entries using this very feature. To make that work, we set up a global log for watch configuration changes. When a client starts up it fetches the watch configuration and stores that locally, and keeps that local configuration object up to date.</p>\n<hr>\n<p>I\u2019ve described this as a change that could be made inside the bindings, because I maintain the nodejs bindings, so I can easily change that code. But I\u2019m not sure if thats actually the best place. Implemented as I\u2019ve described it, this change would need to be implemented independently in all the bindings (which is a hassle). If any clients weren\u2019t inserting log entries, it would mess the whole thing up. And to actually notify consumers without polling, each watch range would need a single \u2018current version\u2019 document or something that other clients can watch. And that would quickly become a bottleneck at scale.</p>\n<p>Also the server already has &amp; maintains a log of operations for replica sets. Its just currently private.</p>\n<p>Anyway, I\u2019m interested in people\u2019s thoughts on this. I might code up a little proof of concept in the node bindings and goof around with it.</p>\n<p>And does this feature interest anyone else?</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 1,
        "updated_at": "2020-05-12T23:48:30.139Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 185,
        "reads": 45,
        "readers_count": 44,
        "score": 994.0,
        "yours": false,
        "topic_id": 2116,
        "topic_slug": "getting-a-realtime-feed-of-changes",
        "display_username": "Seph Gentle",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://forums.foundationdb.org/t/expose-serialization-of-mutationref-in-api/2124/5",
            "internal": true,
            "reflection": true,
            "title": "Expose serialization of MutationRef in api?",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 4
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 120,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/getting-a-realtime-feed-of-changes/2116/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      }
    ],
    "stream": [
      6988
    ]
  },
  "timeline_lookup": [
    [
      1,
      1988
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Getting a realtime feed of changes",
  "id": 2116,
  "title": "Getting a realtime feed of changes",
  "posts_count": 1,
  "created_at": "2020-05-12T23:48:30.073Z",
  "views": 1149,
  "reply_count": 0,
  "like_count": 4,
  "last_posted_at": "2020-05-12T23:48:30.139Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "getting-a-realtime-feed-of-changes",
  "category_id": 9,
  "word_count": 698,
  "deleted_at": null,
  "user_id": 120,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_2116",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 1,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 1,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Changefeeds (watching and getting updates on ranges of keys)",
      "id": 511,
      "title": "Changefeeds (watching and getting updates on ranges of keys)",
      "slug": "changefeeds-watching-and-getting-updates-on-ranges-of-keys",
      "posts_count": 9,
      "reply_count": 7,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2018-06-16T12:26:34.710Z",
      "last_posted_at": "2018-07-06T14:46:54.646Z",
      "bumped": true,
      "bumped_at": "2018-07-06T14:46:54.646Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 4221,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 307,
            "username": "jwr",
            "name": "Jan Rychter",
            "avatar_template": "/user_avatar/forums.foundationdb.org/jwr/{size}/302_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 22,
            "username": "dave",
            "name": "David Scherer",
            "avatar_template": "/user_avatar/forums.foundationdb.org/dave/{size}/89_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Changes feed without hot keys",
      "id": 1057,
      "title": "Changes feed without hot keys",
      "slug": "changes-feed-without-hot-keys",
      "posts_count": 8,
      "reply_count": 4,
      "highest_post_number": 8,
      "image_url": null,
      "created_at": "2019-01-24T21:54:58.266Z",
      "last_posted_at": "2019-01-25T20:22:00.709Z",
      "bumped": true,
      "bumped_at": "2019-01-25T20:22:00.709Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1474,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 491,
            "username": "iilyak",
            "name": "Iilyak",
            "avatar_template": "/user_avatar/forums.foundationdb.org/iilyak/{size}/1073_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 81,
            "username": "ryanworl",
            "name": "Ryan Worl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 308,
            "username": "ananthakumaran",
            "name": "Anantha Kumaran",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ananthakumaran/{size}/526_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 423,
            "username": "kocolosk",
            "name": "Adam Kocoloski",
            "avatar_template": "/user_avatar/forums.foundationdb.org/kocolosk/{size}/412_2.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Watchers and not missing changes",
      "id": 474,
      "title": "Watchers and not missing changes",
      "slug": "watchers-and-not-missing-changes",
      "posts_count": 14,
      "reply_count": 6,
      "highest_post_number": 14,
      "image_url": null,
      "created_at": "2018-05-25T13:29:22.034Z",
      "last_posted_at": "2018-06-05T23:23:48.371Z",
      "bumped": true,
      "bumped_at": "2018-06-05T23:23:48.371Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 1999,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 289,
            "username": "rowanG",
            "name": "Rowan Goemans",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/8baadc/{size}.png",
            "trust_level": 0
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 81,
            "username": "ryanworl",
            "name": "Ryan Worl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 298,
            "username": "gwillis12",
            "name": "Geo",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/ed655f/{size}.png",
            "trust_level": 0
          }
        }
      ]
    },
    {
      "fancy_title": "Transaction Log",
      "id": 785,
      "title": "Transaction Log",
      "slug": "transaction-log",
      "posts_count": 4,
      "reply_count": 2,
      "highest_post_number": 4,
      "image_url": null,
      "created_at": "2018-10-19T09:53:24.224Z",
      "last_posted_at": "2018-10-22T13:58:23.756Z",
      "bumped": true,
      "bumped_at": "2018-10-22T13:58:23.756Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 2939,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 382,
            "username": "rahul",
            "name": "Rahul",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f14d63/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 14,
            "username": "andrew.noyes",
            "name": "",
            "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 22,
            "username": "dave",
            "name": "David Scherer",
            "avatar_template": "/user_avatar/forums.foundationdb.org/dave/{size}/89_2.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Change data capture",
      "id": 1259,
      "title": "Change data capture",
      "slug": "change-data-capture",
      "posts_count": 6,
      "reply_count": 3,
      "highest_post_number": 6,
      "image_url": null,
      "created_at": "2019-03-25T19:00:14.057Z",
      "last_posted_at": "2019-03-26T18:34:07.213Z",
      "bumped": true,
      "bumped_at": "2019-03-26T18:34:07.213Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 1712,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 549,
            "username": "nitins64",
            "name": "Nitin Sharma",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/n/7993a0/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 81,
            "username": "ryanworl",
            "name": "Ryan Worl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
            "trust_level": 3
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 120,
        "username": "josephg",
        "name": "Seph Gentle",
        "avatar_template": "/user_avatar/forums.foundationdb.org/josephg/{size}/84_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      }
    ],
    "created_by": {
      "id": 120,
      "username": "josephg",
      "name": "Seph Gentle",
      "avatar_template": "/user_avatar/forums.foundationdb.org/josephg/{size}/84_2.png"
    },
    "last_poster": {
      "id": 120,
      "username": "josephg",
      "name": "Seph Gentle",
      "avatar_template": "/user_avatar/forums.foundationdb.org/josephg/{size}/84_2.png"
    }
  },
  "bookmarks": []
}