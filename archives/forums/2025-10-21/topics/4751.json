{
  "post_stream": {
    "posts": [
      {
        "id": 14639,
        "name": "Jon Chambers",
        "username": "jon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/jon/{size}/1896_2.png",
        "created_at": "2024-12-27T03:37:41.608Z",
        "cooked": "<p>Hello!</p>\n<p>I\u2019m trying to get my head around directories and am trying to understand the design intent. My interpretation of <a href=\"https://apple.github.io/foundationdb/developer-guide.html#directories\" rel=\"noopener nofollow ugc\">the developer guide</a> is that directories are intended to model the large, static ideas in an application. For example, for a forum application, you might have \u201cusers\u201d and \u201ctopics.\u201d</p>\n<p>My interpretation is <em>also</em> that having a subdirectory for each user\u2019s individual posts might be a bit much. For example, this might stretch the intent of the directory system:</p>\n<ul>\n<li>directory:posts\n<ul>\n<li>directory:1944f2cd-e3c1-4f24-b031-ea5c231624de\n<ul>\n<li>key:post01</li>\n<li>key:post02</li>\n</ul>\n</li>\n<li>directory:74e1106e-4962-4622-8369-ad8b2ee1cc53\n<ul>\n<li>key:post77</li>\n<li>key:post89</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>\u2026but perhaps I\u2019m inventing obstacles where there really are none. So, broadly speaking, <em>are</em> per-user subdirectories in line with the design intent? How many directories is \u201ctoo many?\u201d Is there a point where having a large number of directories starts to have performance side effects?</p>\n<p>Thanks kindly!</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 3,
        "updated_at": "2024-12-27T05:22:09.653Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 32,
        "reads": 11,
        "readers_count": 10,
        "score": 162.2,
        "yours": false,
        "topic_id": 4751,
        "topic_slug": "how-many-directories-is-too-many",
        "display_username": "Jon Chambers",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://apple.github.io/foundationdb/developer-guide.html#directories",
            "internal": false,
            "reflection": false,
            "title": "Developer Guide \u2014 FoundationDB ON documentation",
            "clicks": 2
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1505,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-many-directories-is-too-many/4751/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 14646,
        "name": "Jon Chambers",
        "username": "jon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/jon/{size}/1896_2.png",
        "created_at": "2025-01-02T21:24:18.051Z",
        "cooked": "<p>I\u2019ve thought about this a little more and discussed it with some colleagues, and I think I can articulate the tradeoffs with using directories in a use case like this a little more clearly. Ultimately, what I\u2019ve learned isn\u2019t really novel; it\u2019s mostly just internalizing what\u2019s already been covered in <a href=\"https://forums.foundationdb.org/t/whats-the-purpose-of-the-directory-layer/677/2\" class=\"inline-onebox\">What's the purpose of the Directory layer? - #2 by alloc</a> and applying it more specifically to our immediate use case. Still, I wanted to share the summary here in case it\u2019s helpful to somebody else later.</p>\n<p>For us, the main reason we\u2019d want to use directories in a situation like this is for shorter key prefixes; we wouldn\u2019t likely be making much (or really any) use of things like moving or renaming directories. Our use case would be \u201cinboxes\u201d for a relatively high-traffic messaging service. The idea of shorter prefixes for each message key is\u2014on the surface, at least\u2014appealing because we\u2019d be inserting/reading a bazillion messages, and saving space/bandwidth on the keys seems like a win.</p>\n<p>The problem for our use case is that the cardinality of the space is too high for us to really cache directories, and so we\u2019d be querying the directory metadata for virtually every interaction with the message store. That\u2019s almost certainly be creating a hotspot in the database, and so I think it doesn\u2019t make sense for our use case.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 3,
        "updated_at": "2025-01-02T21:24:18.051Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 4,
        "reads": 10,
        "readers_count": 9,
        "score": 22.0,
        "yours": false,
        "topic_id": 4751,
        "topic_slug": "how-many-directories-is-too-many",
        "display_username": "Jon Chambers",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://forums.foundationdb.org/t/whats-the-purpose-of-the-directory-layer/677/2",
            "internal": true,
            "reflection": false,
            "title": "What's the purpose of the Directory layer?",
            "clicks": 8
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1505,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-many-directories-is-too-many/4751/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 14650,
        "name": "",
        "username": "Imperatorx",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/i/d2c977/{size}.png",
        "created_at": "2025-01-06T17:42:10.251Z",
        "cooked": "<p>I agree, I would just use a single directory for the entity type, and append a tuple to the directory subspace that represents a composite primary key with the indbox id and the message id. The redwood storage engine has prefix compression, so if the only reason for using directories is saving space, then use redwood instead for the same result with less complexity.</p>\n<p>Btw if you are building and inbox service, check out the \u201cTask Queue\u201d feature in my extension\u2019s <a href=\"https://gitlab.com/qfoundation/qfoundation#messaging-layer\" rel=\"noopener nofollow ugc\">messaging layer</a>, it uses a combination of watches, partition allocators and versionstamps to build distributed task inbox consumers that process data fairly between inboxes (identified by the message key).</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 3,
        "updated_at": "2025-01-06T17:42:10.251Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 8,
        "readers_count": 7,
        "score": 6.6,
        "yours": false,
        "topic_id": 4751,
        "topic_slug": "how-many-directories-is-too-many",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://gitlab.com/qfoundation/qfoundation#messaging-layer",
            "internal": false,
            "reflection": false,
            "title": "QFoundation / QFoundation \u00b7 GitLab",
            "clicks": 12
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 164,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-many-directories-is-too-many/4751/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      14639,
      14646,
      14650
    ]
  },
  "timeline_lookup": [
    [
      1,
      299
    ],
    [
      2,
      292
    ],
    [
      3,
      288
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "How many directories is &ldquo;too many?&rdquo;",
  "id": 4751,
  "title": "How many directories is \"too many?\"",
  "posts_count": 3,
  "created_at": "2024-12-27T03:37:41.559Z",
  "views": 165,
  "reply_count": 0,
  "like_count": 0,
  "last_posted_at": "2025-01-06T17:42:10.251Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "how-many-directories-is-too-many",
  "category_id": 7,
  "word_count": 525,
  "deleted_at": null,
  "user_id": 1505,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_4751",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 3,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Should I optimize for single reads?",
      "id": 1155,
      "title": "Should I optimize for single reads?",
      "slug": "should-i-optimize-for-single-reads",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2019-02-19T20:01:01.620Z",
      "last_posted_at": "2019-02-19T21:08:37.414Z",
      "bumped": true,
      "bumped_at": "2019-02-19T21:08:37.414Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 451,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 517,
            "username": "janderland",
            "name": "Jon Anderson",
            "avatar_template": "/user_avatar/forums.foundationdb.org/janderland/{size}/517_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 7,
            "username": "SteavedHams",
            "name": "Steve Atherton",
            "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "What&rsquo;s the purpose of the Directory layer?",
      "id": 677,
      "title": "What's the purpose of the Directory layer?",
      "slug": "whats-the-purpose-of-the-directory-layer",
      "posts_count": 10,
      "reply_count": 6,
      "highest_post_number": 11,
      "image_url": null,
      "created_at": "2018-09-02T20:58:11.436Z",
      "last_posted_at": "2022-07-22T02:24:33.270Z",
      "bumped": true,
      "bumped_at": "2022-07-22T02:24:33.270Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 11,
      "views": 6523,
      "category_id": 9,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 41,
            "username": "amirouche",
            "name": "Amirouche",
            "avatar_template": "/user_avatar/forums.foundationdb.org/amirouche/{size}/1911_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 538,
            "username": "ravilution",
            "name": "Ravilution",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ravilution/{size}/728_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 1080,
            "username": "knarayanan88",
            "name": "Narayanan K",
            "avatar_template": "/user_avatar/forums.foundationdb.org/knarayanan88/{size}/1300_2.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Can subspace/dir be used unlimited (modelling) and about multi client",
      "id": 536,
      "title": "Can subspace/dir be used unlimited (modelling) and about multi client",
      "slug": "can-subspace-dir-be-used-unlimited-modelling-and-about-multi-client",
      "posts_count": 4,
      "reply_count": 1,
      "highest_post_number": 4,
      "image_url": null,
      "created_at": "2018-07-01T15:39:50.966Z",
      "last_posted_at": "2018-07-03T18:41:34.170Z",
      "bumped": true,
      "bumped_at": "2018-07-03T18:44:49.138Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1105,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 317,
            "username": "Lundin",
            "name": "Pontus Lundin",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/l/dfb087/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 22,
            "username": "dave",
            "name": "David Scherer",
            "avatar_template": "/user_avatar/forums.foundationdb.org/dave/{size}/89_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Application design using Subspace and Tuple",
      "id": 452,
      "title": "Application design using Subspace and Tuple",
      "slug": "application-design-using-subspace-and-tuple",
      "posts_count": 9,
      "reply_count": 7,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2018-05-22T21:46:43.537Z",
      "last_posted_at": "2018-07-14T21:02:50.010Z",
      "bumped": true,
      "bumped_at": "2018-07-14T21:02:50.010Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 5,
      "views": 3678,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 211,
            "username": "brk0v",
            "name": "Viacheslav Biriukov",
            "avatar_template": "/user_avatar/forums.foundationdb.org/brk0v/{size}/173_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 317,
            "username": "Lundin",
            "name": "Pontus Lundin",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/l/dfb087/{size}.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Directory Layer design document",
      "id": 1538,
      "title": "Directory Layer design document",
      "slug": "directory-layer-design-document",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2019-07-26T19:30:02.034Z",
      "last_posted_at": "2019-07-26T20:00:10.504Z",
      "bumped": true,
      "bumped_at": "2019-07-26T20:00:10.504Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1042,
      "category_id": 9,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 251,
            "username": "George",
            "name": "",
            "avatar_template": "/user_avatar/forums.foundationdb.org/george/{size}/620_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 1505,
        "username": "jon",
        "name": "Jon Chambers",
        "avatar_template": "/user_avatar/forums.foundationdb.org/jon/{size}/1896_2.png",
        "post_count": 2,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 164,
        "username": "Imperatorx",
        "name": "",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/i/d2c977/{size}.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      }
    ],
    "created_by": {
      "id": 1505,
      "username": "jon",
      "name": "Jon Chambers",
      "avatar_template": "/user_avatar/forums.foundationdb.org/jon/{size}/1896_2.png"
    },
    "last_poster": {
      "id": 164,
      "username": "Imperatorx",
      "name": "",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/i/d2c977/{size}.png"
    },
    "links": [
      {
        "url": "https://gitlab.com/qfoundation/qfoundation#messaging-layer",
        "title": "QFoundation / QFoundation \u00b7 GitLab",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 12,
        "user_id": 164,
        "domain": "gitlab.com",
        "root_domain": "gitlab.com"
      },
      {
        "url": "https://forums.foundationdb.org/t/whats-the-purpose-of-the-directory-layer/677/2",
        "title": "What's the purpose of the Directory layer?",
        "internal": true,
        "attachment": false,
        "reflection": false,
        "clicks": 8,
        "user_id": 1505,
        "domain": "forums.foundationdb.org",
        "root_domain": "foundationdb.org"
      },
      {
        "url": "https://apple.github.io/foundationdb/developer-guide.html#directories",
        "title": "Developer Guide \u2014 FoundationDB ON documentation",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 2,
        "user_id": 1505,
        "domain": "apple.github.io",
        "root_domain": "apple.github.io"
      }
    ]
  },
  "bookmarks": []
}