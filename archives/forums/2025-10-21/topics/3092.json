{
  "post_stream": {
    "posts": [
      {
        "id": 10489,
        "name": "Rajiv M Ranganath",
        "username": "rajivr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png",
        "created_at": "2021-12-26T02:45:56.670Z",
        "cooked": "<p>I am exploring using <code>fdb_future_set_callback</code> in my bindings.</p>\n<p>I am unable fully to understand the behavior of how callbacks would work when prematurely destroyed. I found <a href=\"https://forums.foundationdb.org/t/does-fdb-future-set-callback-guarantee-exactly-once-execution/1498/3\">this</a> comment from <a class=\"mention\" href=\"/u/ajbeamon\">@ajbeamon</a> from an earlier thread.</p>\n<aside class=\"quote no-group\" data-username=\"ajbeamon\" data-post=\"3\" data-topic=\"1498\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"><a href=\"https://forums.foundationdb.org/t/does-fdb-future-set-callback-guarantee-exactly-once-execution/1498/3\">Does `fdb_future_set_callback` guarantee exactly-once execution?</a></div>\n<blockquote>\n<p>It\u2019s true that we can\u2019t guarantee that an operation will complete (and thus call the callback), but I think it\u2019s the case that canceling or destroying the future will cause the callback to complete with an error. Thus you could guarantee that the callback would fire if you canceled or destroyed the future at some point.</p>\n</blockquote>\n</aside>\n<p>Assuming a scenario where, callback has not been executed. If I were to call <code>fdb_future_destroy</code> in application thread <code>T1</code>. Is it the case that</p>\n<ol>\n<li>\n<p>After <code>fdb_future_destroy</code> returns in thread <code>T1</code>, the callback would <em>not</em> get executed in any threads.</p>\n<p>Given the above comment (which I might be misunderstanding), this is unlikely, but I want to confirm anyway. <img src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<p>Basically if I have the guarantee, callback will not get executed after <code>fdb_future_destroy</code> has been called, then I can deal with memory backing <code>callback_parameter</code>  in <code>T1</code> cleanly after <code>fdb_future_destroy</code> has been called.</p>\n</li>\n<li>\n<p>The above comment seems to hint (again, I could be wrong), that calling <code>fdb_future_destroy</code> <em>will</em> cause the callback to run either in <code>T1</code> or the network thread.</p>\n<p>This approach seems to indicate a design where once <code>fdb_future_set_callback</code> has been called, we are guaranteed to get a callback <em>irrespective</em> of whether the future gets prematurely destroyed or successfully resolves.</p>\n<p>During normal execution, when the future resolves, the callback will get executed. However, if <code>fdb_future_destroy</code> gets called, <em>before</em> the callback has had a chance to get called, we would <em>still</em> get a callback.</p>\n<p>For most futures, <code>fdb_transaction_destroy</code> will implicitly call <code>fdb_future_destroy</code> hence trigger the callback, if it hasn\u2019t already been triggered.</p>\n<p><em>However</em>, in case of watch future, after the transaction has been committed, this link between <code>fdb_transaction_destroy</code> and <code>fdb_future_destroy</code> is severed. So, after the transaction has been committed, the only way to trigger the watch future callback would be if - <code>fdb_future_destroy</code> gets called, <em>or</em> if the watch future resolves.</p>\n</li>\n</ol>\n<p>Am I understanding the semantics of callback correctly? Please let me know if there are any other edge cases, that I might not be thinking about.</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 3,
        "updated_at": "2021-12-26T02:58:41.681Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 32,
        "reads": 15,
        "readers_count": 14,
        "score": 163.0,
        "yours": false,
        "topic_id": 3092,
        "topic_slug": "semantics-of-fdb-future-set-callback",
        "display_username": "Rajiv M Ranganath",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 3,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://forums.foundationdb.org/t/does-fdb-future-set-callback-guarantee-exactly-once-execution/1498/3",
            "internal": true,
            "reflection": false,
            "title": "Does `fdb_future_set_callback` guarantee exactly-once execution?",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 946,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/semantics-of-fdb-future-set-callback/3092/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 10515,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2022-01-04T18:39:26.242Z",
        "cooked": "<blockquote>\n<p>The above comment seems to hint (again, I could be wrong), that calling <code>fdb_future_destroy</code> <em>will</em> cause the callback to run either in <code>T1</code> or the network thread.</p>\n</blockquote>\n<p>Calling <code>fdb_future_destroy</code> on an uncompleted future should result in it being completed with an error, and you would get a callback for that. This callback comes from the network thread and could come at some point later after your destroy call returns. If the future is already completed, then destroying it wouldn\u2019t trigger another callback.</p>\n<blockquote>\n<p>This approach seems to indicate a design where once <code>fdb_future_set_callback</code> has been called, we are guaranteed to get a callback <em>irrespective</em> of whether the future gets prematurely destroyed or successfully resolves.</p>\n</blockquote>\n<p>This is true if it completes normally or you destroy it, but if neither happens it may never get called.</p>\n<blockquote>\n<p>For most futures, <code>fdb_transaction_destroy</code> will implicitly call <code>fdb_future_destroy</code> hence trigger the callback, if it hasn\u2019t already been triggered.</p>\n</blockquote>\n<p>Destroying a transaction doesn\u2019t destroy the futures, but it does fail many types of operations that were performed on that transaction. For example, I believe if you destroy a transaction it would fail any outstanding read requests, and that would result in your read callbacks being called with an error. For watches, destroying the transaction doesn\u2019t cancel the watch and so the future is left open.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 3,
        "updated_at": "2022-01-04T18:39:26.242Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 10,
        "readers_count": 9,
        "score": 7.0,
        "yours": false,
        "topic_id": 3092,
        "topic_slug": "semantics-of-fdb-future-set-callback",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/semantics-of-fdb-future-set-callback/3092/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 10522,
        "name": "Rajiv M Ranganath",
        "username": "rajivr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png",
        "created_at": "2022-01-05T00:29:17.265Z",
        "cooked": "<p>Thanks <a class=\"mention\" href=\"/u/ajbeamon\">@ajbeamon</a> for the reply! <img src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=10\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"></p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 3,
        "updated_at": "2022-01-05T00:29:17.265Z",
        "reply_count": 0,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 6,
        "readers_count": 5,
        "score": 1.2,
        "yours": false,
        "topic_id": 3092,
        "topic_slug": "semantics-of-fdb-future-set-callback",
        "display_username": "Rajiv M Ranganath",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 12,
          "username": "ajbeamon",
          "name": "A.J. Beamon",
          "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 946,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/semantics-of-fdb-future-set-callback/3092/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      10489,
      10515,
      10522
    ]
  },
  "timeline_lookup": [
    [
      1,
      1396
    ],
    [
      2,
      1386
    ]
  ],
  "suggested_topics": [],
  "tags": [
    "bindings"
  ],
  "tags_descriptions": {},
  "fancy_title": "Semantics of `fdb_future_set_callback`",
  "id": 3092,
  "title": "Semantics of `fdb_future_set_callback`",
  "posts_count": 3,
  "created_at": "2021-12-26T02:45:56.586Z",
  "views": 422,
  "reply_count": 1,
  "like_count": 0,
  "last_posted_at": "2022-01-05T00:29:17.265Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "semantics-of-fdb-future-set-callback",
  "category_id": 5,
  "word_count": 617,
  "deleted_at": null,
  "user_id": 946,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_3092",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 3,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Does `fdb_future_set_callback` guarantee exactly-once execution?",
      "id": 1498,
      "title": "Does `fdb_future_set_callback` guarantee exactly-once execution?",
      "slug": "does-fdb-future-set-callback-guarantee-exactly-once-execution",
      "posts_count": 4,
      "reply_count": 2,
      "highest_post_number": 4,
      "image_url": null,
      "created_at": "2019-06-28T17:08:44.095Z",
      "last_posted_at": "2019-06-28T20:32:03.679Z",
      "bumped": true,
      "bumped_at": "2019-06-28T20:32:03.679Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 1003,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 251,
            "username": "George",
            "name": "",
            "avatar_template": "/user_avatar/forums.foundationdb.org/george/{size}/620_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 15,
            "username": "markus.pilman",
            "name": "Markus Pilman",
            "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "What is the life time of key, value and other arguments passed to fdb_transaction_*",
      "id": 516,
      "title": "What is the life time of key, value and other arguments passed to fdb_transaction_*",
      "slug": "what-is-the-life-time-of-key-value-and-other-arguments-passed-to-fdb-transaction",
      "posts_count": 11,
      "reply_count": 4,
      "highest_post_number": 11,
      "image_url": null,
      "created_at": "2018-06-18T18:28:57.904Z",
      "last_posted_at": "2018-07-17T16:11:21.242Z",
      "bumped": true,
      "bumped_at": "2018-07-17T16:11:21.242Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "bindings"
      ],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 2608,
      "category_id": 5,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 308,
            "username": "ananthakumaran",
            "name": "Anantha Kumaran",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ananthakumaran/{size}/526_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 22,
            "username": "dave",
            "name": "David Scherer",
            "avatar_template": "/user_avatar/forums.foundationdb.org/dave/{size}/89_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Destroying futures after &lsquo;fdb_transaction_on_error()&rsquo;",
      "id": 1307,
      "title": "Destroying futures after 'fdb_transaction_on_error()'",
      "slug": "destroying-futures-after-fdb-transaction-on-error",
      "posts_count": 9,
      "reply_count": 1,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2019-04-16T13:33:52.150Z",
      "last_posted_at": "2019-04-24T18:38:45.358Z",
      "bumped": true,
      "bumped_at": "2019-04-24T18:38:45.358Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1428,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 419,
            "username": "doublemax",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/d/8e7dd6/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 15,
            "username": "markus.pilman",
            "name": "Markus Pilman",
            "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Question regarding WATCH future",
      "id": 3062,
      "title": "Question regarding WATCH future",
      "slug": "question-regarding-watch-future",
      "posts_count": 8,
      "reply_count": 6,
      "highest_post_number": 8,
      "image_url": null,
      "created_at": "2021-12-07T14:34:46.115Z",
      "last_posted_at": "2021-12-10T01:10:12.437Z",
      "bumped": true,
      "bumped_at": "2021-12-10T01:10:12.437Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "bindings"
      ],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 480,
      "category_id": 5,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 946,
            "username": "rajivr",
            "name": "Rajiv M Ranganath",
            "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "`fdb_future_block_until_ready` and retry logic",
      "id": 2826,
      "title": "`fdb_future_block_until_ready` and retry logic",
      "slug": "fdb-future-block-until-ready-and-retry-logic",
      "posts_count": 17,
      "reply_count": 14,
      "highest_post_number": 17,
      "image_url": null,
      "created_at": "2021-07-29T16:11:47.961Z",
      "last_posted_at": "2021-09-02T13:29:20.517Z",
      "bumped": true,
      "bumped_at": "2021-09-02T13:29:20.517Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "bindings"
      ],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 1009,
      "category_id": 5,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 946,
            "username": "rajivr",
            "name": "Rajiv M Ranganath",
            "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 14,
            "username": "andrew.noyes",
            "name": "",
            "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 946,
        "username": "rajivr",
        "name": "Rajiv M Ranganath",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png",
        "post_count": 2,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 12,
        "username": "ajbeamon",
        "name": "A.J. Beamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      }
    ],
    "created_by": {
      "id": 946,
      "username": "rajivr",
      "name": "Rajiv M Ranganath",
      "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png"
    },
    "last_poster": {
      "id": 946,
      "username": "rajivr",
      "name": "Rajiv M Ranganath",
      "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png"
    }
  },
  "bookmarks": []
}