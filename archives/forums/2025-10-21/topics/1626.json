{
  "post_stream": {
    "posts": [
      {
        "id": 5061,
        "name": "Leo Hu",
        "username": "lehu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
        "created_at": "2019-09-12T21:07:32.863Z",
        "cooked": "<p>I am doing resiliency tests. Two days ago I brought down 3 nodes and then added 3 nodes back in a batch. Both the removal and the addition ops worked fine. However, FDB got stuck when I repeated similar ops later.</p>\n<p>Yesterday I brought down 4 nodes, and data were redistributed.The system was fine. Then today I added 4 nodes back in a batch using a script. Data distribution started. For about 25min, the new 4 nodes got about 10GB of increased disk usage. Then suddenly FDB stopped the data movement for the 4 new nodes. See charter below.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://global.discourse-cdn.com/foundationdb/original/1X/815326e64932cc0dc6e18ad7f6e12f922e059ce8.png\" data-download-href=\"/uploads/short-url/is3Kfk8ajhxtdhmfnpZTwvNTyPe.png?dl=1\" title=\"image.png\" rel=\"nofollow noopener\"><img src=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/815326e64932cc0dc6e18ad7f6e12f922e059ce8_2_690x283.png\" alt=\"image\" data-base62-sha1=\"is3Kfk8ajhxtdhmfnpZTwvNTyPe\" width=\"690\" height=\"283\" srcset=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/815326e64932cc0dc6e18ad7f6e12f922e059ce8_2_690x283.png, https://global.discourse-cdn.com/foundationdb/optimized/1X/815326e64932cc0dc6e18ad7f6e12f922e059ce8_2_1035x424.png 1.5x, https://global.discourse-cdn.com/foundationdb/original/1X/815326e64932cc0dc6e18ad7f6e12f922e059ce8.png 2x\" data-small-upload=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/815326e64932cc0dc6e18ad7f6e12f922e059ce8_2_10x10.png\"><div class=\"meta\">\n<svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use xlink:href=\"#far-image\"></use></svg><span class=\"filename\">image.png</span><span class=\"informations\">1236\u00d7508 40.3 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use xlink:href=\"#discourse-expand\"></use></svg>\n</div></a></div></p>\n<p>Other storage nodes have 210GB disk usage on average. The 4 new nodes only get 10GB, and DD has not moved data for last 4 hours.</p>\n<p>What can cause this? How can I debug this situation? How to restart DD?</p>\n<p>Thank you.</p>\n<p>Leo</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-09-12T21:07:32.863Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 336,
        "reads": 83,
        "readers_count": 82,
        "score": 1696.6,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "Leo Hu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://global.discourse-cdn.com/foundationdb/original/1X/815326e64932cc0dc6e18ad7f6e12f922e059ce8.png",
            "internal": false,
            "reflection": false,
            "title": "815326e64932cc0dc6e18ad7f6e12f922e059ce8.png",
            "clicks": 0
          },
          {
            "url": "https://forums.foundationdb.org/t/storage-servers-95-full-how-to-recover/2315",
            "internal": true,
            "reflection": true,
            "title": "Storage servers 95% full - how to recover",
            "clicks": 1
          },
          {
            "url": "https://forums.foundationdb.org/t/storage-server-running-out-of-space/1655/2",
            "internal": true,
            "reflection": true,
            "title": "Storage server running out of space",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 643,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 5063,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2019-09-12T21:47:40.678Z",
        "cooked": "<p>What version are you running?</p>\n<p>There is one known issue where DD rebalancing stops making progress until it gets restarted. See <a href=\"https://github.com/apple/foundationdb/issues/1884\" rel=\"nofollow noopener\">https://github.com/apple/foundationdb/issues/1884</a>.</p>\n<p>There are also various other fixes in 6.1 and the to-be-released 6.2 that could affect data balance.</p>\n<p>My suggestion would be to first test whether restarting data distribution helps by restarting the process running the data distributor role, or if you are on an old version the process running the master role. If you wanted, you could also just restart every process in the cluster by executing something like <code>kill; kill all; status</code> in <code>fdbcli</code>.</p>\n<p>Hopefully the result of restarting data distribution is that the cluster will make more progress towards being balanced, but if not then there may be another issue involved.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-09-12T21:47:40.678Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 13,
        "reads": 81,
        "readers_count": 80,
        "score": 86.2,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/issues/1884",
            "internal": false,
            "reflection": false,
            "title": "Data distribution rebalancing sometimes stops in an unbalanced state \u00b7 Issue #1884 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 30
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 5064,
        "name": "Leo Hu",
        "username": "lehu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
        "created_at": "2019-09-12T23:21:41.764Z",
        "cooked": "<p>Hi AJ, we are using V6.0.15. I located the Master process and restarted it. I am happy to report it\u2019s moving again!</p>\n<p>I appreciate your prompt assistance. It\u2019s a big help!</p>\n<p>Leo</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-09-12T23:21:41.764Z",
        "reply_count": 0,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 79,
        "readers_count": 78,
        "score": 15.8,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "Leo Hu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 12,
          "username": "ajbeamon",
          "name": "A.J. Beamon",
          "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 643,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 5067,
        "name": "Leo Hu",
        "username": "lehu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
        "created_at": "2019-09-13T16:10:00.993Z",
        "cooked": "<p>Oops, we encountered another issue with data distribution: unevenness among nodes.</p>\n<p>I restarted DD at 15:45 yesterday, it went on and moved data for near 3 hours. t 18:45 Moving-data-in-flight was 0.</p>\n<p>At 22:00 I saw DD stopped, but found the data distribution was still not even. I tried to restart DD multiple times, each time DD only moved a tiny bit and then stopped.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://global.discourse-cdn.com/foundationdb/original/1X/42533046bd8f9ce725be80ecdb834607b0cd7bb2.png\" data-download-href=\"/uploads/short-url/9sJK70BufxA8x72EvOP25KQSjT4.png?dl=1\" title=\"image.png\" rel=\"nofollow noopener\"><img src=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/42533046bd8f9ce725be80ecdb834607b0cd7bb2_2_690x271.png\" alt=\"image\" data-base62-sha1=\"9sJK70BufxA8x72EvOP25KQSjT4\" width=\"690\" height=\"271\" srcset=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/42533046bd8f9ce725be80ecdb834607b0cd7bb2_2_690x271.png, https://global.discourse-cdn.com/foundationdb/optimized/1X/42533046bd8f9ce725be80ecdb834607b0cd7bb2_2_1035x406.png 1.5x, https://global.discourse-cdn.com/foundationdb/original/1X/42533046bd8f9ce725be80ecdb834607b0cd7bb2.png 2x\" data-small-upload=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/42533046bd8f9ce725be80ecdb834607b0cd7bb2_2_10x10.png\"><div class=\"meta\">\n<svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use xlink:href=\"#far-image\"></use></svg><span class=\"filename\">image.png</span><span class=\"informations\">1172\u00d7462 35.8 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use xlink:href=\"#discourse-expand\"></use></svg>\n</div></a></div></p>\n<p>Jun and I noticed yesterday afternoon that the data distribution was not even among nodes, by calculating the disk usage percentage of each node. Last night he was able to construct a graph showing the historical data distribution evenness among nodes, out of our Prometheus metrics data depository.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://global.discourse-cdn.com/foundationdb/original/1X/f7abf5ff108d62bf2c9d5e621ad1ebdd61812342.png\" data-download-href=\"/uploads/short-url/zl0miZAQOm0BymsXLcZ5OacFKOS.png?dl=1\" title=\"Screen Shot 2019-09-13 at 12.05.26 AM.png\" rel=\"nofollow noopener\"><img src=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/f7abf5ff108d62bf2c9d5e621ad1ebdd61812342_2_690x134.png\" alt=\"26%20AM\" data-base62-sha1=\"zl0miZAQOm0BymsXLcZ5OacFKOS\" width=\"690\" height=\"134\" srcset=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/f7abf5ff108d62bf2c9d5e621ad1ebdd61812342_2_690x134.png, https://global.discourse-cdn.com/foundationdb/optimized/1X/f7abf5ff108d62bf2c9d5e621ad1ebdd61812342_2_1035x201.png 1.5x, https://global.discourse-cdn.com/foundationdb/optimized/1X/f7abf5ff108d62bf2c9d5e621ad1ebdd61812342_2_1380x268.png 2x\" data-small-upload=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/f7abf5ff108d62bf2c9d5e621ad1ebdd61812342_2_10x10.png\"><div class=\"meta\">\n<svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use xlink:href=\"#far-image\"></use></svg><span class=\"filename\">Screen Shot 2019-09-13 at 12.05.26 AM.png</span><span class=\"informations\">2178\u00d7426 112 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use xlink:href=\"#discourse-expand\"></use></svg>\n</div></a></div></p>\n<p>He described the graph as follows:<br>\n\u201cYou can clearly see that after data loading, we have very uniform distribution. Then in the middle of the week, rebalancing is also pretty good. After that, it starts to getting worst and worst.\u201d</p>\n<p>It seems that data distribution unevenness worsened and fanned out as we removed and added nodes with our resilience tests.</p>\n<p>Is this an issue with FDB v6.0.15 we are using? Has it been addressed and improved at a later version?  Thanks.</p>\n<p>Leo</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-09-13T16:10:00.993Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 6,
        "reads": 76,
        "readers_count": 75,
        "score": 50.2,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "Leo Hu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://global.discourse-cdn.com/foundationdb/original/1X/42533046bd8f9ce725be80ecdb834607b0cd7bb2.png",
            "internal": false,
            "reflection": false,
            "title": "42533046bd8f9ce725be80ecdb834607b0cd7bb2.png",
            "clicks": 0
          },
          {
            "url": "https://global.discourse-cdn.com/foundationdb/original/1X/f7abf5ff108d62bf2c9d5e621ad1ebdd61812342.png",
            "internal": false,
            "reflection": false,
            "title": "f7abf5ff108d62bf2c9d5e621ad1ebdd61812342.png",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 643,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/4",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 5076,
        "name": "Leo Hu",
        "username": "lehu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
        "created_at": "2019-09-17T01:49:21.279Z",
        "cooked": "<p>Over the weekend, FDB had worked and the cluster data distribution uniformity converged and became quiet even, without any actions from us. Then today, after we removed and added some nodes, the distribution diverged again. Here is the charter for last 3 days.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://global.discourse-cdn.com/foundationdb/original/1X/5393760fe6dbab688eb586a6eb0243b16c982c00.png\" data-download-href=\"/uploads/short-url/bVlyYFbzYNsfMCOgFhHCeLQWgzS.png?dl=1\" title=\"Screen Shot 2019-09-16 at 6.25.58 PM.png\" rel=\"nofollow noopener\"><img src=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/5393760fe6dbab688eb586a6eb0243b16c982c00_2_690x299.png\" alt=\"58%20PM\" data-base62-sha1=\"bVlyYFbzYNsfMCOgFhHCeLQWgzS\" width=\"690\" height=\"299\" srcset=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/5393760fe6dbab688eb586a6eb0243b16c982c00_2_690x299.png, https://global.discourse-cdn.com/foundationdb/optimized/1X/5393760fe6dbab688eb586a6eb0243b16c982c00_2_1035x448.png 1.5x, https://global.discourse-cdn.com/foundationdb/optimized/1X/5393760fe6dbab688eb586a6eb0243b16c982c00_2_1380x598.png 2x\" data-small-upload=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/5393760fe6dbab688eb586a6eb0243b16c982c00_2_10x10.png\"><div class=\"meta\">\n<svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use xlink:href=\"#far-image\"></use></svg><span class=\"filename\">Screen Shot 2019-09-16 at 6.25.58 PM.png</span><span class=\"informations\">1880\u00d7816 155 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use xlink:href=\"#discourse-expand\"></use></svg>\n</div></a></div></p>\n<p>This behavior is a big concern for us to go production soon. Please advise on the following:</p>\n<ul>\n<li>We don\u2019t know how long it takes for DD to converge. Do you have prior data regarding the timing?</li>\n<li>In the issue ticket <span class=\"hashtag\">#1884</span> mentioned above, \u201chgray1 added this to the 7.0 milestone on Jul 29\u201d. That\u2019s too far for us. Do you have other suggestions for us to deal with the problem?</li>\n<li>What are relevant changes for DD in V6.1 and V6.2? When will V6.2 be out? Should we upgrade? What can an upgrade make?</li>\n</ul>\n<p>Thank you.</p>\n<p>Leo</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-09-17T01:49:21.279Z",
        "reply_count": 1,
        "reply_to_post_number": 4,
        "quote_count": 0,
        "incoming_link_count": 8,
        "reads": 61,
        "readers_count": 60,
        "score": 57.2,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "Leo Hu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://global.discourse-cdn.com/foundationdb/original/1X/5393760fe6dbab688eb586a6eb0243b16c982c00.png",
            "internal": false,
            "reflection": false,
            "title": "5393760fe6dbab688eb586a6eb0243b16c982c00.png",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 643,
          "username": "lehu",
          "name": "Leo Hu",
          "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 643,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/5",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 5077,
        "name": "Alex Miller",
        "username": "alexmiller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "created_at": "2019-09-17T02:11:52.040Z",
        "cooked": "<aside class=\"quote no-group quote-modified\" data-username=\"lehu\" data-post=\"5\" data-topic=\"1626\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/lehu/48/995_2.png\" class=\"avatar\"> lehu:</div>\n<blockquote>\n<p>Here is the chart for last 3 days.</p>\n</blockquote>\n</aside>\n<p>From the Y-axis, I\u2019m guessing that this is a chart of disk fullness?</p>\n<p>Part of data distribution working means that it\u2019s going to shuffle data around, and some of that will cause sqlite files to grow on disk, and then be trimmed down over time.  The amount of data each storage server is responsible for will converge much quicker than that.</p>\n<p>My vague memory is that we had a similar conversation about this before, but I can\u2019t seem to find it on the forums.  The changes that I recall discussing back then made it into 6.1.  To quote from the 6.1 release notes:</p>\n<blockquote>\n<ul>\n<li>Increase the rate that deleted pages are made available for reuse in the SQLite storage engine.  Rename and add knobs to provide more control over this process. [6.1.3] <a href=\"https://github.com/apple/foundationdb/pull/1485\">(PR #1485)</a></li>\n<li>SQLite page files now grow and shrink in chunks based on a knob which defaults to an effective chunk size of 100MB. [6.1.4] <a href=\"https://github.com/apple/foundationdb/pull/1482\">(PR #1482)</a> <a href=\"https://github.com/apple/foundationdb/pull/1499\">(PR #1499)</a></li>\n</ul>\n</blockquote>\n<p>So upgrading to 6.1 would also get your storage servers to clean up their disk space 10x faster, or you could set <code>--knob_cleaning_inerval=0.1</code> to see if this helps now on 6.0, but 6.1 turns what this knob controls out into two values, and sets the default lazy cleanup rate higher, so running 6.1 would be preferable.  Either should probably make this particular graph look better.</p>\n<aside class=\"quote no-group\" data-username=\"lehu\" data-post=\"5\" data-topic=\"1626\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/lehu/48/995_2.png\" class=\"avatar\"> lehu:</div>\n<blockquote>\n<ul>\n<li>In the issue ticket <span class=\"hashtag-raw\">#1884</span> mentioned above, \u201chgray1 added this to the 7.0 milestone on Jul 29\u201d. That\u2019s too far for us. Do you have other suggestions for us to deal with the problem?</li>\n</ul>\n</blockquote>\n</aside>\n<p>The graph you\u2019ve shown doesn\u2019t look like data distribution being stuck.  If you see this stop making progress, and then immediately start to make progress if you restart the data distribution process, then that would be what this issue is about.</p>\n<p>This issue isn\u2019t also about trying to minimize how much the file sizes on existing hosts might increase when you add new servers.  It\u2019s known behavior that happen, and is done somewhat intentionally as we prioritize hosting data on the most diverse set of servers over minimizing the total amount of data movement that will happen.  (But work could probably be done in the future to do less movement, or do it more carefully.)</p>\n<aside class=\"quote no-group\" data-username=\"lehu\" data-post=\"5\" data-topic=\"1626\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/lehu/48/995_2.png\" class=\"avatar\"> lehu:</div>\n<blockquote>\n<ul>\n<li>What are relevant changes for DD in V6.1 and V6.2? When will V6.2 be out? Should we upgrade? What can an upgrade make?</li>\n</ul>\n</blockquote>\n</aside>\n<p>There are release notes published for each release summarizing most changes.  The release notes for 6.1 are <a href=\"https://apple.github.io/foundationdb/release-notes.html?highlight=release%20notes\">published in the documentation</a>, whereas for 6.2 they\u2019re only <a href=\"https://github.com/apple/foundationdb/blob/master/documentation/sphinx/source/old-release-notes/release-notes-620.rst#release-notes\">in the code</a> right now, as we haven\u2019t marked a 6.2 patch release as stable and updated the website yet.</p>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-09-17T02:18:11.741Z",
        "reply_count": 1,
        "reply_to_post_number": 5,
        "quote_count": 1,
        "incoming_link_count": 4,
        "reads": 61,
        "readers_count": 60,
        "score": 37.2,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "Alex Miller",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://apple.github.io/foundationdb/release-notes.html?highlight=release%20notes",
            "internal": false,
            "reflection": false,
            "title": "Release Notes \u2014 FoundationDB 6.1",
            "clicks": 2
          },
          {
            "url": "https://github.com/apple/foundationdb/pull/1499",
            "internal": false,
            "reflection": false,
            "title": "Some small improvements by etschannen \u00b7 Pull Request #1499 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 1
          },
          {
            "url": "https://github.com/apple/foundationdb/pull/1482",
            "internal": false,
            "reflection": false,
            "clicks": 1
          },
          {
            "url": "https://github.com/apple/foundationdb/blob/master/documentation/sphinx/source/old-release-notes/release-notes-620.rst#release-notes",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/release-notes-620.rst at master \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 1
          },
          {
            "url": "https://github.com/apple/foundationdb/pull/1485",
            "internal": false,
            "reflection": false,
            "title": "Increase the frequency that lazy deletes are run. Add more parameters\u2026 by ajbeamon \u00b7 Pull Request #1485 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 1
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 13,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/6",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 5079,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2019-09-17T21:35:18.121Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"alexmiller\" data-post=\"6\" data-topic=\"1626\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/alexmiller/48/326_2.png\" class=\"avatar\"> alexmiller:</div>\n<blockquote>\n<p>From the Y-axis, I\u2019m guessing that this is a chart of disk fullness?</p>\n<p>Part of data distribution working means that it\u2019s going to shuffle data around, and some of that will cause sqlite files to grow on disk, and then be trimmed down over time. The amount of data each storage server is responsible for will converge much quicker than that.</p>\n</blockquote>\n</aside>\n<p>The value that data distribution is trying to balance and which should be converging more quickly is the logical bytes stored on each storage server, and that can be obtained from the trace logs by looking at the <code>BytesStored</code> field in the <code>StorageMetrics</code> event. It can also be obtained from JSON status by looking at <code>cluster.processes[&lt;id&gt;].roles[&lt;i&gt;].stored_bytes</code> for any role where <code>cluster.processes[&lt;id&gt;].roles[&lt;i&gt;].role</code> is <code>storage</code>.</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-09-17T21:35:18.121Z",
        "reply_count": 0,
        "reply_to_post_number": 6,
        "quote_count": 1,
        "incoming_link_count": 1,
        "reads": 49,
        "readers_count": 48,
        "score": 29.8,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/7",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 5094,
        "name": "Leo Hu",
        "username": "lehu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
        "created_at": "2019-09-19T21:23:18.181Z",
        "cooked": "<p>Hi Alex,<br>\nThank you for the insight.  Yes, the Y-axis is disk fullness in percentage.</p>\n<p>How do I set knob_cleaning_inerval in v6.0?</p>\n<p>We may consider to upgrade. Since v6.2 is now in pre-release, we may take a look to upgrade to v6.2 as well if timing is right. Do you have any estimated time for its general release?  If the release time changes in the future, I wont hold you accountable. <img src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=9\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"> Just for planning.</p>\n<p>AJ,<br>\nWe will try to pull the logical bytes into our dashboard. Thanks for the info.</p>\n<p>Leo</p>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-09-19T21:23:18.181Z",
        "reply_count": 2,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 46,
        "readers_count": 45,
        "score": 19.2,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "Leo Hu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 643,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/8",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 5096,
        "name": "Leo Hu",
        "username": "lehu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
        "created_at": "2019-09-19T21:28:59.966Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"lehu\" data-post=\"8\" data-topic=\"1626\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/lehu/48/995_2.png\" class=\"avatar\"> lehu:</div>\n<blockquote>\n<p>the Y-axis is disk fullness in percentage</p>\n</blockquote>\n</aside>\n<p>In the FIRST data distribution charter above, the disk fullness was expressed in decimal, from 0 to 1. For example, 0.7 is 70%.</p>\n<p>In the SECOND data distribution charter, we converted it to true percentage, where 70 is 70%.</p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-09-19T21:28:59.966Z",
        "reply_count": 0,
        "reply_to_post_number": 8,
        "quote_count": 1,
        "incoming_link_count": 2,
        "reads": 46,
        "readers_count": 45,
        "score": 19.2,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "Leo Hu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 643,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/9",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 5097,
        "name": "Alex Miller",
        "username": "alexmiller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "created_at": "2019-09-19T21:30:28.761Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"lehu\" data-post=\"8\" data-topic=\"1626\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/lehu/48/995_2.png\" class=\"avatar\"> lehu:</div>\n<blockquote>\n<p>How do I set knob_cleaning_inerval in v6.0?</p>\n</blockquote>\n</aside>\n<p>You pass <code>--knob_cleaning_interval=0.1</code> on the command line to your fdbserver processes.</p>\n<aside class=\"quote no-group\" data-username=\"lehu\" data-post=\"8\" data-topic=\"1626\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/lehu/48/995_2.png\" class=\"avatar\"> lehu:</div>\n<blockquote>\n<p>Do you have any estimated time for its general release?</p>\n</blockquote>\n</aside>\n<p>O(weeks), and probably a small number of weeks.  The last phases of internal validation of the release is being done before offering it for public download.</p>",
        "post_number": 10,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-09-19T21:32:28.657Z",
        "reply_count": 1,
        "reply_to_post_number": 8,
        "quote_count": 1,
        "incoming_link_count": 0,
        "reads": 47,
        "readers_count": 46,
        "score": 14.4,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "Alex Miller",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 13,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/10",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 5102,
        "name": "Leo Hu",
        "username": "lehu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
        "created_at": "2019-09-19T21:57:54.700Z",
        "cooked": "<p>Alex, got it. Nice to know v6.2 is coming out soon. Thank you. \u2013 Leo</p>",
        "post_number": 11,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-09-19T21:57:54.700Z",
        "reply_count": 0,
        "reply_to_post_number": 10,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 47,
        "readers_count": 46,
        "score": 24.4,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "Leo Hu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 13,
          "username": "alexmiller",
          "name": "Alex Miller",
          "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 643,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/11",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 5112,
        "name": "Ray Jenkins",
        "username": "rjenkins",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png",
        "created_at": "2019-09-20T02:24:17.974Z",
        "cooked": "<p>Hi Folks,</p>\n<p>Just wanted to share our experience with <code>--knob_cleaning_interval=0.1</code> over here at Segment. We\u2019re currently running 6.0.18 and ran into similar issues earlier this year. We saw some cases of uneven distribution as well, but the biggest problem we were facing was relatively long periods, (generally 6 days) to reclaim space on storage nodes after adding capacity to the cluster. I\u2019m pleased to report the <code>--knob_cleaning_interval</code> changes were very helpful.</p>\n<p>Below is an example of adding 3 storage nodes on April 27th and taking well into May 3rd/4th to reclaim space.</p>\n<p><img src=\"https://global.discourse-cdn.com/foundationdb/original/1X/ded4b33af9d3af27a66f65b1fdaf28fc8d3ef4d6.png\" alt=\"Screenshot%20from%202019-09-19%2021-09-08\" data-base62-sha1=\"vNfHNb7CITuM7Ui6ek7wx12ENJI\" width=\"598\" height=\"299\"></p>\n<p>After adding <code>--knob_cleaning_interval=0.1</code> we observed much faster space reclaiming of disk space.</p>\n<p>Below is an example of 2 separate events where we of added several storage nodes, reclaiming disk space across the storage tier now completes in hours vs. days.</p>\n<p><img src=\"https://global.discourse-cdn.com/foundationdb/original/1X/dbb2a99ce070a15fa07fcde883125ad6f5e9fedf.png\" alt=\"Screenshot%20from%202019-09-19%2021-09-56\" data-base62-sha1=\"vlxlCHanWj8rcALAzgMhTAOaM2j\" width=\"598\" height=\"302\"></p>\n<p>We add the flag directly in the <code>/etc/foundationdb/foundationdb.conf</code> file as follows</p>\n<p>command = /usr/sbin/fdbserver --knob_cleaning_interval=0.1.</p>\n<p>-Ray</p>",
        "post_number": 12,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-09-20T02:24:17.974Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 4,
        "reads": 50,
        "readers_count": 49,
        "score": 110.0,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "Ray Jenkins",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 3
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 490,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/12",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 5138,
        "name": "Leo Hu",
        "username": "lehu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
        "created_at": "2019-09-23T20:37:47.204Z",
        "cooked": "<p>Hi Ray, thanks for sharing your experience. It\u2019s nice to know your solution worked! \u2013 Leo</p>",
        "post_number": 13,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-09-23T20:37:47.204Z",
        "reply_count": 0,
        "reply_to_post_number": 12,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 51,
        "readers_count": 50,
        "score": 25.2,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "Leo Hu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 490,
          "username": "rjenkins",
          "name": "Ray Jenkins",
          "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png"
        },
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 643,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/13",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 5522,
        "name": "Ray Jenkins",
        "username": "rjenkins",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png",
        "created_at": "2019-11-12T19:57:18.277Z",
        "cooked": "<p>Hiya Folks,</p>\n<p>Following up on this, it appears we are also still hitting <a href=\"https://github.com/apple/foundationdb/issues/1884\" rel=\"nofollow noopener\">https://github.com/apple/foundationdb/issues/1884</a>. Based on our observations from our previous cluster expansion (^^see above) we thought our latest configuration and knob changes had resolved our data distribution and cleanup issues. However, last week we expanded our cluster and we are observing slow data distribution (relative to previous cluster expansions). To recap, on our last cluster expansion we added the <code>--knob_cleaning_interval=0.1</code> and are observing much quicker storage cleanup, this is great!. For whatever reason, on our last expansion data distribution progressed and reached equilibrium very quickly. On that previous expansion we added 6 new storage instances in 2 batches of 3 nodes.</p>\n<p>The following is a chart of the trace logs BytesStored  as we expanded the cluster, data distribution reached equilibrium, across all storage nodes, quite quickly.</p>\n<p><img src=\"https://global.discourse-cdn.com/foundationdb/original/1X/ead8d7e8945dc57ce3b98602259650b61d7b3038.png\" alt=\"Screenshot%20from%202019-11-12%2012-48-42\" data-base62-sha1=\"xvyjoPuiX88J2EAB0AAFspiXbe0\" width=\"599\" height=\"267\"></p>\n<p>We can also observe the trace logs, data in-flight, during this period.</p>\n<p><img src=\"https://global.discourse-cdn.com/foundationdb/original/1X/5fdec49b97125897f57b864bfb38bcd0ccfe950d.png\" alt=\"Screenshot%20from%202019-11-12%2012-52-35\" data-base62-sha1=\"dG6DyctSHI1hRwsaV2kfgYmHyPz\" width=\"621\" height=\"276\"></p>\n<p>As expected with the new cleaning interval setting we recovered disk space very quickly.</p>\n<p><img src=\"https://global.discourse-cdn.com/foundationdb/original/1X/403e923a484fea47cb295935ae9bceaf51fb87c4.png\" alt=\"Screenshot%20from%202019-11-12%2012-49-00\" data-base62-sha1=\"9akCd1fyVXC0b2HW5lBpjGjUsEQ\" width=\"599\" height=\"291\">.</p>\n<p>However, on this latest cluster expansion, reaching BytesStored equilibrium is taking weeks rather than hours. On 11/04/2019 we added 3 new storage nodes. From the 4th to the 5th approximately only 2GB of keyspace was allocated to the new nodes as visible by the BytesStored metric.</p>\n<p><img src=\"https://global.discourse-cdn.com/foundationdb/original/1X/0d6a3f902a01b36cf782574167d168c2f16425a8.png\" alt=\"Screenshot%20from%202019-11-12%2012-57-41\" data-base62-sha1=\"1UFQgCOjqmwS64dafPdtlSh2eCY\" width=\"599\" height=\"291\"></p>\n<p>One 11/5/2019 we restarted the fdbserver processes on the master node (per <a class=\"mention\" href=\"/u/ajbeamon\">@ajbeamon</a>\u2019s suggestion above) and data distribution started moving more aggressively again.  However after 2 hours distribution slowed down again.</p>\n<p><img src=\"https://global.discourse-cdn.com/foundationdb/original/1X/329e09f9e415be83f93d1c080820c2b11be3487f.png\" alt=\"Screenshot%20from%202019-11-12%2013-09-08\" data-base62-sha1=\"7dMtaq0WZpLPlXnMYLeoZ6cmWkL\" width=\"603\" height=\"294\"></p>\n<p><img src=\"https://global.discourse-cdn.com/foundationdb/original/1X/7cc961100abecf0c6e225a0172746bcf6d4e74d4.png\" alt=\"Screenshot%20from%202019-11-12%2013-09-29\" data-base62-sha1=\"hNUERSjLplDIprvFiDVaGNXXodm\" width=\"599\" height=\"292\">.</p>\n<p>Today we tried restarting the master process again to see if we could trigger an increase in BytesStored across the new nodes, but it has had no effect.</p>\n<p>We have noticed during periods of increased write volume from our applications, data distribution rates increase, this is good. However the unpredictability of distribution is somewhat problematic for us. Specifically, there are times we would prefer to scale out and achieve cluster storage equilibrium before we on-board new customers, as these customers can add significant read/write load to the system.</p>\n<p>During periods of data balancing we observe an increase in latency which can cause lag in processing. Therefore we would prefer to scale and reach equilibrium before we add more load to the cluster. Finally we have observed cluster-wide performance drop drastically when a storage node becomes full, so we\u2019d like to avoid that scenario. We could of course simply trust that the system will more aggressively distribute data when load is added, but that could cause back pressure and additional latency resulting in degradation of our services and we\u2019d like to avoid that if possible.</p>\n<p>It\u2019s not clear to us from the above if upgrading to 6.2 would provide any improvement or if those changes only relate to reclaiming disk space, which we\u2019ve addressed with the <code>knob_cleaning_interval</code> changes.</p>\n<p>Is there anything we can do to help gather data for <a href=\"https://github.com/apple/foundationdb/issues/1884\" rel=\"nofollow noopener\">https://github.com/apple/foundationdb/issues/1884</a>. cc: <a class=\"mention\" href=\"/u/rbranson\">@rbranson</a></p>",
        "post_number": 14,
        "post_type": 1,
        "posts_count": 14,
        "updated_at": "2019-11-12T19:57:18.277Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 9,
        "reads": 48,
        "readers_count": 47,
        "score": 54.6,
        "yours": false,
        "topic_id": 1626,
        "topic_slug": "data-distribution-stopped-how-to-restart",
        "display_username": "Ray Jenkins",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/issues/1884",
            "internal": false,
            "reflection": false,
            "title": "Data distribution rebalancing sometimes stops in an unbalanced state \u00b7 Issue #1884 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 23
          }
        ],
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 490,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/data-distribution-stopped-how-to-restart/1626/14",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      5061,
      5063,
      5064,
      5067,
      5076,
      5077,
      5079,
      5094,
      5096,
      5097,
      5102,
      5112,
      5138,
      5522
    ]
  },
  "timeline_lookup": [
    [
      1,
      2231
    ],
    [
      4,
      2230
    ],
    [
      5,
      2227
    ],
    [
      7,
      2226
    ],
    [
      8,
      2224
    ],
    [
      13,
      2220
    ],
    [
      14,
      2170
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Data Distribution Stopped - How to Restart?",
  "id": 1626,
  "title": "Data Distribution Stopped - How to Restart?",
  "posts_count": 14,
  "created_at": "2019-09-12T21:07:32.803Z",
  "views": 1877,
  "reply_count": 8,
  "like_count": 5,
  "last_posted_at": "2019-11-12T19:57:18.277Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "data-distribution-stopped-how-to-restart",
  "category_id": 7,
  "word_count": 2393,
  "deleted_at": null,
  "user_id": 643,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": "https://global.discourse-cdn.com/foundationdb/optimized/1X/815326e64932cc0dc6e18ad7f6e12f922e059ce8_2_1024x420.png",
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_1626",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 14,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 4,
  "show_read_indicator": false,
  "thumbnails": [
    {
      "max_width": null,
      "max_height": null,
      "width": 1236,
      "height": 508,
      "url": "https://global.discourse-cdn.com/foundationdb/original/1X/815326e64932cc0dc6e18ad7f6e12f922e059ce8.png"
    },
    {
      "max_width": 1024,
      "max_height": 1024,
      "width": 1024,
      "height": 420,
      "url": "https://global.discourse-cdn.com/foundationdb/optimized/1X/815326e64932cc0dc6e18ad7f6e12f922e059ce8_2_1024x420.png"
    }
  ],
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Data distribution / Disk usage uneven: bifurcated at 2 tiers",
      "id": 2270,
      "title": "Data distribution / Disk usage uneven: bifurcated at 2 tiers",
      "slug": "data-distribution-disk-usage-uneven-bifurcated-at-2-tiers",
      "posts_count": 7,
      "reply_count": 3,
      "highest_post_number": 7,
      "image_url": null,
      "created_at": "2020-08-02T03:47:59.558Z",
      "last_posted_at": "2020-08-06T06:17:39.778Z",
      "bumped": true,
      "bumped_at": "2020-08-06T06:17:39.778Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 537,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 643,
            "username": "lehu",
            "name": "Leo Hu",
            "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 741,
            "username": "sears",
            "name": "Russell Sears",
            "avatar_template": "/user_avatar/forums.foundationdb.org/sears/{size}/887_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 337,
            "username": "mengxu",
            "name": "Meng Xu",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Storage server running out of space",
      "id": 1655,
      "title": "Storage server running out of space",
      "slug": "storage-server-running-out-of-space",
      "posts_count": 17,
      "reply_count": 14,
      "highest_post_number": 17,
      "image_url": null,
      "created_at": "2019-09-28T02:44:46.227Z",
      "last_posted_at": "2019-10-02T20:48:03.731Z",
      "bumped": true,
      "bumped_at": "2019-10-02T20:48:03.731Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 4053,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 311,
            "username": "ThomasJ",
            "name": "Thomas Johson",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 612,
            "username": "fzhjon",
            "name": "Jon Fu",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/f/9d8465/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "How to speed up balancing?",
      "id": 1565,
      "title": "How to speed up balancing?",
      "slug": "how-to-speed-up-balancing",
      "posts_count": 12,
      "reply_count": 7,
      "highest_post_number": 12,
      "image_url": null,
      "created_at": "2019-08-06T08:49:50.107Z",
      "last_posted_at": "2019-08-21T00:41:02.788Z",
      "bumped": true,
      "bumped_at": "2019-08-21T00:41:02.788Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "performance"
      ],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1541,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 629,
            "username": "Sraw",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/s/a88e57/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 81,
            "username": "ryanworl",
            "name": "Ryan Worl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Unexpected repartitioning of the database",
      "id": 2225,
      "title": "Unexpected repartitioning of the database",
      "slug": "unexpected-repartitioning-of-the-database",
      "posts_count": 6,
      "reply_count": 3,
      "highest_post_number": 6,
      "image_url": null,
      "created_at": "2020-07-04T19:16:19.817Z",
      "last_posted_at": "2020-07-09T15:49:16.906Z",
      "bumped": true,
      "bumped_at": "2020-07-09T15:49:16.906Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "performance"
      ],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 1035,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 645,
            "username": "subramaniamr",
            "name": "Subramaniam R",
            "avatar_template": "/user_avatar/forums.foundationdb.org/subramaniamr/{size}/658_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 337,
            "username": "mengxu",
            "name": "Meng Xu",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "DD(data_distributor) process does not work in large clusters",
      "id": 3810,
      "title": "DD(data_distributor) process does not work in large clusters",
      "slug": "dd-data-distributor-process-does-not-work-in-large-clusters",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2023-02-15T14:22:51.248Z",
      "last_posted_at": "2023-05-05T10:30:40.203Z",
      "bumped": true,
      "bumped_at": "2023-05-05T10:30:40.203Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 422,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 1209,
            "username": "Felix-zhoux",
            "name": "Felix-zhoux",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/f/8797f3/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 1175,
            "username": "libo-sober",
            "name": "BoLee",
            "avatar_template": "/user_avatar/forums.foundationdb.org/libo-sober/{size}/1447_2.png",
            "trust_level": 1
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 643,
        "username": "lehu",
        "name": "Leo Hu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
        "post_count": 8,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      },
      {
        "id": 12,
        "username": "ajbeamon",
        "name": "A.J. Beamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "post_count": 2,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      },
      {
        "id": 13,
        "username": "alexmiller",
        "name": "Alex Miller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "post_count": 2,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 4
      },
      {
        "id": 490,
        "username": "rjenkins",
        "name": "Ray Jenkins",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png",
        "post_count": 2,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      }
    ],
    "created_by": {
      "id": 643,
      "username": "lehu",
      "name": "Leo Hu",
      "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png"
    },
    "last_poster": {
      "id": 490,
      "username": "rjenkins",
      "name": "Ray Jenkins",
      "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png"
    },
    "links": [
      {
        "url": "https://github.com/apple/foundationdb/issues/1884",
        "title": "Data distribution rebalancing sometimes stops in an unbalanced state \u00b7 Issue #1884 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 53,
        "user_id": 12,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://apple.github.io/foundationdb/release-notes.html?highlight=release%20notes",
        "title": "Release Notes \u2014 FoundationDB 6.1",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 2,
        "user_id": 13,
        "domain": "apple.github.io",
        "root_domain": "apple.github.io"
      },
      {
        "url": "https://forums.foundationdb.org/t/storage-servers-95-full-how-to-recover/2315",
        "title": "Storage servers 95% full - how to recover",
        "internal": true,
        "attachment": false,
        "reflection": true,
        "clicks": 1,
        "user_id": 737,
        "domain": "forums.foundationdb.org",
        "root_domain": "foundationdb.org"
      },
      {
        "url": "https://github.com/apple/foundationdb/blob/master/documentation/sphinx/source/old-release-notes/release-notes-620.rst#release-notes",
        "title": "foundationdb/release-notes-620.rst at master \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 1,
        "user_id": 13,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/apple/foundationdb/pull/1482",
        "title": null,
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 1,
        "user_id": 13,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/apple/foundationdb/pull/1485",
        "title": "Increase the frequency that lazy deletes are run. Add more parameters\u2026 by ajbeamon \u00b7 Pull Request #1485 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 1,
        "user_id": 13,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/apple/foundationdb/pull/1499",
        "title": "Some small improvements by etschannen \u00b7 Pull Request #1499 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 1,
        "user_id": 13,
        "domain": "github.com",
        "root_domain": "github.com"
      }
    ]
  },
  "bookmarks": []
}