{
  "post_stream": {
    "posts": [
      {
        "id": 7039,
        "name": "Steve Korshakov",
        "username": "ex3ndr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
        "created_at": "2020-05-21T03:47:18.379Z",
        "cooked": "<p>We are struggling to find a way and if it is even possible to do so.<br>\nWe want to be able to achieve 1000 parallel transactions each doing 1k reads with 500 bytes values each second.</p>\n<p>What we tried:</p>\n<ol>\n<li>Have multiple clients (1-100) for a single process</li>\n<li>Reusing Read Version</li>\n<li>Increase transactions, but reduce reads</li>\n<li>Using memory engine</li>\n</ol>\n<p>All is on development machine (MacBook Pro) on MacOS, but we are getting about the same performance in our cluster.</p>\n<p>We checked if our application is bottleneck and if FDB have high CPU/IOPS, but nothing is true - application is mostly idle waiting for responses and FDB is eating 5% at most.</p>\n<p>So, our results (number of clients x number of transactions x number of reads):</p>\n<ol>\n<li>1 x 100k x 1 ~ 3 sec (same with cached read version)</li>\n<li>1 x 1000 x 1000 - aborted</li>\n<li>1 x 1000 x 200 ~ 3 sec</li>\n<li>1 x 1000 x 400 ~ 6 sec (linear growth!)</li>\n<li>10 \u0445 1000 \u0445 100 ~ 125sec (why they are not timeouted?)</li>\n<li>100 \u0445 10 \u0445 1000 ~ 59sec (no timeout again)</li>\n<li>100 \u0445 100 \u0445 1000 + reuse read version ~ 174sec</li>\n</ol>\n<p>fdbcli shows usually ~30khz of reads at most.</p>\n<p>This is all are far from official documentation: <a href=\"https://apple.github.io/foundationdb/benchmarking.html\" rel=\"nofollow noopener\">https://apple.github.io/foundationdb/benchmarking.html</a></p>\n<p>Are we missing something?</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T03:47:18.379Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 458,
        "reads": 99,
        "readers_count": 98,
        "score": 2296.8,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Korshakov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://apple.github.io/foundationdb/benchmarking.html",
            "internal": false,
            "reflection": false,
            "title": "Benchmarking \u2014 FoundationDB 6.2",
            "clicks": 14
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 393,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 7040,
        "name": "Steve Atherton",
        "username": "SteavedHams",
        "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png",
        "created_at": "2020-05-21T04:23:57.415Z",
        "cooked": "<p>This is not enough information to know for certain what is going on, but here is one possibility:</p>\n<p>If your data set does not fit in cache, and your reads are random, then each 500 byte value you are trying to read exists in a different, uncached page of your storage engine files.  This would mean that a read rate of 30k key-value pairs per second is reading 30,000 different random disk pages per second.  Even though your values are only 500 bytes, those disk pages are 4k each, and so your disk is reading about 120 MBytes/s of random data.  That\u2019s probably about the limit of what your disk can do, which is why you are seeing low CPU usage - you are disk bound.</p>\n<p>Using a real cluster, with multiple storage engine processes to load balance across (requires replication of double or triple), you have more disks you can max out IOPs on, so you should be able to go faster.  If you are not, then you probably need to increase the parallelism of your read requests.</p>\n<p>You did not say how many client processes you are using, but you are trying to read 500 MBytes of key-value data per second so I can say with certainty that one process is too few.  You need multiple processes, and possibly multiple machines depending on network connectivity.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T04:23:57.415Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 12,
        "reads": 95,
        "readers_count": 94,
        "score": 94.0,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Atherton",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 7,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7041,
        "name": "Steve Korshakov",
        "username": "ex3ndr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
        "created_at": "2020-05-21T04:48:00.366Z",
        "cooked": "<p>I actually put a very simple benchmark: <a href=\"https://github.com/openland/foundationdb-benchmark/blob/master/src/parallel.ts\" rel=\"nofollow noopener\">https://github.com/openland/foundationdb-benchmark/blob/master/src/parallel.ts</a></p>\n<p>And as i mentioned we have tried memory store just to roll out disk issues. This is all available data and everything is in cache.</p>\n<p>I did said how many clients - first number in my tests is the number of clients used.</p>\n<p>But thank you, your math is useful, but reviewing my setup i can\u2019t see anything that causes saturation neither disks nor network. For example, Mac\u2019s disk is 1300MB read / 600MB write. Network is just a localhost.</p>\n<p>It sounds like it is just some kind of throttling or natural latency somewhere.</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T04:49:21.099Z",
        "reply_count": 0,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 12,
        "reads": 92,
        "readers_count": 91,
        "score": 78.4,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Korshakov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/openland/foundationdb-benchmark/blob/master/src/parallel.ts",
            "internal": false,
            "reflection": false,
            "title": "foundationdb-benchmark/parallel.ts at master \u00b7 openland/foundationdb-benchmark \u00b7 GitHub",
            "clicks": 31
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 7,
          "username": "SteavedHams",
          "name": "Steve Atherton",
          "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 393,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7042,
        "name": "Steve Korshakov",
        "username": "ex3ndr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
        "created_at": "2020-05-21T04:51:39.948Z",
        "cooked": "<p>Also during backups i can see 200k/s reads in our cluster (we are using single vm for backups), but our app never was able to reach that speed having ~50 processes, not even close.</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T04:51:39.948Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 90,
        "readers_count": 89,
        "score": 23.0,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Korshakov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 393,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/4",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7044,
        "name": "Steve Atherton",
        "username": "SteavedHams",
        "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png",
        "created_at": "2020-05-21T06:00:08.304Z",
        "cooked": "<p>Ah yes, I forgot you mentioned trying the memory storage engine, which would eliminate disk issues.</p>\n<p>I asked about \u201cclient processes\u201d, not \u201cclients.\u201d  By \u201cprocess\u201d I am referring to the operating system concept.  You mentioned having up to 100 clients in a single process, which suggested maybe you are only using one process to run all of your clients, but I did not want to assume this.</p>\n<p>The reason I asked about process count is that each unique <em>process</em> will have one instance of the <code>fdb_c</code> library, which has a single fdb network thread through which all communication is routed, so this can be a bottleneck.  I am not familiar with what ops/s or KV byte/s rates at which this becomes an issue, hopefully someone else can chime in about that.</p>\n<p>Backup does large many parallel <code>getRange()</code> requests of sequential data in ranges chosen to distribute well across the cluster.  That is different from what you are doing.</p>\n<p>My understanding of your code is that each instance of <code>parallel.ts</code> will get a single read version, then create 100 transactions with that read version (so no round trip to the cluster which is good) and each transaction will launch 1000 parallel reads of the same 1000 keys and then wait for them, and then you wait for all 100 transactions to finish before printing the time it took.  Basically, you are bursting a bunch of requests to a single storage team in your cluster (3 specific processes in triple replication) and waiting for all of them to return.</p>\n<p>If you are running a single instance of <code>parallel.ts</code> as your benchmark, and when you say \u201c100 clients\u201d you are referring to the 100 parallel transactions in this code, then this is not a great benchmark for measuring sustained throughput.  The amount of work outstanding at once will go from 0 to up to 100,000 very quickly (\u201cup to\u201d because likely some will complete by the time all of them are launched) and then fall rapidly until the last one completes.  Your test is waiting for the final completion before it counts anything as completed.</p>\n<p>To measure throughput, it is better to target some fixed number of requests outstanding, launch that number of requests, and when any of them complete then launch another request to replace it.  Then you can measure the number of complete/launch events per second, which gives you the throughput (ops/second) benchmark at that level of parallelism.  Then run the test again at higher levels of parallelism to find the saturation point, which is the point at which the throughput does not increase.</p>\n<p>EDIT: Once you have found this saturation limit for a single test process, then you can try running more than one test process, and if that gets you a higher aggregate throughput (and I expect it would) then the bottleneck was the single client process (with its single fdb library instance) and not the cluster.</p>\n<p>Also, although this is not relevant to your issue I wanted to point out that your quoted Mac disk speeds are for linear read and write, uncached random access workloads are much slower.</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T06:04:57.651Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 8,
        "reads": 90,
        "readers_count": 89,
        "score": 73.0,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Atherton",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 7,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/5",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7046,
        "name": "Steve Korshakov",
        "username": "ex3ndr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
        "created_at": "2020-05-21T08:01:44.669Z",
        "cooked": "<p>Ah my bad i left only one client in the sources, but in my benchmarks i iterated between different number of clients (first for loop) from 1 to 100. This is just my latest iteration. It have different instances - is this still the one network thread? So actual connection pooling is not possible?</p>\n<p>Unfortunately, we need exactly this performance: 1k of txs in parallel with 1000 of random reads withing one instance of our app and we need them ASAP - this direct request processing from customer apps and not workers that could be delayed. This benchmark is quite what we want. Beside i am not sure how we can actually budget transaction to make a good balancing/queuing, i bet FDB knows much better how to distribute workload than our application code.</p>\n<p>Right now we have a limit for 200 parallel transactions per process and this is very slow, this just means that our app can\u2019t handle even 200 users without degradation.</p>\n<p>Our nodes are barely loaded, launching x10 processes looks like very suboptimal since NodeJS (just like any other language) have some fixed overhead and if we barely use them, this became a major contributor to resource consumption.</p>\n<p>For example if we want 1m of concurrent users requires whooping 5000 processes. I bet we just doing something wrong or misconfigured something. This just means that to achieve performance we need x100 of client processes comparing to FDB cluster size, this couldn\u2019t be right.</p>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T08:01:44.669Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 81,
        "readers_count": 80,
        "score": 26.2,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Korshakov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 393,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/6",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7047,
        "name": "Steve Atherton",
        "username": "SteavedHams",
        "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png",
        "created_at": "2020-05-21T09:13:24.349Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ex3ndr\" data-post=\"6\" data-topic=\"2130\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ex3ndr/48/389_2.png\" class=\"avatar\"> ex3ndr:</div>\n<blockquote>\n<p>It have different instances - is this still the one network thread? So actual connection pooling is not possible?</p>\n</blockquote>\n</aside>\n<p>Assuming when you say \u201cinstance\u201d you mean once <em>process</em> launched (for example, <code>node &lt;some_program&gt;</code> then each instance would be using a different instance of the FDB library and therefore a network thread.  This is what you would want to happen, combining requests from different client app instances on the same box would not be an improvement.</p>\n<p>An FDB network thread only opens at most one TCP connection to any cluster process it communicates with, and all requests to that node share that one connection.  The FDB client talks to several roles in the cluster, but mainly the proxies (for getting read versions, discovering what storage server to talk to for a key range, and submitting transactions) and the storage servers.</p>\n<aside class=\"quote no-group\" data-username=\"ex3ndr\" data-post=\"6\" data-topic=\"2130\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ex3ndr/48/389_2.png\" class=\"avatar\"> ex3ndr:</div>\n<blockquote>\n<p>Unfortunately, we need exactly this performance: 1k of txs in parallel with 1000 of random reads withing one instance of our app and we need them ASAP - this direct request processing from customer apps and not workers that could be delayed</p>\n</blockquote>\n</aside>\n<p>If your values are 500 bytes each, and this is the amount of requests you need to perform in one second, then you are trying to read 500 MB/s with 1 million requests per second from a single instance of the FDB client library.  While your cluster can go this fast, a single instance of the FDB client library cannot.</p>\n<p>It also seems likely that your network connection could not go this fast.  Although 500 MBytes/s sounds slower than 10 Gigabit ethernet (which is 1.1GBytes / second) this traffic pattern of 1 million small requests per second to many different processes is very different from, say, streaming a file at 500 MByte/s.</p>\n<p>Supposing though that your network connection was able to handle this, and your client machine was powerful enough, there may be some future in which this speed from a single client application is possible.  There is a plan to eventually (no idea when\u2026) have an RPC layer in front of FoundationDB.</p>\n<p>This could help your use case because then a single process application could perform its reads with many threads and many connections to many RPC service instances in the FDB cluster.  This would remove the bottleneck of all requests being routed through the FDB client library instance\u2019s single network thread.</p>\n<p>There is a discussion of the RPC layer concept here:</p><aside class=\"quote quote-modified\" data-post=\"1\" data-topic=\"1817\">\n  <div class=\"title\">\n    <div class=\"quote-controls\"></div>\n    <img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\">\n    <a href=\"https://forums.foundationdb.org/t/rpc-layer-requirements-and-design/1817\">RPC Layer Requirements and Design</a> <a class=\"badge-category__wrapper \" href=\"/c/development/5\"><span data-category-id=\"5\" data-drop-close=\"true\" class=\"badge-category \" title=\"Topics related to development of FoundationDB.\"><span class=\"badge-category__name\">Development</span></span></a>\n  </div>\n  <blockquote>\n    Hello all, \nWe\u2019ve published an initial draft of the requirements document for the RPC layer on the project\u2019s GitHub wiki: <a href=\"https://github.com/apple/foundationdb/wiki/FoundationDB-RPC-Layer-Requirements\">https://github.com/apple/foundationdb/wiki/FoundationDB-RPC-Layer-Requirements</a>. The intent of this layer is to provide a straightforward and stable protocol for clients that makes it easier to write pure language bindings (i.e. not dependent on our client library) and simplifies the story around versioning and upgrades. \nIf this is a topic that interests you, please take a lo\u2026\n  </blockquote>\n</aside>\n",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T09:13:24.349Z",
        "reply_count": 1,
        "reply_to_post_number": 6,
        "quote_count": 1,
        "incoming_link_count": 4,
        "reads": 82,
        "readers_count": 81,
        "score": 56.4,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Atherton",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://forums.foundationdb.org/t/rpc-layer-requirements-and-design/1817",
            "internal": true,
            "reflection": false,
            "title": "RPC Layer Requirements and Design",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 7,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/7",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7059,
        "name": "Steve Korshakov",
        "username": "ex3ndr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
        "created_at": "2020-05-21T22:37:59.501Z",
        "cooked": "<p>Your ideas a valid, but not reflecting out tests. We narrowed down our test: reading the very same keys (1000 of them in tx), keys are the only one in the database (~1mb of kv), memory storage. Added three more FDB stateless processes (running on macbookpro still, 6-8 cores). We also built a simple golang benchmark that equals to NodeJS one to rule out JS part: it turns out that performance is ~10% less in nodejs, but it is more reliable and we found one minor improvement that makes everything equals to golang performance.</p>\n<p>This is clearly some kind of \u201canti-pattern\u201d benchmark, but we are basically trying to achieve one of the reference benchmarks:</p>\n<pre><code class=\"lang-auto\">Start 100 parallel clients, each doing:\n    Loop for 1 minute:\n        Start a transaction\n        Perform a random 1000-key range read\n\nResult: 3,600,000 keys/second\n</code></pre>\n<p>The main difference is that we want to get this in a single \u201cinstance\u201d of our app.</p>\n<p>As our research shows that network thread is indeed shared across all clients in the same process, but we actually tried to run everything in parallel and we got ~20x performance degradation.</p>\n<p>We literally just started 5 parallel instances of our app each with one client and we got <strong>32 sec</strong> per instance instead of <strong>1.5sec</strong>.</p>\n<p>Again, reusing read versions yield same results.</p>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T22:37:59.501Z",
        "reply_count": 1,
        "reply_to_post_number": 7,
        "quote_count": 0,
        "incoming_link_count": 4,
        "reads": 74,
        "readers_count": 73,
        "score": 39.8,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Korshakov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 7,
          "username": "SteavedHams",
          "name": "Steve Atherton",
          "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 393,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/8",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7060,
        "name": "Clement Pang",
        "username": "panghy",
        "avatar_template": "/user_avatar/forums.foundationdb.org/panghy/{size}/19_2.png",
        "created_at": "2020-05-21T23:20:20.138Z",
        "cooked": "<p>We regularly do much more than this against a memory cluster but it seems like you\u2019re hitting the same SS process constantly? You really only have &lt;replication_factor&gt; number of single-threaded FDB processes answering (you could try going triple if you have the option). The trace logs on the server will show you what sort of throughput you\u2019re getting (we can regularly get triple digit megabytes/s out of a single FDB process, AWS i3).</p>\n<p>On the client side, you are correct that the network thread is single threaded per process so you\u2019d want to run more of your clients but again it seems to me that the dataset is just too small to begin with (there\u2019s work to have read caches but that\u2019s not in any released version).</p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T23:20:20.138Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 68,
        "readers_count": 67,
        "score": 48.6,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Clement Pang",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 38,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/9",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7061,
        "name": "Clement Pang",
        "username": "panghy",
        "avatar_template": "/user_avatar/forums.foundationdb.org/panghy/{size}/19_2.png",
        "created_at": "2020-05-21T23:24:45.258Z",
        "cooked": "<p>BTW, in many non-critical (write-then-read) use cases, we re-use the same transaction (obv same read version) and recycle them every second. That way you also get some local caching too (if you\u2019re really reading the same keys, even ranges, all the time).</p>\n<p>Java but you get the idea:</p>\n<aside class=\"onebox githubblob\">\n  <header class=\"source\">\n      <a href=\"https://github.com/wavefrontHQ/foundationdb-utils/blob/master/src/main/java/com/wavefront/fdb/utils/BatchReader.java\" target=\"_blank\" rel=\"nofollow noopener\">github.com</a>\n  </header>\n  <article class=\"onebox-body\">\n    <h4><a href=\"https://github.com/wavefrontHQ/foundationdb-utils/blob/master/src/main/java/com/wavefront/fdb/utils/BatchReader.java\" target=\"_blank\" rel=\"nofollow noopener\">wavefrontHQ/foundationdb-utils/blob/master/src/main/java/com/wavefront/fdb/utils/BatchReader.java</a></h4>\n<pre><code class=\"lang-java\">package com.wavefront.fdb.utils;\n\nimport com.apple.foundationdb.*;\nimport com.apple.foundationdb.async.AsyncIterable;\n\nimport javax.annotation.Nonnull;\nimport javax.annotation.Nullable;\nimport java.util.List;\nimport java.util.concurrent.CompletableFuture;\nimport java.util.concurrent.ConcurrentHashMap;\nimport java.util.concurrent.ConcurrentMap;\nimport java.util.concurrent.atomic.AtomicBoolean;\nimport java.util.concurrent.atomic.AtomicInteger;\nimport java.util.concurrent.atomic.AtomicLong;\nimport java.util.concurrent.atomic.AtomicReference;\nimport java.util.concurrent.locks.ReentrantReadWriteLock;\nimport java.util.function.BiFunction;\nimport java.util.function.Function;\n\n/**\n</code></pre>\n\n  This file has been truncated. <a href=\"https://github.com/wavefrontHQ/foundationdb-utils/blob/master/src/main/java/com/wavefront/fdb/utils/BatchReader.java\" target=\"_blank\" rel=\"nofollow noopener\">show original</a>\n\n  </article>\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n  <div style=\"clear: both\"></div>\n</aside>\n",
        "post_number": 10,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T23:24:45.258Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 69,
        "readers_count": 68,
        "score": 18.8,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Clement Pang",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/wavefrontHQ/foundationdb-utils/blob/master/src/main/java/com/wavefront/fdb/utils/BatchReader.java",
            "internal": false,
            "reflection": false,
            "title": "foundationdb-utils/BatchReader.java at master \u00b7 wavefrontHQ/foundationdb-utils \u00b7 GitHub",
            "clicks": 22
          }
        ],
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 38,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/10",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7062,
        "name": "Steve Atherton",
        "username": "SteavedHams",
        "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png",
        "created_at": "2020-05-21T23:26:11.713Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ex3ndr\" data-post=\"8\" data-topic=\"2130\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ex3ndr/48/389_2.png\" class=\"avatar\"> ex3ndr:</div>\n<blockquote>\n<p>The main difference is that we want to get this in a single \u201cinstance\u201d of our app.</p>\n</blockquote>\n</aside>\n<p>That\u2019s a really important difference, and another really important difference is that the <em>range read</em> mentioned in your example is 1 request out with a very large response returned.  You are trying to do 1000 individual requests out with 1000 individual responses returned.  This is very different, and has orders of magnitude more overhead (because 1000x more requests) in the client for cross-thread synchronization, network serialization and send, and receive overhead to match up the responses to requests (they are not 1:1 in order or even necessarily from the same TCP connection if replication is greater than single).</p>",
        "post_number": 11,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T23:30:20.020Z",
        "reply_count": 0,
        "reply_to_post_number": 8,
        "quote_count": 1,
        "incoming_link_count": 2,
        "reads": 64,
        "readers_count": 63,
        "score": 22.8,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Atherton",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 7,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/11",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7063,
        "name": "Steve Atherton",
        "username": "SteavedHams",
        "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png",
        "created_at": "2020-05-21T23:28:21.214Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"panghy\" data-post=\"9\" data-topic=\"2130\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/panghy/48/19_2.png\" class=\"avatar\"> panghy:</div>\n<blockquote>\n<p>We regularly do much more than this against a memory cluster but it seems like you\u2019re hitting the same SS process constantly?</p>\n</blockquote>\n</aside>\n<p>But what is your throughput from a single client process (and so a single FDB library instance)?</p>",
        "post_number": 12,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T23:28:21.214Z",
        "reply_count": 1,
        "reply_to_post_number": 9,
        "quote_count": 1,
        "incoming_link_count": 0,
        "reads": 62,
        "readers_count": 61,
        "score": 17.4,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Atherton",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 7,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/12",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7064,
        "name": "Clement Pang",
        "username": "panghy",
        "avatar_template": "/user_avatar/forums.foundationdb.org/panghy/{size}/19_2.png",
        "created_at": "2020-05-21T23:31:30.089Z",
        "cooked": "<p>20Gbps fabric, we are seeing &gt; 100 megabytes/s on a single JVM (highest priority to network thread). AWS m5/r5. Most of these are getRanges() with bounded thread pools for call-backs.</p>",
        "post_number": 13,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T23:31:30.089Z",
        "reply_count": 1,
        "reply_to_post_number": 12,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 60,
        "readers_count": 59,
        "score": 17.0,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Clement Pang",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "reply_to_user": {
          "id": 7,
          "username": "SteavedHams",
          "name": "Steve Atherton",
          "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 38,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/13",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7065,
        "name": "Steve Atherton",
        "username": "SteavedHams",
        "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png",
        "created_at": "2020-05-21T23:38:13.620Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"panghy\" data-post=\"13\" data-topic=\"2130\" data-full=\"true\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/panghy/48/19_2.png\" class=\"avatar\"> panghy:</div>\n<blockquote>\n<p>20Gbps fabric, we are seeing &gt; 100 megabytes/s on a single JVM (highest priority to network thread). AWS m5/r5. Most of these are getRanges() with bounded thread pools for call-backs.</p>\n</blockquote>\n</aside>\n<p>Do you know how many requests per second?  The goal <a class=\"mention\" href=\"/u/ex3ndr\">@ex3ndr</a> is trying to hit here is 1 million <code>get()</code> (not get range) requests per second, each reading a 500 byte value, from a single client, and I am fairly certain this is several times faster than what can be achieved with point small point reads on a single client library instance.</p>",
        "post_number": 14,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T23:39:29.036Z",
        "reply_count": 1,
        "reply_to_post_number": 13,
        "quote_count": 1,
        "incoming_link_count": 2,
        "reads": 60,
        "readers_count": 59,
        "score": 27.0,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Atherton",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 3,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 7,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/14",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7067,
        "name": "Steve Korshakov",
        "username": "ex3ndr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
        "created_at": "2020-05-21T23:51:41.090Z",
        "cooked": "<blockquote>\n<p>we re-use the same transaction</p>\n</blockquote>\n<p>We are doing something like this, but just copying read version. In our tests performance is similar for both variants (reuse rw or tx).</p>\n<blockquote>\n<p>This is very different, and has orders of magnitude more overhead (because 1000x more requests)</p>\n</blockquote>\n<p>One of the selling points is intelligent batching, but it seems that it is not implemented for reads? If every key is on the same SS then workload is about the same as range reads. Overhead is only on network that could be avoided or batched. This is just very surprising that it is not true.</p>",
        "post_number": 15,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-21T23:51:41.090Z",
        "reply_count": 1,
        "reply_to_post_number": 10,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 60,
        "readers_count": 59,
        "score": 22.0,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Korshakov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 38,
          "username": "panghy",
          "name": "Clement Pang",
          "avatar_template": "/user_avatar/forums.foundationdb.org/panghy/{size}/19_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 393,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/15",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7068,
        "name": "Clement Pang",
        "username": "panghy",
        "avatar_template": "/user_avatar/forums.foundationdb.org/panghy/{size}/19_2.png",
        "created_at": "2020-05-22T00:20:41.751Z",
        "cooked": "<p>We are seeing per second scan rates from a single machine going beyond 30k requests/s so it\u2019s definitely less a million gets a second. For a data set that\u2019s a few megabytes of KV, you\u2019d almost be better to read all of them in a single scan and just serve from an in-memory cache =p</p>",
        "post_number": 16,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-22T00:20:41.751Z",
        "reply_count": 1,
        "reply_to_post_number": 14,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 63,
        "readers_count": 62,
        "score": 37.6,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Clement Pang",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "reply_to_user": {
          "id": 7,
          "username": "SteavedHams",
          "name": "Steve Atherton",
          "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png"
        },
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 38,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/16",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7069,
        "name": "Steve Atherton",
        "username": "SteavedHams",
        "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png",
        "created_at": "2020-05-22T00:30:13.891Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ex3ndr\" data-post=\"15\" data-topic=\"2130\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ex3ndr/48/389_2.png\" class=\"avatar\"> ex3ndr:</div>\n<blockquote>\n<p>If every key is on the same SS then workload is about the same as range reads. Overhead is only on network that could be avoided or batched. This is just very surprising that it is not true.</p>\n</blockquote>\n</aside>\n<p>No, and no.  I\u2019m sorry but you are completely ignoring constant factor overhead of just <em>having</em> a request, on the client side and on the server side but in this case especially on the client.  Once the per-request overhead is paid, the more work that request produces the faster your throughput will be.  One million small requests per second is not at all the same as 1000 request per second where each request produces 1000x the amount of output as each of the million small ones.</p>\n<p>I\u2019m going to try explaining this with a non-FDB example in hopes it will help.  The concept of per-request overhead and the idea of maximizing per-request output to reduce overhead and maximize throughput is not unique to FDB.</p>\n<p>Imagine you have a file sitting in Amazon S3.  That file is 500 Mbytes in size.  You have a client running in AWS, very close to S3 in terms of network latency and throughput, and you want to use that client to read that file.  You open an HTTP connection to the S3 service and then do one of these two things:</p>\n<ul>\n<li>A) Issue a single Read request to the file data with (offset 0, length 500 million)</li>\n<li>B) Issue 1 million Read requests in a row, on that same HTTP connection, each requesting the next consecutive 500 bytes of the file.  In other words, (offset 0, length 500) then (offset 500, length 500), then (offset 1000, length 500) and so on.</li>\n</ul>\n<p>Does it make sense to you that these will not run at the same speed?  B will be far, far slower than A.  The B approach is incurring per-request overhead a million times.  This overhead is <em>significant</em> compared to the work of returning 500 sequential bytes from the file once the request is parsed and the location in the file is reached.</p>",
        "post_number": 17,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-22T00:30:13.891Z",
        "reply_count": 0,
        "reply_to_post_number": 15,
        "quote_count": 1,
        "incoming_link_count": 4,
        "reads": 66,
        "readers_count": 65,
        "score": 33.2,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Atherton",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 7,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/17",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7070,
        "name": "Steve Atherton",
        "username": "SteavedHams",
        "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png",
        "created_at": "2020-05-22T00:34:13.443Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"panghy\" data-post=\"16\" data-topic=\"2130\" data-full=\"true\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/panghy/48/19_2.png\" class=\"avatar\"> panghy:</div>\n<blockquote>\n<p>We are seeing per second scan rates from a single machine going beyond 30k requests/s so it\u2019s definitely less a million gets a second. For a data set that\u2019s a few megabytes of KV, you\u2019d almost be better to read all of them in a single scan and just serve from an in-memory cache =p</p>\n</blockquote>\n</aside>\n<p>Thank you!</p>\n<p><a class=\"mention\" href=\"/u/ex3ndr\">@ex3ndr</a> This sounds about the same as the 30khz you initially observed with a single process running many concurrent transactions.</p>\n<p>As for why you could not get more with more client processes, one possibility is your are over-committing the CPU cores on your single machine (you should not have fewer CPU cores than you have <code>fdbserver processes + client processes</code>).</p>",
        "post_number": 18,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-22T00:34:13.443Z",
        "reply_count": 1,
        "reply_to_post_number": 16,
        "quote_count": 1,
        "incoming_link_count": 3,
        "reads": 71,
        "readers_count": 70,
        "score": 34.2,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Atherton",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 7,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/18",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7074,
        "name": "Steve Korshakov",
        "username": "ex3ndr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
        "created_at": "2020-05-22T03:12:35.831Z",
        "cooked": "<p>Hey! I am not trying to nullify constant cost of a request! I just trying to figure out a way to achieve performance and this thread shows than performance is limited for reading very same 1k keys:</p>\n<ol>\n<li>By replication factor, maximum is 3</li>\n<li>By number of data centers, maximum is 3 too?</li>\n<li>Limited by a client process performance.</li>\n</ol>\n<p>Since a single process can yield ~30khz then we are getting 30 * 9 = 270khz total maximum read rate for same amount of keys meaning there are no way to read it faster? And enen then we should guarantee that workload is even between DC that we couldn\u2019t do actually, so it is more like 90khz.</p>\n<p>Is this a limiting factor of FDB - maximum practical speed of reading same keys will be ~ 90khz? That\u2019s quite limiting, i bet there are a better option, is it possible to have read replicas?</p>\n<p>This limitation is very unfortunate since i often promote FDB as replacement for Cassandra, but Cassandra at least has a way to scale such reads and it seems there are no way to do so in FDB or i am wrong and there is a way?</p>",
        "post_number": 19,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-22T03:12:59.516Z",
        "reply_count": 0,
        "reply_to_post_number": 18,
        "quote_count": 0,
        "incoming_link_count": 27,
        "reads": 69,
        "readers_count": 68,
        "score": 148.8,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Steve Korshakov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 7,
          "username": "SteavedHams",
          "name": "Steve Atherton",
          "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 393,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/19",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7075,
        "name": "Clement Pang",
        "username": "panghy",
        "avatar_template": "/user_avatar/forums.foundationdb.org/panghy/{size}/19_2.png",
        "created_at": "2020-05-22T04:10:38.790Z",
        "cooked": "<p>If you can scale the number of clients and you are capped by a single fdb server process, you can always duplicate the keys and just randomly read from one replica (and increase writes).</p>",
        "post_number": 20,
        "post_type": 1,
        "posts_count": 25,
        "updated_at": "2020-05-22T04:10:38.790Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 71,
        "readers_count": 70,
        "score": 24.2,
        "yours": false,
        "topic_id": 2130,
        "topic_slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
        "display_username": "Clement Pang",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 38,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client/2130/20",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      7039,
      7040,
      7041,
      7042,
      7044,
      7046,
      7047,
      7059,
      7060,
      7061,
      7062,
      7063,
      7064,
      7065,
      7067,
      7068,
      7069,
      7070,
      7074,
      7075,
      7730,
      7738,
      7812,
      10430,
      10433
    ]
  },
  "timeline_lookup": [
    [
      1,
      1980
    ],
    [
      8,
      1979
    ],
    [
      21,
      1902
    ],
    [
      22,
      1901
    ],
    [
      23,
      1889
    ],
    [
      24,
      1406
    ]
  ],
  "tags": [
    "performance"
  ],
  "tags_descriptions": {},
  "fancy_title": "How to achieve (1000 tx 1000 reads each)/sec on single client",
  "id": 2130,
  "title": "How to achieve (1000 tx 1000 reads each)/sec on single client",
  "posts_count": 25,
  "created_at": "2020-05-21T03:47:18.304Z",
  "views": 3174,
  "reply_count": 16,
  "like_count": 8,
  "last_posted_at": "2021-12-15T17:53:19.208Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "how-to-achieve-1000-tx-1000-reads-each-sec-on-single-client",
  "category_id": 7,
  "word_count": 3609,
  "deleted_at": null,
  "user_id": 393,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_2130",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 25,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 6,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": null,
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 393,
        "username": "ex3ndr",
        "name": "Steve Korshakov",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
        "post_count": 8,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 7,
        "username": "SteavedHams",
        "name": "Steve Atherton",
        "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png",
        "post_count": 8,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 4
      },
      {
        "id": 38,
        "username": "panghy",
        "name": "Clement Pang",
        "avatar_template": "/user_avatar/forums.foundationdb.org/panghy/{size}/19_2.png",
        "post_count": 5,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 808,
        "username": "sfc-gh-ngoyal",
        "name": "Neelam Goyal",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/s/439d5e/{size}.png",
        "post_count": 2,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      },
      {
        "id": 337,
        "username": "mengxu",
        "name": "Meng Xu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 933,
        "username": "rmanoj",
        "name": "Manoj Ramakrishnan",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/c5a1d2/{size}.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      }
    ],
    "created_by": {
      "id": 393,
      "username": "ex3ndr",
      "name": "Steve Korshakov",
      "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png"
    },
    "last_poster": {
      "id": 808,
      "username": "sfc-gh-ngoyal",
      "name": "Neelam Goyal",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/s/439d5e/{size}.png"
    },
    "links": [
      {
        "url": "https://github.com/openland/foundationdb-benchmark/blob/master/src/parallel.ts",
        "title": "foundationdb-benchmark/parallel.ts at master \u00b7 openland/foundationdb-benchmark \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 31,
        "user_id": 393,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/wavefrontHQ/foundationdb-utils/blob/master/src/main/java/com/wavefront/fdb/utils/BatchReader.java",
        "title": "foundationdb-utils/BatchReader.java at master \u00b7 wavefrontHQ/foundationdb-utils \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 22,
        "user_id": 38,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://apple.github.io/foundationdb/benchmarking.html",
        "title": "Benchmarking \u2014 FoundationDB 6.2",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 14,
        "user_id": 393,
        "domain": "apple.github.io",
        "root_domain": "apple.github.io"
      }
    ]
  },
  "bookmarks": []
}