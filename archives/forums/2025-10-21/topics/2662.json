{
  "post_stream": {
    "posts": [
      {
        "id": 9317,
        "name": "",
        "username": "arshia",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/a/d2c977/{size}.png",
        "created_at": "2021-04-17T16:35:02.736Z",
        "cooked": "<p>Hello there!<br>\nWe\u2019re working on a method to determine the cluster\u2019s sanity based on its ability to process new transactions. To ascertain this, we were relying on <em>database availability</em> and <em>quorum fields</em> in status json.  However, we discovered an exception to this rule, where the database is still available but can not process new transactions due to the storage server reaching the 5% limit. We understand that there might me more such exceptions that need to be accounted for.<br>\nHence, it\u2019d be helpful to know if there\u2019s a better method to determine if my db is capable of processing new transactions, albeit at a reduced performance.</p>\n<p>Thanks!</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2021-04-17T16:35:02.736Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 26,
        "reads": 26,
        "readers_count": 25,
        "score": 135.2,
        "yours": false,
        "topic_id": 2662,
        "topic_slug": "determine-cluster-availability-for-processing-new-transactions",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 804,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/determine-cluster-availability-for-processing-new-transactions/2662/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 9335,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2021-04-19T16:41:04.319Z",
        "cooked": "<p>The <code>client.database_status.available</code> field will report that the cluster is available if the client can connect to the cluster to get status, and if as part of that status request the cluster controller was able to start an immediate priority transaction, read a key, and commit the transaction. There are some timeouts set on different parts of this operation, and if those are hit the database will be regarded as unavailable for this status field.</p>\n<p>There are various cases where a client of the cluster may experience unavailability but not be able to detect it through this status field. For example:</p>\n<ol>\n<li>Ratekeeper throttling that delays GRV requests significantly. There are a variety of reasons this throttling could happen, including the example you listed where a process runs out of space.</li>\n<li>Some keys could become unavailable for reads. I mentioned that status checks whether a read works, but it doesn\u2019t read from all shards in the cluster. If some set of data has gone missing or its storage servers are unable to handle reads in a timely manner, then any transactions relying on that data will not work.</li>\n<li>A problem limited to a subset of the proxies could prevent some clients from starting and/or committing transactions while not preventing all transactions.</li>\n</ol>\n<p>Monitoring <span class=\"hashtag\">#1</span> is perhaps most easily accomplished by performing latency probes into the cluster to check the timeliness of default-priority GRVs. Unlike the immediate-priority transactions used to populate the <code>availability</code> field in status, these are subjected to ratekeeper, and you could use them to determine if it\u2019s possible to start transactions quickly enough. Status includes a latency probe at <code>cluster.latency_probe.transaction_start_seconds</code> that you could use, but it should be noted that it caps out at 5 seconds. If you are happy treating the database as unavailable if this value crosses a threshold at or below that, then you could use it. Otherwise, you would probably need to run your own probe. Also, be aware that this value could be missing in status, which should be treated as if the latency is larger than 5 seconds.</p>\n<p>For <span class=\"hashtag\">#2</span>, this is a bit trickier. We can detect when the cluster knows that all replicas of some piece of data are missing (<code>cluster.data.min_replicas_remaining</code>). To determine if data is present but unreadable (e.g. because storage servers are too busy or have fallen behind), we would need to use a few other metrics. We can probably tell if a storage server is too busy by looking at the read latency statistics for it (<code>cluster.processes[&lt;ID&gt;].roles[N].read_latency_statistics</code> for storage roles). We can tell if it is behind by checking whether <code>cluster.processes[&lt;ID&gt;].roles[N].data_lag.seconds</code> is large (&gt;5s or so). In both of these cases the problem needs to affect all replicas of some subset of data, so you\u2019d probably only want to report an availability issue if the number of storage servers with problems was at least as large as your replication factor (3 in triple).</p>\n<p>For <span class=\"hashtag\">#3</span>, we can probably cover a good number of the cases here by checking proxy request latencies (<code>cluster.processes[&lt;ID&gt;].roles[N].grv_latency_statistics</code> and <code>commit_latency_statistics</code> for proxy roles).</p>\n<p>I realize this is quite a bit to monitor in order to observe the available state of the cluster, and that\u2019s not ideal. This is something that I\u2019m currently thinking about and hoping to improve going forward. I\u2019m not sure it\u2019s necessarily a good idea to just roll up all of this data into a binary available field, as that limits the ability for others to define availability the way they want (e.g. is a 5 second downtime unavailable, or 30, etc? Is one busy team of storage servers a complete unavailability?). However, it seems doable that we could provide a few basic statistics about the cluster\u2019s availability that could be more easily reasoned about than what I described above.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2021-04-19T16:41:04.319Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 23,
        "readers_count": 22,
        "score": 79.6,
        "yours": false,
        "topic_id": 2662,
        "topic_slug": "determine-cluster-availability-for-processing-new-transactions",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 3
          }
        ],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/determine-cluster-availability-for-processing-new-transactions/2662/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      9317,
      9335
    ]
  },
  "timeline_lookup": [
    [
      1,
      1648
    ],
    [
      2,
      1646
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Determine cluster availability for processing new transactions",
  "id": 2662,
  "title": "Determine cluster availability for processing new transactions",
  "posts_count": 2,
  "created_at": "2021-04-17T16:35:02.670Z",
  "views": 561,
  "reply_count": 0,
  "like_count": 3,
  "last_posted_at": "2021-04-19T16:41:04.319Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "determine-cluster-availability-for-processing-new-transactions",
  "category_id": 7,
  "word_count": 776,
  "deleted_at": null,
  "user_id": 804,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_2662",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 2,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Detecting cluster availability transitions for long running clients",
      "id": 365,
      "title": "Detecting cluster availability transitions for long running clients",
      "slug": "detecting-cluster-availability-transitions-for-long-running-clients",
      "posts_count": 9,
      "reply_count": 7,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2018-05-07T08:18:42.873Z",
      "last_posted_at": "2018-05-08T17:59:06.057Z",
      "bumped": true,
      "bumped_at": "2018-05-08T17:59:06.057Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 1318,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 22,
            "username": "dave",
            "name": "David Scherer",
            "avatar_template": "/user_avatar/forums.foundationdb.org/dave/{size}/89_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "How to do status check using the Java API",
      "id": 534,
      "title": "How to do status check using the Java API",
      "slug": "how-to-do-status-check-using-the-java-api",
      "posts_count": 6,
      "reply_count": 2,
      "highest_post_number": 6,
      "image_url": null,
      "created_at": "2018-06-29T01:27:37.697Z",
      "last_posted_at": "2018-06-30T19:28:29.255Z",
      "bumped": true,
      "bumped_at": "2018-06-30T19:28:29.255Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "bindings"
      ],
      "tags_descriptions": {},
      "like_count": 5,
      "views": 2002,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 236,
            "username": "marctrem",
            "name": "Marc-Andr\u00e9 Tremblay",
            "avatar_template": "/user_avatar/forums.foundationdb.org/marctrem/{size}/208_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 15,
            "username": "markus.pilman",
            "name": "Markus Pilman",
            "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 38,
            "username": "panghy",
            "name": "Clement Pang",
            "avatar_template": "/user_avatar/forums.foundationdb.org/panghy/{size}/19_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Troubles scaling up the cluster",
      "id": 751,
      "title": "Troubles scaling up the cluster",
      "slug": "troubles-scaling-up-the-cluster",
      "posts_count": 32,
      "reply_count": 26,
      "highest_post_number": 32,
      "image_url": null,
      "created_at": "2018-10-08T03:24:54.004Z",
      "last_posted_at": "2018-11-01T16:26:01.527Z",
      "bumped": true,
      "bumped_at": "2018-11-01T16:26:01.527Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 3747,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 311,
            "username": "ThomasJ",
            "name": "Thomas Johson",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 15,
            "username": "markus.pilman",
            "name": "Markus Pilman",
            "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 255,
            "username": "aqua",
            "name": "Matt Lohier",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/a/b9bd4f/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Backpressure against data pipelines",
      "id": 2003,
      "title": "Backpressure against data pipelines",
      "slug": "backpressure-against-data-pipelines",
      "posts_count": 9,
      "reply_count": 3,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2020-03-04T21:02:28.384Z",
      "last_posted_at": "2020-03-09T15:19:54.676Z",
      "bumped": true,
      "bumped_at": "2020-03-09T15:19:54.676Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 1548,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 735,
            "username": "dmitrig01",
            "name": "Dmitri G",
            "avatar_template": "/user_avatar/forums.foundationdb.org/dmitrig01/{size}/791_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 622,
            "username": "rcbranch",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/82dd89/{size}.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Write-availability of FoundationDB",
      "id": 2668,
      "title": "Write-availability of FoundationDB",
      "slug": "write-availability-of-foundationdb",
      "posts_count": 5,
      "reply_count": 3,
      "highest_post_number": 5,
      "image_url": "https://global.discourse-cdn.com/foundationdb/original/2X/3/3c15ebda6cee4cbb93ad42c2519a256425b3bf16.png",
      "created_at": "2021-04-19T11:23:39.525Z",
      "last_posted_at": "2021-04-19T22:49:02.939Z",
      "bumped": true,
      "bumped_at": "2021-04-20T04:25:09.154Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 5,
      "views": 957,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 927,
            "username": "peter",
            "name": "Peter Zeller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/peter/{size}/1064_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 12,
        "username": "ajbeamon",
        "name": "A.J. Beamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      },
      {
        "id": 804,
        "username": "arshia",
        "name": "",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/a/d2c977/{size}.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      }
    ],
    "created_by": {
      "id": 804,
      "username": "arshia",
      "name": "",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/a/d2c977/{size}.png"
    },
    "last_poster": {
      "id": 12,
      "username": "ajbeamon",
      "name": "A.J. Beamon",
      "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png"
    }
  },
  "bookmarks": []
}