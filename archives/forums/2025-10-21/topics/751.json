{
  "post_stream": {
    "posts": [
      {
        "id": 2265,
        "name": "Thomas Johson",
        "username": "ThomasJ",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
        "created_at": "2018-10-08T03:24:54.079Z",
        "cooked": "<p>Hi guys,</p>\n<p>We\u2019re running FDB cluster for couple of months now and things are working out well. However mid last week it started running out of space. I decided to increase the size to almost double (from 40 to 70 servers; each 4 vCPU, 15GB RAM, 1x375GB NVME SSD). I only added storage classes however and a day after the log servers (we had 5 servers, 2 per server) started running out. So I added 3 more servers with 2 log classes per server (2 are stateless) and left the cluster to do whatever it needs to do.</p>\n<p>But the cluster is now running into some troubles. I can\u2019t get any data from the <code>status</code> as it always returns something like this</p>\n<pre><code class=\"lang-auto\">fdb&gt; status details\n\nUsing cluster file `fdb.cluster'.\n\nUnable to communicate with the cluster controller at 10.128.9.184:4500 to get\nstatus.\n\nConfiguration:\n  Redundancy mode        - unknown\n  Storage engine         - unknown\n  Coordinators           - unknown\n\nCluster:\n  FoundationDB processes - unknown\n  Machines               -\n  Machines               - unknown\n\nData:\n  Replication health     - unknown\n  Moving data            - unknown\n  Sum of key-value sizes - unknown\n  Disk space used        - unknown\n\nOperating space:\n  Unable to retrieve operating space status\n\nWorkload:\n  Read rate              - unknown\n  Write rate             - unknown\n  Transactions started   - unknown\n  Transactions committed - unknown\n  Conflict rate          - unknown\n\nBackup and DR:\n  Running backups        - 0\n  Running DRs            - 0\n\nProcess performance details:\n\nCoordination servers:\n  10.128.0.125:4500  (reachable)\n  10.128.0.204:4500  (reachable)\n  10.128.0.240:4500  (reachable)\n  10.128.1.36:4500  (reachable)\n  10.128.1.243:4500  (reachable)\n  10.128.3.106:4500  (reachable)\n  10.128.4.114:4500  (reachable)\n\nClient time: 10/07/18 20:07:39\n</code></pre>\n<p>There are no errors in the processes. I did restart the cluster (just to make sure) but it has no impact. The cluster itself works most of the time, but every 10 minutes or so things stop to halt and then start working again after couple of minutes.</p>\n<p>Any suggestion what to do? I did pause any writes into the cluster to give it time to recover, but need to get it working as soon as possible. Any help is very appreciated.</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-08T03:24:54.079Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 447,
        "reads": 118,
        "readers_count": 117,
        "score": 2258.6,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Thomas Johson",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 311,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 2270,
        "name": "gaurav",
        "username": "gaurav",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
        "created_at": "2018-10-08T04:54:28.060Z",
        "cooked": "<p>Hi Thomas, are you running with a large number of fdbserver instances + client instances? Could it be that Cluster Coordinator is bottlenecked on number of monitoring all connected entities?</p>\n<p>Please see some recent threads <a href=\"https://forums.foundationdb.org/t/cluster-controller-cpu-utilization-pegged/740\">https://forums.foundationdb.org/t/cluster-controller-cpu-utilization-pegged/740</a> and <a href=\"https://forums.foundationdb.org/t/migrating-from-a-large-cluster-to-another/721\">https://forums.foundationdb.org/t/migrating-from-a-large-cluster-to-another/721</a> if they give you any clues\u2026</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-08T04:54:28.060Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 108,
        "readers_count": 107,
        "score": 36.6,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "gaurav",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://forums.foundationdb.org/t/cluster-controller-cpu-utilization-pegged/740",
            "internal": true,
            "reflection": false,
            "title": "Cluster Controller CPU Utilization Pegged",
            "clicks": 20
          },
          {
            "url": "https://forums.foundationdb.org/t/migrating-from-a-large-cluster-to-another/721",
            "internal": true,
            "reflection": false,
            "title": "Migrating from a large cluster to another",
            "clicks": 11
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 166,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2273,
        "name": "Thomas Johson",
        "username": "ThomasJ",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
        "created_at": "2018-10-08T15:06:36.022Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"gaurav\" data-post=\"2\" data-topic=\"751\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://avatars.discourse-cdn.com/v4/letter/g/b487fb/48.png\" class=\"avatar\"> gaurav:</div>\n<blockquote>\n<p>are you running with a large number of fdbserver instances + client instances? Could it be that Cluster Coordinator is bottlenecked on number of monitoring all connected entities?</p>\n</blockquote>\n</aside>\n<p>4 per server, so 280 total. There are no clients connecting at the moment.</p>\n<p>I read through the discussions, but not sure what the solution is. Should I start slowly removing servers?</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-08T15:06:36.022Z",
        "reply_count": 1,
        "reply_to_post_number": 2,
        "quote_count": 1,
        "incoming_link_count": 2,
        "reads": 107,
        "readers_count": 106,
        "score": 36.4,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Thomas Johson",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 311,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2278,
        "name": "Markus Pilman",
        "username": "markus.pilman",
        "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
        "created_at": "2018-10-08T17:37:45.767Z",
        "cooked": "<p>This looks a lot like the cluster controller is overloaded. One way of figuring out is to go to the machine that runs the cluster controller and grep for messages of type <code>LongDelayOnClusterController</code> in the traces of the process.</p>\n<p>That being said, 280 servers should not be an issue. The easiest way to run into this issue is if you have many instances of processes that run <code>status json</code> (or <code>status</code> or <code>status details</code> as internally these three do the same thing). We found experimentally, that running a low number of these commands simultaneously can kill the ClusterController (which will result in a recovery - if you are very unlucky, this will happen all the time). Low number here refers to 10s of simultaneous requests.</p>\n<p>Do you have some monitoring that runs <code>status json</code> and runs on every machine? 70 of those would certainly be problematic.</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-08T17:37:45.767Z",
        "reply_count": 1,
        "reply_to_post_number": 3,
        "quote_count": 0,
        "incoming_link_count": 8,
        "reads": 103,
        "readers_count": 102,
        "score": 65.6,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Markus Pilman",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 311,
          "username": "ThomasJ",
          "name": "Thomas Johson",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 15,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/4",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2279,
        "name": "Thomas Johson",
        "username": "ThomasJ",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
        "created_at": "2018-10-08T19:00:11.403Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"markus.pilman\" data-post=\"4\" data-topic=\"751\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/markus.pilman/48/379_2.png\" class=\"avatar\"> markus.pilman:</div>\n<blockquote>\n<p>Do you have some monitoring that runs <code>status json</code> and runs on every machine? 70 of those would certainly be problematic.</p>\n</blockquote>\n</aside>\n<p>That\u2019s exactly it. We run a telegraf on each server that does just that. Idiotic, but it was easy to scale. Anyway, I turned them off. Is there anything I can do to help the cluster controller to recover? 10 minutes in and no change. Currently there are no clients connecting to the cluster, no processes requesting any status updates.</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-08T19:00:11.403Z",
        "reply_count": 1,
        "reply_to_post_number": 4,
        "quote_count": 1,
        "incoming_link_count": 2,
        "reads": 97,
        "readers_count": 96,
        "score": 34.4,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Thomas Johson",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 311,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/5",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2283,
        "name": "Thomas Johson",
        "username": "ThomasJ",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
        "created_at": "2018-10-08T20:02:07.617Z",
        "cooked": "<p>Unfortunately, even when I removed the status requests, the cluster controller is still experiencing problems for some reason</p>\n<pre><code class=\"lang-auto\">n@:~$ sudo grep -rnw -e 'LongDelayOnClusterController' /var/log/foundationdb/ | wc -l\n463\nn@:~$ sudo grep -rnw -e 'LongDelayOnClusterController' /var/log/foundationdb/ | wc -l\n490\n</code></pre>\n<p>The amount of errors is still growing. Could this be caused by the cluster itself? Any idea what could I do to help it?</p>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-08T20:02:07.617Z",
        "reply_count": 1,
        "reply_to_post_number": 5,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 89,
        "readers_count": 88,
        "score": 37.8,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Thomas Johson",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 311,
          "username": "ThomasJ",
          "name": "Thomas Johson",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 311,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/6",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2284,
        "name": "Markus Pilman",
        "username": "markus.pilman",
        "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
        "created_at": "2018-10-08T22:02:00.048Z",
        "cooked": "<p>This is super weird. We run clusters that are much larger than yours and we made benchmarks with clusters that have more than 1,000 fdbserver processes. I have to admit that I don\u2019t have many ideas how to help you here.</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-08T22:02:00.048Z",
        "reply_count": 1,
        "reply_to_post_number": 6,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 85,
        "readers_count": 84,
        "score": 27.0,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Markus Pilman",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 311,
          "username": "ThomasJ",
          "name": "Thomas Johson",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 15,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/7",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2285,
        "name": "Thomas Johson",
        "username": "ThomasJ",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
        "created_at": "2018-10-08T22:16:15.446Z",
        "cooked": "<p>I appreciate your pointers though. At least I know what caused it. Just not sure how to get out if.</p>\n<p>Trying to see what happens if I turn off the whole cluster and start turning on server after server. Maybe something will happen there.</p>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-08T22:16:15.446Z",
        "reply_count": 1,
        "reply_to_post_number": 7,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 84,
        "readers_count": 83,
        "score": 21.8,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Thomas Johson",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 15,
          "username": "markus.pilman",
          "name": "Markus Pilman",
          "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 311,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/8",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2286,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2018-10-08T22:32:19.626Z",
        "cooked": "<p>Does restarting every process help (e.g. <code>kill; kill all</code> in fdbcli, assuming you are using something like fdbmonitor that will automatically restart the processes)?</p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-08T22:32:19.626Z",
        "reply_count": 1,
        "reply_to_post_number": 8,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 84,
        "readers_count": 83,
        "score": 21.8,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 311,
          "username": "ThomasJ",
          "name": "Thomas Johson",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/9",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2288,
        "name": "Thomas Johson",
        "username": "ThomasJ",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
        "created_at": "2018-10-08T23:28:54.192Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ajbeamon\" data-post=\"9\" data-topic=\"751\" data-full=\"true\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"> ajbeamon:</div>\n<blockquote>\n<p>Does restarting every process help (e.g. <code>kill; kill all</code> in fdbcli, assuming you are using something like fdbmonitor that will automatically restart the processes)?</p>\n</blockquote>\n</aside>\n<p>Haven\u2019t tried through <code>fbdcli</code> but did try through ansible and didn\u2019t help.</p>\n<p>Anyway, I did stop all processes and then started adding slowly and thing did get back (at least I get data now). However I think I broke the cluster as now it says that it doesn\u2019t have access to some of the data</p>\n<pre><code class=\"lang-auto\">Data:\n  Replication health     - UNHEALTHY: No replicas remain of some data\n  Moving data            - 1905.884 GB\n  Sum of key-value sizes - 2.190 TB\n  Disk space used        - 8.871 TB\n</code></pre>\n<p>I don\u2019t think it will be able to recover from this unfortunately. Fortunately we do have backup of the raw data, but it will take me a week to restore it. High price for running <code>status json</code></p>",
        "post_number": 10,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-08T23:28:54.192Z",
        "reply_count": 1,
        "reply_to_post_number": 9,
        "quote_count": 1,
        "incoming_link_count": 3,
        "reads": 87,
        "readers_count": 86,
        "score": 37.4,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Thomas Johson",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 311,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/10",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2289,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2018-10-09T00:22:26.384Z",
        "cooked": "<p>Running status is certainly expensive and can saturate the cluster controller if done a lot (although this is made a lot better in 6.0), but I don\u2019t think it would lead to any cluster damage.</p>\n<p>The missing data report here is possibly misleading. If you\u2019ve added back all of your storage servers and there was no missing data before the problem, then my guess is that the data is all present. However, while adding back the storage servers slowly, there would have been a period where some data was missing, and you would get this message. Do to a reporting quirk, this status can persist even when all data does show up if there is a lot of data movement queued up. Can you let it run for a bit until data movement finishes  and see if it becomes happy? Alternatively, I think there are some logs we can check to see if things are in an ok state, but I\u2019ll have to wait until I\u2019m able to look up the events to provide details.</p>",
        "post_number": 11,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-09T00:22:26.384Z",
        "reply_count": 1,
        "reply_to_post_number": 10,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 87,
        "readers_count": 86,
        "score": 22.4,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 311,
          "username": "ThomasJ",
          "name": "Thomas Johson",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/11",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2290,
        "name": "Thomas Johson",
        "username": "ThomasJ",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
        "created_at": "2018-10-09T01:42:54.361Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ajbeamon\" data-post=\"11\" data-topic=\"751\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"> ajbeamon:</div>\n<blockquote>\n<p>Can you let it run for a bit until data movement finishes and see if it becomes happy?</p>\n</blockquote>\n</aside>\n<p>Yes, will do. One of the storage servers is quite stuck at 5% limit and there is still 2TB of data to be moved. Will give it the night and see if it came back.</p>",
        "post_number": 12,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-09T01:42:54.361Z",
        "reply_count": 1,
        "reply_to_post_number": 11,
        "quote_count": 1,
        "incoming_link_count": 4,
        "reads": 87,
        "readers_count": 86,
        "score": 42.4,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Thomas Johson",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 311,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/12",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2292,
        "name": "Thomas Johson",
        "username": "ThomasJ",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
        "created_at": "2018-10-09T14:06:50.722Z",
        "cooked": "<p>Even after 12 hours, the cluster is not recovering It\u2019s quite stuck at the same level without any material change.</p>\n<pre><code class=\"lang-auto\">Data:\n  Replication health     - UNHEALTHY: No replicas remain of some data\n  Moving data            - 1781.906 GB\n  Sum of key-value sizes - 2.190 TB\n  Disk space used        - 9.264 TB\n</code></pre>\n<p>I did bring back all servers and all of them should have the original data, but it seems something broke along the way. Any ideas what else can I try before I have to purge it all and redo it again?</p>",
        "post_number": 13,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-09T14:06:50.722Z",
        "reply_count": 1,
        "reply_to_post_number": 12,
        "quote_count": 0,
        "incoming_link_count": 4,
        "reads": 87,
        "readers_count": 86,
        "score": 42.4,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Thomas Johson",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 311,
          "username": "ThomasJ",
          "name": "Thomas Johson",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 311,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/13",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2293,
        "name": "Markus Pilman",
        "username": "markus.pilman",
        "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
        "created_at": "2018-10-09T15:48:33.272Z",
        "cooked": "<p>So one thing you can try (this is a long shot but it is cheap to try) is  to kill the master process. fdbmonitor will automatically restart it and it will force fdb to do a recovery.</p>\n<p>We ran into a problem before where the master seemed to \u201cforget\u201d about some partitions. We never managed to find a way to reproduce the problem but killing the master usually fixed it. But we usually only \u201clost\u201d one copy of the data, not all three of them. But it is still worth a try.</p>",
        "post_number": 14,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-09T15:48:33.272Z",
        "reply_count": 1,
        "reply_to_post_number": 13,
        "quote_count": 0,
        "incoming_link_count": 27,
        "reads": 84,
        "readers_count": 83,
        "score": 156.8,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Markus Pilman",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 311,
          "username": "ThomasJ",
          "name": "Thomas Johson",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 15,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/14",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2295,
        "name": "Thomas Johson",
        "username": "ThomasJ",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
        "created_at": "2018-10-09T21:42:37.040Z",
        "cooked": "<p>Funny enough, that\u2019s exactly what I did (out of desperation) and the whole cluster recovered after that. Quite surprising to be honest.</p>\n<p>But at least I now know, never to run multiple <code>status</code> at the same time and how to deal with outages of this kind.</p>\n<p>Really appreciate all the help you guys gave me.</p>",
        "post_number": 15,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-09T21:42:37.040Z",
        "reply_count": 1,
        "reply_to_post_number": 14,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 78,
        "readers_count": 77,
        "score": 20.6,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Thomas Johson",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 15,
          "username": "markus.pilman",
          "name": "Markus Pilman",
          "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 311,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/15",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2296,
        "name": "Markus Pilman",
        "username": "markus.pilman",
        "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
        "created_at": "2018-10-09T21:48:24.843Z",
        "cooked": "<p>Glad to hear you could fix this problem. This is definitely a bug.</p>\n<p><a class=\"mention\" href=\"/u/ajbeamon\">@ajbeamon</a> We had this happen to us as well (master randomly losing track of some partitions or storage servers). We never managed to reproduce this in a test environment. If you guys have any idea how to reproduce this or what this bug could be would be great! Maybe create a bug report for this? I am honestly a bit out of ideas of how to reproduce and fix this. But as we are not the only one seeing this behavior, this seems definitely a bug somewhere (also it seems to exist for quite a while).</p>",
        "post_number": 16,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-09T21:48:24.843Z",
        "reply_count": 2,
        "reply_to_post_number": 15,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 77,
        "readers_count": 76,
        "score": 35.4,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Markus Pilman",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 311,
          "username": "ThomasJ",
          "name": "Thomas Johson",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 15,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/16",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2297,
        "name": "Thomas Johson",
        "username": "ThomasJ",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
        "created_at": "2018-10-09T22:13:12.033Z",
        "cooked": "<p>Maybe it could be reproduced the way I done it? That I introduced only a few server at a time to the cluster and then the cluster was just not able to recover from it? The second all processes got restarted, things recovered within an hour.</p>",
        "post_number": 17,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-09T22:13:12.033Z",
        "reply_count": 0,
        "reply_to_post_number": 16,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 75,
        "readers_count": 74,
        "score": 20.0,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Thomas Johson",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 15,
          "username": "markus.pilman",
          "name": "Markus Pilman",
          "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 311,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/17",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2298,
        "name": "Matt Lohier",
        "username": "aqua",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/a/b9bd4f/{size}.png",
        "created_at": "2018-10-09T22:44:22.849Z",
        "cooked": "<p>Good team work figuring out what could have happened and finding a way to recover it <img src=\"https://emoji.discourse-cdn.com/twitter/clap.png?v=6\" title=\":clap:\" class=\"emoji\" alt=\":clap:\"><br>\nI went to change my telegraf collection also to only run telegraf from a single monitoring node. So thank you!</p>\n<p>Also <a class=\"mention\" href=\"/u/thomasj\">@ThomasJ</a> I wanted to check if you had just run a \u2018kill\u2019 of the FDB process running the master role or if you had done this differently, in case it happens to anyone else. Was the master process re-created on the same node automatically?<br>\nCheers!</p>",
        "post_number": 18,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-09T22:44:22.849Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 73,
        "readers_count": 72,
        "score": 19.6,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Matt Lohier",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 255,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/18",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2302,
        "name": "Thomas Johson",
        "username": "ThomasJ",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
        "created_at": "2018-10-10T15:40:37.492Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"aqua\" data-post=\"18\" data-topic=\"751\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://avatars.discourse-cdn.com/v4/letter/a/b9bd4f/48.png\" class=\"avatar\"> aqua:</div>\n<blockquote>\n<p>if you had just run a \u2018kill\u2019 of the FDB process running the master role or if you had done this differently, in case it happens to anyone else. Was the master process re-created on the same node automatically?</p>\n</blockquote>\n</aside>\n<p>Just that. Rann <code>kill; kill all</code> and the system came back up after an hour or so. It seems everything went smoothly afterwards.</p>\n<p>One thing I\u2019ve noticed, because there is 70 servers now running, first time I call status it always fails with unknowns e.g.</p>\n<pre><code class=\"lang-auto\">fdb&gt; status\n\nUsing cluster file `fdb.cluster'.\n\nUnable to communicate with the cluster controller at 10.128.0.125:4503 to get\nstatus.\n\nConfiguration:\n  Redundancy mode        - unknown\n  Storage engine         - unknown\n  Coordinators           - unknown\n\nCluster:\n  FoundationDB processes - unknown\n  Machines               -\n  Machines               - unknown\n\nData:\n  Replication health     - unknown\n  Moving data            - unknown\n  Sum of key-value sizes - unknown\n  Disk space used        - unknown\n\nOperating space:\n  Unable to retrieve operating space status\n\nWorkload:\n  Read rate              - unknown\n  Write rate             - unknown\n  Transactions started   - unknown\n  Transactions committed - unknown\n  Conflict rate          - unknown\n\nBackup and DR:\n  Running backups        - 0\n  Running DRs            - 0\n\nClient time: 10/10/18 08:36:36\n</code></pre>\n<p>Maybe there is some other way how to collect statistics across the nodes? I know <a class=\"mention\" href=\"/u/ajbeamon\">@ajbeamon</a> mentioned that this may be reworked in 6.0, but not sure if it addresses this exact issue.</p>",
        "post_number": 19,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-10T15:40:37.492Z",
        "reply_count": 1,
        "reply_to_post_number": 18,
        "quote_count": 1,
        "incoming_link_count": 1,
        "reads": 79,
        "readers_count": 78,
        "score": 25.8,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "Thomas Johson",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 311,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/19",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2303,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2018-10-10T16:05:46.617Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"markus.pilman\" data-post=\"16\" data-topic=\"751\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/markus.pilman/48/379_2.png\" class=\"avatar\"> markus.pilman:</div>\n<blockquote>\n<p>We had this happen to us as well (master randomly losing track of some partitions or storage servers). We never managed to reproduce this in a test environment. If you guys have any idea how to reproduce this or what this bug could be would be great! Maybe create a bug report for this? I am honestly a bit out of ideas of how to reproduce and fix this. But as we are not the only one seeing this behavior, this seems definitely a bug somewhere (also it seems to exist for quite a while).</p>\n</blockquote>\n</aside>\n<p>The one issue I know of here is the one I mentioned where status is pessimistic about how many replicas remain when there is a lot of queued data movement. Data movements are given priorities based on why those movements are happening, with higher priorities given to movements restoring the replication factor. The fewer replicas of the data that remain, the higher the priority is. I believe we are currently determining what to report in status based on the highest priority active data movement task. It seems that when a lot of data movement is queued, these high priority tasks are sticking around for a while.</p>\n<p>I\u2019m not sure if this happens only when the data movement becomes unnecessary or if they would also be slow to get executed if they were still needed. I\u2019m not that familiar with how priorities are dealt with in data distribution and how data movement gets canceled, but I do intend to address this issue before too long (and I can raise a GitHub issue for it - <a href=\"https://github.com/apple/foundationdb/issues/833\" class=\"inline-onebox\">Status replication health is pessimistic when replication factor is restored and a lot of data movement is queued \u00b7 Issue #833 \u00b7 apple/foundationdb \u00b7 GitHub</a>).</p>\n<p>In this case, the replication factor should return to normal when data movement completes, or possibly before. It should also be the case that the data is still accessible in the cluster. I think this is what happened in Thomas\u2019s case, though possibly due to space issues the data movement was unable to complete. Bouncing the cluster (or just the master even) would have restarted data distribution and cleared out the high priority movement, but I\u2019m not sure why it helped with the space issue.</p>\n<p>Does the above seem like it may be what you\u2019ve encountered? If not and you have any other details that could point me in the right direction, please let me know.</p>\n<p>EDIT:</p>\n<aside class=\"quote no-group\">\n<blockquote>\n<p>I\u2019m not sure why it helped with the space issue.</p>\n</blockquote>\n</aside>\n<p>Given that it took a while for the cluster to come back after bouncing the master, it may have been the combination of a few factors. The data movement to re-replicate the data would have been cancelled, removing pressure on disk space and opening the way for lower priority rebalancing work to happen. Additionally, the gradual process of reclaiming cleared data (which also occurs as a result of data movement) could be helping as well.</p>",
        "post_number": 20,
        "post_type": 1,
        "posts_count": 32,
        "updated_at": "2018-10-10T16:34:55.176Z",
        "reply_count": 1,
        "reply_to_post_number": 16,
        "quote_count": 1,
        "incoming_link_count": 6,
        "reads": 81,
        "readers_count": 80,
        "score": 51.2,
        "yours": false,
        "topic_id": 751,
        "topic_slug": "troubles-scaling-up-the-cluster",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 3,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/issues/833",
            "internal": false,
            "reflection": false,
            "title": "Status replication health is pessimistic when replication factor is restored and a lot of data movement is queued \u00b7 Issue #833 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 7
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/troubles-scaling-up-the-cluster/751/20",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      2265,
      2270,
      2273,
      2278,
      2279,
      2283,
      2284,
      2285,
      2286,
      2288,
      2289,
      2290,
      2292,
      2293,
      2295,
      2296,
      2297,
      2298,
      2302,
      2303,
      2304,
      2305,
      2317,
      2320,
      2321,
      2508,
      2510,
      2511,
      2515,
      2517,
      2521,
      2523
    ]
  },
  "timeline_lookup": [
    [
      1,
      2571
    ],
    [
      3,
      2570
    ],
    [
      13,
      2569
    ],
    [
      19,
      2568
    ],
    [
      23,
      2567
    ],
    [
      26,
      2547
    ],
    [
      31,
      2546
    ]
  ],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Troubles scaling up the cluster",
  "id": 751,
  "title": "Troubles scaling up the cluster",
  "posts_count": 32,
  "created_at": "2018-10-08T03:24:54.004Z",
  "views": 3747,
  "reply_count": 26,
  "like_count": 0,
  "last_posted_at": "2018-11-01T16:26:01.527Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "troubles-scaling-up-the-cluster",
  "category_id": 7,
  "word_count": 4902,
  "deleted_at": null,
  "user_id": 311,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_751",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 32,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 6,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": null,
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 311,
        "username": "ThomasJ",
        "name": "Thomas Johson",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
        "post_count": 17,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 12,
        "username": "ajbeamon",
        "name": "A.J. Beamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "post_count": 8,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      },
      {
        "id": 15,
        "username": "markus.pilman",
        "name": "Markus Pilman",
        "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
        "post_count": 4,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      },
      {
        "id": 13,
        "username": "alexmiller",
        "name": "Alex Miller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 4
      },
      {
        "id": 255,
        "username": "aqua",
        "name": "Matt Lohier",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/a/b9bd4f/{size}.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      },
      {
        "id": 166,
        "username": "gaurav",
        "name": "gaurav",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 3
      }
    ],
    "created_by": {
      "id": 311,
      "username": "ThomasJ",
      "name": "Thomas Johson",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png"
    },
    "last_poster": {
      "id": 311,
      "username": "ThomasJ",
      "name": "Thomas Johson",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png"
    },
    "links": [
      {
        "url": "https://forums.foundationdb.org/t/cluster-controller-cpu-utilization-pegged/740",
        "title": "Cluster Controller CPU Utilization Pegged",
        "internal": true,
        "attachment": false,
        "reflection": false,
        "clicks": 20,
        "user_id": 166,
        "domain": "forums.foundationdb.org",
        "root_domain": "foundationdb.org"
      },
      {
        "url": "https://github.com/apple/foundationdb/pull/687",
        "title": "Fixed problems found when migrating a cluster to usable_regions=2 by etschannen \u00b7 Pull Request #687 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 16,
        "user_id": 12,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://forums.foundationdb.org/t/migrating-from-a-large-cluster-to-another/721",
        "title": "Migrating from a large cluster to another",
        "internal": true,
        "attachment": false,
        "reflection": false,
        "clicks": 11,
        "user_id": 166,
        "domain": "forums.foundationdb.org",
        "root_domain": "foundationdb.org"
      },
      {
        "url": "https://forums.foundationdb.org/t/migrating-from-a-large-cluster-to-another/721/4",
        "title": "Migrating from a large cluster to another",
        "internal": true,
        "attachment": false,
        "reflection": false,
        "clicks": 11,
        "user_id": 12,
        "domain": "forums.foundationdb.org",
        "root_domain": "foundationdb.org"
      },
      {
        "url": "https://github.com/apple/foundationdb/issues/833",
        "title": "Status replication health is pessimistic when replication factor is restored and a lot of data movement is queued \u00b7 Issue #833 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 7,
        "user_id": 12,
        "domain": "github.com",
        "root_domain": "github.com"
      }
    ]
  },
  "bookmarks": []
}