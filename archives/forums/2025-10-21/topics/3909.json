{
  "post_stream": {
    "posts": [
      {
        "id": 12726,
        "name": "",
        "username": "mAdkins23",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/m/7993a0/{size}.png",
        "created_at": "2023-04-17T00:45:59.767Z",
        "cooked": "<p>I\u2019m trying stuff to see what happens. It seems like removing a directory leaves some keys in place.</p>\n<p>This is my test program (in Go):</p>\n<pre><code class=\"lang-auto\">package main\n\nimport (\n\t\"fmt\"\n\t\"log\"\n\n\t\"github.com/apple/foundationdb/bindings/go/src/fdb\"\n\t\"github.com/apple/foundationdb/bindings/go/src/fdb/directory\"\n\t\"github.com/apple/foundationdb/bindings/go/src/fdb/tuple\"\n)\n\nfunc main() {\n\t// Different API versions may expose different runtime behaviors.\n\t// Don't set this above the maximum for the FoundationDB version in use.\n\tfdb.MustAPIVersion(630)\n\n\t// Open the default database from the system cluster\n\tdb := fdb.MustOpenDefault()\n\n\tds, e := directory.CreateOrOpen(db, []string{\"testdir\"}, nil)\n\tif e != nil {\n\t\tlog.Fatalf(\"Unable to create/open directory: %s\\n\", e)\n\t}\n\n\ttup := []tuple.TupleElement{[]byte(\"one\")}\n\tbegin := []tuple.TupleElement{[]byte(\"\")}\n\tend := []tuple.TupleElement{[]byte(\"\\xFF\")}\n\n\t// Database reads and writes happen inside transactions\n\t_, e = db.Transact(func(tr fdb.Transaction) (interface{}, error) {\n\t\tpacked := ds.Pack(tup)\n\t\tfmt.Printf(\"Packed: %s\\n\", packed)\n\t\ttr.Set(packed, []byte(\"loneliest number\"))\n\t\treturn nil, nil\n\t})\n\tif e != nil {\n\t\tlog.Fatalf(\"Unable to perform FDB transaction (%v)\", e)\n\t}\n\n\t_, e = db.Transact(func(tr fdb.Transaction) (interface{}, error) {\n\t\trangeResult := tr.GetRange(fdb.KeyRange{ds.Pack(begin), ds.Pack(end)}, fdb.RangeOptions{})\n\t\trangeIterator := rangeResult.Iterator()\n\n\t\t// Advance will return true until the iterator is exhausted\n\t\tfor rangeIterator.Advance() {\n\t\t\tif kv, e := rangeIterator.Get(); e != nil {\n\t\t\t\treturn nil, fmt.Errorf(\"read next value: %w\", e)\n\t\t\t} else {\n\t\t\t\tfmt.Printf(\"Key:  %s =&gt; %s\\n\", string(kv.Key), string(kv.Value))\n\t\t\t}\n\t\t}\n\n\t\treturn nil, nil\n\t})\n\tif e != nil {\n\t\tlog.Fatalf(\"Unable to perform FDB range iteration (%v)\", e)\n\t}\n\n\t// Clear keys.\n\t_, e = db.Transact(func(tr fdb.Transaction) (interface{}, error) {\n\t\tdone, err := ds.Remove(db, nil)\n\t\tif err != nil {\n\t\t\tlog.Fatalf(\"Removing diretory: %s\\n\", err)\n\t\t}\n\t\tif !done {\n\t\t\tfmt.Printf(\"Not done?\\n\")\n\t\t}\n\t\treturn nil, nil\n\t})\n\tif e != nil {\n\t\tlog.Fatalf(\"Unable to perform FDB clear transaction (%v)\", e)\n\t}\n}\n</code></pre>\n<p>This is what\u2019s left after removing the directory:</p>\n<pre><code class=\"lang-auto\">fdb&gt; getrange \"\" \"\\xFF\"\n\nRange limited to 25 keys\n`\\xfe\\x01\\xfe\\x00\\x01hca\\x00\\x14\\x14' is `\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00'\n`\\xfe\\x01\\xfe\\x00\\x01hca\\x00\\x15\\x01\\x15\\x12' is `'\n`\\xfe\\x01\\xfe\\x00\\x01version\\x00' is `\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'\n</code></pre>\n<p>For comparison, commenting out the directory close statement shows the intermediate value:</p>\n<pre><code class=\"lang-auto\">fdb&gt; getrange \"\" \"\\xFF\"\n\nRange limited to 25 keys\n`\\x15\\x12\\x01one\\x00' is `loneliest number'\n`\\xfe\\x01\\x15\\x12\\x00\\x01layer\\x00' is `'\n`\\xfe\\x01\\xfe\\x00\\x01hca\\x00\\x14\\x14' is `\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00'\n`\\xfe\\x01\\xfe\\x00\\x01hca\\x00\\x15\\x01\\x15\\x12' is `'\n`\\xfe\\x01\\xfe\\x00\\x01version\\x00' is `\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00'\n`\\xfe\\x01\\xfe\\x00\\x14\\x02testdir\\x00' is `\\x15\\x12'\n</code></pre>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2023-04-17T00:45:59.767Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 92,
        "reads": 28,
        "readers_count": 27,
        "score": 465.6,
        "yours": false,
        "topic_id": 3909,
        "topic_slug": "directory-removal-leaves-stuff-in-database",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1242,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/directory-removal-leaves-stuff-in-database/3909/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 12758,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2023-04-23T22:58:58.572Z",
        "cooked": "<p>The keys left are state associated with the directory layer, and they aren\u2019t connected with any particular directory. They will be present even if you delete all of your directories, but if you are done with the directory layer they can be deleted. Note that if you then try to recreate the directory layer after that, it may then reuse directory prefixes.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2023-04-23T22:58:58.572Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 17,
        "readers_count": 16,
        "score": 3.4,
        "yours": false,
        "topic_id": 3909,
        "topic_slug": "directory-removal-leaves-stuff-in-database",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/directory-removal-leaves-stuff-in-database/3909/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      12726,
      12758
    ]
  },
  "timeline_lookup": [
    [
      1,
      919
    ],
    [
      2,
      912
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Directory removal leaves stuff in database",
  "id": 3909,
  "title": "Directory removal leaves stuff in database",
  "posts_count": 2,
  "created_at": "2023-04-17T00:45:59.695Z",
  "views": 399,
  "reply_count": 0,
  "like_count": 0,
  "last_posted_at": "2023-04-23T22:58:58.572Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "directory-removal-leaves-stuff-in-database",
  "category_id": 7,
  "word_count": 530,
  "deleted_at": null,
  "user_id": 1242,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_3909",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 2,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Directory recreate and left over data",
      "id": 2981,
      "title": "Directory recreate and left over data",
      "slug": "directory-recreate-and-left-over-data",
      "posts_count": 1,
      "reply_count": 0,
      "highest_post_number": 1,
      "image_url": null,
      "created_at": "2021-11-01T16:29:10.987Z",
      "last_posted_at": "2021-11-01T16:29:11.061Z",
      "bumped": true,
      "bumped_at": "2021-11-01T16:29:11.061Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 280,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest single",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 1027,
            "username": "randyhu",
            "name": "Randy Hu",
            "avatar_template": "/user_avatar/forums.foundationdb.org/randyhu/{size}/1224_2.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Atomic_Add(key, -1) can &ldquo;leak&rdquo; keys with value 0 if you are not careful",
      "id": 148,
      "title": "Atomic_Add(key, -1) can \"leak\" keys with value 0 if you are not careful",
      "slug": "atomic-add-key-1-can-leak-keys-with-value-0-if-you-are-not-careful",
      "posts_count": 5,
      "reply_count": 2,
      "highest_post_number": 5,
      "image_url": null,
      "created_at": "2018-04-20T19:00:47.495Z",
      "last_posted_at": "2018-04-21T10:05:05.991Z",
      "bumped": true,
      "bumped_at": "2018-04-21T10:05:05.991Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 817,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 111,
            "username": "andoma",
            "name": "Andreas Smas",
            "avatar_template": "/user_avatar/forums.foundationdb.org/andoma/{size}/78_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 54,
            "username": "Evan",
            "name": "Evan Tschannen",
            "avatar_template": "/user_avatar/forums.foundationdb.org/evan/{size}/104_2.png",
            "moderator": true,
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 22,
            "username": "dave",
            "name": "David Scherer",
            "avatar_template": "/user_avatar/forums.foundationdb.org/dave/{size}/89_2.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Application design using Subspace and Tuple",
      "id": 452,
      "title": "Application design using Subspace and Tuple",
      "slug": "application-design-using-subspace-and-tuple",
      "posts_count": 9,
      "reply_count": 7,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2018-05-22T21:46:43.537Z",
      "last_posted_at": "2018-07-14T21:02:50.010Z",
      "bumped": true,
      "bumped_at": "2018-07-14T21:02:50.010Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 5,
      "views": 3678,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 211,
            "username": "brk0v",
            "name": "Viacheslav Biriukov",
            "avatar_template": "/user_avatar/forums.foundationdb.org/brk0v/{size}/173_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 317,
            "username": "Lundin",
            "name": "Pontus Lundin",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/l/dfb087/{size}.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Data retention after deleting a key range using SSD engine",
      "id": 2190,
      "title": "Data retention after deleting a key range using SSD engine",
      "slug": "data-retention-after-deleting-a-key-range-using-ssd-engine",
      "posts_count": 9,
      "reply_count": 5,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2020-06-18T16:06:24.766Z",
      "last_posted_at": "2020-06-22T12:07:30.047Z",
      "bumped": true,
      "bumped_at": "2020-06-22T12:07:30.047Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 4,
      "views": 1379,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 481,
            "username": "mikerhodes",
            "name": "Mike Rhodes",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mikerhodes/{size}/480_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 714,
            "username": "tuk",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/b5ac83/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 7,
            "username": "SteavedHams",
            "name": "Steve Atherton",
            "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        }
      ]
    },
    {
      "fancy_title": "Questions of extraneous keys received via Go binding on a full range read",
      "id": 2649,
      "title": "Questions of extraneous keys received via Go binding on a full range read",
      "slug": "questions-of-extraneous-keys-received-via-go-binding-on-a-full-range-read",
      "posts_count": 3,
      "reply_count": 1,
      "highest_post_number": 3,
      "image_url": null,
      "created_at": "2021-04-11T20:49:00.028Z",
      "last_posted_at": "2021-04-12T16:23:09.328Z",
      "bumped": true,
      "bumped_at": "2021-04-12T16:23:09.328Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 340,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 405,
            "username": "harikb",
            "name": "Hari B",
            "avatar_template": "/user_avatar/forums.foundationdb.org/harikb/{size}/1033_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 12,
        "username": "ajbeamon",
        "name": "A.J. Beamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      },
      {
        "id": 1242,
        "username": "mAdkins23",
        "name": "",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/m/7993a0/{size}.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      }
    ],
    "created_by": {
      "id": 1242,
      "username": "mAdkins23",
      "name": "",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/m/7993a0/{size}.png"
    },
    "last_poster": {
      "id": 12,
      "username": "ajbeamon",
      "name": "A.J. Beamon",
      "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png"
    }
  },
  "bookmarks": []
}