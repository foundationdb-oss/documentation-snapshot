{
  "post_stream": {
    "posts": [
      {
        "id": 3833,
        "name": "Ray Jenkins",
        "username": "rjenkins",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png",
        "created_at": "2019-04-04T19:04:42.476Z",
        "cooked": "<p>Hi All,</p>\n<p>I noticed today our production cluster on 6.0.18 is reporting via fdbcli <code>status</code></p>\n<p><code>Fault Tolerance - 0 machines (1 without data loss)</code></p>\n<p>Unsure why, as it is provisioned for triple and has sufficient capacity to handle 2 machine failures, I ran an experiment in staging and I\u2019m seeing the same results. Our cluster is deployed in AWS and uses 3 distinct ASGs. We assign a process class to the nodes per ASG, either transaction, stateless, or storage, (per previous configuration guidelines discussed here, primarily from <a class=\"mention\" href=\"/u/alexmiller\">@alexmiller</a>\u2019s posts). <a href=\"https://forums.foundationdb.org/t/cluster-tuning-cookbook/520/7\" class=\"inline-onebox\">Cluster tuning cookbook</a> / <a href=\"https://forums.foundationdb.org/t/questions-about-process-classes-recruitment-behavior-and-cluster-configuration/1177\" class=\"inline-onebox\">Questions about process classes, recruitment behavior and cluster configuration</a></p>\n<p>Here is a rough timeline of my steps in order to reproduce.</p>\n<ol>\n<li>Boot 3 node cluster (1 txn log nodes, 1 storage node, 1 stateless node), sdd engine, single redundancy mode. fdbcli status reports <code>Fault Tolerance of 0 Machines</code>, as expected.</li>\n<li>Scale cluster up to 9 nodes (3 txn, 3 storage, 3 stateless), configure double, re-coordinate with coordinators auto. After cluster heals to achieve the double replica config, fdbcli status reports   <code>Fault Tolerance - 1 machine</code>. At this point I increased the number of logs to 6 and proxies to 9 with <code>configure logs=6</code> and <code>configure proxies=9</code> as I had extra processes running on these new boxes that weren\u2019t yet recruited. <code>Fault Tolerance showed 1 machine</code> as expected. Great, everything is working fine at this point!</li>\n<li>Scale cluster up to 15 nodes (5 txn, 5 storage, 5 stateless), configure triple, re-coordinate with coordinators auto. <code>fdbcli coordinators</code> reports 5 coordinators as expected. After cluster heals to support triple replica <code>fdbcli status</code> shows. <code>Fault Tolerance - 0 machines (1 without data loss)</code>.</li>\n</ol>\n<p>At this point I reduced the number of txn logs and proxies to 3 just to see if that made a difference but we\u2019re still showing  <code>Fault Tolerance - 0 machines (1 without data loss).</code></p>\n<p>Is it possible this is a known issues in the <code>fdbcli status</code> output? Here\u2019s some additional configuration info.</p>\n<pre><code class=\"lang-auto\">  Redundancy mode        - triple\n  Storage engine         - ssd-2\n  Coordinators           - 5\n  Desired Proxies        - 3\n  Desired Logs           - 3\n\nCluster:\n  FoundationDB processes - 50\n  Machines               - 15\n  Memory availability    - 1.8 GB per process on machine with least available\n                           &gt;&gt;&gt;&gt;&gt; (WARNING: 4.0 GB recommended) &lt;&lt;&lt;&lt;&lt;\n  Fault Tolerance        - 0 machines (1 without data loss)\n  Server time            - 04/04/19 18:52:01\n\nData:\n  Replication health     - Healthy (Rebalancing)\n  Moving data            - 0.000 GB\n  Sum of key-value sizes - 56.471 GB\n  Disk space used        - 306.350 GB\n\nOperating space:\n  Storage server         - 753.7 GB free on most full server\n  Log server             - 420.2 GB free on most full server\n\nWorkload:\n  Read rate              - 31 Hz\n  Write rate             - 96 Hz\n  Transactions started   - 21 Hz\n  Transactions committed - 17 Hz\n  Conflict rate          - 0 Hz\n\nBackup and DR:\n  Running backups        - 0\n  Running DRs            - 0\n\nClient time: 04/04/19 18:52:01\n</code></pre>\n<p>fdbtop output<br>\n\u2014 snip \u2014</p>\n<pre><code class=\"lang-auto\">ssh 10.30.0.4 \"fdbcli --exec 'status json'\" | fdbtop\nip               port    cpu%  mem%  iops    net  class          roles               \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.0.4        4500    0     2     -       0    stateless                         \n                  4501    0     2     -       0    stateless                         \n                  4502    1     2     -       0    stateless      proxy              \n                  4503    0     2     -       0    stateless                         \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.137.101    4500    0     2     -       0    stateless                         \n                  4501    3     3     -       1    stateless      cluster_controller \n                  4502    1     2     -       0    stateless                         \n                  4503    1     2     -       0    stateless      resolver           \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.137.244    4500    1     3     -       0    transaction                       \n                  4501    2     5     27      1    transaction    log                \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.141.54     4500    0     2     -       0    stateless                         \n                  4501    2     3     -       1    stateless      master             \n                  4502    0     2     -       0    stateless                         \n                  4503    0     2     -       0    stateless                         \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.148.89     4500    2     33    892     0    storage        storage            \n                  4501    3     33    888     0    storage        storage            \n                  4502    2     32    853     0    storage        storage            \n                  4503    2     33    853     0    storage        storage            \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.155.43     4500    2     30    239     0    storage        storage            \n                  4501    2     32    231     0    storage        storage            \n                  4502    1     31    231     0    storage        storage            \n                  4503    2     31    239     0    storage        storage            \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.18.143     4500    3     4     27      1    transaction    log                \n                  4501    1     4     -       0    transaction                       \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.19.134     4500    1     3     -       0    stateless                         \n                  4501    0     2     -       0    stateless                         \n                  4502    1     3     -       0    stateless                         \n                  4503    1     3     -       0    stateless                         \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.22.64      4500    3     34    1191    0    storage        storage            \n                  4501    3     33    1160    0    storage        storage            \n                  4502    3     33    1201    0    storage        storage            \n                  4503    3     34    1160    0    storage        storage            \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.25.13      4500    2     3     -       0    transaction                       \n                  4501    1     3     -       0    transaction                       \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.64.114     4500    2     31    413     0    storage        storage            \n                  4501    1     31    413     0    storage        storage            \n                  4502    1     31    364     0    storage        storage            \n                  4503    2     32    413     0    storage        storage            \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.65.151     4500    2     3     -       0    transaction                       \n                  4501    1     4     -       0    transaction                       \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.74.43      4500    2     32    1013    0    storage        storage            \n                  4501    3     32    1024    0    storage        storage            \n                  4502    2     33    1024    0    storage        storage            \n                  4503    2     33    1024    0    storage        storage            \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.76.74      4500    2     4     -       0    transaction                       \n                  4501    2     4     27      0    transaction    log                \n---------------  ------  ----  ----  ------  ---  -------------  --------------------\n 10.30.79.79      4500    1     3     -       0    stateless                         \n                  4501    1     3     -       0    stateless      proxy              \n                  4502    1     3     -       0    stateless                         \n                  4503    1     4     -       0    stateless      proxy              \n</code></pre>\n<p>Thanks<br>\n-R</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-04T19:04:42.476Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 384,
        "reads": 74,
        "readers_count": 73,
        "score": 1934.8,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "Ray Jenkins",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://forums.foundationdb.org/t/questions-about-process-classes-recruitment-behavior-and-cluster-configuration/1177",
            "internal": true,
            "reflection": false,
            "title": "Questions about process classes, recruitment behavior and cluster configuration",
            "clicks": 5
          },
          {
            "url": "https://forums.foundationdb.org/t/cluster-tuning-cookbook/520/7",
            "internal": true,
            "reflection": false,
            "title": "Cluster tuning cookbook",
            "clicks": 3
          }
        ],
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 490,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 3834,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2019-04-04T19:50:38.696Z",
        "cooked": "<p>Any chance you could send over the output of <code>status json</code> as well?</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-04T19:50:38.696Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 56,
        "readers_count": 55,
        "score": 21.2,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 3836,
        "name": "Ray Jenkins",
        "username": "rjenkins",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png",
        "created_at": "2019-04-04T20:05:34.675Z",
        "cooked": "<p><a class=\"mention\" href=\"/u/ajbeamon\">@ajbeamon</a> I believe it\u2019s too large to post on the forum, the form will reject. Is there a particular part you want me to snip, or perhaps attach in an email?</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-04T20:05:34.675Z",
        "reply_count": 0,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 58,
        "readers_count": 57,
        "score": 26.6,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "Ray Jenkins",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "reply_to_user": {
          "id": 12,
          "username": "ajbeamon",
          "name": "A.J. Beamon",
          "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 490,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/4",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 3838,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2019-04-04T20:36:10.553Z",
        "cooked": "<p>It looks like this is happening because there are only 3 Zone IDs being used in the cluster. The Zone ID represents different fault domains in the cluster, which we use for distributing data that needs to be sufficiently failure independent. For example, the different replicas of each piece of data must live in separate fault domains. The fault tolerance calculation is actually counting how many fault domains you can lose, and I believe the reason you would lose availability after 1 fault domain failure is that the cluster wouldn\u2019t be able to recruit logs in the required three different fault domains.</p>\n<p>That status describes your fault tolerance in terms of machines is a relic of the fact that in the past, our only fault domain was at the machine level (although you could trick it by manually assigning machine IDs). I think we need to clean up the language around this area a bit. Additionally, I think we should log additional information about zone counts in the status output, which could help to identify these issues more easily. I\u2019ve recently filed a <a href=\"https://github.com/apple/foundationdb/issues/1420\" rel=\"nofollow noopener\">GitHub issue</a> to that effect.</p>\n<p>As for how to resolve your current issue, I think you\u2019ll need to choose a different unit to serve as your fault domain, such as machines or racks, etc. Or you could add more of your current zones if that made sense.</p>\n<p>If you need to maintain certain properties with respect to how the cluster distributes data between your current zones such that you can\u2019t easily use a finer grained zone, it may be possible to make this work with a multi-datacenter mode. There have been a variety of changes in this area recently, and I\u2019m admittedly not an expert on the state-of-the-art here, so maybe <a class=\"mention\" href=\"/u/alexmiller\">@alexmiller</a> or <a class=\"mention\" href=\"/u/evan\">@Evan</a> could provide more guidance on that.</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-04T20:38:29.462Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 5,
        "reads": 59,
        "readers_count": 58,
        "score": 41.8,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/issues/1420",
            "internal": false,
            "reflection": false,
            "title": "Add zone count to regular fdbcli status output \u00b7 Issue #1420 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 6
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/5",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 3839,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2019-04-04T20:39:26.406Z",
        "cooked": "<p>I also created <a href=\"https://github.com/apple/foundationdb/issues/1421\" rel=\"nofollow noopener\">https://github.com/apple/foundationdb/issues/1421</a> to update the language we use when reporting fault tolerance.</p>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-04T20:39:26.406Z",
        "reply_count": 1,
        "reply_to_post_number": 5,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 59,
        "readers_count": 58,
        "score": 21.8,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/issues/1421",
            "internal": false,
            "reflection": false,
            "title": "Clarify language about fault tolerance in status \u00b7 Issue #1421 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 10
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 12,
          "username": "ajbeamon",
          "name": "A.J. Beamon",
          "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/6",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 3841,
        "name": "Ray Jenkins",
        "username": "rjenkins",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png",
        "created_at": "2019-04-04T21:49:16.326Z",
        "cooked": "<p><a class=\"mention\" href=\"/u/ajbeamon\">@ajbeamon</a> Thank you for the explanation! When I built the tooling for the cluster I added <code>locality_zoneid</code> to the build process and selected the AWS availability zone to use for my <code>locality_zoneid</code>. I did this primarily to ensure when set to <code>triple</code> my data would be properly distributed across storage replicas in 3 distinct AZs. This is to avoid the risk of all replicas landing in a single AZ. It is quite common to deploy across 3 AZs and distribute your replicas across them for safety, we do this with Kafka and Cassandra, but I did not consider the txn nodes. Now that I think about it, that makes sense.</p>\n<p>It is a bit more nuanced though than what you described, is it not? i.e. <code>I believe the reason you would lose availability after 1 fault domain failure is that the cluster wouldn\u2019t be able to recruit logs in the required three different fault domains.</code></p>\n<p>Let\u2019s say we have 5 txn nodes in the following 3 fault domains. [a,b,c,a,b]. Now as long as we write to at least 3 distinct fault domains [a,b,c] we can sustain a loss of up to two fault domains and not lose any data, correct?</p>\n<p>As far as fulfilling the triple replication contract after failure, if we lose <code>c</code> : [a,b,a,b] remains, two <code>b</code> instances : [a,c,a] remains or two <code>a</code> instances : [b,c,b] remains, then we can no longer sustain the triple replica contract.</p>\n<p>However if we lose a single <code>a</code> or <code>b</code>, or even both an <code>a</code> and <code>b</code> we are left with [ a,b,c ] and that still fulfills triple replication, correct?</p>\n<p>(Note: Edit to s/failure domains/fault domains/)</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-04T22:19:34.340Z",
        "reply_count": 1,
        "reply_to_post_number": 6,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 58,
        "readers_count": 57,
        "score": 31.6,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "Ray Jenkins",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 3,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "reply_to_user": {
          "id": 12,
          "username": "ajbeamon",
          "name": "A.J. Beamon",
          "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 490,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/7",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 3842,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2019-04-04T22:25:37.909Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"rjenkins\" data-post=\"7\" data-topic=\"1282\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/rjenkins/48/487_2.png\" class=\"avatar\"> rjenkins:</div>\n<blockquote>\n<p>Thank you for the explanation! When I built the tooling for the cluster I added <code>locality_zoneid</code> to the build process and selected the AWS availability zone to use for my <code>locality_zoneid</code> . I did this primarily to ensure when set to <code>triple</code> my data would be properly distributed across storage replicas in 3 distinct AZs. This is to avoid the risk of all replicas landing in a single AZ.</p>\n</blockquote>\n</aside>\n<p>I believe this is where the multi-datacenter modes may be able to help, as they can ensure your data is replicated to multiple AZs.</p>\n<aside class=\"quote no-group quote-modified\" data-username=\"rjenkins\" data-post=\"7\" data-topic=\"1282\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/rjenkins/48/487_2.png\" class=\"avatar\"> rjenkins:</div>\n<blockquote>\n<p>Let\u2019s say we have 5 txn nodes in the following 3 fault domains. [a,b,c,a,b]. Now as long as we write to at least 3 distinct failure domains [a,b,c] we can sustain a loss of up to two failure domains and not lose any data, correct?</p>\n</blockquote>\n</aside>\n<p>I think this is mostly correct, as you\u2019ll should still have a copy of 1 replica of data on the storage servers and logs. The reason data fault tolerance is reported as 1, however, is because of the coordinators. I don\u2019t remember all of the ways that you can run into trouble here, but for example it\u2019s possible some failure scenarios could have resulted in a network partition that allowed commits on the other AZs before they disappeared. There may also be potential issues with the state stored on the coordinators if you don\u2019t have a quorum of them available, but I\u2019m not sure of the details there.</p>\n<aside class=\"quote no-group\" data-username=\"rjenkins\" data-post=\"7\" data-topic=\"1282\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/rjenkins/48/487_2.png\" class=\"avatar\"> rjenkins:</div>\n<blockquote>\n<p>However if we lose a single <code>a</code> or <code>b</code> , or even both an <code>a</code> and <code>b</code> we are left with [ a,b,c ] and that still fulfills triple replication, correct?</p>\n</blockquote>\n</aside>\n<p>This is true, though our reporting for fault tolerance isn\u2019t so granular at the moment \u2013 it\u2019s currently only able to tell you how many fault domains you can lose safely. It\u2019s possible as we get into more elaborate configurations that we would want a more expressive way to describe what the fault tolerance is.</p>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-04T22:25:37.909Z",
        "reply_count": 1,
        "reply_to_post_number": 7,
        "quote_count": 1,
        "incoming_link_count": 6,
        "reads": 57,
        "readers_count": 56,
        "score": 46.4,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/8",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 3843,
        "name": "Ray Jenkins",
        "username": "rjenkins",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png",
        "created_at": "2019-04-05T01:08:57.356Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ajbeamon\" data-post=\"8\" data-topic=\"1282\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"> ajbeamon:</div>\n<blockquote>\n<p>I believe this is where the multi-datacenter modes may be able to help, as they can ensure your data is replicated to multiple AZs.</p>\n</blockquote>\n</aside>\n<p>I\u2019d be interesting in hearing more details about your ideas here <a class=\"mention\" href=\"/u/ajbeamon\">@ajbeamon</a>. I was originally under the impression that specifying <code>--datacenter_id</code> was for multi-regional clusters as described here <a href=\"https://apple.github.io/foundationdb/configuration.html#configuring-regions\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Configuration \u2014 FoundationDB 7.1</a>.</p>\n<p>Are you perhaps referring to the data-center-aware mode? <a href=\"https://apple.github.io/foundationdb/configuration.html#datacenter-aware-mode\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Configuration \u2014 FoundationDB 7.1</a> and in particular setting  <code>configure three_datacenter</code>?</p>\n<p>It looks like I\u2019d also need to specify <code>--datacenter_id</code> to use that per the docs.</p>\n<blockquote>\n<p>When using the datacenter-aware mode, all fdbserver processes should be passed a valid datacenter identifier on the command line.</p>\n</blockquote>\n<p>fdb&gt; configure three_datacenter<br>\nERROR: Not enough processes exist to support the specified configuration<br>\nType `configure FORCE *\u2019 to configure without this check</p>\n<p>One thing I am not clear on is how does that differs and interacts with <code>locality_zoneid</code>. The only obvious difference from the docs are triple mode require 3 active fault domains to continue to be available for writes.</p>\n<blockquote>\n<p>triple mode<br>\n(best for 5+ machines)</p>\n<p>FoundationDB replicates data to three machines, and at least three available machines are required to make progress</p>\n</blockquote>\n<p>While <code>three_datacenter</code> (somewhat self contradicting) says it attempts to replicate across two datacenters and stays up if only two are available. It then goes on to say data is triple replicated.</p>\n<blockquote>\n<p>FoundationDB attempts to replicate data across two datacenters and will stay up with only two available. Data is triple replicated. For maximum availability, you should use five coordination servers: two in two of the datacenters and one in the third datacenter.</p>\n</blockquote>\n<p>So is that essentially saying it\u2019s triple replicated, but will remain available for writes as long as two datacenters are still available?</p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-05T01:13:41.281Z",
        "reply_count": 0,
        "reply_to_post_number": 8,
        "quote_count": 1,
        "incoming_link_count": 10,
        "reads": 58,
        "readers_count": 57,
        "score": 61.6,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "Ray Jenkins",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://apple.github.io/foundationdb/configuration.html#configuring-regions",
            "internal": false,
            "reflection": false,
            "title": "Configuration \u2014 FoundationDB 6.0",
            "clicks": 6
          },
          {
            "url": "https://apple.github.io/foundationdb/configuration.html#datacenter-aware-mode",
            "internal": false,
            "reflection": false,
            "title": "Configuration \u2014 FoundationDB 6.0",
            "clicks": 2
          }
        ],
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 490,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/9",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 3844,
        "name": "Evan Tschannen",
        "username": "Evan",
        "avatar_template": "/user_avatar/forums.foundationdb.org/evan/{size}/104_2.png",
        "created_at": "2019-04-05T01:48:16.984Z",
        "cooked": "<p>I actually think the configuration the best matches what you are trying to do is the three_data_hall configuration. The AZs will be specified as the \u201cdata_hall\u201d locality attribute.</p>\n<p>This will require one storage replica in each AZ, similar to what you have now. However, it only requires transaction logs in only two of the three AZs, so that way even if one AZ is down the cluster will still be able to recruit a new generation of transaction logs. Note that this configuration have four total replicas of the transaction log data, so you many need to configuration slightly more processes as transaction logs to keep the same performance as before.</p>\n<p>I just looked and realized we do not have a corresponding three_data_hall_fallback configuration, I will add it as a patch for 6.1. You will need this to discard the data is a failed AZ if the failure lasts long enough that the TLogs become low on space.</p>",
        "post_number": 10,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-05T01:48:16.984Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 4,
        "reads": 52,
        "readers_count": 51,
        "score": 47.4,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "Evan Tschannen",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": true,
        "admin": false,
        "staff": true,
        "user_id": 54,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/10",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 3848,
        "name": "Ray Jenkins",
        "username": "rjenkins",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png",
        "created_at": "2019-04-05T15:58:23.081Z",
        "cooked": "<p>Thanks <a class=\"mention\" href=\"/u/evan\">@Evan</a> and <a class=\"mention\" href=\"/u/ajbeamon\">@ajbeamon</a> . I ran an experiment this morning and I\u2019m curious if this might be a viable work around for us to increase availability while still getting triple replica distribution across the storage nodes. I removed the <code>locality_zoneid </code> from the txn nodes, restarted fdbserver on those machines and now the fdbcli is showing.</p>\n<blockquote>\n<p>Fault Tolerance        - 2 machines</p>\n</blockquote>\n<p>I\u2019ve left <code>locality_zoneid</code> on the stateless and storage nodes.</p>\n<p>Of course, I\u2019m now giving up the ability to ensure these writes are getting replicated across AZs or fault domains on the transaction log nodes. Without the <code>locality_zoneid</code> it\u2019s just reverting back to <code>machine_id</code> and any write could for example, land on 3 txn nodes all in a single AZ, correct?</p>\n<p>As you mention in <a href=\"https://www.youtube.com/watch?v=EMwhsGsxfPU\" rel=\"noopener nofollow ugc\">https://www.youtube.com/watch?v=EMwhsGsxfPU</a> around the nine minute mark, the txn nodes are distributed WALs. Under normal operation you\u2019re fsync\u2019ing and then replicating out to the storage nodes from page cache very quickly, and then cleaning up.</p>\n<p>Assuming I\u2019d be willing to take the risk of non fault domain/AZ-aware transaction log replication and the potential consequence of data loss in the event of losing an AZ, i.e. some set of transactions were replicated across 3 transaction logs nodes in a single AZ, do you foresee any potential issues with this configuration?</p>\n<p>My biggest concern is that I\u2019d be introducing some configuration that has never been tested on FoundationDB, i.e. some portion of machines with and without <code>locality_zoneid</code>, and there are some hidden gotchas.</p>\n<p>However, if you believe this is a viable configuration option, this may be a trade-off we\u2019d consider. Our data is being fed to FoundationDB from Kafka and we already have triple replication there. Further our workload is idempotent, so in the event of such a failure we could restore FoundationDB and simply replay the data from Kafka.</p>",
        "post_number": 11,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-05T15:58:23.081Z",
        "reply_count": 2,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 5,
        "reads": 51,
        "readers_count": 50,
        "score": 45.2,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "Ray Jenkins",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://www.youtube.com/watch?v=EMwhsGsxfPU",
            "internal": false,
            "reflection": false,
            "title": "YouTube",
            "clicks": 4
          }
        ],
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 490,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/11",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 3851,
        "name": "Alex Miller",
        "username": "alexmiller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "created_at": "2019-04-05T16:38:48.927Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"rjenkins\" data-post=\"11\" data-topic=\"1282\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/rjenkins/48/487_2.png\" class=\"avatar\"> rjenkins:</div>\n<blockquote>\n<p>Of course, I\u2019m now giving up the ability to ensure these writes are getting replicated across AZs or fault domains on the transaction log nodes. Without the <code>locality_zoneid</code> it\u2019s just reverting back to <code>machine_id</code> and any write could for example, land on 3 txn nodes all in a single AZ, correct?</p>\n</blockquote>\n</aside>\n<p>The policy for three_data_hall mode is:</p>\n<ul>\n<li>For a team of storage servers, please recruit 1 storage server per datahall</li>\n<li>For transaction logs, please ensure commits are on at least 2 different zoneids in each of 2 different datahalls (minimum 4 logs total)</li>\n</ul>\n<p>So --locality_data_hall is taking the place of --locality_zoneid in ensuring distribution across AZs.  If you had the concept of a rack of machines within your AZ, then it\u2019d be appropriate to set zoneids according to the rack to help prevent the loss of both transaction logs in an AZ at once.</p>\n<p>To be clear, with --locality_data_hall set to the AZ a process is in, you\u2019re still getting replication across AZ\u2019s, and the ability to survive the loss of one, but not two, AZs.</p>",
        "post_number": 12,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-05T16:38:48.927Z",
        "reply_count": 1,
        "reply_to_post_number": 11,
        "quote_count": 1,
        "incoming_link_count": 2,
        "reads": 46,
        "readers_count": 45,
        "score": 24.2,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "Alex Miller",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 13,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/12",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 3852,
        "name": "Ray Jenkins",
        "username": "rjenkins",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png",
        "created_at": "2019-04-05T17:03:05.323Z",
        "cooked": "<p>Hiya <a class=\"mention\" href=\"/u/alexmiller\">@alexmiller</a> thank you for the reply.</p>\n<aside class=\"quote no-group\" data-username=\"alexmiller\" data-post=\"12\" data-topic=\"1282\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/alexmiller/48/326_2.png\" class=\"avatar\"> alexmiller:</div>\n<blockquote>\n<p>So --locality_data_hall is taking the place of --locality_zoneid in ensuring distribution across AZs. If you had the concept of a rack of machines within your AZ, then it\u2019d be appropriate to set zoneids according to the rack to help prevent the loss of both transaction logs in an AZ at once.</p>\n</blockquote>\n</aside>\n<p>Yes I understand the path here Evan and you are describing with the <code>locality_data_hall</code> replacing the use of <code>locality_zoneid</code> on the machines. My reply is actually in regards to a different configuration entirely, that is, using <code>triple</code> and simply removing <code>locality_zoneid</code> on the transaction log nodes. I\u2019m curious if that configuration I describe is a viable one, given the trade-offs, and as a potential interim solution until Evan includes the patch he references in 6.1.</p>\n<p>In terms of moving to the <code>three_data_hall</code> approach that\u2019s definitely on the table for us to consider, it seems like that might be the best approach long term.</p>\n<p>Do you have any additional thoughts on the configuration I described above?</p>",
        "post_number": 13,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-05T17:03:05.323Z",
        "reply_count": 1,
        "reply_to_post_number": 12,
        "quote_count": 1,
        "incoming_link_count": 2,
        "reads": 44,
        "readers_count": 43,
        "score": 23.8,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "Ray Jenkins",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 490,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/13",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 3853,
        "name": "Alex Miller",
        "username": "alexmiller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "created_at": "2019-04-05T17:29:53.678Z",
        "cooked": "<p>Ah, my apologies.  I indeed cannot read, and maybe I shouldn\u2019t respond to forum requests before the morning caffeine\u2026</p>\n<aside class=\"quote no-group\" data-username=\"rjenkins\" data-post=\"11\" data-topic=\"1282\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/rjenkins/48/487_2.png\" class=\"avatar\"> rjenkins:</div>\n<blockquote>\n<p>Without the <code>locality_zoneid</code> it\u2019s just reverting back to <code>machine_id</code> and any write could for example, land on 3 txn nodes all in a single AZ, correct?</p>\n</blockquote>\n</aside>\n<p>This is entirely correct.</p>\n<p>The path of machineid becoming zoneid is well tested; I think it\u2019s what simulation actually does.  I wouldn\u2019t be concerned about running in this way, as most people that know to set --locality_zoneid would also be running in this way.</p>\n<p>If you\u2019re fine potentially having to wipe and recreate your cluster if an AZ goes down, then I agree that this is a configuration you could consider.</p>",
        "post_number": 14,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-05T17:29:53.678Z",
        "reply_count": 0,
        "reply_to_post_number": 13,
        "quote_count": 1,
        "incoming_link_count": 6,
        "reads": 41,
        "readers_count": 40,
        "score": 53.2,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "Alex Miller",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 490,
          "username": "rjenkins",
          "name": "Ray Jenkins",
          "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png"
        },
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 13,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/14",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 3855,
        "name": "Ryan Worl",
        "username": "ryanworl",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
        "created_at": "2019-04-05T18:03:57.046Z",
        "cooked": "<p>It may be worth investigating whether the partition mode of EC2 placement groups would let you manufacture more fault domains per AZ.</p>",
        "post_number": 15,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-05T18:03:57.046Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 41,
        "readers_count": 40,
        "score": 13.2,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "Ryan Worl",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 81,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/15",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 3856,
        "name": "Evan Tschannen",
        "username": "Evan",
        "avatar_template": "/user_avatar/forums.foundationdb.org/evan/{size}/104_2.png",
        "created_at": "2019-04-06T00:41:42.940Z",
        "cooked": "<p>Even without a <code>three_data_hall_fallback</code> configuration, you could still configure <code>double</code> to recover if a AZ failed for a long period of time. It is just going allow putting both replicas in one AZ until you are able to configure back to <code>three_data_hall</code>.</p>\n<p>This might be acceptable as a short term option since the only reason you would be doing this configuration change is because one AZ has failed for more than a few hours.</p>",
        "post_number": 16,
        "post_type": 1,
        "posts_count": 15,
        "updated_at": "2019-04-06T00:41:42.940Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 40,
        "readers_count": 39,
        "score": 13.0,
        "yours": false,
        "topic_id": 1282,
        "topic_slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
        "display_username": "Evan Tschannen",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": false,
        "staff": true,
        "user_id": 54,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode/1282/16",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      3833,
      3834,
      3836,
      3838,
      3839,
      3841,
      3842,
      3843,
      3844,
      3848,
      3851,
      3852,
      3853,
      3855,
      3856
    ]
  },
  "timeline_lookup": [
    [
      1,
      2392
    ],
    [
      10,
      2391
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "6.0.18 Reporting incorrect Fault Tolerance via fdbcli with triple redundancy mode?",
  "id": 1282,
  "title": "6.0.18 Reporting incorrect Fault Tolerance via fdbcli with triple redundancy mode?",
  "posts_count": 15,
  "created_at": "2019-04-04T19:04:42.341Z",
  "views": 1976,
  "reply_count": 8,
  "like_count": 2,
  "last_posted_at": "2019-04-06T00:41:42.940Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
  "category_id": 7,
  "word_count": 3312,
  "deleted_at": null,
  "user_id": 490,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_1282",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 16,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 5,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Fault Tolerance - 0 zones after setting locality_zoneid",
      "id": 2706,
      "title": "Fault Tolerance - 0 zones after setting locality_zoneid",
      "slug": "fault-tolerance-0-zones-after-setting-locality-zoneid",
      "posts_count": 9,
      "reply_count": 3,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2021-05-18T19:17:29.648Z",
      "last_posted_at": "2021-05-19T16:26:58.309Z",
      "bumped": true,
      "bumped_at": "2021-05-19T16:26:58.309Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 792,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 393,
            "username": "ex3ndr",
            "name": "Steve Korshakov",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Fault Tolerance changes from &ldquo;2 machines&rdquo; to &ldquo;0 machines (2 without data loss)&rdquo;",
      "id": 1408,
      "title": "Fault Tolerance changes from \"2 machines\" to \"0 machines (2 without data loss)\"",
      "slug": "fault-tolerance-changes-from-2-machines-to-0-machines-2-without-data-loss",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2019-05-30T00:40:05.914Z",
      "last_posted_at": "2019-06-05T23:05:50.387Z",
      "bumped": true,
      "bumped_at": "2019-06-05T23:05:50.387Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 574,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 577,
            "username": "binzhangebay",
            "name": "binzhang",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/b/6a8cbe/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Trying out redundancy mode &lsquo;double&rsquo; on a single macOS machine",
      "id": 376,
      "title": "Trying out redundancy mode 'double' on a single macOS machine",
      "slug": "trying-out-redundancy-mode-double-on-a-single-macos-machine",
      "posts_count": 6,
      "reply_count": 3,
      "highest_post_number": 6,
      "image_url": null,
      "created_at": "2018-05-08T07:37:40.052Z",
      "last_posted_at": "2018-05-08T19:05:18.144Z",
      "bumped": true,
      "bumped_at": "2018-05-08T19:05:18.144Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1203,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 243,
            "username": "brb",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/b/9d8465/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Ideal setup for Fault Tolerance = 3 in Triple mode",
      "id": 1520,
      "title": "Ideal setup for Fault Tolerance = 3 in Triple mode",
      "slug": "ideal-setup-for-fault-tolerance-3-in-triple-mode",
      "posts_count": 3,
      "reply_count": 0,
      "highest_post_number": 3,
      "image_url": null,
      "created_at": "2019-07-15T08:01:44.798Z",
      "last_posted_at": "2019-07-15T15:36:51.994Z",
      "bumped": true,
      "bumped_at": "2019-07-15T15:36:51.994Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 1220,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 607,
            "username": "senthil",
            "name": "Senthil Nathan",
            "avatar_template": "/user_avatar/forums.foundationdb.org/senthil/{size}/720_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Configuring FoundationDB to Use More Than One Resolver",
      "id": 1414,
      "title": "Configuring FoundationDB to Use More Than One Resolver",
      "slug": "configuring-foundationdb-to-use-more-than-one-resolver",
      "posts_count": 24,
      "reply_count": 18,
      "highest_post_number": 24,
      "image_url": null,
      "created_at": "2019-05-30T20:58:21.102Z",
      "last_posted_at": "2019-08-21T08:48:24.207Z",
      "bumped": true,
      "bumped_at": "2019-08-21T08:48:24.207Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "performance"
      ],
      "tags_descriptions": {},
      "like_count": 8,
      "views": 2574,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 369,
            "username": "ricky.saltzer",
            "name": "Ricky Saltzer",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 9,
            "username": "mbhaskar",
            "name": "Bhaskar Muppana",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mbhaskar/{size}/277_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 641,
            "username": "smithclarkson01",
            "name": "Smith Clarkson",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/s/977dab/{size}.png",
            "trust_level": 0
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 81,
            "username": "ryanworl",
            "name": "Ryan Worl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
            "trust_level": 3
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 490,
        "username": "rjenkins",
        "name": "Ray Jenkins",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png",
        "post_count": 6,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 12,
        "username": "ajbeamon",
        "name": "A.J. Beamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "post_count": 4,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      },
      {
        "id": 13,
        "username": "alexmiller",
        "name": "Alex Miller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "post_count": 2,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 4
      },
      {
        "id": 54,
        "username": "Evan",
        "name": "Evan Tschannen",
        "avatar_template": "/user_avatar/forums.foundationdb.org/evan/{size}/104_2.png",
        "post_count": 2,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "moderator": true,
        "trust_level": 1
      },
      {
        "id": 81,
        "username": "ryanworl",
        "name": "Ryan Worl",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 3
      }
    ],
    "created_by": {
      "id": 490,
      "username": "rjenkins",
      "name": "Ray Jenkins",
      "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png"
    },
    "last_poster": {
      "id": 54,
      "username": "Evan",
      "name": "Evan Tschannen",
      "avatar_template": "/user_avatar/forums.foundationdb.org/evan/{size}/104_2.png"
    },
    "links": [
      {
        "url": "https://github.com/apple/foundationdb/issues/1421",
        "title": "Clarify language about fault tolerance in status \u00b7 Issue #1421 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 10,
        "user_id": 12,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://apple.github.io/foundationdb/configuration.html#configuring-regions",
        "title": "Configuration \u2014 FoundationDB 6.0",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 6,
        "user_id": 490,
        "domain": "apple.github.io",
        "root_domain": "apple.github.io"
      },
      {
        "url": "https://github.com/apple/foundationdb/issues/1420",
        "title": "Add zone count to regular fdbcli status output \u00b7 Issue #1420 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 6,
        "user_id": 12,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://forums.foundationdb.org/t/questions-about-process-classes-recruitment-behavior-and-cluster-configuration/1177",
        "title": "Questions about process classes, recruitment behavior and cluster configuration",
        "internal": true,
        "attachment": false,
        "reflection": false,
        "clicks": 5,
        "user_id": 490,
        "domain": "forums.foundationdb.org",
        "root_domain": "foundationdb.org"
      },
      {
        "url": "https://www.youtube.com/watch?v=EMwhsGsxfPU",
        "title": "YouTube",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 4,
        "user_id": 490,
        "domain": "www.youtube.com",
        "root_domain": "youtube.com"
      },
      {
        "url": "https://forums.foundationdb.org/t/cluster-tuning-cookbook/520/7",
        "title": "Cluster tuning cookbook",
        "internal": true,
        "attachment": false,
        "reflection": false,
        "clicks": 3,
        "user_id": 490,
        "domain": "forums.foundationdb.org",
        "root_domain": "foundationdb.org"
      },
      {
        "url": "https://apple.github.io/foundationdb/configuration.html#datacenter-aware-mode",
        "title": "Configuration \u2014 FoundationDB 6.0",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 2,
        "user_id": 490,
        "domain": "apple.github.io",
        "root_domain": "apple.github.io"
      }
    ]
  },
  "bookmarks": []
}