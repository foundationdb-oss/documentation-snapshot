{
  "post_stream": {
    "posts": [
      {
        "id": 2752,
        "name": "",
        "username": "zellsun",
        "avatar_template": "/user_avatar/forums.foundationdb.org/zellsun/{size}/431_2.png",
        "created_at": "2018-11-29T22:51:31.542Z",
        "cooked": "<p>I found two statements are seemingly contradictory in fdb document layer\u2019s documentation.</p>\n<p><aside class=\"onebox whitelistedgeneric\">\n  <header class=\"source\">\n      <a href=\"https://foundationdb.github.io/fdb-document-layer/developer-guide.html\" target=\"_blank\" rel=\"nofollow noopener\">FoundationDB Document Layer</a>\n  </header>\n  <article class=\"onebox-body\">\n    \n\n<h3><a href=\"https://foundationdb.github.io/fdb-document-layer/developer-guide.html\" target=\"_blank\" rel=\"nofollow noopener\">Developer Guide</a></h3>\n\n<p>A document data model on FoundationDB, implementing MongoDB\u00ae wire protocol</p>\n\n\n  </article>\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n  <div style=\"clear: both\"></div>\n</aside>\n<br>\n\u201cLike the FoundationDB Key-Value Store, the Document Layer achieves its maximum performance with a highly concurrent workload. Multiple client processes are one way of achieving this, but in many situations, it is advantageous for each individual client to open multiple connections to the Document Layer and round-robin requests across them. Clients using MongoDB\u00ae drivers that automatically instantiate connection pools may need to <strong>manually increase pool size</strong> to saturate the Document Layer and Key-Value Store server processes.\u201d</p>\n<p><aside class=\"onebox whitelistedgeneric\">\n  <header class=\"source\">\n      <a href=\"https://foundationdb.github.io/fdb-document-layer/transactions.html\" target=\"_blank\" rel=\"nofollow noopener\">FoundationDB Document Layer</a>\n  </header>\n  <article class=\"onebox-body\">\n    \n\n<h3><a href=\"https://foundationdb.github.io/fdb-document-layer/transactions.html\" target=\"_blank\" rel=\"nofollow noopener\">Transactions</a></h3>\n\n<p>A document data model on FoundationDB, implementing MongoDB\u00ae wire protocol</p>\n\n\n  </article>\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n  <div style=\"clear: both\"></div>\n</aside>\n<br>\n\u201cTransactions are tracked on a per-connection basis. Therefore, care must be taken when using a MongoDB\u00ae client or driver that automatically round-robins operations across a connection pool. To ensure correct behavior, the safest approach is to <strong>deactivate such features</strong> and manage connections manually.\u201d</p>\n<p><strong>So my question is how to nicely handle Mongo drivers that automatically round-robin?</strong></p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2018-11-29T22:52:58.900Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 350,
        "reads": 40,
        "readers_count": 39,
        "score": 1758.0,
        "yours": false,
        "topic_id": 917,
        "topic_slug": "how-to-nicely-handle-mongo-drivers-that-automatically-round-robin",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://foundationdb.github.io/fdb-document-layer/developer-guide.html",
            "internal": false,
            "reflection": false,
            "title": "Developer Guide | FoundationDB Document Layer",
            "clicks": 4
          },
          {
            "url": "https://foundationdb.github.io/fdb-document-layer/transactions.html",
            "internal": false,
            "reflection": false,
            "title": "Transactions | FoundationDB Document Layer",
            "clicks": 4
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 440,
        "hidden": false,
        "trust_level": 0,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-nicely-handle-mongo-drivers-that-automatically-round-robin/917/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 2753,
        "name": "Bhaskar Muppana",
        "username": "mbhaskar",
        "avatar_template": "/user_avatar/forums.foundationdb.org/mbhaskar/{size}/277_2.png",
        "created_at": "2018-11-29T23:58:48.827Z",
        "cooked": "<p>Documentation could have been clearer here. The first paragraph was talking about normal requests which are not part of explicit client transactions. As FoundationDB is better with parallel requests, having more parallel requests on the Document Layer would turn into parallel FDB transactions.</p>\n<p>The second statement is about explicit transactions started from the application using <code>beginTransaction</code> command. All the requests between <code>beginTransaction</code> and <code>commitTransaction</code> will be committed under a single transaction. But there is no transaction ID or object that groups all these requests into a transaction. So, the protocol couples transaction with the connection. All requests on the connection would be considered as part of the transaction. Hence, it is important to not use load balancing features in drivers together with the Document Layer transactions. This is why we should use explicit transactions only with the <a href=\"https://foundationdb.github.io/fdb-document-layer/architecture.html\">sidecar architecture</a>. Even then we should be careful with load balancing in the driver as explained above.</p>\n<p>Our plan is to support transactions through MongoDB sessions. Then, session ID can be used to group requests in a transaction just like MongoDB v4.0.0 transactions. That will allow us to not have many of these limitations.</p>\n<p>Just want to add a little bit more on the Document Layer request processing. Every request on the Document Layer is part of a FDB transaction, whether it is part of an explicit client transaction or not. Even a request not part of an explicit transaction would start a FDB transaction just for itself. For example, an insert/update operation would start one FDB transaction for both index update and document update. This gives better consistency guarentees even for normal requests.</p>\n<p>Hope this makes it bit clearer.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2018-11-29T23:58:48.827Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 5,
        "reads": 38,
        "readers_count": 37,
        "score": 32.6,
        "yours": false,
        "topic_id": 917,
        "topic_slug": "how-to-nicely-handle-mongo-drivers-that-automatically-round-robin",
        "display_username": "Bhaskar Muppana",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://foundationdb.github.io/fdb-document-layer/architecture.html",
            "internal": false,
            "reflection": false,
            "title": "Architecture | FoundationDB Document Layer",
            "clicks": 7
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 9,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-nicely-handle-mongo-drivers-that-automatically-round-robin/917/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      2752,
      2753
    ]
  },
  "timeline_lookup": [
    [
      1,
      2518
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "How to nicely handle Mongo drivers that automatically round-robin?",
  "id": 917,
  "title": "How to nicely handle Mongo drivers that automatically round-robin?",
  "posts_count": 2,
  "created_at": "2018-11-29T22:51:31.464Z",
  "views": 1668,
  "reply_count": 0,
  "like_count": 0,
  "last_posted_at": "2018-11-29T23:58:48.827Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "how-to-nicely-handle-mongo-drivers-that-automatically-round-robin",
  "category_id": 11,
  "word_count": 459,
  "deleted_at": null,
  "user_id": 440,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_917",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 2,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "1 M rows write via Mongo client using document layer",
      "id": 1157,
      "title": "1 M rows write via Mongo client using document layer",
      "slug": "1-m-rows-write-via-mongo-client-using-document-layer",
      "posts_count": 13,
      "reply_count": 6,
      "highest_post_number": 13,
      "image_url": null,
      "created_at": "2019-02-19T21:32:16.215Z",
      "last_posted_at": "2019-06-13T13:08:26.134Z",
      "bumped": true,
      "bumped_at": "2019-06-13T13:08:26.134Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 2280,
      "category_id": 14,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 521,
            "username": "vaggarwal",
            "name": "VISHAL AGGARWAL",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/v/b3f665/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 9,
            "username": "mbhaskar",
            "name": "Bhaskar Muppana",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mbhaskar/{size}/277_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 81,
            "username": "ryanworl",
            "name": "Ryan Worl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 584,
            "username": "aaerofeev",
            "name": "Alexandr Erofeev",
            "avatar_template": "/user_avatar/forums.foundationdb.org/aaerofeev/{size}/582_2.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Document Layer Performance",
      "id": 1255,
      "title": "Document Layer Performance",
      "slug": "document-layer-performance",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2019-03-25T02:01:43.056Z",
      "last_posted_at": "2019-04-08T20:36:48.678Z",
      "bumped": true,
      "bumped_at": "2019-04-08T20:36:48.678Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "performance"
      ],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 1531,
      "category_id": 11,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 542,
            "username": "jonahwest",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/j/90db22/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 9,
            "username": "mbhaskar",
            "name": "Bhaskar Muppana",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mbhaskar/{size}/277_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Need to use mongo api driver against document layer",
      "id": 1206,
      "title": "Need to use mongo api driver against document layer",
      "slug": "need-to-use-mongo-api-driver-against-document-layer",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2019-03-08T00:35:23.096Z",
      "last_posted_at": "2019-03-08T15:31:03.147Z",
      "bumped": true,
      "bumped_at": "2019-03-08T15:31:03.147Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 907,
      "category_id": 11,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 525,
            "username": "samir",
            "name": "Samir",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/s/ea666f/{size}.png",
            "trust_level": 0
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 9,
            "username": "mbhaskar",
            "name": "Bhaskar Muppana",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mbhaskar/{size}/277_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Announcing FoundationDB Document Layer",
      "id": 914,
      "title": "Announcing FoundationDB Document Layer",
      "slug": "announcing-foundationdb-document-layer",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2018-11-29T20:15:26.902Z",
      "last_posted_at": "2018-11-29T21:22:01.867Z",
      "bumped": true,
      "bumped_at": "2018-11-29T20:15:27.009Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": true,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 5,
      "views": 902,
      "category_id": 6,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest single",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 1,
            "username": "davelester",
            "name": "Dave Lester",
            "avatar_template": "/user_avatar/forums.foundationdb.org/davelester/{size}/1927_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Nested Transactions",
      "id": 995,
      "title": "Nested Transactions",
      "slug": "nested-transactions",
      "posts_count": 3,
      "reply_count": 1,
      "highest_post_number": 3,
      "image_url": null,
      "created_at": "2019-01-04T04:33:14.993Z",
      "last_posted_at": "2019-01-04T06:28:29.932Z",
      "bumped": true,
      "bumped_at": "2019-01-04T06:28:29.932Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1490,
      "category_id": 11,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 471,
            "username": "bencherian",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/b/96bed5/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 9,
            "username": "mbhaskar",
            "name": "Bhaskar Muppana",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mbhaskar/{size}/277_2.png",
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 9,
        "username": "mbhaskar",
        "name": "Bhaskar Muppana",
        "avatar_template": "/user_avatar/forums.foundationdb.org/mbhaskar/{size}/277_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 4
      },
      {
        "id": 440,
        "username": "zellsun",
        "name": "",
        "avatar_template": "/user_avatar/forums.foundationdb.org/zellsun/{size}/431_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 0
      }
    ],
    "created_by": {
      "id": 440,
      "username": "zellsun",
      "name": "",
      "avatar_template": "/user_avatar/forums.foundationdb.org/zellsun/{size}/431_2.png"
    },
    "last_poster": {
      "id": 9,
      "username": "mbhaskar",
      "name": "Bhaskar Muppana",
      "avatar_template": "/user_avatar/forums.foundationdb.org/mbhaskar/{size}/277_2.png"
    },
    "links": [
      {
        "url": "https://foundationdb.github.io/fdb-document-layer/architecture.html",
        "title": "Architecture | FoundationDB Document Layer",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 7,
        "user_id": 9,
        "domain": "foundationdb.github.io",
        "root_domain": "foundationdb.github.io"
      },
      {
        "url": "https://foundationdb.github.io/fdb-document-layer/developer-guide.html",
        "title": "Developer Guide | FoundationDB Document Layer",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 4,
        "user_id": 440,
        "domain": "foundationdb.github.io",
        "root_domain": "foundationdb.github.io"
      },
      {
        "url": "https://foundationdb.github.io/fdb-document-layer/transactions.html",
        "title": "Transactions | FoundationDB Document Layer",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 4,
        "user_id": 440,
        "domain": "foundationdb.github.io",
        "root_domain": "foundationdb.github.io"
      }
    ]
  },
  "bookmarks": []
}