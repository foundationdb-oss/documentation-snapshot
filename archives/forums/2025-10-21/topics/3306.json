{
  "post_stream": {
    "posts": [
      {
        "id": 11074,
        "name": "Rajiv M Ranganath",
        "username": "rajivr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png",
        "created_at": "2022-05-09T04:23:30.889Z",
        "cooked": "<p>I\u2019ve Tokio/Rust bindings CI setup to continuously run binding tester.</p>\n<p>Recently I encountered an <a href=\"https://github.com/fdb-rs/fdb/runs/6340413041\" rel=\"noopener nofollow ugc\">unusual failure</a> with FDB version 7.1.3 and API version 710.</p>\n<p>The failing seed according to CI is <code>1191235632</code> and it fails with the following error message</p>\n<pre><code class=\"lang-auto\">Incorrect result: \n  rust   - ('tester_output', 'stack', 630, 24440) = b'\\x01GOT_RANGE_SPLIT_POINTS\\x00'\n  python - ('tester_output', 'stack', 630, 24440) = b'\\x01\\x01ERROR\\x00\\xff\\x012131\\x00\\xff\\x00'\n\n\nTest with seed 1191235632 and concurrency 1 had 1 incorrect result(s) and 0 error(s) at API version 710\n</code></pre>\n<p>From the failure, it looks like Python bindings detected a <code>2131</code> (<code>tenant_not_found</code>) error, whereas the Rust bindings was able to complete the <code>get_range_split_points</code> instruction successfully.</p>\n<p>When I tried to replicate failure locally, using the failing seed, the error disappeared, and the seed passed successfully.</p>\n<p>What would be the recommended approach for dealing with such heisenbugs?</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-05-09T04:23:55.226Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 71,
        "reads": 40,
        "readers_count": 39,
        "score": 368.0,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "Rajiv M Ranganath",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/fdb-rs/fdb/runs/6340413041",
            "internal": false,
            "reflection": false,
            "title": "chore: bump main to v0.4.0 \u00b7 fdb-rs/fdb@134b893 \u00b7 GitHub",
            "clicks": 3
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 946,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 11083,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2022-05-09T15:40:20.869Z",
        "cooked": "<p>Some of these types of issues can be a bit tricky. Sometimes I\u2019ll set up a bindingtester job to run the same seed repeatedly to see how common the failure reproduces. If it\u2019s frequent enough, then that kind of reproduction can be enough to debug what\u2019s happening and validate a fix.</p>\n<p>Another strategy is to look at the sequence of instructions leading up to the failed instruction, often with some extra debugging output added. For example, in this case you have a tenant that isn\u2019t found, and so you could determine what tenant is being used and what kind of operations have been performed on that tenant. If you see that it was recently created or deleted for example, then there may be some sort of race between the creation/deletion and the use of the tenant. It can help to manually run through the instructions to determine what you think should happen, which can give clues to where things might go wrong.</p>\n<p>If what you are seeing is that typically both bindings report a successful call to get the split points but only Python failed the one time, then it\u2019s likely the problem isn\u2019t the rust bindings. It could be something in the Python bindings or tester, something non-deterministic about the generated test, or even an issue in the core FoundationDB client. In any of these cases, I would expect the error to appear occasionally for us as well, so perhaps we\u2019ll come across it soon.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-05-09T15:40:20.869Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 37,
        "readers_count": 36,
        "score": 17.4,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11086,
        "name": "Rajiv M Ranganath",
        "username": "rajivr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png",
        "created_at": "2022-05-09T22:56:21.673Z",
        "cooked": "<p>Thanks <a class=\"mention\" href=\"/u/ajbeamon\">@ajbeamon</a> for the reply!</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-05-09T22:56:21.673Z",
        "reply_count": 1,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 31,
        "readers_count": 30,
        "score": 11.2,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "Rajiv M Ranganath",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 12,
          "username": "ajbeamon",
          "name": "A.J. Beamon",
          "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 946,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11091,
        "name": "Rajiv M Ranganath",
        "username": "rajivr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png",
        "created_at": "2022-05-10T03:33:30.157Z",
        "cooked": "<p>I just had another similar <a href=\"https://github.com/fdb-rs/fdb/runs/6360741531\" rel=\"noopener nofollow ugc\">failure</a>, so I decided to investigate further.</p>\n<p>For the seed <code>1191235632</code>, the sequence of instructions is as follows.</p>\n<pre><code class=\"lang-auto\">24433. 'RESET'\n24435. 'TENANT_DELETE'\n24436. 'WAIT_FUTURE'\n24440. 'GET_RANGE_SPLIT_POINTS'\n24443. 'READ_CONFLICT_RANGE'\n</code></pre>\n<p>For the seed <code>3275318271</code>, the sequence of instructions is very similar and is as follows.</p>\n<pre><code class=\"lang-auto\">26949. 'RESET'\n26951. 'TENANT_DELETE'\n26952. 'WAIT_FUTURE'\n26956. 'GET_RANGE_SPLIT_POINTS'\n26957. 'RESET'\n</code></pre>\n<p>The code that implements <code>TENANT_DELETE</code> instruction in Rust is very similar to the Java implementation. Rust implementation is <a href=\"https://github.com/fdb-rs/fdb/blob/fdb-0.3.1/fdb/src/tenant/tenant_management.rs#L78-L119\" rel=\"noopener nofollow ugc\">here</a>. Java implementation is <a href=\"https://github.com/apple/foundationdb/blob/7.1.3/bindings/java/src/main/com/apple/foundationdb/TenantManagement.java#L171-L190\" rel=\"noopener nofollow ugc\">here</a>. I was wondering if you might be able to spot any issue in the Rust implementation?</p>\n<p>I could be wrong, but It looks to me that in the Rust implementation, for some reason the C binding layer is returning that tenant deletion was successful, and in some cases <em>not returning an error</em> for the subsequent <code>GET_RANGE_SPLIT_POINTS</code> instruction.</p>\n<p>Also when I was investigating this issue, I tried to figure out where <a href=\"https://github.com/apple/foundationdb/blob/7.1.3/bindings/bindingtester/spec/tenantTester.md#_tenant-suffix\" rel=\"noopener nofollow ugc\"><code>_TENANT</code></a> suffix instructions were getting added in <a href=\"https://github.com/apple/foundationdb/blob/7.1.3/bindings/bindingtester/tests/api.py#L150-L168\" rel=\"noopener nofollow ugc\"><code>api.py</code></a> since I didn\u2019t find any <code>_TENANT</code> suffix instructions.</p>\n<p>Shouldn\u2019t <code>api.py</code>'s <code>generate</code> method contain something along the lines?</p>\n<pre><code class=\"lang-auto\">tenant_reads = [x + '_TENANT' for x in reads]\ntenant_mutations = [x + '_TENANT' for x in mutations]\n</code></pre>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-05-10T03:33:30.157Z",
        "reply_count": 1,
        "reply_to_post_number": 3,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 31,
        "readers_count": 30,
        "score": 11.2,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "Rajiv M Ranganath",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/fdb-rs/fdb/blob/fdb-0.3.1/fdb/src/tenant/tenant_management.rs#L78-L119",
            "internal": false,
            "reflection": false,
            "title": "fdb/tenant_management.rs at fdb-0.3.1 \u00b7 fdb-rs/fdb \u00b7 GitHub",
            "clicks": 2
          },
          {
            "url": "https://github.com/apple/foundationdb/blob/7.1.3/bindings/java/src/main/com/apple/foundationdb/TenantManagement.java#L171-L190",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/TenantManagement.java at 7.1.3 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 2
          },
          {
            "url": "https://github.com/apple/foundationdb/blob/7.1.3/bindings/bindingtester/tests/api.py#L150-L168",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/api.py at 7.1.3 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 0
          },
          {
            "url": "https://github.com/apple/foundationdb/blob/7.1.3/bindings/bindingtester/spec/tenantTester.md#_tenant-suffix",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/tenantTester.md at 7.1.3 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 0
          },
          {
            "url": "https://github.com/fdb-rs/fdb/runs/6360741531",
            "internal": false,
            "reflection": false,
            "title": "chore: bump main to v0.4.0 \u00b7 fdb-rs/fdb@134b893 \u00b7 GitHub",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 946,
          "username": "rajivr",
          "name": "Rajiv M Ranganath",
          "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 946,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/4",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11106,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2022-05-11T18:15:10.632Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"rajivr\" data-post=\"4\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/rajivr/48/1100_2.png\" class=\"avatar\"> rajivr:</div>\n<blockquote>\n<p>Also when I was investigating this issue, I tried to figure out where <a href=\"https://github.com/apple/foundationdb/blob/7.1.3/bindings/bindingtester/spec/tenantTester.md#_tenant-suffix\"> <code>_TENANT</code> </a> suffix instructions were getting added in <a href=\"https://github.com/apple/foundationdb/blob/7.1.3/bindings/bindingtester/tests/api.py#L150-L168\"> <code>api.py</code> </a> since I didn\u2019t find any <code>_TENANT</code> suffix instructions.</p>\n<p>Shouldn\u2019t <code>api.py</code> 's <code>generate</code> method contain something along the lines?</p>\n</blockquote>\n</aside>\n<p>Good catch, yes that should be added.</p>\n<blockquote>\n<p>I was wondering if you might be able to spot any issue in the Rust implementation?</p>\n</blockquote>\n<p>I don\u2019t spot anything in a first look. You said re-running the test doesn\u2019t fail every time, do you know if in that case both bindings are reporting that the split points operation failed or if both cases had the operation succeed?</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-05-11T18:15:10.632Z",
        "reply_count": 1,
        "reply_to_post_number": 4,
        "quote_count": 1,
        "incoming_link_count": 0,
        "reads": 26,
        "readers_count": 25,
        "score": 10.2,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/5",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11109,
        "name": "Rajiv M Ranganath",
        "username": "rajivr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png",
        "created_at": "2022-05-12T01:22:15.663Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ajbeamon\" data-post=\"5\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"> ajbeamon:</div>\n<blockquote>\n<p>You said re-running the test doesn\u2019t fail every time, do you know if in that case both bindings are reporting that the split points operation failed or if both cases had the operation succeed?</p>\n</blockquote>\n</aside>\n<p>AFAICT, its is only the Rust bindings that occasionally reports <code>GOT_RANGE_SPLIT_POINTS</code> when it should be reporting an error.</p>\n<p>The Tokio/Rust implementation of <code>get_range_split_points</code> is <a href=\"https://github.com/fdb-rs/fdb/blob/fdb-0.3.1/fdb/src/transaction/fdb_transaction.rs#L273-L286\" rel=\"noopener nofollow ugc\">here</a> and <a href=\"https://github.com/fdb-rs/fdb/blob/fdb-0.3.1/fdb/src/transaction/fdb_transaction.rs#L744-L769\" rel=\"noopener nofollow ugc\">here</a>. I am not really doing anything other than just calling the C API.</p>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-05-12T01:22:15.663Z",
        "reply_count": 1,
        "reply_to_post_number": 5,
        "quote_count": 1,
        "incoming_link_count": 0,
        "reads": 26,
        "readers_count": 25,
        "score": 10.2,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "Rajiv M Ranganath",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/fdb-rs/fdb/blob/fdb-0.3.1/fdb/src/transaction/fdb_transaction.rs#L273-L286",
            "internal": false,
            "reflection": false,
            "title": "fdb/fdb_transaction.rs at fdb-0.3.1 \u00b7 fdb-rs/fdb \u00b7 GitHub",
            "clicks": 0
          },
          {
            "url": "https://github.com/fdb-rs/fdb/blob/fdb-0.3.1/fdb/src/transaction/fdb_transaction.rs#L744-L769",
            "internal": false,
            "reflection": false,
            "title": "fdb/fdb_transaction.rs at fdb-0.3.1 \u00b7 fdb-rs/fdb \u00b7 GitHub",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 946,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/6",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11800,
        "name": "Pierre Zemb",
        "username": "PierreZ",
        "avatar_template": "/user_avatar/forums.foundationdb.org/pierrez/{size}/866_2.png",
        "created_at": "2022-10-06T10:25:01.258Z",
        "cooked": "<p>Funny story, I\u2019m also <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3196194750/jobs/5217799983\" rel=\"noopener nofollow ugc\">experiencing <code>2131</code> errors during bindingTester</a> <img src=\"https://emoji.discourse-cdn.com/twitter/upside_down_face.png?v=12\" title=\":upside_down_face:\" class=\"emoji\" alt=\":upside_down_face:\" loading=\"lazy\" width=\"20\" height=\"20\"><br>\nDigging <img src=\"https://emoji.discourse-cdn.com/twitter/eyes.png?v=12\" title=\":eyes:\" class=\"emoji\" alt=\":eyes:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<p><a class=\"mention\" href=\"/u/rajivr\">@rajivr</a>, did you disable some tests on your side?</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-10-06T10:25:01.258Z",
        "reply_count": 1,
        "reply_to_post_number": 6,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 21,
        "readers_count": 20,
        "score": 19.2,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "Pierre Zemb",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3196194750/jobs/5217799983",
            "internal": false,
            "reflection": false,
            "title": "Tenants \u00b7 foundationdb-rs/foundationdb-rs@5be2b93 \u00b7 GitHub",
            "clicks": 2
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 946,
          "username": "rajivr",
          "name": "Rajiv M Ranganath",
          "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 534,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/7",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11801,
        "name": "Rajiv M Ranganath",
        "username": "rajivr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png",
        "created_at": "2022-10-06T11:26:36.724Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"PierreZ\" data-post=\"7\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/pierrez/48/866_2.png\" class=\"avatar\"> PierreZ:</div>\n<blockquote>\n<p>Funny story, I\u2019m also <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3196194750/jobs/5217799983\" rel=\"noopener nofollow ugc\">experiencing <code>2131</code> errors during bindingTester</a> <img src=\"https://emoji.discourse-cdn.com/twitter/upside_down_face.png?v=12\" title=\":upside_down_face:\" class=\"emoji\" alt=\":upside_down_face:\" loading=\"lazy\" width=\"20\" height=\"20\"><br>\nDigging <img src=\"https://emoji.discourse-cdn.com/twitter/eyes.png?v=12\" title=\":eyes:\" class=\"emoji\" alt=\":eyes:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n</blockquote>\n</aside>\n<p>I would be <em>really</em> interested if you are able to fix this issue. So far, I\u2019ve had no luck.</p>\n<aside class=\"quote no-group\" data-username=\"PierreZ\" data-post=\"7\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/pierrez/48/866_2.png\" class=\"avatar\"> PierreZ:</div>\n<blockquote>\n<p><a class=\"mention\" href=\"/u/rajivr\">@rajivr</a>, did you disable some tests on your side?</p>\n</blockquote>\n</aside>\n<p>The only test that I\u2019ve disabled is versionstamp v1 format as that is not supported in my bindings. It is documented <a href=\"https://github.com/fdb-rs/fdb/tree/fdb-0.3.1/fdb-stacktester/fdb-stacktester-710/bindingtester\" rel=\"noopener nofollow ugc\">here</a>.</p>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-10-06T11:26:36.724Z",
        "reply_count": 1,
        "reply_to_post_number": 7,
        "quote_count": 1,
        "incoming_link_count": 0,
        "reads": 21,
        "readers_count": 20,
        "score": 9.2,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "Rajiv M Ranganath",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/fdb-rs/fdb/tree/fdb-0.3.1/fdb-stacktester/fdb-stacktester-710/bindingtester",
            "internal": false,
            "reflection": false,
            "title": "fdb/fdb-stacktester/fdb-stacktester-710/bindingtester at fdb-0.3.1 \u00b7 fdb-rs/fdb \u00b7 GitHub",
            "clicks": 1
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 946,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/8",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11809,
        "name": "Pierre Zemb",
        "username": "PierreZ",
        "avatar_template": "/user_avatar/forums.foundationdb.org/pierrez/{size}/866_2.png",
        "created_at": "2022-10-07T14:36:32.048Z",
        "cooked": "<p>Okay, after some digging, here\u2019s what I found:</p>\n<p>I\u2019m experiencing many tenant-related error on the Rust-bindings. I decided to dig on the seed <code>3181802154</code> on FoundationDB (7.1.23). BindingTester is the latest commit on the <code>release-7.1</code>. The seed is passing on my laptop running Linux, and failing on Github Actions:</p>\n<pre><code class=\"lang-auto\"> Incorrect result: \n   rust   - ('tester_output', 'stack', 1174, 19426) = b'\\x01\\x01ERROR\\x00\\xff\\x011025\\x00\\xff\\x00'\n   python - ('tester_output', 'stack', 1174, 19426) = b'\\x01\\x01ERROR\\x00\\xff\\x012131\\x00\\xff\\x00'\n \n \n Test with seed 3181802154 and concurrency 1 had 1 incorrect result(s) and 0 error(s) at API version 710\n Completed api test with random seed 3181802154 and 1000 operations\n</code></pre>\n<p>We have error 1025(<code>transaction_cancelled</code>) on Rust whereas we have 2131(<code>tenant_not_found</code>) on operation <code>19426</code>. I forked my branch, and start hacking.</p>\n<p>I managed to reduce the scope of the problem to two jobs in the same job <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3204829394\" rel=\"noopener nofollow ugc\">run</a>:</p>\n<ul>\n<li>one that is <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3204829394/jobs/5236591311\" rel=\"noopener nofollow ugc\">failing</a>,</li>\n<li>one that is <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3204829394/jobs/5236591311\" rel=\"noopener nofollow ugc\">succeeding</a>.</li>\n</ul>\n<p>They are both trying to run 50 iterations of the same seed. The only difference is that I\u2019ve added <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/blob/5f355582c474ecfef2cb2d62a58d54bf7c2cc229/foundationdb-bindingtester/src/main.rs#L2753-L2757\" rel=\"noopener nofollow ugc\">an ugly sleep</a> of 4ms between each op near <code>19426</code> to make it work.</p>\n<p>I know tenants are an experimental features, but I have the feeling that the Rust code is executing faster than Python, causing a race-condition somewhere <img src=\"https://emoji.discourse-cdn.com/twitter/thinking.png?v=12\" title=\":thinking:\" class=\"emoji\" alt=\":thinking:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<p>Following this debug, I have some questions:</p>\n<ul>\n<li>On the official CI, how many cores are used during <code>bindingTester</code> tests? Github Actions runners have only 2-core CPU.</li>\n<li>are tenant-operations async internally somehwere?</li>\n<li>I cannot see any tenant op in the Flow bindings, is it planned?</li>\n</ul>\n<p>I could use some help or advices to fix that issue <img src=\"https://emoji.discourse-cdn.com/twitter/eyes.png?v=12\" title=\":eyes:\" class=\"emoji\" alt=\":eyes:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-10-07T15:36:22.610Z",
        "reply_count": 1,
        "reply_to_post_number": 8,
        "quote_count": 0,
        "incoming_link_count": 11,
        "reads": 21,
        "readers_count": 20,
        "score": 94.2,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "Pierre Zemb",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/foundationdb-rs/foundationdb-rs/blob/5f355582c474ecfef2cb2d62a58d54bf7c2cc229/foundationdb-bindingtester/src/main.rs#L2753-L2757",
            "internal": false,
            "reflection": false,
            "title": "foundationdb-rs/main.rs at 5f355582c474ecfef2cb2d62a58d54bf7c2cc229 \u00b7 foundationdb-rs/foundationdb-rs \u00b7 GitHub",
            "clicks": 2
          },
          {
            "url": "https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3204829394/jobs/5236591311",
            "internal": false,
            "reflection": false,
            "title": "DO NOT MERGE: Playground tenant error \u00b7 foundationdb-rs/foundationdb-rs@5f35558 \u00b7 GitHub",
            "clicks": 1
          },
          {
            "url": "https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3204829394",
            "internal": false,
            "reflection": false,
            "title": "DO NOT MERGE: Playground tenant error \u00b7 foundationdb-rs/foundationdb-rs@5f35558 \u00b7 GitHub",
            "clicks": 1
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 946,
          "username": "rajivr",
          "name": "Rajiv M Ranganath",
          "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png"
        },
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 2
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 534,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/9",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11810,
        "name": "Rajiv M Ranganath",
        "username": "rajivr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png",
        "created_at": "2022-10-08T02:04:19.807Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"PierreZ\" data-post=\"9\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/pierrez/48/866_2.png\" class=\"avatar\"> PierreZ:</div>\n<blockquote>\n<p>I managed to reduce the scope of the problem to two jobs in the same job <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3204829394\" rel=\"noopener nofollow ugc\">run</a>:</p>\n<ul>\n<li>one that is <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3204829394/jobs/5236591311\" rel=\"noopener nofollow ugc\">failing</a>,</li>\n<li>one that is <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3204829394/jobs/5236591311\" rel=\"noopener nofollow ugc\">succeeding</a>.</li>\n</ul>\n<p>They are both trying to run 50 iterations of the same seed. The only difference is that I\u2019ve added <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/blob/5f355582c474ecfef2cb2d62a58d54bf7c2cc229/foundationdb-bindingtester/src/main.rs#L2753-L2757\" rel=\"noopener nofollow ugc\">an ugly sleep</a> of 4ms between each op near <code>19426</code> to make it work.</p>\n<p>I know tenants are an experimental features, but I have the feeling that the Rust code is executing faster than Python, causing a race-condition somewhere <img src=\"https://emoji.discourse-cdn.com/twitter/thinking.png?v=12\" title=\":thinking:\" class=\"emoji\" alt=\":thinking:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n</blockquote>\n</aside>\n<p>Thanks <a class=\"mention\" href=\"/u/pierrez\">@PierreZ</a> for the awesome work in helping to reproduce this issue. The CI for my bindings is on a previous version (7.1.12), and I too <a href=\"https://github.com/fdb-rs/fdb/actions?query=is%3Afailure\" rel=\"noopener nofollow ugc\">regularly</a> see this error. Other than this one error, the binding tester is very stable.</p>",
        "post_number": 10,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-10-08T02:06:39.541Z",
        "reply_count": 0,
        "reply_to_post_number": 9,
        "quote_count": 1,
        "incoming_link_count": 0,
        "reads": 19,
        "readers_count": 18,
        "score": 3.8,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "Rajiv M Ranganath",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/fdb-rs/fdb/actions?query=is%3Afailure",
            "internal": false,
            "reflection": false,
            "title": "Actions \u00b7 fdb-rs/fdb \u00b7 GitHub",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 946,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/10",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11811,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2022-10-08T03:07:29.942Z",
        "cooked": "<p>My usual questions for starting an investigation into an issue like this are:</p>\n<ol>\n<li>Does the test always fail? If so, then that\u2019s usually the easier case and we\u2019re mainly need to find out where the two errors are coming from.</li>\n<li>If not, is one of the binding testers producing a stable result? For example, do we most of the time get error 2131 in both bindings but occasionally 1025 in rust (or the opposite)? Or maybe both bindings occasionally give 1025 while usually giving 2131? If only rust gives the 1025 error and then only some of the time, then it could be a subtle behavior difference in the bindings. That doesn\u2019t necessarily mean that they binding implementation is to blame, but it could be revealing a non-determinism in the client behavior. This is of course harder to debug because of the difficulty in reproduction, and I\u2019ll sometimes turn on more verbose logging and as some extra instrumentation before sending it off to try a bunch of runs.</li>\n<li>What are the operations being run when the failure happens? The specific operation is useful, as well as any others in the same or concurrent transactions.</li>\n</ol>\n<p>Some of the times I\u2019ve seen cases where the same operation has generated 2 different errors, both errors are valid in the context and which you get depends on which one you hit first. Still there can often be managed, and the first step is understanding why the operation would generate the errors.</p>",
        "post_number": 11,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-10-08T03:07:29.942Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 17,
        "readers_count": 16,
        "score": 8.4,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/11",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11812,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2022-10-08T03:11:35.279Z",
        "cooked": "<p>I\u2019ll add that I don\u2019t think I\u2019ve seen this problem (though I haven\u2019t run the binding tester on 7.1 in a while, maybe something has been fixed since). If I had a reproduction I could play with using the standard bindings, I would try to lend a hand tracking it down, but otherwise I can try to offer suggestions based on any findings you have.</p>",
        "post_number": 12,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-10-08T03:11:35.279Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 16,
        "readers_count": 15,
        "score": 3.2,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/12",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11823,
        "name": "Pierre Zemb",
        "username": "PierreZ",
        "avatar_template": "/user_avatar/forums.foundationdb.org/pierrez/{size}/866_2.png",
        "created_at": "2022-10-10T08:45:48.071Z",
        "cooked": "<p>Thanks a lot <a class=\"mention\" href=\"/u/ajbeamon\">@ajbeamon</a> for your suggestions <img src=\"https://emoji.discourse-cdn.com/twitter/smile.png?v=12\" title=\":smile:\" class=\"emoji\" alt=\":smile:\" loading=\"lazy\" width=\"20\" height=\"20\"> I will try to answer them the best way I can:</p>\n<aside class=\"quote no-group\" data-username=\"ajbeamon\" data-post=\"11\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"> ajbeamon:</div>\n<blockquote>\n<p>Does the test always fail? If so, then that\u2019s usually the easier case and we\u2019re mainly need to find out where the two errors are coming from.</p>\n</blockquote>\n</aside>\n<p>The test is always failing on Github Actions. I\u2019ve just tested 200 iterations of <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/pull/74/commits/1274be3dbdf1225d21366b533603801d9c166f07\" rel=\"noopener nofollow ugc\">the same seed</a>.</p>\n<p><a href=\"https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3217600052\" rel=\"noopener nofollow ugc\">The lastest run</a> is:</p>\n<ul>\n<li>failing without sleep at the very first iteration,</li>\n<li>succeedding with a sleep of 4ms on 200 iterations.</li>\n</ul>\n<aside class=\"quote no-group\" data-username=\"ajbeamon\" data-post=\"11\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"> ajbeamon:</div>\n<blockquote>\n<p>If not, is one of the binding testers producing a stable result? For example, do we most of the time get error 2131 in both bindings but occasionally 1025 in rust (or the opposite)? Or maybe both bindings occasionally give 1025 while usually giving 2131? If only rust gives the 1025 error and then only some of the time, then it could be a subtle behavior difference in the bindings. That doesn\u2019t necessarily mean that they binding implementation is to blame, but it could be revealing a non-determinism in the client behavior. This is of course harder to debug because of the difficulty in reproduction, and I\u2019ll sometimes turn on more verbose logging and as some extra instrumentation before sending it off to try a bunch of runs.</p>\n</blockquote>\n</aside>\n<p>It\u2019s an hardware-based stable result <img src=\"https://emoji.discourse-cdn.com/twitter/see_no_evil.png?v=12\" title=\":see_no_evil:\" class=\"emoji\" alt=\":see_no_evil:\" loading=\"lazy\" width=\"20\" height=\"20\"> For the <code>3181802154</code> seed on operation <code>19426</code>:</p>\n<ul>\n<li>in Python, I\u2019m always experiencing 2131</li>\n<li>in Rust, I\u2019m experiencing either:\n<ul>\n<li>2131 on a local, more beefy machine,</li>\n<li>2131 on Github Actions with a 4ms sleep after each op between 18900 and 1950,</li>\n<li>1025 on Github Actions without a sleep.</li>\n</ul>\n</li>\n</ul>\n<aside class=\"quote no-group\" data-username=\"rajivr\" data-post=\"1\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/rajivr/48/1100_2.png\" class=\"avatar\"> rajivr:</div>\n<blockquote>\n<p>Recently I encountered an <a href=\"https://github.com/fdb-rs/fdb/runs/6340413041\" rel=\"noopener nofollow ugc\">unusual failure </a> with FDB version 7.1.3 and API version 710.</p>\n<p>The failing seed according to CI is <code>1191235632</code> and it fails with the following error message</p>\n<pre><code class=\"lang-auto\">Incorrect result: \n  rust   - ('tester_output', 'stack', 630, 24440) = b'\\x01GOT_RANGE_SPLIT_POINTS\\x00'\n  python - ('tester_output', 'stack', 630, 24440) = b'\\x01\\x01ERROR\\x00\\xff\\x012131\\x00\\xff\\x00'\n\n\nTest with seed 1191235632 and concurrency 1 had 1 incorrect result(s) and 0 error(s) at API version 710\n</code></pre>\n<p>From the failure, it looks like Python bindings detected a <code>2131</code> (<code>tenant_not_found</code>) error, whereas the Rust bindings was able to complete the <code>get_range_split_points</code> instruction successfully.</p>\n</blockquote>\n</aside>\n<p>I\u2019m seeing also this error on previous runs on other seeds. The similarity are quite high:</p>\n<ul>\n<li>Same low-level rust librairies,</li>\n<li>CI both based on Github Actions,</li>\n<li>python bindings experiencing <code>2131</code>,</li>\n<li>rust binding experiencing another behavior, from errors to a succeeding transaction.</li>\n</ul>\n<aside class=\"quote no-group\" data-username=\"ajbeamon\" data-post=\"11\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"> ajbeamon:</div>\n<blockquote>\n<p>What are the operations being run when the failure happens? The specific operation is useful, as well as any others in the same or concurrent transactions.</p>\n</blockquote>\n</aside>\n<p>I\u2019m not sure what you mean by operations being run. As far as I know:</p>\n<ul>\n<li>I\u2019m not running  operations other than the <a href=\"https://gist.github.com/PierreZ/e12548442392c58fc67099b8c7387bef\" rel=\"noopener nofollow ugc\">previous operations</a>,</li>\n<li>I have no parallelism enabled in <code>./bindings/bindingtester/bindingtester.py --num-ops 1000 --api-version $fdb_api_version --test-name api --compare python rust --seed 3181802154</code></li>\n</ul>",
        "post_number": 13,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-10-10T08:45:48.071Z",
        "reply_count": 1,
        "reply_to_post_number": 11,
        "quote_count": 2,
        "incoming_link_count": 3,
        "reads": 18,
        "readers_count": 17,
        "score": 23.6,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "Pierre Zemb",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://gist.github.com/PierreZ/e12548442392c58fc67099b8c7387bef",
            "internal": false,
            "reflection": false,
            "title": "tenant-error.log \u00b7 GitHub",
            "clicks": 1
          },
          {
            "url": "https://github.com/foundationdb-rs/foundationdb-rs/pull/74/commits/1274be3dbdf1225d21366b533603801d9c166f07",
            "internal": false,
            "reflection": false,
            "title": "DO NOT MERGE: Playground tenant error by PierreZ \u00b7 Pull Request #74 \u00b7 foundationdb-rs/foundationdb-rs \u00b7 GitHub",
            "clicks": 0
          },
          {
            "url": "https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3217600052",
            "internal": false,
            "reflection": false,
            "title": "DO NOT MERGE: Playground tenant error \u00b7 foundationdb-rs/foundationdb-rs@1274be3 \u00b7 GitHub",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 534,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/13",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11824,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2022-10-10T13:45:15.525Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"PierreZ\" data-post=\"13\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/pierrez/48/866_2.png\" class=\"avatar\"> PierreZ:</div>\n<blockquote>\n<p>I\u2019m not sure what you mean by operations being run.</p>\n</blockquote>\n</aside>\n<p>I meant to say the sequence of instructions run by the binding tester. You can use the <code>--print</code> option to print the sequence of instructions for a seed (and add <code>--all</code> I believe to include even the less interesting instructions).</p>\n<p>In this output:</p>\n<pre><code class=\"lang-auto\">rust   - ('tester_output', 'stack', 1174, 19426)\n</code></pre>\n<p>The 19426 refers to the instruction number, so you can track it back down to the particular instruction that failed and look at what ran leading up to it.</p>\n<p>This doesn\u2019t always point you to the most relevant place, so it\u2019s also helpful if you have a stable result to use <code>--bisect</code>. This will run the test repeatedly with different numbers of instructions until it finds the minimum number that produces your error. Then you pass that number into <code>--num-ops</code> and rerun the smaller reproduction and/or print the test instructions and see how it ends.</p>",
        "post_number": 14,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-10-10T13:50:12.080Z",
        "reply_count": 1,
        "reply_to_post_number": 13,
        "quote_count": 1,
        "incoming_link_count": 0,
        "reads": 17,
        "readers_count": 16,
        "score": 8.4,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/14",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11837,
        "name": "Pierre Zemb",
        "username": "PierreZ",
        "avatar_template": "/user_avatar/forums.foundationdb.org/pierrez/{size}/866_2.png",
        "created_at": "2022-10-12T09:08:36.276Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ajbeamon\" data-post=\"14\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"> ajbeamon:</div>\n<blockquote>\n<p>I meant to say the sequence of instructions run by the binding tester. You can use the <code>--print</code> option to print the sequence of instructions for a seed (and add <code>--all</code> I believe to include even the less interesting instructions).</p>\n</blockquote>\n</aside>\n<p>Thanks for the tips, it will help me display relevant operations.</p>\n<aside class=\"quote no-group\" data-username=\"ajbeamon\" data-post=\"14\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"> ajbeamon:</div>\n<blockquote>\n<p>This doesn\u2019t always point you to the most relevant place, so it\u2019s also helpful if you have a stable result to use <code>--bisect</code>. This will run the test repeatedly with different numbers of instructions until it finds the minimum number that produces your error. Then you pass that number into <code>--num-ops</code> and rerun the smaller reproduction and/or print the test instructions and see how it ends.</p>\n</blockquote>\n</aside>\n<p>Running <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3233184084/jobs/5294707898\" rel=\"noopener nofollow ugc\">\u2013bisect</a> is confirming that something strange is going on, here\u2019s an extract of the logs:</p>\n<pre><code class=\"lang-auto\">Test with seed 3181802154 and concurrency 1 had 0 incorrect result(s) and 0 error(s) at API version 710\nCompleted api test with random seed 3181802154 and 500 operations\n\nTest with seed 3181802154 and concurrency 1 had 0 incorrect result(s) and 0 error(s) at API version 710\nCompleted api test with random seed 3181802154 and 750 operations\n\nTest with seed 3181802154 and concurrency 1 had 1 incorrect result(s) and 0 error(s) at API version 710\nCompleted api test with random seed 3181802154 and 875 operations\n\nTest with seed 3181802154 and concurrency 1 had 0 incorrect result(s) and 0 error(s) at API version 710\nCompleted api test with random seed 3181802154 and 813 operations\n\n# Same logs with 0 errors and operations {844, 860, 852, 848, 846, 845}\n\nError finding minimal failing test for seed 3181802154. The failure may not be deterministic\n</code></pre>\n<p>We also started running integrations tests (which are starting an fdb testcontainer) on our layers with tenants enabled, and we are also hitting the same <code>tenant_not_found</code> error, even if it has been created. I\u2019m not sure why, but sleeping before running the tests seems to fix the issue. I will keep digging, much faster now that I can reproduce locally through our integration tests.</p>",
        "post_number": 15,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-10-12T09:08:36.276Z",
        "reply_count": 1,
        "reply_to_post_number": 14,
        "quote_count": 1,
        "incoming_link_count": 0,
        "reads": 18,
        "readers_count": 17,
        "score": 8.6,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "Pierre Zemb",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3233184084/jobs/5294707898",
            "internal": false,
            "reflection": false,
            "title": "DO NOT MERGE: Playground tenant error \u00b7 foundationdb-rs/foundationdb-rs@dece4fa \u00b7 GitHub",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 534,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/15",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11847,
        "name": "Pierre Zemb",
        "username": "PierreZ",
        "avatar_template": "/user_avatar/forums.foundationdb.org/pierrez/{size}/866_2.png",
        "created_at": "2022-10-13T09:08:09.105Z",
        "cooked": "<p>To add more details, on our integrations tests, we are spinning up an fdb container running <code>7.1.23</code>. From several tests, I discovered that tests are always failing if I\u2019m starting my tests right after <code>configure new single memory tenant_mode=optional_experimental;createtenant test</code> with a <code>tenant_not_found</code> error. Waiting for database to be healthy before starting the test fixed the issue <img src=\"https://emoji.discourse-cdn.com/twitter/see_no_evil.png?v=12\" title=\":see_no_evil:\" class=\"emoji\" alt=\":see_no_evil:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<p>I tried adding some sleep on the bindingTester, with no success.</p>",
        "post_number": 16,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-10-13T12:26:39.161Z",
        "reply_count": 1,
        "reply_to_post_number": 15,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 17,
        "readers_count": 16,
        "score": 18.4,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "Pierre Zemb",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 534,
          "username": "PierreZ",
          "name": "Pierre Zemb",
          "avatar_template": "/user_avatar/forums.foundationdb.org/pierrez/{size}/866_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 534,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/16",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 11873,
        "name": "Pierre Zemb",
        "username": "PierreZ",
        "avatar_template": "/user_avatar/forums.foundationdb.org/pierrez/{size}/866_2.png",
        "created_at": "2022-10-19T08:35:27.078Z",
        "cooked": "<p>I didn\u2019t have time to look at the issue, but is there some tenants-caching involved internally in fdbclient/fdb?</p>\n<h3>\n<a name=\"edit-17-of-november-2022-1\" class=\"anchor\" href=\"#edit-17-of-november-2022-1\"></a>EDIT 17 of november 2022</h3>\n<p>I finally had the time to dig a bit more:</p>\n<ul>\n<li>my assumption that I can reproduce it locally is wrong, it was another issue on our side <img src=\"https://emoji.discourse-cdn.com/twitter/see_no_evil.png?v=12\" title=\":see_no_evil:\" class=\"emoji\" alt=\":see_no_evil:\" loading=\"lazy\" width=\"20\" height=\"20\">\n</li>\n<li>we have not encountered the bug in our layers, which are using the tenant branch,</li>\n<li>It is still failling on CI. I added more pipelines to try to retrieve more patterns:\n<ul>\n<li>\n<code>./bindings/bindingtester/bindingtester.py --num-ops 1000 --api-version $fdb_api_version --test-name api --compare python rust --seed 3181802154</code> is failing without a sleep and succeeds with a sleep(<a href=\"https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3489980557/jobs/5840803261\" rel=\"noopener nofollow ugc\">Exhibit A</a> and <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3489980557/jobs/5840803505\" rel=\"noopener nofollow ugc\">B</a>, code difference is <a href=\"https://github.com/foundationdb-rs/foundationdb-rs/blob/be156847b0e36ee050c18a11ef6e0ee4c040832a/foundationdb-bindingtester/src/main.rs#L2764-L2771\" rel=\"noopener nofollow ugc\">here</a>)</li>\n<li>\n<a href=\"https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3489980560\" rel=\"noopener nofollow ugc\">brute-forcing --bisect</a> on multiple fdb versions is showing that:\n<ul>\n<li>it fails randomly during bisect when sleep is disabled, regardless of fdb\u2019s version(<code>Error finding minimal failing test for seed 3181802154. The failure may not be deterministic</code>)</li>\n<li>it always succeeds when sleep is enabled, regardless of fdb\u2019s version(<code>No failing test found for seed 3181802154 with 1000 ops. Try specifying a larger --num-ops parameter.</code>)</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>I\u2019m not sure on how I could debug more this issue, any ideas <a class=\"mention\" href=\"/u/ajbeamon\">@ajbeamon</a> ?</p>\n<p>My question above still remains, is there some tenant-caching in libfdb/fdbserver?</p>",
        "post_number": 17,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-11-17T16:39:33.598Z",
        "reply_count": 0,
        "reply_to_post_number": 16,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 17,
        "readers_count": 16,
        "score": 3.4,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "Pierre Zemb",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3489980557/jobs/5840803261",
            "internal": false,
            "reflection": false,
            "title": "DO NOT MERGE: Playground tenant error \u00b7 foundationdb-rs/foundationdb-rs@be15684 \u00b7 GitHub",
            "clicks": 0
          },
          {
            "url": "https://github.com/foundationdb-rs/foundationdb-rs/blob/be156847b0e36ee050c18a11ef6e0ee4c040832a/foundationdb-bindingtester/src/main.rs#L2764-L2771",
            "internal": false,
            "reflection": false,
            "title": "foundationdb-rs/main.rs at be156847b0e36ee050c18a11ef6e0ee4c040832a \u00b7 foundationdb-rs/foundationdb-rs \u00b7 GitHub",
            "clicks": 0
          },
          {
            "url": "https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3489980557/jobs/5840803505",
            "internal": false,
            "reflection": false,
            "title": "DO NOT MERGE: Playground tenant error \u00b7 foundationdb-rs/foundationdb-rs@be15684 \u00b7 GitHub",
            "clicks": 0
          },
          {
            "url": "https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3489980560",
            "internal": false,
            "reflection": false,
            "title": "DO NOT MERGE: Playground tenant error \u00b7 foundationdb-rs/foundationdb-rs@be15684 \u00b7 GitHub",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 534,
          "username": "PierreZ",
          "name": "Pierre Zemb",
          "avatar_template": "/user_avatar/forums.foundationdb.org/pierrez/{size}/866_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 534,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/17",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12033,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2022-11-18T23:47:49.848Z",
        "cooked": "<p>I spent a little bit of time digging into the get range split points operation and what might go wrong with it. I don\u2019t have an exact answer yet, but there are a couple things that seemed interesting. First, are you running your test against a cluster that has more than one process in it? I think that all of our binding tester runs involve only one process in the cluster, and if you are doing something different it could represent something worth exploring.</p>\n<p>The other thing is that the <code>getRangeSplitPoints</code> function does not actually get a read version on the client to send to the cluster for this request. Instead, it gets answered based on the most recent data on the server process it talks to.</p>\n<p>That means that if you delete a tenant and then succeed in sending a <code>getRangeSplitPoints</code> request to a storage server for that tenant, that server may get the request before it learns of the deletion. It would therefore not actually fail. Running more than one process in your cluster could make this scenario more likely, as there would be a longer delay between data being committed and getting sent to the storage server.</p>\n<p>The last relevant bit involves what the client does when it wants to use a tenant as part of an operation. It needs to look up some details about the tenant, which it either learns from the commit proxy or gets locally from cache. Ordinarily reading the local cache would have been fine because the server process should reject the request if the cache was stale, but as mentioned above that isn\u2019t happening here with an unversioned request.</p>\n<p>That means it is also possible that there is some race involving this entry showing up in your client cache. This seems less likely (I think it would require that no successful operation on this tenant has been completed yet and that one is outstanding), but it may also be possible.</p>\n<p>As a side note, some of what I described above (in particular, the caching behavior on the client) is likely going to change soon.</p>",
        "post_number": 18,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-11-18T23:47:49.848Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 10,
        "readers_count": 9,
        "score": 7.0,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/18",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12039,
        "name": "Pierre Zemb",
        "username": "PierreZ",
        "avatar_template": "/user_avatar/forums.foundationdb.org/pierrez/{size}/866_2.png",
        "created_at": "2022-11-21T16:02:46.403Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ajbeamon\" data-post=\"18\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"> ajbeamon:</div>\n<blockquote>\n<p>I spent a little bit of time digging into the get range split points operation and what might go wrong with it. I don\u2019t have an exact answer yet, but there are a couple things that seemed interesting.</p>\n</blockquote>\n</aside>\n<p>Thanks a lot for spending time on it <img src=\"https://emoji.discourse-cdn.com/twitter/smile.png?v=12\" title=\":smile:\" class=\"emoji\" alt=\":smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<aside class=\"quote no-group\" data-username=\"ajbeamon\" data-post=\"18\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"> ajbeamon:</div>\n<blockquote>\n<p>I think that all of our binding tester runs involve only one process in the cluster, and if you are doing something different it could represent something worth exploring.</p>\n</blockquote>\n</aside>\n<p>I\u2019m not doing something different.</p>\n<aside class=\"quote no-group\" data-username=\"ajbeamon\" data-post=\"18\" data-topic=\"3306\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"> ajbeamon:</div>\n<blockquote>\n<p>The other thing is that the <code>getRangeSplitPoints</code> function does not actually get a read version on the client to send to the cluster for this request. Instead, it gets answered based on the most recent data on the server process it talks to.</p>\n<p>That means that if you delete a tenant and then succeed in sending a <code>getRangeSplitPoints</code> request to a storage server for that tenant, that server may get the request before it learns of the deletion. It would therefore not actually fail. Running more than one process in your cluster could make this scenario more likely, as there would be a longer delay between data being committed and getting sent to the storage server.</p>\n<p>The last relevant bit involves what the client does when it wants to use a tenant as part of an operation. It needs to look up some details about the tenant, which it either learns from the commit proxy or gets locally from cache. Ordinarily reading the local cache would have been fine because the server process should reject the request if the cache was stale, but as mentioned above that isn\u2019t happening here with an unversioned request.</p>\n<p>That means it is also possible that there is some race involving this entry showing up in your client cache. This seems less likely (I think it would require that no successful operation on this tenant has been completed yet and that one is outstanding), but it may also be possible.</p>\n<p>As a side note, some of what I described above (in particular, the caching behavior on the client) is likely going to change soon.</p>\n</blockquote>\n</aside>\n<p>That could explains the error when combining <code>getRangeSplitPoints</code> and <code>tenants</code>, thanks for digging that out.</p>\n<p>If I put aside those types of errors, I\u2019m oftenly seeing a transaction cancelled in Rust where it should be <code>tenant_not_found</code>:</p>\n<pre><code class=\"lang-auto\"> Incorrect result: \n  rust   - ('tester_output', 'stack', 1308, 26689) = b'\\x01\\x01ERROR\\x00\\xff\\x011025\\x00\\xff\\x00'\n  python - ('tester_output', 'stack', 1308, 26689) = b'\\x01\\x01ERROR\\x00\\xff\\x012131\\x00\\xff\\x00'\n\n\nTest with seed 2834048320 and concurrency 1 had 1 incorrect result(s) and 0 error(s) at API version 710\nCompleted api test with random seed 2834048320 and 1000 operations\n</code></pre>\n<p>Those errors are only appearing on the CI, and I can\u2019t reproduce the error locally. I will try to add more a more beefy CI server, because I have no idea how reliable those Github Actions VMs are <img src=\"https://emoji.discourse-cdn.com/twitter/see_no_evil.png?v=12\" title=\":see_no_evil:\" class=\"emoji\" alt=\":see_no_evil:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<p>Also, could you share how the bindingTester is runned on the official CI? I\u2019m mostly looking for information like:</p>\n<ul>\n<li>how many ops and which scenarios are run,</li>\n<li>how many core and ram are available,</li>\n<li>how the loop is handled.</li>\n<li>Is there a retry strategy on a seed?</li>\n<li>do you fail on each errors?</li>\n</ul>\n<p>My goal is to be more closer to what you are using <img src=\"https://emoji.discourse-cdn.com/twitter/smile.png?v=12\" title=\":smile:\" class=\"emoji\" alt=\":smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
        "post_number": 19,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-11-21T16:02:46.403Z",
        "reply_count": 1,
        "reply_to_post_number": 18,
        "quote_count": 1,
        "incoming_link_count": 0,
        "reads": 12,
        "readers_count": 11,
        "score": 7.4,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "Pierre Zemb",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 534,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/19",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12042,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2022-11-22T00:36:05.797Z",
        "cooked": "<p>I\u2019m not really sure what kind of hardware we use, but I can point you to the scripts that we use to run the binding tester. I\u2019m not super familiar with what the details of what these scripts do, but I can give a summary from my understanding. The basic idea is that for a given run, we start with <a href=\"https://github.com/apple/foundationdb/blob/main/contrib/Joshua/scripts/bindingTest.sh\">bindingTest.sh</a>, which does a little setup and then runs <a href=\"https://github.com/apple/foundationdb/blob/main/contrib/Joshua/scripts/bindingTestScript.sh\">bindingTestScript.sh</a>. This creates a local cluster (using <a href=\"https://github.com/apple/foundationdb/blob/main/contrib/Joshua/scripts/localClusterStart.sh\">localClusterStart.sh</a>) and then starts <a href=\"https://github.com/apple/foundationdb/blob/main/bindings/bindingtester/run_binding_tester.sh\">run_binding_tester.sh</a> to actually run the binding tester. This last script has some logic to choose a particular set of arguments for the test and runs it.</p>\n<p>We basically package all of this up and run it across a test framework that executes this whole process a bunch of times (with random seeds, etc., each time). I believe each run only does one run of the binding tester, and if the binding tester reports that the run failed (I think by exit code), then we will consider the test failed. We don\u2019t really retry the same set of arguments in any automated way, but when we get reports of failures we would re-run the test manually.</p>",
        "post_number": 20,
        "post_type": 1,
        "posts_count": 21,
        "updated_at": "2022-11-22T00:36:05.797Z",
        "reply_count": 1,
        "reply_to_post_number": 19,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 11,
        "readers_count": 10,
        "score": 7.2,
        "yours": false,
        "topic_id": 3306,
        "topic_slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/blob/main/contrib/Joshua/scripts/bindingTest.sh",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/bindingTest.sh at main \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 0
          },
          {
            "url": "https://github.com/apple/foundationdb/blob/main/bindings/bindingtester/run_binding_tester.sh",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/run_binding_tester.sh at main \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 0
          },
          {
            "url": "https://github.com/apple/foundationdb/blob/main/contrib/Joshua/scripts/bindingTestScript.sh",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/bindingTestScript.sh at main \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 0
          },
          {
            "url": "https://github.com/apple/foundationdb/blob/main/contrib/Joshua/scripts/localClusterStart.sh",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/localClusterStart.sh at main \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 534,
          "username": "PierreZ",
          "name": "Pierre Zemb",
          "avatar_template": "/user_avatar/forums.foundationdb.org/pierrez/{size}/866_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/binding-tester-heisenbug-with-api-version-710-and-tenant/3306/20",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      11074,
      11083,
      11086,
      11091,
      11106,
      11109,
      11800,
      11801,
      11809,
      11810,
      11811,
      11812,
      11823,
      11824,
      11837,
      11847,
      11873,
      12033,
      12039,
      12042,
      12044
    ]
  },
  "timeline_lookup": [
    [
      1,
      1262
    ],
    [
      2,
      1261
    ],
    [
      5,
      1259
    ],
    [
      7,
      1112
    ],
    [
      8,
      1111
    ],
    [
      9,
      1110
    ],
    [
      13,
      1108
    ],
    [
      14,
      1107
    ],
    [
      15,
      1106
    ],
    [
      16,
      1105
    ],
    [
      17,
      1099
    ],
    [
      18,
      1068
    ],
    [
      19,
      1065
    ]
  ],
  "tags": [
    "bindings"
  ],
  "tags_descriptions": {},
  "fancy_title": "Binding tester heisenbug with API version 710 and tenant",
  "id": 3306,
  "title": "Binding tester heisenbug with API version 710 and tenant",
  "posts_count": 21,
  "created_at": "2022-05-09T04:23:30.827Z",
  "views": 921,
  "reply_count": 16,
  "like_count": 2,
  "last_posted_at": "2022-11-22T08:33:59.508Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "binding-tester-heisenbug-with-api-version-710-and-tenant",
  "category_id": 5,
  "word_count": 4827,
  "deleted_at": null,
  "user_id": 946,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_3306",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 21,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 3,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": null,
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 534,
        "username": "PierreZ",
        "name": "Pierre Zemb",
        "avatar_template": "/user_avatar/forums.foundationdb.org/pierrez/{size}/866_2.png",
        "post_count": 8,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 12,
        "username": "ajbeamon",
        "name": "A.J. Beamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "post_count": 7,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      },
      {
        "id": 946,
        "username": "rajivr",
        "name": "Rajiv M Ranganath",
        "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png",
        "post_count": 6,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      }
    ],
    "created_by": {
      "id": 946,
      "username": "rajivr",
      "name": "Rajiv M Ranganath",
      "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png"
    },
    "last_poster": {
      "id": 534,
      "username": "PierreZ",
      "name": "Pierre Zemb",
      "avatar_template": "/user_avatar/forums.foundationdb.org/pierrez/{size}/866_2.png"
    },
    "links": [
      {
        "url": "https://github.com/fdb-rs/fdb/runs/6340413041",
        "title": "chore: bump main to v0.4.0 \u00b7 fdb-rs/fdb@134b893 \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 3,
        "user_id": 946,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3196194750/jobs/5217799983",
        "title": "Tenants \u00b7 foundationdb-rs/foundationdb-rs@5be2b93 \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 2,
        "user_id": 534,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/fdb-rs/fdb/blob/fdb-0.3.1/fdb/src/tenant/tenant_management.rs#L78-L119",
        "title": "fdb/tenant_management.rs at fdb-0.3.1 \u00b7 fdb-rs/fdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 2,
        "user_id": 946,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/foundationdb-rs/foundationdb-rs/blob/5f355582c474ecfef2cb2d62a58d54bf7c2cc229/foundationdb-bindingtester/src/main.rs#L2753-L2757",
        "title": "foundationdb-rs/main.rs at 5f355582c474ecfef2cb2d62a58d54bf7c2cc229 \u00b7 foundationdb-rs/foundationdb-rs \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 2,
        "user_id": 534,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/apple/foundationdb/blob/7.1.3/bindings/java/src/main/com/apple/foundationdb/TenantManagement.java#L171-L190",
        "title": "foundationdb/TenantManagement.java at 7.1.3 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 2,
        "user_id": 946,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/fdb-rs/fdb/tree/fdb-0.3.1/fdb-stacktester/fdb-stacktester-710/bindingtester",
        "title": "fdb/fdb-stacktester/fdb-stacktester-710/bindingtester at fdb-0.3.1 \u00b7 fdb-rs/fdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 1,
        "user_id": 946,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://gist.github.com/PierreZ/e12548442392c58fc67099b8c7387bef",
        "title": "tenant-error.log \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 1,
        "user_id": 534,
        "domain": "gist.github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3204829394",
        "title": "DO NOT MERGE: Playground tenant error \u00b7 foundationdb-rs/foundationdb-rs@5f35558 \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 1,
        "user_id": 534,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/foundationdb-rs/foundationdb-rs/actions/runs/3204829394/jobs/5236591311",
        "title": "DO NOT MERGE: Playground tenant error \u00b7 foundationdb-rs/foundationdb-rs@5f35558 \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 1,
        "user_id": 534,
        "domain": "github.com",
        "root_domain": "github.com"
      }
    ]
  },
  "bookmarks": []
}