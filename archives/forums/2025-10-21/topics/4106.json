{
  "post_stream": {
    "posts": [
      {
        "id": 13161,
        "name": "David Young",
        "username": "funkypenguin",
        "avatar_template": "/user_avatar/forums.foundationdb.org/funkypenguin/{size}/1153_2.png",
        "created_at": "2023-08-12T00:54:55.142Z",
        "cooked": "<p>Hi folks,</p>\n<p>We\u2019re on operator v1.11.0, and recently started the exercise of replacing our Kubernetes nodes for OS upgrades. After replacing several nodes, one of our clusters is now unhealthy, and I\u2019m looking for ideas re how to resolve it.</p>\n<p>We\u2019re using the following in the cluster CR:</p>\n<pre><code class=\"lang-auto\">  routing:\n    headlessService: true\n    publicIPSource: service\n</code></pre>\n<p>So a service is created for each storage pod, like this:</p>\n<pre><code class=\"lang-auto\">root@cowboy:/tmp# k get svc -n dev  | grep retort\nretort-fdb-storage-1          ClusterIP   10.104.240.116   &lt;none&gt;        4500/TCP,4501/TCP                                       235d\nretort-fdb-storage-10         ClusterIP   10.98.164.89     &lt;none&gt;        4500/TCP,4501/TCP                                       47m\nretort-fdb-storage-2          ClusterIP   10.98.136.60     &lt;none&gt;        4500/TCP,4501/TCP                                       235d\nretort-fdb-storage-3          ClusterIP   10.102.39.88     &lt;none&gt;        4500/TCP,4501/TCP                                       184d\nretort-fdb-storage-4          ClusterIP   10.111.121.156   &lt;none&gt;        4500/TCP,4501/TCP                                       406d\n</code></pre>\n<p>In this case, the <code>retort-fdb-storage-2</code> pod was delete when its underlying kubernetes node was replaced (<em>the replacement happens to have the same node name, but was removed from the kubernetes cluster and re-created</em>), but the service persists (above).</p>\n<p>When I exec into one of the FDB pods and run <code>status</code> inside <code>fdbcli</code>, I see that the clusterfile still points to the service IP assigned to <code>retort-fdb-storage-2</code>:</p>\n<pre><code class=\"lang-auto\">Could not communicate with all of the coordination servers.\n  The database will remain operational as long as we\n  can connect to a quorum of servers, however the fault\n  tolerance of the system is reduced as long as the\n  servers remain disconnected.\n\n  10.96.134.14:4501  (reachable)\n  10.98.136.60:4501  (unreachable)\n  10.102.39.88:4501  (reachable)\n  10.104.240.116:4501  (reachable)\n  10.111.121.156:4501  (reachable)\n\n</code></pre>\n<p>And:</p>\n<pre><code class=\"lang-auto\">Cluster description: retort_fdb\nCluster coordinators (5): 10.102.39.88:4501,10.104.240.116:4501,10.111.121.156:4501,10.96.134.14:4501,10.98.136.60:4501\nType `help coordinators' to learn how to change this information.\nfdb&gt;\n</code></pre>\n<p>If I use the kubectl plugin to analyze the cluster, I get:</p>\n<pre><code class=\"lang-auto\">root@dog1:~# kubectl-fdb analyze -n dev retort-fdb\nChecking cluster: dev/retort-fdb\n\u2716 Cluster is not available\n\u2716 Cluster is not fully replicated\n\u2716 Cluster is not reconciled\n\u2716 ProcessGroup: storage-9 has the following condition: MissingProcesses since 2023-08-12 00:02:44 +0000 UTC\n\u2716 ProcessGroup: storage-9 has the following condition: MissingPod since 2023-08-12 00:02:44 +0000 UTC\n\u2716 ProcessGroup: storage-9 has the following condition: MissingPVC since 2023-08-12 00:02:44 +0000 UTC\n\u2716 ProcessGroup: storage-10 has the following condition: MissingProcesses since 2023-08-12 00:02:44 +0000 UTC\n\u2716 ProcessGroup: storage-10 has the following condition: MissingPod since 2023-08-12 00:02:44 +0000 UTC\n\u2716 ProcessGroup: storage-10 has the following condition: MissingPVC since 2023-08-12 00:02:44 +0000 UTC\n\u26a0 Ignored 5 process groups marked for removal\n\u2714 Pods are all running and available\nError:\nfound issues for cluster retort-fdb. Please check them\nroot@dog1:~#\n</code></pre>\n<p>Since presumably 4/5 of the nodes are happy, how should I proceed?</p>\n<p>Thanks!<br>\nD</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2023-08-12T00:54:55.142Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 26,
        "reads": 13,
        "readers_count": 12,
        "score": 132.6,
        "yours": false,
        "topic_id": 4106,
        "topic_slug": "cluster-unhealthy-after-node-replacement-which-necessitated-pod-replacement",
        "display_username": "David Young",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 988,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/cluster-unhealthy-after-node-replacement-which-necessitated-pod-replacement/4106/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 13180,
        "name": "Johannes Scheuermann",
        "username": "johscheuer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/j/f475e1/{size}.png",
        "created_at": "2023-08-22T06:17:42.257Z",
        "cooked": "<p>Are you cordoning those nodes before taking them down? Or what is the actual process behind \u201creplacing\u201d a node?</p>\n<p>Is this cluster TLS enabled? Could it be some issues with the certificates on the newly created nodes? Probably the best is to check the trace events of this cluster to get a better idea why the connection is not possible. And have you checked that the service is pointing to the right endpoint, e.g. the new Pod IP address?</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2023-08-22T06:17:42.257Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 7,
        "readers_count": 6,
        "score": 1.4,
        "yours": false,
        "topic_id": 4106,
        "topic_slug": "cluster-unhealthy-after-node-replacement-which-necessitated-pod-replacement",
        "display_username": "Johannes Scheuermann",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 849,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/cluster-unhealthy-after-node-replacement-which-necessitated-pod-replacement/4106/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      13161,
      13180
    ]
  },
  "timeline_lookup": [
    [
      1,
      802
    ],
    [
      2,
      792
    ]
  ],
  "suggested_topics": [],
  "tags": [
    "operator"
  ],
  "tags_descriptions": {},
  "fancy_title": "Cluster unhealthy after node replacement (which necessitated pod replacement)",
  "id": 4106,
  "title": "Cluster unhealthy after node replacement (which necessitated pod replacement)",
  "posts_count": 2,
  "created_at": "2023-08-12T00:54:55.067Z",
  "views": 272,
  "reply_count": 0,
  "like_count": 0,
  "last_posted_at": "2023-08-22T06:17:42.257Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "cluster-unhealthy-after-node-replacement-which-necessitated-pod-replacement",
  "category_id": 7,
  "word_count": 602,
  "deleted_at": null,
  "user_id": 988,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_4106",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 2,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Failure / Recovery scenario",
      "id": 2384,
      "title": "Failure / Recovery scenario",
      "slug": "failure-recovery-scenario",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2020-10-10T01:06:26.706Z",
      "last_posted_at": "2020-10-12T13:36:11.016Z",
      "bumped": true,
      "bumped_at": "2020-10-12T13:36:11.016Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 695,
      "category_id": 16,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 819,
            "username": "mbuleandra",
            "name": "Marius",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mbuleandra/{size}/977_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 3,
            "username": "john_brownlee",
            "name": "John Brownlee",
            "avatar_template": "/user_avatar/forums.foundationdb.org/john_brownlee/{size}/22_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "FoundationDB @ Kubernetes having &ldquo;issues&rdquo;",
      "id": 383,
      "title": "FoundationDB @ Kubernetes having \"issues\"",
      "slug": "foundationdb-kubernetes-having-issues",
      "posts_count": 4,
      "reply_count": 2,
      "highest_post_number": 4,
      "image_url": null,
      "created_at": "2018-05-09T10:17:53.797Z",
      "last_posted_at": "2018-05-11T17:28:05.081Z",
      "bumped": true,
      "bumped_at": "2018-05-11T17:28:05.081Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 2031,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 247,
            "username": "Chr1st0ph",
            "name": "Chr1st0ph",
            "avatar_template": "/user_avatar/forums.foundationdb.org/chr1st0ph/{size}/353_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Connecting to the database using `fdbcli` results in an error",
      "id": 1841,
      "title": "Connecting to the database using `fdbcli` results in an error",
      "slug": "connecting-to-the-database-using-fdbcli-results-in-an-error",
      "posts_count": 8,
      "reply_count": 4,
      "highest_post_number": 8,
      "image_url": null,
      "created_at": "2019-12-14T07:23:08.203Z",
      "last_posted_at": "2019-12-17T15:06:03.064Z",
      "bumped": true,
      "bumped_at": "2019-12-17T15:06:03.064Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 2426,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 700,
            "username": "viveksinghggits",
            "name": "Vivek Singh",
            "avatar_template": "/user_avatar/forums.foundationdb.org/viveksinghggits/{size}/737_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 3,
            "username": "john_brownlee",
            "name": "John Brownlee",
            "avatar_template": "/user_avatar/forums.foundationdb.org/john_brownlee/{size}/22_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "K8s operator fdb.cluster IP addresses issue",
      "id": 2273,
      "title": "K8s operator fdb.cluster IP addresses issue",
      "slug": "k8s-operator-fdb-cluster-ip-addresses-issue",
      "posts_count": 6,
      "reply_count": 1,
      "highest_post_number": 6,
      "image_url": null,
      "created_at": "2020-08-03T20:04:36.427Z",
      "last_posted_at": "2020-09-18T09:27:09.647Z",
      "bumped": true,
      "bumped_at": "2020-09-18T09:27:09.647Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "operator"
      ],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 1219,
      "category_id": 16,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 798,
            "username": "ghenom",
            "name": "Ghenom",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/46a35a/{size}.png",
            "trust_level": 0
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 3,
            "username": "john_brownlee",
            "name": "John Brownlee",
            "avatar_template": "/user_avatar/forums.foundationdb.org/john_brownlee/{size}/22_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 820,
            "username": "kcking",
            "name": "Kevin King",
            "avatar_template": "/user_avatar/forums.foundationdb.org/kcking/{size}/934_2.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Stateless node keep reaching out to removed storage node",
      "id": 3267,
      "title": "Stateless node keep reaching out to removed storage node",
      "slug": "stateless-node-keep-reaching-out-to-removed-storage-node",
      "posts_count": 1,
      "reply_count": 0,
      "highest_post_number": 1,
      "image_url": null,
      "created_at": "2022-04-14T15:46:15.825Z",
      "last_posted_at": "2022-04-14T15:46:15.893Z",
      "bumped": true,
      "bumped_at": "2022-04-14T15:46:15.893Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "operator"
      ],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 390,
      "category_id": 16,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest single",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 1089,
            "username": "iyuroch",
            "name": "Ivan Yurochko",
            "avatar_template": "/user_avatar/forums.foundationdb.org/iyuroch/{size}/1311_2.png",
            "trust_level": 2
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 849,
        "username": "johscheuer",
        "name": "Johannes Scheuermann",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/j/f475e1/{size}.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 988,
        "username": "funkypenguin",
        "name": "David Young",
        "avatar_template": "/user_avatar/forums.foundationdb.org/funkypenguin/{size}/1153_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      }
    ],
    "created_by": {
      "id": 988,
      "username": "funkypenguin",
      "name": "David Young",
      "avatar_template": "/user_avatar/forums.foundationdb.org/funkypenguin/{size}/1153_2.png"
    },
    "last_poster": {
      "id": 849,
      "username": "johscheuer",
      "name": "Johannes Scheuermann",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/j/f475e1/{size}.png"
    }
  },
  "bookmarks": []
}