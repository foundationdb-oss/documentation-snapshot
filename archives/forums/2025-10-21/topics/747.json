{
  "post_stream": {
    "posts": [
      {
        "id": 2246,
        "name": "Caleb Spare",
        "username": "cespare",
        "avatar_template": "/user_avatar/forums.foundationdb.org/cespare/{size}/36_2.png",
        "created_at": "2018-10-06T01:55:20.534Z",
        "cooked": "<p>Since I\u2019ve started using FoundationDB one of the most idiosyncratic operational characteristics is how it wants to watch the configuration files and respond to changes. This has surprised me a few times, but today I really got thrown for a loop.</p>\n<p>A cluster I was using started giving this warning every time I connected:</p>\n<pre><code class=\"lang-auto\">$ fdbcli -C fdb.cluster\nUsing cluster file `fdb.cluster'.\n\nThe database is available, but has issues (type 'status' for more information).\n\nWelcome to the fdbcli. For help, type `help'.\nfdb&gt; status\n\nUsing cluster file `fdb.cluster'.\n\n1 client(s) reported: Cluster file contents do not match current cluster connection string. Verify the cluster file and its parent directory are writable and that the cluster file has not been overwritten externally.\n\nConfiguration:\n  Redundancy mode        - triple\n  Storage engine         - ssd-2\n  Coordinators           - 5\n...\n</code></pre>\n<p>I checked all the fdbcli processes and configuration everywhere (or so I thought) and I was really pulling my hair out after about 45 minutes. Eventually I found that <code>status details</code> gave me an IP address and then I figured out that another laptop I\u2019d run fdbcli on still had that session open (but I\u2019d changed to another git branch in the meantime, removing the fdb.cluster out from underneath fdbcli).</p>\n<p>This behavior is really surprising for two reasons:</p>\n<ul>\n<li>If I run some software with a configuration file that tells it what servers to connect to, I don\u2019t expect that it will monitor that file after startup and care if it changes.</li>\n<li>I don\u2019t expect that the particular state of some fdbcli process on some laptop somewhere causes a warning to appear for everyone who connects to the cluster (as though there\u2019s some problem with the cluster itself).</li>\n</ul>\n<p>So, two questions (or maybe feature requests):</p>\n<ol>\n<li>\n<p>Is it possible to run fdbcli in a way that loads the config once and then doesn\u2019t monitor the file? I tried tricking fdbcli this way but it didn\u2019t work:</p>\n<pre><code>$ fdbcli -C &lt;(cat fdb.cluster) \nUnexpected error loading cluster file `/proc/self/fd/11': 1516 File too large to be read\n</code></pre>\n</li>\n<li>\n<p>Is there any way to suppress warnings caused by fdbclis that are connected to the cluster? If we end up deploying FDB at my company I imagine that the \u201cCluster file contents do not match current \u2026\u201d warnings will be semi-permanent due to weird fdbcli connections.</p>\n</li>\n</ol>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2018-10-06T01:55:20.534Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 371,
        "reads": 68,
        "readers_count": 67,
        "score": 1873.6,
        "yours": false,
        "topic_id": 747,
        "topic_slug": "how-to-prevent-fdbcli-from-monitoring-the-connfile",
        "display_username": "Caleb Spare",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 44,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-prevent-fdbcli-from-monitoring-the-connfile/747/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 2275,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2018-10-08T16:27:34.392Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"cespare\" data-post=\"1\" data-topic=\"747\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/cespare/48/36_2.png\" class=\"avatar\"> cespare:</div>\n<blockquote>\n<p>If I run some software with a configuration file that tells it what servers to connect to, I don\u2019t expect that it will monitor that file after startup and care if it changes.</p>\n</blockquote>\n</aside>\n<p>This is done because the processes are trying to keep these files up-to-date with respect to the current connection string. If you change the coordinators of your cluster, for example, then every process will update their cluster file. If the file isn\u2019t current and the process restarts, it may not be able to connect to the cluster upon restart.</p>\n<p>A common cause for getting this error is if the cluster file isn\u2019t writable. Another is if the file gets changed by an external process. The latter can be a problem for multiple reasons. One is what I said above \u2013 that having an inaccurate cluster file can prevent the process from reconnecting on restart. The second is that a change to the coordinators in the cluster will cause the process to overwrite the file. If you were intending to intentionally change the cluster file externally, your process may actually end up undoing your work. Additionally, if the cluster file was changed in a way that connects to a different, unintended cluster, then there could be a variety of negative consequences if that process restarts.</p>\n<aside class=\"quote no-group\" data-username=\"cespare\" data-post=\"1\" data-topic=\"747\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/cespare/48/36_2.png\" class=\"avatar\"> cespare:</div>\n<blockquote>\n<p>I don\u2019t expect that the particular state of some fdbcli process on some laptop somewhere causes a warning to appear for everyone who connects to the cluster (as though there\u2019s some problem with the cluster itself).</p>\n</blockquote>\n</aside>\n<p>The status command is intended to give an overall picture of health and operation of the cluster. Based on what I described above, we\u2019ve considered a cluster file problem to be indicative of some sort of configuration or administrative problem that can lead to bad consequences. In that light, we want to make sure that this is apparent in the cluster\u2019s status and can be corrected. <code>fdbcli</code> is basically like any other client, so it behaves similarly.</p>\n<p>There\u2019s a similar issue when upgrading that can arise from having a process left connected to the cluster like this. If you are using the multi-version client, it\u2019s usually a good idea to check that all connected clients are properly prepared for the upgrade before going through with it. I believe an orphaned <code>fdbcli</code> will appear as an older client and you\u2019d have to hunt it down in that case too.</p>\n<aside class=\"quote no-group\" data-username=\"cespare\" data-post=\"1\" data-topic=\"747\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/cespare/48/36_2.png\" class=\"avatar\"> cespare:</div>\n<blockquote>\n<p>Is it possible to run fdbcli in a way that loads the config once and then doesn\u2019t monitor the file?</p>\n</blockquote>\n</aside>\n<aside class=\"quote no-group\" data-username=\"cespare\" data-post=\"1\" data-topic=\"747\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/cespare/48/36_2.png\" class=\"avatar\"> cespare:</div>\n<blockquote>\n<p>Is there any way to suppress warnings caused by fdbclis that are connected to the cluster?</p>\n</blockquote>\n</aside>\n<p>I don\u2019t know of a way to do so currently. It\u2019s possible this topic could fold into the broader discussion about the future of cluster files and connection strings (see <a href=\"https://github.com/apple/foundationdb/issues/567\" class=\"inline-onebox\">Providing a connection string without a cluster file \u00b7 Issue #567 \u00b7 apple/foundationdb \u00b7 GitHub</a> and various topics on the forums), but keep in mind one thing you may want to do with fdbcli is change the coordinators, and in that case it\u2019s often helpful that it then writes the new cluster file for you.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2018-10-08T16:27:34.392Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 1,
        "incoming_link_count": 13,
        "reads": 61,
        "readers_count": 60,
        "score": 77.2,
        "yours": false,
        "topic_id": 747,
        "topic_slug": "how-to-prevent-fdbcli-from-monitoring-the-connfile",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/issues/567",
            "internal": false,
            "reflection": false,
            "title": "Providing a connection string without a cluster file \u00b7 Issue #567 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 28
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-prevent-fdbcli-from-monitoring-the-connfile/747/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      2246,
      2275
    ]
  },
  "timeline_lookup": [
    [
      1,
      2573
    ],
    [
      2,
      2570
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "How to prevent fdbcli from monitoring the connfile?",
  "id": 747,
  "title": "How to prevent fdbcli from monitoring the connfile?",
  "posts_count": 2,
  "created_at": "2018-10-06T01:55:20.444Z",
  "views": 1386,
  "reply_count": 0,
  "like_count": 0,
  "last_posted_at": "2018-10-08T16:27:34.392Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "how-to-prevent-fdbcli-from-monitoring-the-connfile",
  "category_id": 7,
  "word_count": 954,
  "deleted_at": null,
  "user_id": 44,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_747",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 2,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Doubts regarding fdb.cluster file",
      "id": 1109,
      "title": "Doubts regarding fdb.cluster file",
      "slug": "doubts-regarding-fdb-cluster-file",
      "posts_count": 4,
      "reply_count": 2,
      "highest_post_number": 4,
      "image_url": null,
      "created_at": "2019-02-02T16:02:47.335Z",
      "last_posted_at": "2019-02-07T17:17:38.271Z",
      "bumped": true,
      "bumped_at": "2019-02-07T17:17:38.271Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 2739,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Deployment with custom fdb.cluster file",
      "id": 592,
      "title": "Deployment with custom fdb.cluster file",
      "slug": "deployment-with-custom-fdb-cluster-file",
      "posts_count": 8,
      "reply_count": 4,
      "highest_post_number": 8,
      "image_url": null,
      "created_at": "2018-07-26T23:00:18.994Z",
      "last_posted_at": "2018-07-27T23:44:31.722Z",
      "bumped": true,
      "bumped_at": "2018-07-27T23:44:31.722Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 4329,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 311,
            "username": "ThomasJ",
            "name": "Thomas Johson",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Allowing client APIs to use an &ldquo;in-memory&rdquo; fdb.cluster file?",
      "id": 675,
      "title": "Allowing client APIs to use an \"in-memory\" fdb.cluster file?",
      "slug": "allowing-client-apis-to-use-an-in-memory-fdb-cluster-file",
      "posts_count": 3,
      "reply_count": 1,
      "highest_post_number": 3,
      "image_url": null,
      "created_at": "2018-08-31T17:20:31.703Z",
      "last_posted_at": "2018-09-01T21:58:12.317Z",
      "bumped": true,
      "bumped_at": "2018-09-01T21:58:12.317Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1755,
      "category_id": 8,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 158,
            "username": "aseipp",
            "name": "Austin Seipp",
            "avatar_template": "/user_avatar/forums.foundationdb.org/aseipp/{size}/124_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Fdbmonitor configuration reload not stopping old fdbserver processes",
      "id": 1674,
      "title": "Fdbmonitor configuration reload not stopping old fdbserver processes",
      "slug": "fdbmonitor-configuration-reload-not-stopping-old-fdbserver-processes",
      "posts_count": 4,
      "reply_count": 1,
      "highest_post_number": 4,
      "image_url": null,
      "created_at": "2019-10-09T18:30:44.191Z",
      "last_posted_at": "2019-10-16T17:46:40.574Z",
      "bumped": true,
      "bumped_at": "2019-10-16T17:46:40.574Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 568,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 576,
            "username": "davisp",
            "name": "Paul J  Davis",
            "avatar_template": "/user_avatar/forums.foundationdb.org/davisp/{size}/570_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "How are &lsquo;contributing_workers&rsquo; computed?",
      "id": 360,
      "title": "How are 'contributing_workers' computed?",
      "slug": "how-are-contributing-workers-computed",
      "posts_count": 20,
      "reply_count": 13,
      "highest_post_number": 20,
      "image_url": null,
      "created_at": "2018-05-07T00:53:18.538Z",
      "last_posted_at": "2018-05-12T07:19:34.562Z",
      "bumped": true,
      "bumped_at": "2018-05-12T07:19:34.562Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 6,
      "views": 1986,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 236,
            "username": "marctrem",
            "name": "Marc-Andr\u00e9 Tremblay",
            "avatar_template": "/user_avatar/forums.foundationdb.org/marctrem/{size}/208_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 54,
            "username": "Evan",
            "name": "Evan Tschannen",
            "avatar_template": "/user_avatar/forums.foundationdb.org/evan/{size}/104_2.png",
            "moderator": true,
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 156,
            "username": "spullara",
            "name": "Sam Pullara",
            "avatar_template": "/user_avatar/forums.foundationdb.org/spullara/{size}/125_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 247,
            "username": "Chr1st0ph",
            "name": "Chr1st0ph",
            "avatar_template": "/user_avatar/forums.foundationdb.org/chr1st0ph/{size}/353_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 118,
            "username": "abdullin",
            "name": "Rinat Abdullin",
            "avatar_template": "/user_avatar/forums.foundationdb.org/abdullin/{size}/83_2.png",
            "trust_level": 2
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 12,
        "username": "ajbeamon",
        "name": "A.J. Beamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      },
      {
        "id": 44,
        "username": "cespare",
        "name": "Caleb Spare",
        "avatar_template": "/user_avatar/forums.foundationdb.org/cespare/{size}/36_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      }
    ],
    "created_by": {
      "id": 44,
      "username": "cespare",
      "name": "Caleb Spare",
      "avatar_template": "/user_avatar/forums.foundationdb.org/cespare/{size}/36_2.png"
    },
    "last_poster": {
      "id": 12,
      "username": "ajbeamon",
      "name": "A.J. Beamon",
      "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png"
    },
    "links": [
      {
        "url": "https://github.com/apple/foundationdb/issues/567",
        "title": "Providing a connection string without a cluster file \u00b7 Issue #567 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 28,
        "user_id": 12,
        "domain": "github.com",
        "root_domain": "github.com"
      }
    ]
  },
  "bookmarks": []
}