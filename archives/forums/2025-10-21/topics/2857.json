{
  "post_stream": {
    "posts": [
      {
        "id": 9892,
        "name": "Lou",
        "username": "laita",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/l/77aa72/{size}.png",
        "created_at": "2021-08-20T19:11:36.466Z",
        "cooked": "<p>I am facing in a strange behavior using python api to access fdb. This is based on gunicorn which forks a worker process. I open  the database from main then I try to uses it from forked process then it hangs.</p>\n<p>I produced in a small script this behavior. I debugged and found that it stucks in semaphore.acquire() in fdb/impl.py in function block_until_ready.</p>\n<p>Here is a buggy script that reproduces, any help is welcome. Thank you</p>\n<pre><code class=\"lang-auto\">\n\nimport fdb\n\nfdb.api_version(630)\n\nfrom multiprocessing import Process\n\n\ndb = fdb.open('/etc/local/foundationdb/fdb.cluster')\n\ndb[b'u'] = b'v'\n\nprint( db[b'u'])\n\ndef f(name, db):\n    #import pdb; pdb.set_trace()\n    print('hello', name, db)\n    db[b'z'] = b'w'\n    print(db[b'z'])\n\nif __name__ == '__main__':\n    p = Process(target=f, args=('bob',db))\n    p.start()\n    p.join()\n</code></pre>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 3,
        "updated_at": "2021-08-20T19:13:31.998Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 31,
        "reads": 13,
        "readers_count": 12,
        "score": 157.6,
        "yours": false,
        "topic_id": 2857,
        "topic_slug": "access-db-from-forked-process",
        "display_username": "Lou",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 989,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/access-db-from-forked-process/2857/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 9901,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2021-08-23T00:26:07.181Z",
        "cooked": "<p>See the post below for a little discussion of this. The conclusion there was that you\u2019ll need to connect to FDB after you fork rather than before in order for the client network thread to work properly.</p>\n<aside class=\"quote quote-modified\" data-post=\"1\" data-topic=\"560\">\n  <div class=\"title\">\n    <div class=\"quote-controls\"></div>\n    <img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/cloudspeech/48/330_2.png\" class=\"avatar\">\n    <a href=\"https://forums.foundationdb.org/t/fork-and-indefinite-blocking-of-fdb-future-block-until-ready/560\">Fork and indefinite blocking of fdb_future_block_until_ready</a> <a class=\"badge-category__wrapper \" href=\"/c/development/5\"><span data-category-id=\"5\" data-drop-close=\"true\" class=\"badge-category \" title=\"Topics related to development of FoundationDB.\"><span class=\"badge-category__name\">Development</span></span></a>\n  </div>\n  <blockquote>\n    Hi, \nI tried to couple a (pre)forking socket server with foundationDB, using the C API directly. \nThe socket server is a slight modification of <a href=\"https://gist.github.com/paulsmith/204301\" rel=\"nofollow noopener\">https://gist.github.com/paulsmith/204301</a> \nfor unix domain sockets. \nA client connects with an input that ultimately translates into a key to be looked up in a foundationDB database. \nUsing a variation of function getKey in \n\n\nI intended to send the value corresponding to the key back to the client. \nEverything works as intended when I disable forking all\u2026\n  </blockquote>\n</aside>\n",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 3,
        "updated_at": "2021-08-23T00:26:53.633Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 10,
        "readers_count": 9,
        "score": 7.0,
        "yours": false,
        "topic_id": 2857,
        "topic_slug": "access-db-from-forked-process",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://forums.foundationdb.org/t/fork-and-indefinite-blocking-of-fdb-future-block-until-ready/560",
            "internal": true,
            "reflection": false,
            "title": "Fork and indefinite blocking of fdb_future_block_until_ready",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/access-db-from-forked-process/2857/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 9902,
        "name": "Lou",
        "username": "laita",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/l/77aa72/{size}.png",
        "created_at": "2021-08-23T07:25:58.501Z",
        "cooked": "<p>It was also my independent conclusion after session of debug. In fact I use Gunicorn which forks a new process.<br>\nSo I do init in forked process. Even my python module is loaded before. This has some drawbacks but works.</p>\n<p>Thank you</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 3,
        "updated_at": "2021-08-23T07:26:18.203Z",
        "reply_count": 0,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 10,
        "readers_count": 9,
        "score": 2.0,
        "yours": false,
        "topic_id": 2857,
        "topic_slug": "access-db-from-forked-process",
        "display_username": "Lou",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 12,
          "username": "ajbeamon",
          "name": "A.J. Beamon",
          "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 989,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/access-db-from-forked-process/2857/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      9892,
      9901,
      9902
    ]
  },
  "timeline_lookup": [
    [
      1,
      1523
    ],
    [
      2,
      1521
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Access db from forked process",
  "id": 2857,
  "title": "Access db from forked process",
  "posts_count": 3,
  "created_at": "2021-08-20T19:11:36.405Z",
  "views": 619,
  "reply_count": 1,
  "like_count": 0,
  "last_posted_at": "2021-08-23T07:25:58.501Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "access-db-from-forked-process",
  "category_id": 7,
  "word_count": 236,
  "deleted_at": null,
  "user_id": 989,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_2857",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 3,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Fork and indefinite blocking of fdb_future_block_until_ready",
      "id": 560,
      "title": "Fork and indefinite blocking of fdb_future_block_until_ready",
      "slug": "fork-and-indefinite-blocking-of-fdb-future-block-until-ready",
      "posts_count": 3,
      "reply_count": 1,
      "highest_post_number": 3,
      "image_url": null,
      "created_at": "2018-07-11T17:59:19.588Z",
      "last_posted_at": "2018-07-12T16:10:30.664Z",
      "bumped": true,
      "bumped_at": "2018-07-12T16:10:30.664Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 868,
      "category_id": 5,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 208,
            "username": "cloudspeech",
            "name": "Cloudspeech",
            "avatar_template": "/user_avatar/forums.foundationdb.org/cloudspeech/{size}/330_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Indefinite blocking of fdb_future_block_until_ready even though DB is available",
      "id": 1323,
      "title": "Indefinite blocking of fdb_future_block_until_ready even though DB is available",
      "slug": "indefinite-blocking-of-fdb-future-block-until-ready-even-though-db-is-available",
      "posts_count": 3,
      "reply_count": 0,
      "highest_post_number": 3,
      "image_url": null,
      "created_at": "2019-04-22T12:11:56.933Z",
      "last_posted_at": "2019-04-26T07:06:08.936Z",
      "bumped": true,
      "bumped_at": "2019-04-26T07:06:08.936Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "bindings"
      ],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 956,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 511,
            "username": "sakthivelpvs",
            "name": "Sakthivel",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/s/9dc877/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Fdbmonitor starting identical copies of itself instead of fdbserver process (5.2.5, RHEL)",
      "id": 545,
      "title": "Fdbmonitor starting identical copies of itself instead of fdbserver process (5.2.5, RHEL)",
      "slug": "fdbmonitor-starting-identical-copies-of-itself-instead-of-fdbserver-process-5-2-5-rhel",
      "posts_count": 4,
      "reply_count": 1,
      "highest_post_number": 4,
      "image_url": "https://global.discourse-cdn.com/foundationdb/optimized/1X/4e8a1b5f4248f69a18d6ca69f2134a3c1159f498_2_1024x428.jpg",
      "created_at": "2018-07-04T16:09:40.511Z",
      "last_posted_at": "2018-07-05T15:52:08.139Z",
      "bumped": true,
      "bumped_at": "2018-07-17T21:31:35.082Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 842,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 22,
            "username": "dave",
            "name": "David Scherer",
            "avatar_template": "/user_avatar/forums.foundationdb.org/dave/{size}/89_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Foundationdb seems keep reinitialising itself after client hang",
      "id": 1437,
      "title": "Foundationdb seems keep reinitialising itself after client hang",
      "slug": "foundationdb-seems-keep-reinitialising-itself-after-client-hang",
      "posts_count": 6,
      "reply_count": 2,
      "highest_post_number": 6,
      "image_url": null,
      "created_at": "2019-06-10T10:10:13.209Z",
      "last_posted_at": "2019-06-26T18:08:03.629Z",
      "bumped": true,
      "bumped_at": "2019-06-26T18:08:03.629Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 1222,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 602,
            "username": "ppggff",
            "name": "ppggff",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ppggff/{size}/855_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "How to improve connections count from client to server in go sdk or in c sdk",
      "id": 223,
      "title": "How to improve connections count from client to server in go sdk or in c sdk",
      "slug": "how-to-improve-connections-count-from-client-to-server-in-go-sdk-or-in-c-sdk",
      "posts_count": 9,
      "reply_count": 7,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2018-04-23T15:43:18.969Z",
      "last_posted_at": "2018-04-24T05:23:56.703Z",
      "bumped": true,
      "bumped_at": "2018-04-24T05:23:56.703Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 1718,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 152,
            "username": "shgxwxl",
            "name": "Shgxwxl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/shgxwxl/{size}/127_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 22,
            "username": "dave",
            "name": "David Scherer",
            "avatar_template": "/user_avatar/forums.foundationdb.org/dave/{size}/89_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 989,
        "username": "laita",
        "name": "Lou",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/l/77aa72/{size}.png",
        "post_count": 2,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      },
      {
        "id": 12,
        "username": "ajbeamon",
        "name": "A.J. Beamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      }
    ],
    "created_by": {
      "id": 989,
      "username": "laita",
      "name": "Lou",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/l/77aa72/{size}.png"
    },
    "last_poster": {
      "id": 989,
      "username": "laita",
      "name": "Lou",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/l/77aa72/{size}.png"
    }
  },
  "bookmarks": []
}