{
  "post_stream": {
    "posts": [
      {
        "id": 11968,
        "name": "Zhang Hui Gui",
        "username": "ZhangHuiGui",
        "avatar_template": "/user_avatar/forums.foundationdb.org/zhanghuigui/{size}/1377_2.png",
        "created_at": "2022-11-07T13:17:09.443Z",
        "cooked": "<p>Hello <a class=\"mention\" href=\"/u/andrew.noyes\">@andrew.noyes</a>,<br>\nThere is a small question about <code>CLIENT_BUGGIFY</code>, when we use c-api and open CLIENT_BUGGIFY, we find the c-api return timed-out error after commit, but there was a <code>simulateTimeoutInFlightCommit</code> with ACTOR model.</p>\n<p>So could you give us some suggestion to deal with this kind of problem, cause the inflight commit may success and change the key\u2019s value but client receive error code?</p>\n<p>Many thanks for your suggestion!</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2022-11-07T13:17:09.443Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 19,
        "reads": 17,
        "readers_count": 16,
        "score": 98.4,
        "yours": false,
        "topic_id": 3642,
        "topic_slug": "how-to-deal-with-client-buggify-return-error-but-simulatetimeoutinflightcommit-success",
        "display_username": "Zhang Hui Gui",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1134,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-deal-with-client-buggify-return-error-but-simulatetimeoutinflightcommit-success/3642/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 11972,
        "name": "",
        "username": "andrew.noyes",
        "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
        "created_at": "2022-11-07T17:59:31.770Z",
        "cooked": "<p>Reasoning about possible behaviors in this scenario is very tricky. The simplest way to handle this all correctly (and what I highly recommend) is <em>don\u2019t retry a transaction whose commit future failed with transaction_timed_out</em>. This is also why <code>transaction_timed_out</code> is not retried by the default retry loop.</p>\n<p>Also there was actually a bug that was only recently fixed in the implementation of <code>simulateTimeoutInFlightCommit</code> itself (<a href=\"https://github.com/apple/foundationdb/pull/8416\" rel=\"noopener nofollow ugc\">https://github.com/apple/foundationdb/pull/8416</a>), that means that your test can fail even if you are handling this correctly.</p>\n<p>The basic problem is that if you get <code>transaction_timed_out</code> from a commit, then you have very little information about what has happened or what can happen. The commit attempt may have already succeeded, may succeed in the future, or may never succeed. The c api internally (before throwing <code>commit_unknown_result</code>), will guarantee that either the commit has already succeeded or will never succeed. Doing this requires getting a response from the cluster though, so it could take an indefinite amount of time. Setting a transaction timeout basically subverts this mechanism, and it kind of has to - the alternative is waiting indefinitely, and avoiding that is the whole point of setting a timeout.</p>\n<p>If you want to retry a transaction whose commit failed with transaction_timed_out, the only safe way to do it is to somehow ensure that the last commit attempt is no longer in-flight. All mechanisms for doing this require getting a response from the cluster though, so it would have been more efficient and safer to not set a transaction time out at all and to just way for the c api to figure this out for you.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2022-11-07T17:59:31.770Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 15,
        "readers_count": 14,
        "score": 48.0,
        "yours": false,
        "topic_id": 3642,
        "topic_slug": "how-to-deal-with-client-buggify-return-error-but-simulatetimeoutinflightcommit-success",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/pull/8416",
            "internal": false,
            "reflection": false,
            "title": "Make ApiWorkload::clearData tx self-conflicting by sfc-gh-anoyes \u00b7 Pull Request #8416 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 3
          }
        ],
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 2
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 14,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/how-to-deal-with-client-buggify-return-error-but-simulatetimeoutinflightcommit-success/3642/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      11968,
      11972
    ]
  },
  "timeline_lookup": [
    [
      1,
      1079
    ]
  ],
  "suggested_topics": [],
  "tags": [
    "bindings"
  ],
  "tags_descriptions": {},
  "fancy_title": "How to deal with CLIENT_BUGGIFY return error but simulateTimeoutInFlightCommit success?",
  "id": 3642,
  "title": "How to deal with CLIENT_BUGGIFY return error but simulateTimeoutInFlightCommit success?",
  "posts_count": 2,
  "created_at": "2022-11-07T13:17:09.376Z",
  "views": 395,
  "reply_count": 0,
  "like_count": 2,
  "last_posted_at": "2022-11-07T17:59:31.770Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "how-to-deal-with-client-buggify-return-error-but-simulatetimeoutinflightcommit-success",
  "category_id": 7,
  "word_count": 348,
  "deleted_at": null,
  "user_id": 1134,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_3642",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 2,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Prevent retrying on slow transactions",
      "id": 1737,
      "title": "Prevent retrying on slow transactions",
      "slug": "prevent-retrying-on-slow-transactions",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2019-11-14T20:42:30.931Z",
      "last_posted_at": "2019-11-14T20:46:22.590Z",
      "bumped": true,
      "bumped_at": "2019-11-14T20:46:22.590Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 715,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 681,
            "username": "stevent",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/s/5f9b8f/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "&ldquo;Transaction may or may not have committed&rdquo; receive during scheduled node",
      "id": 486,
      "title": "\"Transaction may or may not have committed\" receive during scheduled node",
      "slug": "transaction-may-or-may-not-have-committed-receive-during-scheduled-node",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2018-06-04T18:07:58.814Z",
      "last_posted_at": "2018-06-04T23:00:31.353Z",
      "bumped": true,
      "bumped_at": "2018-06-04T23:00:31.353Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 885,
      "category_id": 5,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 296,
            "username": "theos",
            "name": "Daniil Gitelson",
            "avatar_template": "/user_avatar/forums.foundationdb.org/theos/{size}/282_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Make commit_unknown_results unlikely - PR status",
      "id": 3413,
      "title": "Make commit_unknown_results unlikely - PR status",
      "slug": "make-commit-unknown-results-unlikely-pr-status",
      "posts_count": 14,
      "reply_count": 12,
      "highest_post_number": 14,
      "image_url": null,
      "created_at": "2022-07-01T00:26:40.443Z",
      "last_posted_at": "2022-07-20T12:27:13.316Z",
      "bumped": true,
      "bumped_at": "2022-07-20T12:27:13.316Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 798,
      "category_id": 5,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 946,
            "username": "rajivr",
            "name": "Rajiv M Ranganath",
            "avatar_template": "/user_avatar/forums.foundationdb.org/rajivr/{size}/1100_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 15,
            "username": "markus.pilman",
            "name": "Markus Pilman",
            "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 14,
            "username": "andrew.noyes",
            "name": "",
            "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Proper transaction retry loops",
      "id": 2090,
      "title": "Proper transaction retry loops",
      "slug": "proper-transaction-retry-loops",
      "posts_count": 4,
      "reply_count": 1,
      "highest_post_number": 4,
      "image_url": null,
      "created_at": "2020-04-28T21:37:58.250Z",
      "last_posted_at": "2020-04-29T20:54:27.789Z",
      "bumped": true,
      "bumped_at": "2020-04-29T20:54:27.789Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 561,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 576,
            "username": "davisp",
            "name": "Paul J  Davis",
            "avatar_template": "/user_avatar/forums.foundationdb.org/davisp/{size}/570_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Question on parallel commit latencies",
      "id": 1346,
      "title": "Question on parallel commit latencies",
      "slug": "question-on-parallel-commit-latencies",
      "posts_count": 9,
      "reply_count": 3,
      "highest_post_number": 9,
      "image_url": "https://global.discourse-cdn.com/foundationdb/optimized/1X/cd4148da17fe747ccfd45b2b1d4d36efedb0bf4c_2_1024x1024.png",
      "created_at": "2019-05-03T20:34:29.622Z",
      "last_posted_at": "2019-05-31T19:51:53.366Z",
      "bumped": true,
      "bumped_at": "2019-05-31T19:51:53.366Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 1616,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 576,
            "username": "davisp",
            "name": "Paul J  Davis",
            "avatar_template": "/user_avatar/forums.foundationdb.org/davisp/{size}/570_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 454,
            "username": "jzhou",
            "name": "Jingyu Zhou",
            "avatar_template": "/user_avatar/forums.foundationdb.org/jzhou/{size}/445_2.png",
            "admin": true,
            "moderator": true,
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 14,
        "username": "andrew.noyes",
        "name": "",
        "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 1134,
        "username": "ZhangHuiGui",
        "name": "Zhang Hui Gui",
        "avatar_template": "/user_avatar/forums.foundationdb.org/zhanghuigui/{size}/1377_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      }
    ],
    "created_by": {
      "id": 1134,
      "username": "ZhangHuiGui",
      "name": "Zhang Hui Gui",
      "avatar_template": "/user_avatar/forums.foundationdb.org/zhanghuigui/{size}/1377_2.png"
    },
    "last_poster": {
      "id": 14,
      "username": "andrew.noyes",
      "name": "",
      "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png"
    },
    "links": [
      {
        "url": "https://github.com/apple/foundationdb/pull/8416",
        "title": "Make ApiWorkload::clearData tx self-conflicting by sfc-gh-anoyes \u00b7 Pull Request #8416 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 3,
        "user_id": 14,
        "domain": "github.com",
        "root_domain": "github.com"
      }
    ]
  },
  "bookmarks": []
}