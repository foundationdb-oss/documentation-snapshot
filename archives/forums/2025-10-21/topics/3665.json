{
  "post_stream": {
    "posts": [
      {
        "id": 12031,
        "name": "Dan Meyers",
        "username": "danm",
        "avatar_template": "/user_avatar/forums.foundationdb.org/danm/{size}/1393_2.png",
        "created_at": "2022-11-18T16:50:09.458Z",
        "cooked": "<p>So, we\u2019re updating the AMI our FoundationDB cluster runs on. We want to do this as hitlessly as possible. Previously, we\u2019ve only ever either done it in a\u2026 \u2018hitful\u2019 way, by replacing all the machines and having the new ones come up and mount the volume and associated network interface (and thus IP) of their predecessor.</p>\n<p>What has worked for us when we\u2019ve made changes to <em><code>storage</code></em> class machines is to use the <code>exclude</code> command to exclude the machineid of each of the machines we want to shut down, wait for some time until all the data has been shuffled off them and onto the new <code>storage</code> processes on the new <code>storage</code> class machines (at which point the excluded processes also drop the <code>storage</code> role in their status), then shut down the \u2018old\u2019 machines, and delete them and their disks.</p>\n<p>This worked fine, for <code>storage</code> class machines. During the data move the cluster reported itself as \u2018Healing\u2019, but was still responding to requests. Again, this was as expected.</p>\n<p>When we did the same for machines running processes assigned the <code>log</code> or <code>stateless</code> classes, not only did their processes <em>not</em> drop their associated roles (and have processes on non-excluded machines pick them up), if we force a role to migrate by shutting down the <code>fdbmonitor</code> (and thus also the managed <code>fdbserver</code>) process on that machine, FDB is frequently choosing already-excluded processes, which had no assigned roles, as the new processes to run the next generation of that role. The cluster is listed as \u2018Healthy\u2019 throughout this migration attempt, so it either doesn\u2019t think it <em>needs</em> to heal, or the healing process completes so quickly that we don\u2019t see it.</p>\n<p>What gives? I thought excluding a process was supposed to shuffle all data (which, because this is a very lightly loaded cluster, is basically 0 outside of the <code>storage</code> processes) owned by that process across to another one via a rebalnace operation, and then drop any roles from the process and not assign new ones? If that\u2019s <em>not</em> the case, what should we be doing to safely migrate these roles to machines we\u2019re not about to shut down?</p>\n<p>N.B. I know the <code>coordinator</code> role is different and we have to manually migrate that. I\u2019m worried about the others.</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2022-11-18T16:52:07.959Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 185,
        "reads": 34,
        "readers_count": 33,
        "score": 926.8,
        "yours": false,
        "topic_id": 3665,
        "topic_slug": "excluding-non-storage-processes-on-fdb-7-1-23",
        "display_username": "Dan Meyers",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1142,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/excluding-non-storage-processes-on-fdb-7-1-23/3665/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 12035,
        "name": "Johannes Scheuermann",
        "username": "johscheuer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/j/f475e1/{size}.png",
        "created_at": "2022-11-21T07:15:43.729Z",
        "cooked": "<blockquote>\n<p>What has worked for us when we\u2019ve made changes to <em><code>storage</code></em> class machines is to use the <code>exclude</code> command to exclude the machineid of each of the machines we want to shut down, wait for some time until all the data has been shuffled off them and onto the new <code>storage</code> processes on the new <code>storage</code> class machines (at which point the excluded processes also drop the <code>storage</code> role in their status), then shut down the \u2018old\u2019 machines, and delete them and their disks.</p>\n</blockquote>\n<p>If you only want to update the AMI and keep the data on the associated EBS volumes you might want to look into the <a href=\"https://github.com/apple/foundationdb/wiki/Maintenance-mode\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Maintenance mode \u00b7 apple/foundationdb Wiki \u00b7 GitHub</a> instead of doing an exclusion and a migration to a new ec2 instance. That would allow you to run for a \u201cshort\u201d time (probably a few minutes until the new ec2 instance is up) with reduced fault tolerance until the new instance is up and running again.</p>\n<blockquote>\n<p>When we did the same for machines running processes assigned the <code>log</code> or <code>stateless</code> classes, not only did their processes <em>not</em> drop their associated roles (and have processes on non-excluded machines pick them up), if we force a role to migrate by shutting down the <code>fdbmonitor</code> (and thus also the managed <code>fdbserver</code> ) process on that machine, FDB is frequently choosing already-excluded processes, which had no assigned roles, as the new processes to run the next generation of that role. The cluster is listed as \u2018Healthy\u2019 throughout this migration attempt, so it either doesn\u2019t think it <em>needs</em> to heal, or the healing process completes so quickly that we don\u2019t see it.</p>\n</blockquote>\n<p>I haven\u2019t seen a scenario where an excluded process picks up an active role in a new generation, if you have a minimal reproducible scenario that would be helpful. When a stateless process is excluded, that exclusion is normally instantly (since there is no state to replicate and a new recovery will be triggered), for log processes it\u2019s almost the same, there will be a recovery and the log process will not be part of the new generation but FDB will ensure that all mutations (logs) are persisted before the log role will be dropped. If you cluster doesn\u2019t have a high write load, that should probably take a few seconds. I would be surprised if the role is not dropped, since we do testing with the FDB Kubernetes operator for this version and a deletion actually checks if the role is dropped: <a href=\"https://github.com/FoundationDB/fdb-kubernetes-operator/blob/main/fdbclient/admin_client.go#L472-L474\" rel=\"noopener nofollow ugc\">https://github.com/FoundationDB/fdb-kubernetes-operator/blob/main/fdbclient/admin_client.go#L472-L474</a>, if the role still exists that could mean that either the process was not excluded or, in case of a log process, they process still has mutations that are not persisted in the storage subsystem.</p>\n<blockquote>\n<p>What gives? I thought excluding a process was supposed to shuffle all data (which, because this is a very lightly loaded cluster, is basically 0 outside of the <code>storage</code> processes) owned by that process across to another one via a rebalnace operation, and then drop any roles from the process and not assign new ones? If that\u2019s <em>not</em> the case, what should we be doing to safely migrate these roles to machines we\u2019re not about to shut down?</p>\n</blockquote>\n<p>That\u2019s the expected behaviour, like I said if you could share a reproducible example that would be helpful, so far I haven\u2019t seen this behaviour, which doesn\u2019t mean it doesn\u2019t exist.</p>\n<p>As a side note: The exclusion command does only a very limited set of checks before doing the exclusion, so you want to ensure that you have enough processes in your cluster for your configuration, see: <a href=\"https://github.com/apple/foundationdb/issues/1292\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">New safety checks on exclusions that could take a database unavailable \u00b7 Issue #1292 \u00b7 apple/foundationdb \u00b7 GitHub</a>.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2022-11-21T07:15:43.729Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 13,
        "reads": 34,
        "readers_count": 33,
        "score": 76.8,
        "yours": false,
        "topic_id": 3665,
        "topic_slug": "excluding-non-storage-processes-on-fdb-7-1-23",
        "display_username": "Johannes Scheuermann",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/wiki/Maintenance-mode",
            "internal": false,
            "reflection": false,
            "title": "Maintenance mode \u00b7 apple/foundationdb Wiki \u00b7 GitHub",
            "clicks": 7
          },
          {
            "url": "https://github.com/apple/foundationdb/issues/1292",
            "internal": false,
            "reflection": false,
            "title": "New safety checks on exclusions that could take a database unavailable \u00b7 Issue #1292 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 5
          },
          {
            "url": "https://github.com/FoundationDB/fdb-kubernetes-operator/blob/main/fdbclient/admin_client.go#L472-L474",
            "internal": false,
            "reflection": false,
            "title": "fdb-kubernetes-operator/admin_client.go at main \u00b7 FoundationDB/fdb-kubernetes-operator \u00b7 GitHub",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 849,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/excluding-non-storage-processes-on-fdb-7-1-23/3665/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12036,
        "name": "Dan Meyers",
        "username": "danm",
        "avatar_template": "/user_avatar/forums.foundationdb.org/danm/{size}/1393_2.png",
        "created_at": "2022-11-21T11:50:21.140Z",
        "cooked": "<blockquote>\n<p>If you only want to update the AMI and keep the data on the associated EBS volumes you might want to look into the <a href=\"https://github.com/apple/foundationdb/wiki/Maintenance-mode\" rel=\"noopener nofollow ugc\">Maintenance mode \u00b7 apple/foundationdb Wiki \u00b7 GitHub</a></p>\n</blockquote>\n<p>Interesting :). We do, however, have a load of tooling already around the existing system, which also means we don\u2019t need separate processes for switching out the AMI vs swapping the disks to new ones that are larger/have more IOPS/whatever. We\u2019re happy to take the hit on time/cost for that consistency, <em>for now</em>, because our data volumes are going to be small enough for a few years yet that it\u2019s not a major issue. We\u2019re also intending to run a bank on this once we get approval, so people are going to be leery of anything which lowers fault tolerance, even for a short while. Once we\u2019re to the point of it taking days to replicate everything, we may well rework things <img src=\"https://emoji.discourse-cdn.com/twitter/wink.png?v=12\" title=\":wink:\" class=\"emoji\" alt=\":wink:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<blockquote>\n<p>if you have a minimal reproducible scenario that would be helpful</p>\n</blockquote>\n<p>Annoyingly, this is the first time we\u2019ve seen it. We\u2019ll try and work up a reproduction today (we\u2019re in the UK, so will be running on GMT).</p>\n<p>As initial reference, we\u2019re running in <code>three_data_hall</code> mode. We\u2019re spread across the <code>eu-west-2</code> region, with then intention of being able to handle an entire AZ going offline + still being able to do rolling updates if necessary by taking a single machine at a time out across the remaining 2 AZs.</p>\n<p>As such, our \u2018standard\u2019 setup is</p>\n<ul>\n<li>9 \u2018coordinator\u2019 class machines (3 per AZ) which we manually configure as\u2026 the coordinators</li>\n<li>3 \u2018stateless\u2019 class machines (2 processes per machine, 1 machine per AZ)</li>\n<li>9 \u2018log\u2019 class machines (3x3 again, of which the default 4 are in use with role \u2018log\u2019 at any one time, but it allows FDB to roll to an entire new log generation within the existing collection of machines under normal circumstances)</li>\n<li>6 \u2018storage\u2019 class machines (2 per AZ).</li>\n</ul>\n<p>We have a startup script which queries the tags on an instance to know what class it is, attaches and mounts a previously-unattached volume of that class in the same AZ, and use the tags on the volume to locate the associated network interface (and thus IP) which it also attaches, before finally writing the FDB config file with</p>\n<ul>\n<li><code>locality-machineid</code> as the AWS instance ID (<code>i-0e6f3e2c231f77558</code>)</li>\n<li><code>locality-data-hall</code> as the AZ (<code>eu-west-2a</code>)</li>\n<li><code>locality-dcid</code> as the region (<code>eu-west-2</code>)</li>\n</ul>\n<p>before finally starting <code>fdbmonitor</code> via a <code>systemd</code> init script.</p>\n<p>What we\u2019ve done with our rolling update is double the number of running instances for each class (via a new set of ASGs for each), so 18 coordinators, 6 stateless (12 processes), 18 logs, 12 storage. We\u2019ve not touched the coordinators yet, so the original 9 are still running as them and the new 9 should just be sat there doing nothing, but for stateless, log, and storage, we excluded <code>locality_machineid:&lt;AWS instance ID&gt;</code> for all of the old instances. They\u2019re listed as <code>excluded</code> in <code>status json</code>. <code>storage</code> processes migrated their data over to the new, non-excluded, instances, and the old ones are now safe to shut down. <code>log</code> and <code>stateless</code> didn\u2019t change.</p>\n<p>If any of that sound like a wrong/broken setup on a first pass, just in general but <em>especially</em> as a potential cause of our issues, it\u2019d be really good to know <img src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2022-11-21T15:06:03.742Z",
        "reply_count": 0,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 5,
        "reads": 31,
        "readers_count": 30,
        "score": 31.2,
        "yours": false,
        "topic_id": 3665,
        "topic_slug": "excluding-non-storage-processes-on-fdb-7-1-23",
        "display_username": "Dan Meyers",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/wiki/Maintenance-mode",
            "internal": false,
            "reflection": false,
            "title": "Maintenance mode \u00b7 apple/foundationdb Wiki \u00b7 GitHub",
            "clicks": 2
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 849,
          "username": "johscheuer",
          "name": "Johannes Scheuermann",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/j/f475e1/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1142,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/excluding-non-storage-processes-on-fdb-7-1-23/3665/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12037,
        "name": "Dan Meyers",
        "username": "danm",
        "avatar_template": "/user_avatar/forums.foundationdb.org/danm/{size}/1393_2.png",
        "created_at": "2022-11-21T12:27:46.098Z",
        "cooked": "<p>Ok, that last message sat unsent for a while when we did some debugging in our own codebase for other things, but we\u2019ve doen some more digging.</p>\n<p>My colleague tried excluding the nodes directly, via IP/port instead of a \u2018locality\u2019 statement, and the roles were immediately moved as you\u2019d expect, for both <code>log</code> and <code>stateless</code> class machines. But <code>status json</code> definitely listed them as excluded after our previous <code>exclude locality_machineid:XXXX</code> statements. Is there potentially some bug in the way localities are matched up to processes? But if so, why did it work fine for our <code>storage</code> processes\u2026</p>\n<p>This also does raise concerns over our plans to define a new locality that would allow us to exclude an entire \u2018generation\u2019 (we\u2019ve taken FDB\u2019s nomenclature for roles/processes and extended it to our definition for the ASGs) of processes all at once, rather than having to look up the AWS instance ID (or IP/port). We know it wouldn\u2019t be paid attention to for data replication/duplication, which is fine/good, but (we thought) it would allow us to <code>exclude locality_classgeneration:log2</code> (for example). But if the base <code>machineid</code> has issues\u2026</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2022-11-21T12:30:40.364Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 26,
        "readers_count": 25,
        "score": 15.2,
        "yours": false,
        "topic_id": 3665,
        "topic_slug": "excluding-non-storage-processes-on-fdb-7-1-23",
        "display_username": "Dan Meyers",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1142,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/excluding-non-storage-processes-on-fdb-7-1-23/3665/4",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12038,
        "name": "Peter Wood",
        "username": "pwood",
        "avatar_template": "/user_avatar/forums.foundationdb.org/pwood/{size}/1653_2.png",
        "created_at": "2022-11-21T15:17:45.917Z",
        "cooked": "<p>(As said colleauge) we also noticed that exclusions with locality_* do not block until complete, unlike exclusions by HOST:PORT.</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2022-11-21T15:18:13.263Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 26,
        "readers_count": 25,
        "score": 10.2,
        "yours": false,
        "topic_id": 3665,
        "topic_slug": "excluding-non-storage-processes-on-fdb-7-1-23",
        "display_username": "Peter Wood",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1154,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/excluding-non-storage-processes-on-fdb-7-1-23/3665/5",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12040,
        "name": "Peter Wood",
        "username": "pwood",
        "avatar_template": "/user_avatar/forums.foundationdb.org/pwood/{size}/1653_2.png",
        "created_at": "2022-11-21T16:18:53.491Z",
        "cooked": "<p>As a follow up - we\u2019ve been able to replicate this with three nodes, no class set.</p>\n<p>If we exclude by locality_:* then we observe the behaviour where it\u2019s marked as excluded in <code>status json</code>, but it doesn\u2019t actually shift any roles. Where as if we exclude by the IP:PORT, it behaves as expected.</p>\n<p>I\u2019ve shoved up a gist with three status jsons if it\u2019s any help, happy to shift this to a Issue in GitHub if it\u2019s more useful.</p>\n<aside class=\"onebox githubgist\" data-onebox-src=\"https://gist.github.com/pwood/a5e4bb781e6fb168ccea35ae9492a4c7\">\n  <header class=\"source\">\n\n      <a href=\"https://gist.github.com/pwood/a5e4bb781e6fb168ccea35ae9492a4c7\" target=\"_blank\" rel=\"noopener nofollow ugc\">gist.github.com</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <h4><a href=\"https://gist.github.com/pwood/a5e4bb781e6fb168ccea35ae9492a4c7\" target=\"_blank\" rel=\"noopener nofollow ugc\">https://gist.github.com/pwood/a5e4bb781e6fb168ccea35ae9492a4c7</a></h4>\n\n  <h5>simple_cluster.json</h5>\n  <pre><code class=\"JSON\">{\n    \"client\" : {\n        \"cluster_file\" : {\n            \"path\" : \"/mnt/fdb/4500/fdb.cluster\",\n            \"up_to_date\" : true\n        },\n        \"coordinators\" : {\n            \"coordinators\" : [\n                {\n                    \"address\" : \"10.1.244.210:4500\",</code></pre>\n    This file has been truncated. <a href=\"https://gist.github.com/pwood/a5e4bb781e6fb168ccea35ae9492a4c7\" target=\"_blank\" rel=\"noopener nofollow ugc\">show original</a>\n  <h5>simple_cluster_exclude_by_ip.json</h5>\n  <pre><code class=\"JSON\">{\n    \"client\" : {\n        \"cluster_file\" : {\n            \"path\" : \"/mnt/fdb/4500/fdb.cluster\",\n            \"up_to_date\" : true\n        },\n        \"coordinators\" : {\n            \"coordinators\" : [\n                {\n                    \"address\" : \"10.1.244.210:4500\",</code></pre>\n    This file has been truncated. <a href=\"https://gist.github.com/pwood/a5e4bb781e6fb168ccea35ae9492a4c7\" target=\"_blank\" rel=\"noopener nofollow ugc\">show original</a>\n  <h5>simple_cluster_exclude_by_locality.json</h5>\n  <pre><code class=\"JSON\">{\n    \"client\" : {\n        \"cluster_file\" : {\n            \"path\" : \"/mnt/fdb/4500/fdb.cluster\",\n            \"up_to_date\" : true\n        },\n        \"coordinators\" : {\n            \"coordinators\" : [\n                {\n                    \"address\" : \"10.1.244.210:4500\",</code></pre>\n    This file has been truncated. <a href=\"https://gist.github.com/pwood/a5e4bb781e6fb168ccea35ae9492a4c7\" target=\"_blank\" rel=\"noopener nofollow ugc\">show original</a>\n\n<p>\n</p>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2022-11-21T16:18:53.491Z",
        "reply_count": 0,
        "reply_to_post_number": 5,
        "quote_count": 0,
        "incoming_link_count": 4,
        "reads": 26,
        "readers_count": 25,
        "score": 25.2,
        "yours": false,
        "topic_id": 3665,
        "topic_slug": "excluding-non-storage-processes-on-fdb-7-1-23",
        "display_username": "Peter Wood",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://gist.github.com/pwood/a5e4bb781e6fb168ccea35ae9492a4c7",
            "internal": false,
            "reflection": false,
            "title": "simple_cluster.json \u00b7 GitHub",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 1154,
          "username": "pwood",
          "name": "Peter Wood",
          "avatar_template": "/user_avatar/forums.foundationdb.org/pwood/{size}/1653_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1154,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/excluding-non-storage-processes-on-fdb-7-1-23/3665/6",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12046,
        "name": "Johannes Scheuermann",
        "username": "johscheuer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/j/f475e1/{size}.png",
        "created_at": "2022-11-22T09:04:19.787Z",
        "cooked": "<blockquote>\n<p>My colleague tried excluding the nodes directly, via IP/port instead of a \u2018locality\u2019 statement, and the roles were immediately moved as you\u2019d expect, for both <code>log</code> and <code>stateless</code> class machines. But <code>status json</code> definitely listed them as excluded after our previous <code>exclude locality_machineid:XXXX</code> statements. Is there potentially some bug in the way localities are matched up to processes? But if so, why did it work fine for our <code>storage</code> processes\u2026</p>\n</blockquote>\n<p>Using the locality might be the issue. Our current tests only use the IP:ports pairs to exclude machines. I will create a test case using localities to see if we observe the same behaviour. In general that sounds like a bug in the locality setup for exclusions.</p>\n<p>Thanks for reporting!</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 7,
        "updated_at": "2022-11-22T09:04:19.787Z",
        "reply_count": 0,
        "reply_to_post_number": 4,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 26,
        "readers_count": 25,
        "score": 20.2,
        "yours": false,
        "topic_id": 3665,
        "topic_slug": "excluding-non-storage-processes-on-fdb-7-1-23",
        "display_username": "Johannes Scheuermann",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "reply_to_user": {
          "id": 1142,
          "username": "danm",
          "name": "Dan Meyers",
          "avatar_template": "/user_avatar/forums.foundationdb.org/danm/{size}/1393_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 849,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/excluding-non-storage-processes-on-fdb-7-1-23/3665/7",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      12031,
      12035,
      12036,
      12037,
      12038,
      12040,
      12046
    ]
  },
  "timeline_lookup": [
    [
      1,
      1068
    ],
    [
      2,
      1066
    ],
    [
      3,
      1065
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Excluding non-storage processes (on FDB 7.1.23)",
  "id": 3665,
  "title": "Excluding non-storage processes (on FDB 7.1.23)",
  "posts_count": 7,
  "created_at": "2022-11-18T16:50:09.390Z",
  "views": 525,
  "reply_count": 3,
  "like_count": 0,
  "last_posted_at": "2022-11-22T09:04:19.787Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "excluding-non-storage-processes-on-fdb-7-1-23",
  "category_id": 7,
  "word_count": 2041,
  "deleted_at": null,
  "user_id": 1142,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_3665",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 7,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 3,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Any way to gracefully stop fdbserver process temporarily without affecting traffic?",
      "id": 1643,
      "title": "Any way to gracefully stop fdbserver process temporarily without affecting traffic?",
      "slug": "any-way-to-gracefully-stop-fdbserver-process-temporarily-without-affecting-traffic",
      "posts_count": 9,
      "reply_count": 6,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2019-09-23T15:19:26.449Z",
      "last_posted_at": "2019-12-09T21:45:34.279Z",
      "bumped": true,
      "bumped_at": "2019-12-09T21:45:34.279Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1561,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 642,
            "username": "arob",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/a/9fc29f/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 3,
            "username": "john_brownlee",
            "name": "John Brownlee",
            "avatar_template": "/user_avatar/forums.foundationdb.org/john_brownlee/{size}/22_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Permanently remove excluded IP addresses",
      "id": 1586,
      "title": "Permanently remove excluded IP addresses",
      "slug": "permanently-remove-excluded-ip-addresses",
      "posts_count": 6,
      "reply_count": 4,
      "highest_post_number": 6,
      "image_url": null,
      "created_at": "2019-08-16T23:12:27.226Z",
      "last_posted_at": "2019-08-20T01:06:57.823Z",
      "bumped": true,
      "bumped_at": "2019-08-20T01:06:57.823Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 632,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 311,
            "username": "ThomasJ",
            "name": "Thomas Johson",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 629,
            "username": "Sraw",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/s/a88e57/{size}.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Migrating from a large cluster to another",
      "id": 721,
      "title": "Migrating from a large cluster to another",
      "slug": "migrating-from-a-large-cluster-to-another",
      "posts_count": 15,
      "reply_count": 9,
      "highest_post_number": 15,
      "image_url": null,
      "created_at": "2018-09-21T15:41:31.742Z",
      "last_posted_at": "2018-11-06T16:15:24.202Z",
      "bumped": true,
      "bumped_at": "2018-11-06T16:15:24.202Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 2418,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 16,
            "username": "ashishnm",
            "name": "Ashish Motivala",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/a/b5e925/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 15,
            "username": "markus.pilman",
            "name": "Markus Pilman",
            "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 43,
            "username": "killertypo",
            "name": "Mike McMahon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/killertypo/{size}/35_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 311,
            "username": "ThomasJ",
            "name": "Thomas Johson",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Can I remove a process?",
      "id": 1428,
      "title": "Can I remove a process?",
      "slug": "can-i-remove-a-process",
      "posts_count": 9,
      "reply_count": 4,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2019-06-05T23:13:44.635Z",
      "last_posted_at": "2019-06-18T14:05:53.063Z",
      "bumped": true,
      "bumped_at": "2019-06-18T14:05:53.063Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 2178,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 594,
            "username": "zhuyi29",
            "name": "Zoe",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/z/edb3f5/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 337,
            "username": "mengxu",
            "name": "Meng Xu",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 511,
            "username": "sakthivelpvs",
            "name": "Sakthivel",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/s/9dc877/{size}.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "How are &lsquo;contributing_workers&rsquo; computed?",
      "id": 360,
      "title": "How are 'contributing_workers' computed?",
      "slug": "how-are-contributing-workers-computed",
      "posts_count": 20,
      "reply_count": 13,
      "highest_post_number": 20,
      "image_url": null,
      "created_at": "2018-05-07T00:53:18.538Z",
      "last_posted_at": "2018-05-12T07:19:34.562Z",
      "bumped": true,
      "bumped_at": "2018-05-12T07:19:34.562Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 6,
      "views": 1986,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 236,
            "username": "marctrem",
            "name": "Marc-Andr\u00e9 Tremblay",
            "avatar_template": "/user_avatar/forums.foundationdb.org/marctrem/{size}/208_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 54,
            "username": "Evan",
            "name": "Evan Tschannen",
            "avatar_template": "/user_avatar/forums.foundationdb.org/evan/{size}/104_2.png",
            "moderator": true,
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 156,
            "username": "spullara",
            "name": "Sam Pullara",
            "avatar_template": "/user_avatar/forums.foundationdb.org/spullara/{size}/125_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 247,
            "username": "Chr1st0ph",
            "name": "Chr1st0ph",
            "avatar_template": "/user_avatar/forums.foundationdb.org/chr1st0ph/{size}/353_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 118,
            "username": "abdullin",
            "name": "Rinat Abdullin",
            "avatar_template": "/user_avatar/forums.foundationdb.org/abdullin/{size}/83_2.png",
            "trust_level": 2
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 1142,
        "username": "danm",
        "name": "Dan Meyers",
        "avatar_template": "/user_avatar/forums.foundationdb.org/danm/{size}/1393_2.png",
        "post_count": 3,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 849,
        "username": "johscheuer",
        "name": "Johannes Scheuermann",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/j/f475e1/{size}.png",
        "post_count": 2,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 1154,
        "username": "pwood",
        "name": "Peter Wood",
        "avatar_template": "/user_avatar/forums.foundationdb.org/pwood/{size}/1653_2.png",
        "post_count": 2,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      }
    ],
    "created_by": {
      "id": 1142,
      "username": "danm",
      "name": "Dan Meyers",
      "avatar_template": "/user_avatar/forums.foundationdb.org/danm/{size}/1393_2.png"
    },
    "last_poster": {
      "id": 849,
      "username": "johscheuer",
      "name": "Johannes Scheuermann",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/j/f475e1/{size}.png"
    },
    "links": [
      {
        "url": "https://github.com/apple/foundationdb/wiki/Maintenance-mode",
        "title": "Maintenance mode \u00b7 apple/foundationdb Wiki \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 9,
        "user_id": 849,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/apple/foundationdb/issues/1292",
        "title": "New safety checks on exclusions that could take a database unavailable \u00b7 Issue #1292 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 5,
        "user_id": 849,
        "domain": "github.com",
        "root_domain": "github.com"
      }
    ]
  },
  "bookmarks": []
}