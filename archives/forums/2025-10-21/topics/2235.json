{
  "post_stream": {
    "posts": [
      {
        "id": 7553,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2020-07-08T20:05:13.613Z",
        "cooked": "<p>Hello all! I have a few questions for the community.</p>\n<p>First, when encountering compromised shard replication such as a state like</p>\n<pre><code class=\"lang-auto\">HEALING: Only one replica remains of some data\n</code></pre>\n<p>is it possible to determine the placement of the imperiled shard(s) to drive operational decision making? I understand that it\u2019s FoundationDB\u2019s job to manage data, but we\u2019ve got a staging cluster in this state that\u2019s absolutely refusing to move data / heal, and I\u2019d like to learn more about the replica distribution.</p>\n<p>Secondly, how intelligently are replicas chosen when dropping redundancy levels? We met this n=1 replica state after dropping from triple to double in an n=2 state, which was a surprise (there was plenty of other activity which may have impacted the observation). This leads me to have some concern for how replicas are chosen. Will FDB ensure that a replica is healthy/live before selecting it to \u201csurvive\u201d a redundancy drop?</p>\n<p>To get out of this stuck cluster\u2019s state I\u2019m thinking of either adding more storage processes or new machines with storage processes to allow healthy storage roles as healing targets. But we\u2019d also considered dropping to <code>single</code> mode to allow us to exclude problematic storage processes and then start bringing the redundancy back up / healing.</p>\n<p>Best,<br>\nKyle</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-08T20:05:13.613Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 117,
        "reads": 49,
        "readers_count": 48,
        "score": 594.8,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 7621,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2020-07-16T16:05:58.430Z",
        "cooked": "<p>Any thoughts?</p>\n<p>We\u2019ve expanded the staging cluster with three new storage processes in three new zones and are happy to see a bump up to an n=2 replica state. We plan on pursuing process excludes to encourage further healing, excluding processes with actors exhibiting huge data lag e.g. <code>2075604805895</code> aka just not functioning.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-16T16:05:58.430Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 42,
        "readers_count": 41,
        "score": 18.4,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7624,
        "name": "Meng Xu",
        "username": "mengxu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
        "created_at": "2020-07-17T03:33:22.961Z",
        "cooked": "<p>FDB\u2019s replication policy\u2019s high level idea is similar to the Copyset paper: <a href=\"https://www.usenix.org/conference/atc13/technical-sessions/presentation/cidon\" rel=\"noopener nofollow ugc\">https://www.usenix.org/conference/atc13/technical-sessions/presentation/cidon</a><br>\nThe actual implementation is more sophisticated than the paper.</p>\n<p>By default, we choose a selective set of k replicas groups (we call it server team) that have different zoneIds.</p>\n<p>I actually don\u2019t understand the question below. Would you mind elaborating a bit, like giving a scenario?</p>\n<blockquote>\n<p>Secondly, how intelligently are replicas chosen when dropping redundancy levels?</p>\n</blockquote>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-17T03:33:22.961Z",
        "reply_count": 1,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 43,
        "readers_count": 42,
        "score": 18.6,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Meng Xu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://www.usenix.org/conference/atc13/technical-sessions/presentation/cidon",
            "internal": false,
            "reflection": false,
            "title": "Copysets: Reducing the Frequency of Data Loss in Cloud Storage | USENIX",
            "clicks": 10
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 484,
          "username": "ksnavely",
          "name": "Kyle Snavely",
          "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 337,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7630,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2020-07-20T20:15:57.902Z",
        "cooked": "<p>Hello <a class=\"mention\" href=\"/u/mengxu\">@mengxu</a>!</p>\n<p>Yes, allow me give an update and to elaborate on lowering the redundancy level.</p>\n<h4><a name=\"redundancy-level-question-1\" class=\"anchor\" href=\"#redundancy-level-question-1\"></a>Redundancy level question</h4>\n<p>During the operational troubleshooting for this cluster, at one point the cluster was in <code>triple</code> redundancy mode, but reporting \u201cOnly two replicas remain of some data.\u201d</p>\n<p>At this point, one of our operators lowered the cluster\u2019s redundancy level to <code>double</code>, expecting FoundationDB to choose the two live replicas, and basically wind up in a \u201cnormal\u201d <code>double</code> redundancy situation.</p>\n<p>Instead we found FoundationDB reporting \u201cOnly one replica remains of some data.\u201d! So my question is: how intelligent is FoundationDB in choosing which replicas \u201csurvive\u201d a lowering of redundancy modes, e.g. <code>triple</code> \u2192 <code>double</code>.</p>\n<h4><a name=\"current-update-2\" class=\"anchor\" href=\"#current-update-2\"></a>Current Update</h4>\n<p>At this point, a few days later in troubleshooting, I can tell there is some serious issue trying to heal this data set. This may have been part of the problem leading to the situation I described above.</p>\n<p>We expanded the cluster with three new machines/zones as I mentioned and found it did bring us back to an n=2 replicas state. However some of the storage processes are just very clearly unhealthy. Here is an example data lag \u2013 just extracted from status json.</p>\n<pre><code class=\"lang-auto\">role     actor_id          process_address          process_id                        durable_version  data_lag\nstorage  2ac9f1823a4d5f67  10.95.111.214:4504:tls   d0b26295ff5c6fc497e0a7d514794cf3  None             None                                                                                                                                                                           \nstorage  6f04ac5764ebccd4  10.95.111.214:4503:tls   0f44b61c2c7ab209eab5ffa04d7906ea  None             None                                                                                                                                                                           \nstorage  721e454b96e75d0c  10.95.111.214:4505:tls   b7615bd9bc0e1c4bc796636626e1a539  None             None                                                                                                                                                                           \nstorage  8b52db5932066c2d  10.185.175.43:4504:tls   e2632a0f8c0a76bfad6a660fc9284693  8889482016494    2164815125363                                                                                                                                                                  \nstorage  b873c12c848af3f1  10.185.175.43:4505:tls   2587c383a9044b046790f372fc3e83c3  8889482016494    2164815125363                                                                                                                                                                  \nstorage  d487eab27f823aa3  10.185.175.43:4503:tls   89317bb27bf21eb2be6e6c3de371d5ff  8889482016494    2164815125363                                                                                                                                                                  \nstorage  a78d2fc8068c6bc8  10.220.237.150:4504:tls  75262da7e16ad452fa18f654e9deca0c  8889041958540    2165150183317                                                                                                                                                                  \nstorage  db7c8c1449e77cb4  10.185.115.215:4503:tls  92907d8b67f512ef0f289da88e3761ec  8889041958540    2165150183317                                                                                                                                                                  \nstorage  c47540138fb4f3e4  10.95.111.214:4505:tls   b7615bd9bc0e1c4bc796636626e1a539  11054299296554   0                                                                                                                                                                              \nstorage  d14f692f7e8cb4bb  10.95.111.219:4503:tls   c68295ef3a1f825b5c6dd6f5c488b1aa  11054297141857   0                                                                                                                                                                              \nstorage  159a3452afb39ba4  10.95.111.219:4504:tls   13fd0ef40e1ea16876f9d6034d0416e1  11054295420150   1656540                                                                                                                                                                        \nstorage  1c84cbe629e664da  10.221.166.13:4505:tls   d50db70f76c64da3b46d67031b4b7b3f  11054295420150   1656540                                                                                                                                                                        \nstorage  1cf91d84d0405637  10.221.166.13:4503:tls   8c039c3fa145652c939b9e76a29d9105  11054295420150   1656540                                                                                                                                                                        \nstorage  37cbbce93187ccf1  10.208.190.181:4505:tls  66b70754318016036b391bcc8daeefca  11054295420150   1656540                                                                                                                                                                        \nstorage  6e2d6a04fe7fcdcf  10.185.175.43:4505:tls   2587c383a9044b046790f372fc3e83c3  11054295420150   1656540                                                                                                                                                                        \nstorage  71be057fa064dfa0  10.185.115.215:4505:tls  e62d4245342bbfe886acb1d61b0d7a42  11054295420150   1656540                                                                                                                                                                        \nstorage  7c3f5de634d89332  10.208.190.181:4504:tls  355fc729e9a1104be046cf9c11c71510  11054295420150   1656540                                                                                                                                                                        \nstorage  86f067a7b14892a6  10.220.237.150:4505:tls  d4b5f11f0832b88def06c3dffabcf5b7  11054295420150   1656540                                                                                                                                                                        \nstorage  a614df1c88908d1e  10.220.237.150:4505:tls  d4b5f11f0832b88def06c3dffabcf5b7  11054295420150   1656540                                                                                                                                                                        \nstorage  d090dee9dc188f6c  10.95.111.219:4505:tls   8608598d11e6c794191731ab4308e550  11054295420150   1656540                                                                                                                                                                        \nstorage  d207c53565bad221  10.208.190.181:4503:tls  99c95c04859c90dbc692228ae1ce2be7  11054295420150   1656540                                                                                                                                                                        \nstorage  f9f479eddee32ff3  10.221.166.13:4504:tls   9bed6336457eb511f5d3d090a53440c3  11054295420150   1656540                                                                                                                                                                        \nstorage  09a972450d63c006  10.185.175.85:4503:tls   52238f1eba411da9833f75ecd5868bd2  11054297141857   1721707                                                                                                                                                                        \nstorage  0a7c5e51d14f6223  10.220.237.150:4503:tls  fd75186a0c9989f34ec503bce4615a0e  11054297141857   1721707                                                                                                                                                                        \nstorage  1053cd090ac8a252  10.220.237.150:4504:tls  75262da7e16ad452fa18f654e9deca0c  11054297141857   1721707                                                                                                                                                                        \nstorage  10acef9c859fc163  10.185.175.85:4504:tls   25fabd28ce65f76a15cfbd20badc9592  11054297141857   1721707                                                                                                                                                                        \nstorage  5d9ae63025eb37b0  10.95.111.214:4504:tls   d0b26295ff5c6fc497e0a7d514794cf3  11054297141857   1721707                                                                                                                                                                        \nstorage  73a6404856fb4c13  10.95.111.214:4503:tls   0f44b61c2c7ab209eab5ffa04d7906ea  11054297141857   1721707                                                                                                                                                                        \nstorage  e6a418c607217be0  10.185.115.215:4504:tls  7fdb2d6ba9e1a72457ccfdbc5d81e65c  11054297141857   1721707                                                                                                                                                                        \nstorage  f4d63771128ea9af  10.185.175.85:4505:tls   b022af6271b7ab4fbe0e0fea69cd6286  11054297141857   1721707                                                                                                                                                                        \nstorage  2217d81e47c74b1a  10.185.175.43:4503:tls   89317bb27bf21eb2be6e6c3de371d5ff  11054293763610   2036983                                                                                                                                                                        \nstorage  2f0e9b7a6922fc2f  10.185.175.43:4504:tls   e2632a0f8c0a76bfad6a660fc9284693  11054293763610   2036983                                                                                                                                                                        \n</code></pre>\n<p>Now, we\u2019ve tried to exclude these large data lag processes in the past. However data never moves off of them. I tried something more brutal \u2013 I brought down FoundationDB on the <code>10.185.175.43</code> machine/zone entirely in the hopes of seeing data redistribution. I saw the moving data value float up and down a few megabytes and then just flatline again.</p>\n<p>I was able to line up logs with this action and notice a few standout warnings. I\u2019ve reproduced them below with some minor sanitization.</p>\n<hr>\n<p>We saw a steady rate of these which lines up with the lack of actual data movement.</p>\n<blockquote>\n<p>Jul 20 11:20:20 fdb8 trace.10.208.190.181.4505.1594654180.VmrXDJ.1.82.json {  \u201cSeverity\u201d: \u201c30\u201d, \u201cTime\u201d: \u201c1595265619.425258\u201d, \u201cType\u201d: \u201cFetchKeysTooLong\u201d, \u201cID\u201d: \u201c0000000000000000\u201d, \u201cDuration\u201d: \u201c611400\u201d, \u201cPhase\u201d: \u201c0\u201d, \u201cBegin\u201d: \u201c\\x15\\x1c\\x15\\x0f\\x01\\x16\\x12\\xb8\\x00\\x15\\x14\u2026\u201d, \u201cEnd\u201d: \u201c\\x15\\x1c\\x15\\x0f\\x01\\x16\\x12\\xc9\\x00\\x15\\x15\\\u2026\u201d, \u201cMachine\u201d: \u201c10.208.190.181:4505\u201d, \u201cLogGroup\u201d: \u201cdefault\u201d, \u201cRoles\u201d: \u201cSS\u201d }</p>\n</blockquote>\n<p>Then I downed FoundationDB on the previously mentioned machine, saw these which is expected. We also dropped from n=2 replicas to n=1 replicas as we expected possible.</p>\n<blockquote>\n<p>Jul 20 11:21:28 fdb4 trace.10.95.111.214.4503.1593164519.NZ7sl7.2.281.json {  \u201cSeverity\u201d: \u201c30\u201d, \u201cTime\u201d: \u201c1595265688.623143\u201d, \u201cType\u201d: \u201cTooManyConnectionsClosed\u201d, \u201cID\u201d: \u201c0000000000000000\u201d, \u201cSuppressedEventCount\u201d: \u201c19\u201d, \u201cPeerAddr\u201d: \u201c10.185.175.43:4502:tls\u201d, \u201cMachine\u201d: \u201c10.95.111.214:4503\u201d, \u201cLogGroup\u201d: \u201cdefault\u201d, \u201cRoles\u201d: \u201cSS\u201d }</p>\n</blockquote>\n<p>Finally we see the cluster trying to handle data movement? Very confusingly I can\u2019t find any of these source/destination (storage process?) ids in the status JSON.</p>\n<blockquote>\n<p>Jul 20 11:21:35 fdb7 trace.10.185.175.85.4501.1594654180.i2uZdD.2.339.json {  \u201cSeverity\u201d: \u201c30\u201d, \u201cTime\u201d: \u201c1595265694.457242\u201d, \u201cType\u201d: \u201cRelocateShardTooLong\u201d, \u201cID\u201d: \u201c0000000000000000\u201d, \u201cError\u201d: \u201coperation_cancelled\u201d, \u201cErrorDescription\u201d: \u201cAsynchronous operation cancelled\u201d, \u201cErrorCode\u201d: \u201c1101\u201d, \u201cDuration\u201d: \u201c611298\u201d, \u201cDest\u201d: \u201c0a7c5e51d14f6223d201b73c5ec0b4a2,1c84cbe629e664da7e217a4513f35b14,7c3f5de634d893329e38da967a22e63e\u201d, \u201cSrc\u201d: \u201c0a7c5e51d14f6223d201b73c5ec0b4a2,e6a418c607217be0522f0b5b96d02396\u201d, \u201cMachine\u201d: \u201c10.185.175.85:4501\u201d, \u201cLogGroup\u201d: \u201cdefault\u201d, \u201cRoles\u201d: \u201cDD,MP\u201d }</p>\n</blockquote>\n<p>More data movement woes:</p>\n<blockquote>\n<p>Jul 20 13:50:14 fdb5 trace.10.185.115.215.4500.1593170776.4NB1xR.2.467.json {  \u201cSeverity\u201d: \u201c30\u201d, \u201cTime\u201d: \u201c1595274613.655347\u201d, \u201cType\u201d: \u201cFinishMoveKeysTooLong\u201d, \u201cID\u201d: \u201c0000000000000000\u201d, \u201cDuration\u201d: \u201c8400\u201d, \u201cServers\u201d: \u201c09a972450d63c0069b109876b29ab61d,1cf91d84d04056372cf765ee452ed15e,d207c53565bad2213792a5d0f6255f16\u201d, \u201cMachine\u201d: \u201c10.185.115.215:4500\u201d, \u201cLogGroup\u201d: \u201cdefault\u201d, \u201cRoles\u201d: \u201cCD,DD,MS,RK\u201d }</p>\n</blockquote>\n<p>I can\u2019t even find these ids in the status json \u2013 related?</p>\n<blockquote>\n<p>kyle@fdb1:~$ fdbcli --exec \u2018status json\u2019 | grep -e 09a972450d63c0069b109876b29ab61d -e 1cf91d84d04056372cf765ee452ed15e -e d207c53565bad2213792a5d0f6255f16<br>\nkyle@fdb1:~$</p>\n</blockquote>\n<p>Those and <code>FetchKeysTooLong</code> are now the primary &gt;20 sev logs I see at this point.</p>\n<p>I do see the occasional</p>\n<blockquote>\n<p>Jul 20 14:00:38 fdb5 trace.10.185.115.215.4500.1593170776.4NB1xR.2.468.json {  \u201cSeverity\u201d: \u201c30\u201d, \u201cTime\u201d: \u201c1595275238.168315\u201d, \u201cType\u201d: \u201cTraceEventThrottle_BgDDMountainChopper\u201d, \u201cID\u201d: \u201c0000000000000000\u201d, \u201cSuppressedEventCount\u201d: \u201c47\u201d, \u201cMachine\u201d: \u201c10.185.115.215:4500\u201d, \u201cLogGroup\u201d: \u201cdefault\u201d, \u201cRoles\u201d: \u201cCD,DD,MS,RK\u201d }</p>\n</blockquote>\n<p>But moving data has been fairly static for hours \u2013 sometimes increasing. You can see the moving data is now greater in size than the entire logical data set.</p>\n<pre><code class=\"lang-auto\">Data:\n  Replication health     - HEALING: Only one replica remains of some data\n  Moving data            - 21.887 GB\n  Sum of key-value sizes - 20.820 GB\n  Disk space used        - 61.606 GB\n\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://global.discourse-cdn.com/foundationdb/original/1X/be5311997d2c1d5e6cc0fd09d11fc5ef3c66fb62.png\" data-download-href=\"/uploads/short-url/r9GGZgzc3haHEbd9gyd6T5XSh46.png?dl=1\" title=\"moving_data\" rel=\"noopener nofollow ugc\"><img src=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/be5311997d2c1d5e6cc0fd09d11fc5ef3c66fb62_2_690x221.png\" alt=\"moving_data\" data-base62-sha1=\"r9GGZgzc3haHEbd9gyd6T5XSh46\" width=\"690\" height=\"221\" srcset=\"https://global.discourse-cdn.com/foundationdb/optimized/1X/be5311997d2c1d5e6cc0fd09d11fc5ef3c66fb62_2_690x221.png, https://global.discourse-cdn.com/foundationdb/optimized/1X/be5311997d2c1d5e6cc0fd09d11fc5ef3c66fb62_2_1035x331.png 1.5x, https://global.discourse-cdn.com/foundationdb/optimized/1X/be5311997d2c1d5e6cc0fd09d11fc5ef3c66fb62_2_1380x442.png 2x\" data-dominant-color=\"FBFBFB\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">moving_data</span><span class=\"informations\">1501\u00d7482 29.2 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>6/23 is incident start.</p>\n<p>Finally, the cluster is under almost no load.</p>\n<pre><code class=\"lang-auto\">ip                port    cpu%  mem%  iops  net  class          roles                                                                                                                                                                                                                 \n----------------  ------  ----  ----  ----  ---  -------------  ------------------------------------------------                                                                                                                                                                      \n 10.185.115.215    4500    6     5     -     6    stateless      coordinator,data_distributor,master,ratekeeper                                                                                                                                                                       \n                   4501    3     4     -     4    stateless      cluster_controller                                                                                                                                                                                                   \n                   4502    1     7     4     0    transaction    log                                                                                                                                                                                                                  \n                   4503    2     52    7     1    storage        storage                                                                                                                                                                                                              \n                   4504    1     19    9     0    storage        storage                                                                                                                                                                                                              \n                   4505    1     18    7     0    storage        storage                                                                                                                                                                                                              \n----------------  ------  ----  ----  ----  ---  -------------  ------------------------------------------------                                                                                                                                                                      \n 10.185.175.85     4500    1     3     -     0    stateless      resolver                                                                                                                                                                                                             \n                   4501    4     4     -     8    stateless      proxy                                                                                                                                                                                                                \n                   4502    1     2     7     0    transaction    log                                                                                                                                                                                                                  \n                   4503    1     12    11    0    storage        storage                                                                                                                                                                                                              \n                   4504    1     15    11    0    storage        storage                                                                                                                                                                                                              \n                   4505    1     10    11    0    storage        storage                                                                                                                                                                                                              \n----------------  ------  ----  ----  ----  ---  -------------  ------------------------------------------------                                                                                                                                                                      \n 10.208.190.181    4500    0     2     -     0    stateless                                                                                                                                                                                                                           \n                   4501    0     4     -     0    stateless                                                                                                                                                                                                                           \n                   4502    1     3     7     0    transaction    log                                                                                                                                                                                                                  \n                   4503    1     5     11    1    storage        storage                                                                                                                                                                                                              \n                   4504    1     14    11    0    storage        storage                                                                                                                                                                                                              \n                   4505    1     5     11    0    storage        storage                                                                                                                                                                                                              \n----------------  ------  ----  ----  ----  ---  -------------  ------------------------------------------------                                                                                                                                                                      \n 10.220.237.150    4500    2     4     -     1    stateless      coordinator                                                                                                                                                                                                          \n                   4501    0     4     -     0    stateless                                                                                                                                                                                                                           \n                   4502    2     5     6     0    transaction    log                                                                                                                                                                                                                  \n                   4503    1     15    18    0    storage        storage                                                                                                                                                                                                              \n                   4504    2     35    13    1    storage        storage,storage                                                                                                                                                                                                      \n                   4505    1     14    11    0    storage        storage,storage                                                                                                                                                                                                      \n----------------  ------  ----  ----  ----  ---  -------------  ------------------------------------------------                                                                                                                                                                      \n 10.221.166.13     4500    0     3     -     0    stateless                                                                                                                                                                                                                           \n                   4501    0     4     -     0    stateless                                                                                                                                                                                                                           \n                   4502    1     2     -     0    transaction                                                                                                                                                                                                                         \n                   4503    1     9     10    0    storage        storage                                                                                                                                                                                                              \n                   4504    1     13    10    0    storage        storage                                                                                                                                                                                                              \n                   4505    1     7     10    0    storage        storage                                                                                                                                                                                                              \n----------------  ------  ----  ----  ----  ---  -------------  ------------------------------------------------                                                                                                                                                                      \n 10.95.111.214     4500    1     4     -     0    stateless      coordinator                                                                                                                                                                                                          \n                   4501    0     4     -     0    stateless                                                                                                                                                                                                                           \n                   4502    1     5     4     0    transaction    log                                                                                                                                                                                                                  \n                   4503    1     8     13    0    storage        storage,storage                                                                                                                                                                                                      \n                   4504    1     9     13    0    storage        storage,storage                                                                                                                                                                                                      \n                   4505    1     7     10    0    storage        storage,storage                                                                                                                                                                                                      \n----------------  ------  ----  ----  ----  ---  -------------  ------------------------------------------------                                                                                                                                                                      \n 10.95.111.219     4500    0     4     -     0    stateless                                                                                                                                                                                                                           \n                   4501    0     4     -     0    stateless                                                                                                                                                                                                                           \n                   4502    1     5     -     0    transaction                                                                                                                                                                                                                         \n                   4503    1     19    12    1    storage        storage                                                                                                                                                                                                              \n                   4504    1     21    12    0    storage        storage                                                                                                                                                                                                              \n                   4505    1     15    12    0    storage        storage   \n</code></pre>\n<hr>\n<p>Frankly we\u2019re all a bit frustrated as obviously something is preventing FoundationDB from doing one of it\u2019s best things \u2013 managing the data!</p>\n<p>At this point I\u2019m wondering if it\u2019s actually an issue <em>reading</em> off these problematic shards given we have stood up many new storage processes in new zones that would be suitable healing targets.</p>\n<p>I\u2019ll end with re-asking a question from earlier \u2013 is it possible to tell which actors/processes are holding the n=2, n=1 etc. shards? This might help drive operational decision making.</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-20T20:29:38.319Z",
        "reply_count": 2,
        "reply_to_post_number": 3,
        "quote_count": 0,
        "incoming_link_count": 6,
        "reads": 39,
        "readers_count": 38,
        "score": 47.8,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://global.discourse-cdn.com/foundationdb/original/1X/be5311997d2c1d5e6cc0fd09d11fc5ef3c66fb62.png",
            "internal": false,
            "reflection": false,
            "title": "be5311997d2c1d5e6cc0fd09d11fc5ef3c66fb62.png",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 337,
          "username": "mengxu",
          "name": "Meng Xu",
          "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/4",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7631,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2020-07-20T20:20:35.826Z",
        "cooked": "<p>I\u2019ll also recap what put us into this state \u2013 a series of too fast machine reboots which seems to have too brutally bounced FoundationDB when combined with an accidental mis-targeting of the <code>maintenance</code> command (invalid zones specified). So likely some data movement triggering during a rolling reboot across the cluster where I imagine the reboot process was something like 30s a machine.</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-20T20:20:35.826Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 27,
        "readers_count": 26,
        "score": 5.4,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/5",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7632,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2020-07-20T20:27:56.538Z",
        "cooked": "<p>Ah finally, I forgot to mention, I\u2019ve now excluded all processes with exorbitant data lag.</p>\n<pre><code class=\"lang-auto\">fdb&gt; exclude\nThere are currently 3 servers or processes being excluded from the database:\n  10.185.115.215:4503\n  10.185.175.43    # We know this is the entire machine\n  10.220.237.150:4504\n</code></pre>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-20T20:27:56.538Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 28,
        "readers_count": 27,
        "score": 5.6,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/6",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7633,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2020-07-20T21:04:17.482Z",
        "cooked": "<p>I have confirmed that all mounted storage devices across the cluster are in <code>rw</code> mode and that no SSD reports being in read-only mode.</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-20T21:04:35.202Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 33,
        "readers_count": 32,
        "score": 6.6,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/7",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7634,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2020-07-20T21:17:36.428Z",
        "cooked": "<p>Mmm perhaps this is interesting. Some of the storage actor\u2019s sqlite files have been touched in weeks.</p>\n<pre><code class=\"lang-auto\">kyle@fdb2:~$ du -h --time /srv/sdc/foundationdb/*/*\n4.0K    2020-03-16 10:55        /srv/sdc/foundationdb/4503/processId\n301M    2020-07-20 17:21        /srv/sdc/foundationdb/4503/storage-2217d81e47c74b1a3a7041b1a95332b2.sqlite\n21M     2020-07-20 17:21        /srv/sdc/foundationdb/4503/storage-2217d81e47c74b1a3a7041b1a95332b2.sqlite-wal\n6.0G    2020-06-26 11:28        /srv/sdc/foundationdb/4503/storage-d487eab27f823aa3183ed5634979408c.sqlite\n48M     2020-06-22 16:16        /srv/sdc/foundationdb/4503/storage-d487eab27f823aa3183ed5634979408c.sqlite-wal\n4.0K    2020-07-08 03:47        /srv/sdc/foundationdb/4504/fitness\n4.0K    2020-03-05 10:21        /srv/sdc/foundationdb/4504/processId\n3.9G    2020-07-20 17:21        /srv/sdc/foundationdb/4504/storage-2f0e9b7a6922fc2f348a9bec52c02383.sqlite\n52M     2020-07-20 17:21        /srv/sdc/foundationdb/4504/storage-2f0e9b7a6922fc2f348a9bec52c02383.sqlite-wal\n5.8G    2020-06-26 11:28        /srv/sdc/foundationdb/4504/storage-8b52db5932066c2d2c79e5e1ee1cbc61.sqlite\n48M     2020-06-22 16:16        /srv/sdc/foundationdb/4504/storage-8b52db5932066c2d2c79e5e1ee1cbc61.sqlite-wal\n4.0K    2020-07-20 16:43        /srv/sdc/foundationdb/4505/fitness\n4.0K    2020-03-16 10:55        /srv/sdc/foundationdb/4505/processId\n301M    2020-07-20 17:21        /srv/sdc/foundationdb/4505/storage-6e2d6a04fe7fcdcfed5fb870ea245162.sqlite\n32M     2020-07-20 17:21        /srv/sdc/foundationdb/4505/storage-6e2d6a04fe7fcdcfed5fb870ea245162.sqlite-wal\n6.1G    2020-06-26 11:28        /srv/sdc/foundationdb/4505/storage-b873c12c848af3f1c199091c8e2c49c7.sqlite\n48M     2020-06-22 16:16        /srv/sdc/foundationdb/4505/storage-b873c12c848af3f1c199091c8e2c49c7.sqlite-wal\n</code></pre>\n<p>On this machine in particular several actors were reported with massive data lag.</p>\n<pre><code class=\"lang-auto\">role     actor_id          process_address          process_id                        durable_version  data_lag\nstorage  8b52db5932066c2d  10.185.175.43:4504:tls   e2632a0f8c0a76bfad6a660fc9284693  8889482016494    2164815125363                                                                                                                                                                  \nstorage  b873c12c848af3f1  10.185.175.43:4505:tls   2587c383a9044b046790f372fc3e83c3  8889482016494    2164815125363                                                                                                                                                                  \nstorage  d487eab27f823aa3  10.185.175.43:4503:tls   89317bb27bf21eb2be6e6c3de371d5ff  8889482016494    2164815125363\n</code></pre>\n<p>I\u2019m not sure \u2013 perhaps this is expected if the storage actors are not accepting updates from the tlogs, or perhaps it might help if we\u2019d expect these files to be bumped. Permissions look fine.</p>\n<hr>\n<p>I really want to resist the temptation to hand-wave, but I will in case it spurs thoughts in more knowledgable folks. Is it possible that during the incident-start reboots data-distribution created shards which were then \u201chalf-orphaned\u201d during the incident unfolding?</p>\n<p>Enough that FDB detects e.g. \u201cOnly one replica remaining of some data\u2026\u201d though the shards are not actually usable?</p>\n<p>I see logs such as the following associated with these storage actors:</p>\n<pre><code class=\"lang-auto\">... lots of SlowSSLoopx10; again there's no load on the cluster/disks\nJul 20 11:19:25 fdb2 trace.10.185.175.43.4503.1593170931.2mlq6Z.2.320.json {  \"Severity\": \"20\", \"Time\": \"1595265564.490685\", \"Type\": \"SlowSSLoopx100\", \"ID\": \"d487eab27f823aa3\", \"Elapsed\": \"0.069077\", \"Machine\": \"10.185.175.43:4503\", \"LogGroup\": \"default\", \"Roles\": \"SS\" }\nJul 20 11:21:35 fdb5 trace.10.185.115.215.4500.1593170776.4NB1xR.2.459.json {  \"Severity\": \"20\", \"Time\": \"1595265694.556601\", \"Type\": \"UndesiredStorageServer\", \"ID\": \"3a854a4963363f69\", \"Server\": \"2217d81e47c74b1a\", \"Address\": \"10.185.175.43:4503:tls\", \"OtherServer\": \"d487eab27f823aa3\", \"NumShards\": \"15\", \"OtherNumShards\": \"238\", \"Machine\": \"10.185.115.215:4500\", \"LogGroup\": \"default\", \"Roles\": \"CD,DD,MS,RK\" }\nJul 20 13:18:17 fdb5 trace.10.185.115.215.4500.1593170776.4NB1xR.2.465.json {  \"Severity\": \"20\", \"Time\": \"1595272696.583177\", \"Type\": \"UndesiredStorageServer\", \"ID\": \"3a854a4963363f69\", \"Server\": \"d487eab27f823aa3\", \"Excluded\": \"10.185.175.43\", \"Machine\": \"10.185.115.215:4500\", \"LogGroup\": \"default\", \"Roles\": \"CD,DD,MS,RK\" }\nJul 20 13:18:17 fdb5 trace.10.185.115.215.4500.1593170776.4NB1xR.2.465.json {  \"Severity\": \"20\", \"Time\": \"1595272696.583177\", \"Type\": \"UndesiredStorageServer\", \"ID\": \"3a854a4963363f69\", \"Server\": \"d487eab27f823aa3\", \"Excluded\": \"10.185.175.43\", \"Machine\": \"10.185.115.215:4500\", \"LogGroup\": \"default\", \"Roles\": \"CD,DD,MS,RK\" }\n</code></pre>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-20T21:22:59.757Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 6,
        "reads": 33,
        "readers_count": 32,
        "score": 41.6,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/8",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7635,
        "name": "Meng Xu",
        "username": "mengxu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
        "created_at": "2020-07-20T21:28:48.172Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ksnavely\" data-post=\"4\" data-topic=\"2235\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ksnavely/48/483_2.png\" class=\"avatar\"> ksnavely:</div>\n<blockquote>\n<p>I\u2019ll end with re-asking a question from earlier \u2013 is it possible to tell which actors/processes are holding the n=2, n=1 etc. shards? This might help drive operational decision making.</p>\n</blockquote>\n</aside>\n<p>Yes, the special key space: <code>const KeyRangeRef keyServersKeys( LiteralStringRef(\"\\xff/keyServers/\"), LiteralStringRef(\"\\xff/keyServers0\") );</code> has the key-to-server mapping. If you saw a shard is mapped to more than <code>k</code> server, that\u2019s because the shard is the in process of moving from one server team to another.</p>\n<p>You can read this key space and decode it like this <a href=\"https://github.com/xumengpanda/foundationdb/blob/ba54508c477dc90db1d261ca481663eea0a6220c/fdbclient/SystemData.cpp#L51-L59\" rel=\"noopener nofollow ugc\">https://github.com/xumengpanda/foundationdb/blob/ba54508c477dc90db1d261ca481663eea0a6220c/fdbclient/SystemData.cpp#L51-L59</a></p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-20T21:28:48.172Z",
        "reply_count": 0,
        "reply_to_post_number": 4,
        "quote_count": 1,
        "incoming_link_count": 2,
        "reads": 29,
        "readers_count": 28,
        "score": 15.8,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Meng Xu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/xumengpanda/foundationdb/blob/ba54508c477dc90db1d261ca481663eea0a6220c/fdbclient/SystemData.cpp#L51-L59",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/SystemData.cpp at ba54508c477dc90db1d261ca481663eea0a6220c \u00b7 xumengpanda/foundationdb \u00b7 GitHub",
            "clicks": 11
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 337,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/9",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7636,
        "name": "Meng Xu",
        "username": "mengxu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
        "created_at": "2020-07-20T21:34:37.792Z",
        "cooked": "<aside class=\"quote no-group quote-modified\" data-username=\"ksnavely\" data-post=\"4\" data-topic=\"2235\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ksnavely/48/483_2.png\" class=\"avatar\"> ksnavely:</div>\n<blockquote>\n<p>Instead we found FoundationDB reporting \u201cOnly one replica remains of some data.\u201d! So my question is: how intelligent is FoundationDB in choosing which replicas \u201csurvive\u201d a lowering of redundancy modes, e.g. <code>triple</code> \u2192 <code>double</code> .</p>\n</blockquote>\n</aside>\n<p>FDB should be wise enough to handle this situation. We do tested it in simulation and real world before.</p>\n<p>I\u2019m suspicious on the locality configuration of the SSes. If one zone has too few processes, those processes may be grouped with too many other processes and have their disks almost filled out. When FDB DD detects this, it will stops rebalancing data.</p>\n<p>Do you have a list of the zoneId and processId of each SSes in the cluster?<br>\nEspecially, I\u2019m looking at how many zoneIds are in the cluster, and how many processIds are in each zoneID. (assuming each SS uses the same disk size.)</p>",
        "post_number": 10,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-20T21:34:37.792Z",
        "reply_count": 0,
        "reply_to_post_number": 4,
        "quote_count": 1,
        "incoming_link_count": 1,
        "reads": 28,
        "readers_count": 27,
        "score": 10.6,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Meng Xu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 337,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/10",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7637,
        "name": "Meng Xu",
        "username": "mengxu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
        "created_at": "2020-07-20T21:36:41.413Z",
        "cooked": "<p>Another trace event that is interesting is <code>TeamCollectionInfo</code>. Could you also paste that?</p>",
        "post_number": 11,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-20T21:36:41.413Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 28,
        "readers_count": 27,
        "score": 10.6,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Meng Xu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 337,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/11",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7638,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2020-07-20T21:47:59.769Z",
        "cooked": "<p>We run three storage process per zone (one storage disk, three processes per disk). We do not specify the zone ids so they are randomly generated and boil down to a zone per machine. All machines/zones have three storage processes. There now 8 zones/machines and 24 total storage processes.</p>\n<p>TeamCollectionInfo examples: <a href=\"https://gist.github.com/ksnavely/bb334f04e91939c102758b11366793db\" rel=\"nofollow noopener\">https://gist.github.com/ksnavely/bb334f04e91939c102758b11366793db</a></p>\n<p>We are aware that it\u2019s better to specify the zone ids explicitly for failure planning. We run three data hall mode in most other clusters using datacenters for halls so it\u2019s not as big a concern for us there compared to getting the halls right.</p>\n<p>Note the storage disks are not even close to full, they are ~3.5TB disks. All machines are identical chassis, RAM, disk sizes/models, NICs, at this time.</p>\n<p>I will mention for context at this point I still have one machine\u2019s FDB service purposefully down, that machine is excluded. There are two additional lagging storage actors which are excluded. There are 8 machines total. The cluster is in <code>triple</code> mode.</p>\n<p>I\u2019ll bring the downed service back up as it had no effect on the cluster afaict.</p>\n<p>[EDIT: done, but I\u2019ve allowed the tlog and stateless process to be included but left the storage processes excluded.]</p>\n<pre><code class=\"lang-auto\">^Cfdb&gt; exclude\nThere are currently 5 servers or processes being excluded from the database:\n  10.185.115.215:4503\n  10.185.175.43:4503\n  10.185.175.43:4504\n  10.185.175.43:4505\n  10.220.237.150:4504\nTo find out whether it is safe to remove one or more of these\nservers from the cluster, type `exclude &lt;addresses&gt;'.\nTo return one of these servers to the cluster, type `include &lt;addresses&gt;'.\n</code></pre>",
        "post_number": 12,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-20T22:02:45.609Z",
        "reply_count": 1,
        "reply_to_post_number": 11,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 28,
        "readers_count": 27,
        "score": 20.6,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 4,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://gist.github.com/ksnavely/bb334f04e91939c102758b11366793db",
            "internal": false,
            "reflection": false,
            "title": "gist:bb334f04e91939c102758b11366793db \u00b7 GitHub",
            "clicks": 8
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 337,
          "username": "mengxu",
          "name": "Meng Xu",
          "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/12",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7639,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2020-07-20T22:00:22.641Z",
        "cooked": "<p>This cluster is running FoundationDB 6.2.10 BTW.</p>",
        "post_number": 13,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-20T22:00:22.641Z",
        "reply_count": 0,
        "reply_to_post_number": 12,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 30,
        "readers_count": 29,
        "score": 16.0,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 484,
          "username": "ksnavely",
          "name": "Kyle Snavely",
          "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/13",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7640,
        "name": "Meng Xu",
        "username": "mengxu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
        "created_at": "2020-07-20T22:13:14.150Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ksnavely\" data-post=\"8\" data-topic=\"2235\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ksnavely/48/483_2.png\" class=\"avatar\"> ksnavely:</div>\n<blockquote>\n<pre><code class=\"lang-auto\">Jul 20 11:21:35 fdb5 trace.10.185.115.215.4500.1593170776.4NB1xR.2.459.json {  \"Severity\": \"20\", \"Time\": \"1595265694.556601\", \"Type\": \"UndesiredStorageServer\", \"ID\": \"3a854a4963363f69\", \"Server\": \"2217d81e47c74b1a\", \"Address\": \"10.185.175.43:4503:tls\", \"OtherServer\": \"d487eab27f823aa3\", \"NumShards\": \"15\", \"OtherNumShards\": \"238\", \"Machine\": \"10.185.115.215:4500\", \"LogGroup\": \"default\", \"Roles\": \"CD,DD,MS,RK\" }\n</code></pre>\n</blockquote>\n</aside>\n<p>The <code>UndesiredStorageServer</code> says there are two SSes on the same IP:Port. The <code>Server</code> (field) marks itself as unhealthy because <code>OtherServer</code> has more shards that itself: <code>OtherNumShards &gt; NumShards</code>. So <code>OtherServer</code> should eventually be selected as the destination to host data.</p>\n<p>(I\u2019m kind of out of ideas for now\u2026)</p>",
        "post_number": 14,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-20T22:13:14.150Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 1,
        "incoming_link_count": 2,
        "reads": 30,
        "readers_count": 29,
        "score": 16.0,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Meng Xu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 337,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/14",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 7641,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2020-07-20T23:27:30.234Z",
        "cooked": "<p>I\u2019ve re-included all process to the cluster. I killed DD manually. I don\u2019t see any real change happening to the cluster. Data lag has increased.</p>\n<p>I want to be open for other\u2019s comments, including disaster recovery. If the community comes up short I\u2019m leaning towards an <code>fdbdr</code> based recovery. We have at least two replicas of all shards, so it should be readable. If the DR can catch up, we can perform an <code>fdbdr switch</code> and ~simultaneously point our clients at the DR cluster. Afterwards we can wipe the original cluster and reverse the DR process to get things back to normal. (Or just carry on with the DR cluster\u2026yadda yadda internal infra management details for us :D)</p>",
        "post_number": 15,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2020-07-20T23:34:23.178Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 30,
        "readers_count": 29,
        "score": 11.0,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/15",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 10416,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2021-12-11T04:23:58.585Z",
        "cooked": "<p>Long story short fdbdr actually worked just great here. The incident onset is a bit of a forever mystery due to the issues in staging but we ran a thorough evaluation and remediation effort, taking a couple weeks at staging priority, to use fdbdr and transfer all healthy key ranges to a replacement cluster.</p>\n<p>It wasn\u2019t satisfying to have to move on but with a few missing puzzle pieces and other priorities I\u2019m happy to say we turned the situation into a productive exercise and valuable hands-on experience with FoundationDB for the team.</p>",
        "post_number": 16,
        "post_type": 1,
        "posts_count": 16,
        "updated_at": "2021-12-11T04:23:58.585Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 20,
        "readers_count": 19,
        "score": 4.0,
        "yours": false,
        "topic_id": 2235,
        "topic_slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels/2235/16",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      7553,
      7621,
      7624,
      7630,
      7631,
      7632,
      7633,
      7634,
      7635,
      7636,
      7637,
      7638,
      7639,
      7640,
      7641,
      10416
    ]
  },
  "timeline_lookup": [
    [
      1,
      1931
    ],
    [
      2,
      1923
    ],
    [
      4,
      1919
    ],
    [
      16,
      1411
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Identifying shards associated with replica unavailability; shard selection when dropping redundancy levels",
  "id": 2235,
  "title": "Identifying shards associated with replica unavailability; shard selection when dropping redundancy levels",
  "posts_count": 16,
  "created_at": "2020-07-08T20:05:13.553Z",
  "views": 2127,
  "reply_count": 6,
  "like_count": 0,
  "last_posted_at": "2021-12-11T04:23:58.585Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "identifying-shards-associated-with-replica-unavailability-shard-selection-when-dropping-redundancy-levels",
  "category_id": 17,
  "word_count": 3509,
  "deleted_at": null,
  "user_id": 484,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_2235",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 16,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Fdb cluster is unavailable after delete a disk",
      "id": 2232,
      "title": "Fdb cluster is unavailable after delete a disk",
      "slug": "fdb-cluster-is-unavailable-after-delete-a-disk",
      "posts_count": 4,
      "reply_count": 1,
      "highest_post_number": 4,
      "image_url": null,
      "created_at": "2020-07-07T09:35:29.720Z",
      "last_posted_at": "2020-07-09T08:38:11.028Z",
      "bumped": true,
      "bumped_at": "2020-07-09T09:28:06.173Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1154,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 585,
            "username": "ssb",
            "name": "Shunbo Shi",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ssb/{size}/656_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        }
      ]
    },
    {
      "fancy_title": "Storage server running out of space",
      "id": 1655,
      "title": "Storage server running out of space",
      "slug": "storage-server-running-out-of-space",
      "posts_count": 17,
      "reply_count": 14,
      "highest_post_number": 17,
      "image_url": null,
      "created_at": "2019-09-28T02:44:46.227Z",
      "last_posted_at": "2019-10-02T20:48:03.731Z",
      "bumped": true,
      "bumped_at": "2019-10-02T20:48:03.731Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 4053,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 311,
            "username": "ThomasJ",
            "name": "Thomas Johson",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 612,
            "username": "fzhjon",
            "name": "Jon Fu",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/f/9d8465/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Database unavailable after shutting down a foundationdb node",
      "id": 2113,
      "title": "Database unavailable after shutting down a foundationdb node",
      "slug": "database-unavailable-after-shutting-down-a-foundationdb-node",
      "posts_count": 18,
      "reply_count": 8,
      "highest_post_number": 18,
      "image_url": null,
      "created_at": "2020-05-11T16:09:39.373Z",
      "last_posted_at": "2021-02-05T22:16:50.767Z",
      "bumped": true,
      "bumped_at": "2021-02-05T22:18:40.780Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 8569,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 714,
            "username": "tuk",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/b5ac83/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 810,
            "username": "amanda",
            "name": "Amanda",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/a/67e7ee/{size}.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "R/w performance impact and replicas consistency while moving data",
      "id": 567,
      "title": "R/w performance impact and replicas consistency while moving data",
      "slug": "r-w-performance-impact-and-replicas-consistency-while-moving-data",
      "posts_count": 1,
      "reply_count": 0,
      "highest_post_number": 1,
      "image_url": null,
      "created_at": "2018-07-13T06:23:02.381Z",
      "last_posted_at": "2018-07-13T06:23:02.474Z",
      "bumped": true,
      "bumped_at": "2018-07-13T06:23:02.474Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 499,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest single",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 327,
            "username": "zhanghuan",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/z/5fc32e/{size}.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "6.0.18 Reporting incorrect Fault Tolerance via fdbcli with triple redundancy mode?",
      "id": 1282,
      "title": "6.0.18 Reporting incorrect Fault Tolerance via fdbcli with triple redundancy mode?",
      "slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
      "posts_count": 15,
      "reply_count": 8,
      "highest_post_number": 16,
      "image_url": null,
      "created_at": "2019-04-04T19:04:42.341Z",
      "last_posted_at": "2019-04-06T00:41:42.940Z",
      "bumped": true,
      "bumped_at": "2019-04-06T00:41:42.940Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 1976,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 490,
            "username": "rjenkins",
            "name": "Ray Jenkins",
            "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 81,
            "username": "ryanworl",
            "name": "Ryan Worl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
            "trust_level": 3
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 54,
            "username": "Evan",
            "name": "Evan Tschannen",
            "avatar_template": "/user_avatar/forums.foundationdb.org/evan/{size}/104_2.png",
            "moderator": true,
            "trust_level": 1
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 484,
        "username": "ksnavely",
        "name": "Kyle Snavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "post_count": 11,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      },
      {
        "id": 337,
        "username": "mengxu",
        "name": "Meng Xu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
        "post_count": 5,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      }
    ],
    "created_by": {
      "id": 484,
      "username": "ksnavely",
      "name": "Kyle Snavely",
      "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png"
    },
    "last_poster": {
      "id": 484,
      "username": "ksnavely",
      "name": "Kyle Snavely",
      "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png"
    },
    "links": [
      {
        "url": "https://github.com/xumengpanda/foundationdb/blob/ba54508c477dc90db1d261ca481663eea0a6220c/fdbclient/SystemData.cpp#L51-L59",
        "title": "foundationdb/SystemData.cpp at ba54508c477dc90db1d261ca481663eea0a6220c \u00b7 xumengpanda/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 11,
        "user_id": 337,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://www.usenix.org/conference/atc13/technical-sessions/presentation/cidon",
        "title": "Copysets: Reducing the Frequency of Data Loss in Cloud Storage | USENIX",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 10,
        "user_id": 337,
        "domain": "www.usenix.org",
        "root_domain": "usenix.org"
      },
      {
        "url": "https://gist.github.com/ksnavely/bb334f04e91939c102758b11366793db",
        "title": "gist:bb334f04e91939c102758b11366793db \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 8,
        "user_id": 484,
        "domain": "gist.github.com",
        "root_domain": "github.com"
      }
    ]
  },
  "bookmarks": []
}