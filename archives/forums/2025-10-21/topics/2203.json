{
  "post_stream": {
    "posts": [
      {
        "id": 7452,
        "name": "Leo Hu",
        "username": "lehu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
        "created_at": "2020-06-23T20:15:39.394Z",
        "cooked": "<p>We have one FDB cluster with the following status:</p>\n<blockquote>\n<pre><code>Cluster:\n  FoundationDB processes - 331\n  Zones                  - 19\n  Machines               - 211\n  Memory availability    - 135.2 GB per process on machine with least available\n  Retransmissions rate   - 2 Hz\n  Fault Tolerance        - 0 zones (2 without data loss)\n  Server time            - 06/23/20 01:18:48\n</code></pre>\n</blockquote>\n<p>I am little confused by the \u201c<strong>Fault Tolerance</strong>\u201d line and like to get some advice on how to read the values and why such value combination occur.</p>\n<p>Is the following reading correct?</p>\n<ul>\n<li>The first number (\u201c0 zones\u201d) is for \u201ccluster fault tolerance max zone failures without losing <strong>availability</strong>\u201d</li>\n<li>The second number in parens (\u201c2 without data loss\u201d) is for \u201ccluster fault tolerance max zone failures without losing <strong>data</strong>\u201d</li>\n</ul>\n<p>Please explain losing availability vs. losing data. Under what circumstances would such combination  occur? What does it mean from db operations point of view?</p>\n<p>Why is there such a big difference in fault tolerance between losing availability and losing data (0 zones vs 2 zones)?</p>\n<p>For the availability case, my hypothesis is that it is related the ratio of the number of machines vs. the number of zones in the cluster. (In our deployment, \u201czone\u201d is mapped to \u201crack\u201d.) When the ratio is smaller, i.e., fewer machines per zone, the allowed zone failures would be higher. Is this the case?</p>\n<p>Is there a formula for the ratio (rule of thumb) that can give us some assurance to have at least 1 zone failure tolerance (for availability and/or data)?</p>\n<p>For comparison, we have another cluster with the following status:</p>\n<blockquote>\n<pre><code>Cluster:\n  FoundationDB processes - 141\n  Zones                  - 23\n  Machines               - 94\n  Memory availability    - 140.0 GB per process on machine with least available\n  Retransmissions rate   - 144 Hz\n  Fault Tolerance        - 2 zones\n  Server time            - 06/23/20 19:10:05\n</code></pre>\n</blockquote>\n<p>I assume the single value of \u201c2 zones\u201d above applies to both availability and data.</p>\n<p>In this second cluster, we have fewer machines (94) than the first cluster (211), and more zones (23) than the first one (19), thus the ratio is smaller (94/23 == 4) than the first cluster (211/19 == 11).</p>\n<p>Thanks.</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2020-06-23T20:43:21.416Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 98,
        "reads": 35,
        "readers_count": 34,
        "score": 517.0,
        "yours": false,
        "topic_id": 2203,
        "topic_slug": "max-tolerable-zone-failures-for-availability-and-data",
        "display_username": "Leo Hu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 4,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 643,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/max-tolerable-zone-failures-for-availability-and-data/2203/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 7459,
        "name": "Meng Xu",
        "username": "mengxu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
        "created_at": "2020-06-24T22:48:08.970Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"lehu\" data-post=\"1\" data-topic=\"2203\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/lehu/48/995_2.png\" class=\"avatar\"> lehu:</div>\n<blockquote>\n<p>Please explain losing availability vs. losing data. Under what circumstances would such combination occur? What does it mean from db operations point of view?</p>\n</blockquote>\n</aside>\n<p>let\u2019s ask the question: what is the minimum zones to lose to cause data loss?<br>\nIt is the tLog_replica number of tlogs OR a majority of coordinators OR storage server replica number of SSes.</p>\n<p>So the maximum number of failed zones we can tolerate without losing data is the minimum number above minus one.</p>\n<p>About availability, in a multi-region configuration, we need to replicate data to satellite for every commit.<br>\nFor example, satellite\u2019s tLog replica factor is 2 and it has only 2 zones. If any zone in the satellite fails, FDB won\u2019t be able to recruit new tLogs to satisfy the tLog replication factor. Then commit won\u2019t succeed. Let\u2019s define the number of extra tLog zones in satellite (i.e., <code>extraEligibleTLogZones</code>) as the number of available zones in the satellite minus the tLog replication factor.</p>\n<p>The number of failed zones we can tolerate is the minimum number of <code>extraEligibleTLogZones + 1</code> in satellites.</p>\n<p>The related code is at <a href=\"https://github.com/apple/foundationdb/blob/e10704fd76138c6519a4bf743d7698b43f9eb9df/fdbserver/Status.actor.cpp#L1987-L1990\" rel=\"noopener nofollow ugc\">https://github.com/apple/foundationdb/blob/e10704fd76138c6519a4bf743d7698b43f9eb9df/fdbserver/Status.actor.cpp#L1987-L1990</a></p>\n<p>(BTW, this is a really good question.)</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2020-06-24T22:48:42.802Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 1,
        "incoming_link_count": 10,
        "reads": 30,
        "readers_count": 29,
        "score": 56.0,
        "yours": false,
        "topic_id": 2203,
        "topic_slug": "max-tolerable-zone-failures-for-availability-and-data",
        "display_username": "Meng Xu",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/blob/e10704fd76138c6519a4bf743d7698b43f9eb9df/fdbserver/Status.actor.cpp#L1987-L1990",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/Status.actor.cpp at e10704fd76138c6519a4bf743d7698b43f9eb9df \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 9
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 337,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/max-tolerable-zone-failures-for-availability-and-data/2203/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      7452,
      7459
    ]
  },
  "timeline_lookup": [
    [
      1,
      1946
    ],
    [
      2,
      1945
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Max Tolerable Zone Failures for Availability and Data",
  "id": 2203,
  "title": "Max Tolerable Zone Failures for Availability and Data",
  "posts_count": 2,
  "created_at": "2020-06-23T20:15:39.311Z",
  "views": 607,
  "reply_count": 0,
  "like_count": 1,
  "last_posted_at": "2020-06-24T22:48:08.970Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "max-tolerable-zone-failures-for-availability-and-data",
  "category_id": 7,
  "word_count": 562,
  "deleted_at": null,
  "user_id": 643,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_2203",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 2,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Fault Tolerance changes from &ldquo;2 machines&rdquo; to &ldquo;0 machines (2 without data loss)&rdquo;",
      "id": 1408,
      "title": "Fault Tolerance changes from \"2 machines\" to \"0 machines (2 without data loss)\"",
      "slug": "fault-tolerance-changes-from-2-machines-to-0-machines-2-without-data-loss",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2019-05-30T00:40:05.914Z",
      "last_posted_at": "2019-06-05T23:05:50.387Z",
      "bumped": true,
      "bumped_at": "2019-06-05T23:05:50.387Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 574,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 577,
            "username": "binzhangebay",
            "name": "binzhang",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/b/6a8cbe/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Metric equivalent to &ldquo;max zone failures without losing availability&rdquo; for tlogs?",
      "id": 2633,
      "title": "Metric equivalent to \"max zone failures without losing availability\" for tlogs?",
      "slug": "metric-equivalent-to-max-zone-failures-without-losing-availability-for-tlogs",
      "posts_count": 1,
      "reply_count": 0,
      "highest_post_number": 1,
      "image_url": null,
      "created_at": "2021-04-02T22:02:52.046Z",
      "last_posted_at": "2021-04-02T22:02:52.120Z",
      "bumped": true,
      "bumped_at": "2021-04-02T22:02:52.120Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 369,
      "category_id": 17,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest single",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 81,
            "username": "ryanworl",
            "name": "Ryan Worl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
            "trust_level": 3
          }
        }
      ]
    },
    {
      "fancy_title": "6.0.18 Reporting incorrect Fault Tolerance via fdbcli with triple redundancy mode?",
      "id": 1282,
      "title": "6.0.18 Reporting incorrect Fault Tolerance via fdbcli with triple redundancy mode?",
      "slug": "6-0-18-reporting-incorrect-fault-tolerance-via-fdbcli-with-triple-redundancy-mode",
      "posts_count": 15,
      "reply_count": 8,
      "highest_post_number": 16,
      "image_url": null,
      "created_at": "2019-04-04T19:04:42.341Z",
      "last_posted_at": "2019-04-06T00:41:42.940Z",
      "bumped": true,
      "bumped_at": "2019-04-06T00:41:42.940Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 1976,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 490,
            "username": "rjenkins",
            "name": "Ray Jenkins",
            "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 81,
            "username": "ryanworl",
            "name": "Ryan Worl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
            "trust_level": 3
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 54,
            "username": "Evan",
            "name": "Evan Tschannen",
            "avatar_template": "/user_avatar/forums.foundationdb.org/evan/{size}/104_2.png",
            "moderator": true,
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Fault Tolerance - 0 zones after setting locality_zoneid",
      "id": 2706,
      "title": "Fault Tolerance - 0 zones after setting locality_zoneid",
      "slug": "fault-tolerance-0-zones-after-setting-locality-zoneid",
      "posts_count": 9,
      "reply_count": 3,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2021-05-18T19:17:29.648Z",
      "last_posted_at": "2021-05-19T16:26:58.309Z",
      "bumped": true,
      "bumped_at": "2021-05-19T16:26:58.309Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 792,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 393,
            "username": "ex3ndr",
            "name": "Steve Korshakov",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Write-availability of FoundationDB",
      "id": 2668,
      "title": "Write-availability of FoundationDB",
      "slug": "write-availability-of-foundationdb",
      "posts_count": 5,
      "reply_count": 3,
      "highest_post_number": 5,
      "image_url": "https://global.discourse-cdn.com/foundationdb/original/2X/3/3c15ebda6cee4cbb93ad42c2519a256425b3bf16.png",
      "created_at": "2021-04-19T11:23:39.525Z",
      "last_posted_at": "2021-04-19T22:49:02.939Z",
      "bumped": true,
      "bumped_at": "2021-04-20T04:25:09.154Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 5,
      "views": 957,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 927,
            "username": "peter",
            "name": "Peter Zeller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/peter/{size}/1064_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 337,
        "username": "mengxu",
        "name": "Meng Xu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 643,
        "username": "lehu",
        "name": "Leo Hu",
        "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      }
    ],
    "created_by": {
      "id": 643,
      "username": "lehu",
      "name": "Leo Hu",
      "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png"
    },
    "last_poster": {
      "id": 337,
      "username": "mengxu",
      "name": "Meng Xu",
      "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png"
    },
    "links": [
      {
        "url": "https://github.com/apple/foundationdb/blob/e10704fd76138c6519a4bf743d7698b43f9eb9df/fdbserver/Status.actor.cpp#L1987-L1990",
        "title": "foundationdb/Status.actor.cpp at e10704fd76138c6519a4bf743d7698b43f9eb9df \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 9,
        "user_id": 337,
        "domain": "github.com",
        "root_domain": "github.com"
      }
    ]
  },
  "bookmarks": []
}