{
  "post_stream": {
    "posts": [
      {
        "id": 6233,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2020-02-18T00:29:04.347Z",
        "cooked": "<p>Hello all! This is Kyle over at IBM Cloudant.</p>\n<p>We\u2019re scaling out the storage on an upcoming <code>three_data_hall</code> cluster featuring ~30.4TB of 3x replicated storage (so ~91.2TB raw disk space).</p>\n<p>Now, we\u2019ve been using a single model of SSD after shaking down the performance of a few, which happens to be the smallest/cheapest/fastest we can purchase at 960GB. For our scale-up we\u2019ve chosen denser disks which are more expensive but just as fast.</p>\n<p>Naively I scaled up the tlog disks too but Adam Kocoloski got me thinking \u2013 do we need much tlog disk space generally speaking?</p>\n<p>We have two good options to move forward:</p>\n<ul>\n<li>scale up the tlogs: ~6.7TB of 4x replicated tlog space</li>\n<li>keep the 960GB base SSDs: ~1.7TB of 4x replicated tlog space</li>\n</ul>\n<p>We run 12 tlog processes, 7 active and 5 for redundancy. The sizes above are active sizes. Each process gets its own disk.</p>\n<p>I looked through our historical metrics on test servers but haven\u2019t seen the logs using much disk space, though that could be a complete testing gotcha. I\u2019m not seeing evidence pointing me to the larger option so any guidance on this topic is welcome.</p>\n<p>Cheers,<br>\nKyle</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 4,
        "updated_at": "2020-02-18T00:29:04.347Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 23,
        "reads": 22,
        "readers_count": 21,
        "score": 119.4,
        "yours": false,
        "topic_id": 1962,
        "topic_slug": "quick-question-on-tlog-disk-space-for-large-clusters",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://forums.foundationdb.org/t/questions-regarding-maintenance-for-multiple-storage-oriented-machines-in-a-data-hall/2010/3",
            "internal": true,
            "reflection": true,
            "title": "Questions regarding maintenance for multiple storage-oriented machines in a data hall",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/quick-question-on-tlog-disk-space-for-large-clusters/1962/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 6235,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2020-02-18T03:07:49.536Z",
        "cooked": "<p>If it\u2019s not obvious we\u2019ve been using baremetal machines to host FoundationDB. Out of curiosity I spec\u2019d out a VM based layer for our tlogs and stateless+ processes. I can build out a nice <code>three_data_hall</code> setup with 525GB of 4x replicated tlog space, or even 263GB.</p>\n<p>We\u2019re going to transition to VMs for these non-storage processes in the long term so I\u2019m glad I checked it out. I thought I\u2019d offer up these sizes as well to contrast with 30.4 TB of 3x replicated storage.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 4,
        "updated_at": "2020-02-18T03:07:49.536Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 22,
        "readers_count": 21,
        "score": 9.4,
        "yours": false,
        "topic_id": 1962,
        "topic_slug": "quick-question-on-tlog-disk-space-for-large-clusters",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/quick-question-on-tlog-disk-space-for-large-clusters/1962/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 6236,
        "name": "Alex Miller",
        "username": "alexmiller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "created_at": "2020-02-18T03:17:23.952Z",
        "cooked": "<p>The steady-state disk usage of a TLog will be ~8GB, IIRC.  Smaller file size is actually better here, because it means your SSD will wearlevel better.  You\u2019re mainly purchasing IOPS for TLog disk, and not space.</p>\n<p>\u2026 Except when things fail.  Giving TLogs large disks is useful in the case of storage server failures (or region failures, but you\u2019re not there yet), as the current (6.1+) implementation of TLogs means that they\u2019ll stop being able to recycle previous pieces of the file, and will start growing the file size instead.  Once data distribution removes the failed storage server from all storage teams, the TLogs will throw all of the old data away, and return back to its ~8GB steady state.</p>\n<p>Roughly, you\u2019ll want to roughly calculate out what your TLog write rate will be (<code>Client Write Rate in MB/s *  Replication Factor / Number of TLogs</code>), and then make sure that your TLog disks are large enough to survive O(hours) of that.  And you gave me all but the client write rate, so assuming a moderately high write rate, (((50 (MB / s)) * 4) / 7) * (8 hours) = ~822 gigabytes.  It looks like your current disks give you a bit over 8 hours for data distribution to finish, which should be sufficiently safe.</p>\n<p>Or instead of using math, you could look at your TLogMetrics trace events, and do a rough average of first of the three elements of <code>BytesInput</code>.  (The three elements of it are \u201cdifference variance total\u201d.)</p>\n<p>If you\u2019re choosing between an SSD with and without supercapacitors, your TLog will love you far more if you choose the one with them though.  TLogs basically just call <code>fsync()</code> in a loop, so making those free is pretty nice.</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 4,
        "updated_at": "2020-02-18T03:31:31.619Z",
        "reply_count": 0,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 5,
        "reads": 22,
        "readers_count": 21,
        "score": 29.4,
        "yours": false,
        "topic_id": 1962,
        "topic_slug": "quick-question-on-tlog-disk-space-for-large-clusters",
        "display_username": "Alex Miller",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 3,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 484,
          "username": "ksnavely",
          "name": "Kyle Snavely",
          "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 13,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/quick-question-on-tlog-disk-space-for-large-clusters/1962/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 6242,
        "name": "Kyle Snavely",
        "username": "ksnavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "created_at": "2020-02-18T15:38:49.956Z",
        "cooked": "<p>Alex, what a wonderful breakdown, I will try to reason out a safe size as you had. I was curious about the failing storage scenario so I\u2019m glad you covered it here.</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 4,
        "updated_at": "2020-02-18T15:38:49.956Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 20,
        "readers_count": 19,
        "score": 9.0,
        "yours": false,
        "topic_id": 1962,
        "topic_slug": "quick-question-on-tlog-disk-space-for-large-clusters",
        "display_username": "Kyle Snavely",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 484,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/quick-question-on-tlog-disk-space-for-large-clusters/1962/4",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      6233,
      6235,
      6236,
      6242
    ]
  },
  "timeline_lookup": [
    [
      1,
      2073
    ],
    [
      4,
      2072
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Quick question on tlog disk space for large clusters",
  "id": 1962,
  "title": "Quick question on tlog disk space for large clusters",
  "posts_count": 4,
  "created_at": "2020-02-18T00:29:04.262Z",
  "views": 602,
  "reply_count": 1,
  "like_count": 0,
  "last_posted_at": "2020-02-18T15:38:49.956Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "quick-question-on-tlog-disk-space-for-large-clusters",
  "category_id": 7,
  "word_count": 624,
  "deleted_at": null,
  "user_id": 484,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_1962",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 4,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "How to prevent tlogs from overcommitting",
      "id": 695,
      "title": "How to prevent tlogs from overcommitting",
      "slug": "how-to-prevent-tlogs-from-overcommitting",
      "posts_count": 21,
      "reply_count": 4,
      "highest_post_number": 21,
      "image_url": null,
      "created_at": "2018-09-12T08:05:48.702Z",
      "last_posted_at": "2018-10-23T00:50:58.852Z",
      "bumped": true,
      "bumped_at": "2018-10-23T00:50:58.852Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1648,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 38,
            "username": "panghy",
            "name": "Clement Pang",
            "avatar_template": "/user_avatar/forums.foundationdb.org/panghy/{size}/19_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "WARNING: A single process is both a transaction log and a storage server",
      "id": 1580,
      "title": "WARNING: A single process is both a transaction log and a storage server",
      "slug": "warning-a-single-process-is-both-a-transaction-log-and-a-storage-server",
      "posts_count": 17,
      "reply_count": 14,
      "highest_post_number": 17,
      "image_url": null,
      "created_at": "2019-08-11T17:20:33.378Z",
      "last_posted_at": "2019-08-13T20:43:59.991Z",
      "bumped": true,
      "bumped_at": "2019-08-13T20:43:59.991Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 6,
      "views": 1783,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 311,
            "username": "ThomasJ",
            "name": "Thomas Johson",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 15,
            "username": "markus.pilman",
            "name": "Markus Pilman",
            "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Daily Pattern in WorstTLog Queue / Tuning TLog 2GB Queue size?",
      "id": 1100,
      "title": "Daily Pattern in WorstTLog Queue / Tuning TLog 2GB Queue size?",
      "slug": "daily-pattern-in-worsttlog-queue-tuning-tlog-2gb-queue-size",
      "posts_count": 7,
      "reply_count": 3,
      "highest_post_number": 7,
      "image_url": "https://global.discourse-cdn.com/foundationdb/optimized/1X/b9236d2def40be75b06da47026136e49873439eb_2_1024x361.png",
      "created_at": "2019-02-01T16:28:09.179Z",
      "last_posted_at": "2019-02-05T21:53:23.889Z",
      "bumped": true,
      "bumped_at": "2019-02-05T21:53:23.889Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 815,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 490,
            "username": "rjenkins",
            "name": "Ray Jenkins",
            "avatar_template": "/user_avatar/forums.foundationdb.org/rjenkins/{size}/487_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Problems with TLogServer",
      "id": 2990,
      "title": "Problems with TLogServer",
      "slug": "problems-with-tlogserver",
      "posts_count": 1,
      "reply_count": 0,
      "highest_post_number": 1,
      "image_url": null,
      "created_at": "2021-11-04T03:17:10.341Z",
      "last_posted_at": "2021-11-04T03:17:10.406Z",
      "bumped": true,
      "bumped_at": "2021-11-04T03:17:10.406Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 377,
      "category_id": 8,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest single",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 1006,
            "username": "superhail",
            "name": "Alan Muhammad",
            "avatar_template": "/user_avatar/forums.foundationdb.org/superhail/{size}/1191_2.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "What is the good ratio of the storage processes and the log processes, and the associated metrics for monitoring?",
      "id": 1418,
      "title": "What is the good ratio of the storage processes and the log processes, and the associated metrics for monitoring?",
      "slug": "what-is-the-good-ratio-of-the-storage-processes-and-the-log-processes-and-the-associated-metrics-for-monitoring",
      "posts_count": 4,
      "reply_count": 2,
      "highest_post_number": 4,
      "image_url": null,
      "created_at": "2019-06-03T14:57:46.557Z",
      "last_posted_at": "2019-06-05T17:51:17.358Z",
      "bumped": true,
      "bumped_at": "2019-06-05T17:51:17.358Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "performance"
      ],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 1001,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 531,
            "username": "jltz",
            "name": "Jun Li",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/j/c0e974/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 484,
        "username": "ksnavely",
        "name": "Kyle Snavely",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png",
        "post_count": 3,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      },
      {
        "id": 13,
        "username": "alexmiller",
        "name": "Alex Miller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 4
      }
    ],
    "created_by": {
      "id": 484,
      "username": "ksnavely",
      "name": "Kyle Snavely",
      "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png"
    },
    "last_poster": {
      "id": 484,
      "username": "ksnavely",
      "name": "Kyle Snavely",
      "avatar_template": "/user_avatar/forums.foundationdb.org/ksnavely/{size}/483_2.png"
    }
  },
  "bookmarks": []
}