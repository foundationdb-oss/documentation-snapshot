{
  "post_stream": {
    "posts": [
      {
        "id": 12264,
        "name": "Allen Rohner",
        "username": "arohner",
        "avatar_template": "/user_avatar/forums.foundationdb.org/arohner/{size}/1475_2.png",
        "created_at": "2023-01-20T13:23:59.495Z",
        "cooked": "<p>When working on my application, I find that versionstamps are frequently a footgun, specifically attempting to read a versionstamp that was written in the current transaction.</p>\n<p>Why does that limitation exist? I can create an incomplete versionstamp in my code and print it, and it has a byte representation, so why can\u2019t the server return an incomplete versionstamp?</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 12,
        "updated_at": "2023-01-20T13:23:59.495Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 109,
        "reads": 29,
        "readers_count": 28,
        "score": 565.8,
        "yours": false,
        "topic_id": 3753,
        "topic_slug": "why-is-read-or-wrote-unreadable-key-necessary",
        "display_username": "Allen Rohner",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1191,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/why-is-read-or-wrote-unreadable-key-necessary/3753/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 12270,
        "name": "Jingyu Zhou",
        "username": "jzhou",
        "avatar_template": "/user_avatar/forums.foundationdb.org/jzhou/{size}/445_2.png",
        "created_at": "2023-01-20T16:32:41.881Z",
        "cooked": "<p>Versionstamps are just a placeholder on the client/app side. The value of the versionstamp of a transaction is only determined at the commit time, more precisely when the commit proxy replaces the actual value of the versionstamp for mutations after obtaining the commit version from the sequencer. Because of this limitation, it\u2019s impossible for the client/app to read versionstamp before the commit time.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 12,
        "updated_at": "2023-01-20T16:32:41.881Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 28,
        "readers_count": 27,
        "score": 10.6,
        "yours": false,
        "topic_id": 3753,
        "topic_slug": "why-is-read-or-wrote-unreadable-key-necessary",
        "display_username": "Jingyu Zhou",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": true,
        "admin": true,
        "staff": true,
        "user_id": 454,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/why-is-read-or-wrote-unreadable-key-necessary/3753/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12271,
        "name": "Allen Rohner",
        "username": "arohner",
        "avatar_template": "/user_avatar/forums.foundationdb.org/arohner/{size}/1475_2.png",
        "created_at": "2023-01-20T17:28:45.382Z",
        "cooked": "<p>I get that the complete versionstamp isn\u2019t filled out until the transaction commits, but in Java it\u2019s completely legal to just create an incomplete versionstamp and read it, serialize it to bytes, etc. Given that, why is it necessary for the API to <em>throw an exception</em> when an incomplete versionstamp is read, rather than returning an incomplete versionstamp like I would get before attempting to commit?</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 12,
        "updated_at": "2023-01-20T17:28:45.382Z",
        "reply_count": 1,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 28,
        "readers_count": 27,
        "score": 10.6,
        "yours": false,
        "topic_id": 3753,
        "topic_slug": "why-is-read-or-wrote-unreadable-key-necessary",
        "display_username": "Allen Rohner",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 454,
          "username": "jzhou",
          "name": "Jingyu Zhou",
          "avatar_template": "/user_avatar/forums.foundationdb.org/jzhou/{size}/445_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1191,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/why-is-read-or-wrote-unreadable-key-necessary/3753/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12273,
        "name": "",
        "username": "andrew.noyes",
        "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
        "created_at": "2023-01-20T20:15:09.660Z",
        "cooked": "<p>It sounds like you want the behavior enabled by the <code>bypass_unreadable</code> transaction option</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 12,
        "updated_at": "2023-01-20T20:15:09.660Z",
        "reply_count": 2,
        "reply_to_post_number": 3,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 26,
        "readers_count": 25,
        "score": 15.2,
        "yours": false,
        "topic_id": 3753,
        "topic_slug": "why-is-read-or-wrote-unreadable-key-necessary",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "reply_to_user": {
          "id": 1191,
          "username": "arohner",
          "name": "Allen Rohner",
          "avatar_template": "/user_avatar/forums.foundationdb.org/arohner/{size}/1475_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 14,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/why-is-read-or-wrote-unreadable-key-necessary/3753/4",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12274,
        "name": "",
        "username": "andrew.noyes",
        "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
        "created_at": "2023-01-20T20:39:10.567Z",
        "cooked": "<p>To try to answer the original question of why this is a thing though, let\u2019s first look at the motivation for the read-your-writes cache. If we view transactions as functions that take a database and return a new database (a database being a set of key-value pairs), then we can model the current state of FDB as the composition of some sequence of transactions. FDB\u2019s conflict checking preserves this even if there are concurrent writers.</p>\n<p>Now let\u2019s say your application has two transactions t1 and t2, and you want to make a new transaction t3 which is the composition of t1 and t2. The read-your-writes cache makes this straightforward - you simply call t1 and then t2 in the same transaction. t2 sees the effects of t1, and the result commits atomically. This is also why e.g. in the python api the <code>@fdb.transactional</code> decorator creates a function that takes a Database or a Transaction. You can commit a function as its own transaction, or you can freely compose many functions into one transaction.</p>\n<p>If the read-your-writes cache allowed you to read unresolved version stamps by default, then this whole paradigm no longer works. t2 would see <em>something</em>, but it wouldn\u2019t be the exact effect of t1.</p>\n<p>There are probably other ways for this paradigm to fall short, and in each case FDB should by default choose the safe option of not committing anything. One other way for this to fall short is transaction size limits - it could be that performing t1 and then t2 in one transaction makes the transaction too large to commit.</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 12,
        "updated_at": "2023-01-20T20:39:10.567Z",
        "reply_count": 0,
        "reply_to_post_number": 4,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 25,
        "readers_count": 24,
        "score": 15.0,
        "yours": false,
        "topic_id": 3753,
        "topic_slug": "why-is-read-or-wrote-unreadable-key-necessary",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "reply_to_user": {
          "id": 14,
          "username": "andrew.noyes",
          "name": "",
          "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 14,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/why-is-read-or-wrote-unreadable-key-necessary/3753/5",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12276,
        "name": "Dave Rolle",
        "username": "miridius",
        "avatar_template": "/user_avatar/forums.foundationdb.org/miridius/{size}/1500_2.png",
        "created_at": "2023-01-20T21:35:46.993Z",
        "cooked": "<p>Something that has been quite surprising to me (and does not seem necessary) is that if you have a range with a series of complete versionstamps and one incomplete one, you can\u2019t do a range read on any part of it, even parts that could never possibly contain whatever that versionstamp will be once it\u2019s completed.</p>\n<p>For example:</p>\n<ul>\n<li>\n<code>tx1</code> writes a verionstamped key <code>vs1</code> and commits</li>\n<li>\n<code>tx2</code> writes another one <code>vs2</code> and commits</li>\n<li>\n<code>tx3</code> writes incomplete versionstamped key <code>vs3</code>, and before committing tries to read the range from <code>vs1</code> to <code>vs2</code>. FDB throws \u201cread or wrote unreadable key\u201d.</li>\n</ul>\n<p>In this example we know that <code>vs3</code> must come after the current read version, which must come after <code>vs2</code>, so we aren\u2019t actually reading the incomplete versionstamp. Yet it still is not allowed.</p>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 12,
        "updated_at": "2023-01-20T21:35:46.993Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 23,
        "readers_count": 22,
        "score": 9.6,
        "yours": false,
        "topic_id": 3753,
        "topic_slug": "why-is-read-or-wrote-unreadable-key-necessary",
        "display_username": "Dave Rolle",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1205,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/why-is-read-or-wrote-unreadable-key-necessary/3753/6",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12277,
        "name": "",
        "username": "andrew.noyes",
        "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
        "created_at": "2023-01-20T23:29:50.103Z",
        "cooked": "<p>I think that\u2019s either a bug, an old version of fdb, or a quirk resulting from the fact that setting an atomic op must complete synchronously in the client API, which can be worked around by getting a read version before performing the versionstamped key op.</p>\n<p>What version are you using? Do you still see it if you wait until the transaction has a read version before setting the versionstamped key?</p>\n<p>Sidenote: tracking unreadable keys significantly complicates the implementation of the read-your-writes cache. While it\u2019s probably theoretically possible to fix the above quirk, I kind of doubt anybody will invest enough to pull it off, or if it\u2019s worth the maintenance burden even if someone does.</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 12,
        "updated_at": "2023-01-20T23:29:50.103Z",
        "reply_count": 1,
        "reply_to_post_number": 6,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 23,
        "readers_count": 22,
        "score": 9.6,
        "yours": false,
        "topic_id": 3753,
        "topic_slug": "why-is-read-or-wrote-unreadable-key-necessary",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "reply_to_user": {
          "id": 1205,
          "username": "miridius",
          "name": "Dave Rolle",
          "avatar_template": "/user_avatar/forums.foundationdb.org/miridius/{size}/1500_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 14,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/why-is-read-or-wrote-unreadable-key-necessary/3753/7",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12299,
        "name": "Allen Rohner",
        "username": "arohner",
        "avatar_template": "/user_avatar/forums.foundationdb.org/arohner/{size}/1475_2.png",
        "created_at": "2023-01-26T13:37:51.346Z",
        "cooked": "<p>It appears that <code>bypass_unreadable</code> doesn\u2019t work with range scans, is that correct?</p>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 12,
        "updated_at": "2023-01-26T13:37:51.346Z",
        "reply_count": 1,
        "reply_to_post_number": 4,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 21,
        "readers_count": 20,
        "score": 14.2,
        "yours": false,
        "topic_id": 3753,
        "topic_slug": "why-is-read-or-wrote-unreadable-key-necessary",
        "display_username": "Allen Rohner",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 14,
          "username": "andrew.noyes",
          "name": "",
          "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1191,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/why-is-read-or-wrote-unreadable-key-necessary/3753/8",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12301,
        "name": "",
        "username": "andrew.noyes",
        "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
        "created_at": "2023-01-26T17:32:56.725Z",
        "cooked": "<p>Looks like you\u2019re right - it only affects get requests. I find this surprising. My naive reading of the code is that it wouldn\u2019t be too too difficult to apply this to get range requests as well, but I\u2019m not 100% sure.</p>\n<p>Anyway I can confirm that you\u2019re right. Current status is \u201cgets only\u201d</p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 12,
        "updated_at": "2023-01-26T17:32:56.725Z",
        "reply_count": 0,
        "reply_to_post_number": 8,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 20,
        "readers_count": 19,
        "score": 14.0,
        "yours": false,
        "topic_id": 3753,
        "topic_slug": "why-is-read-or-wrote-unreadable-key-necessary",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "reply_to_user": {
          "id": 1191,
          "username": "arohner",
          "name": "Allen Rohner",
          "avatar_template": "/user_avatar/forums.foundationdb.org/arohner/{size}/1475_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 14,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/why-is-read-or-wrote-unreadable-key-necessary/3753/9",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12331,
        "name": "Dave Rolle",
        "username": "miridius",
        "avatar_template": "/user_avatar/forums.foundationdb.org/miridius/{size}/1500_2.png",
        "created_at": "2023-02-01T19:50:50.845Z",
        "cooked": "<blockquote>\n<p>Do you still see it if you wait until the transaction has a read version before setting the versionstamped key?</p>\n</blockquote>\n<p>Waiting until after the transaction has a read version helped a lot, thank you!</p>\n<p>Limiting a range to only show versionstamps with tx versions <em>less than</em> the current read version works now (incomplete versionstamps are hidden). However, if I include versionstamps whose version is <em>equal to</em> the current read version, I\u2019m back to \u201cread or wrote an unreadable key\u201d.</p>\n<p>I don\u2019t think that\u2019s right - I believe a tx\u2019s commit version will always be greater than its read version, so the incomplete versionstamps cannot be in that range. Or have I misunderstood something?</p>\n<p>The reason this is a bit of an issue is that if we:</p>\n<ol>\n<li>Commit tx1 with a versionstamped key</li>\n<li>Immediately start a new transaction tx2, in which we get the read version</li>\n</ol>\n<p>Then the read version in tx2 is (usually) equal to the commit version of tx1. So we can\u2019t write a new versionstamp in tx2 and then get a range that excludes that while still including the key from tx1.</p>",
        "post_number": 10,
        "post_type": 1,
        "posts_count": 12,
        "updated_at": "2023-02-01T19:50:50.845Z",
        "reply_count": 1,
        "reply_to_post_number": 7,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 19,
        "readers_count": 18,
        "score": 18.8,
        "yours": false,
        "topic_id": 3753,
        "topic_slug": "why-is-read-or-wrote-unreadable-key-necessary",
        "display_username": "Dave Rolle",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 14,
          "username": "andrew.noyes",
          "name": "",
          "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1205,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/why-is-read-or-wrote-unreadable-key-necessary/3753/10",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12358,
        "name": "Dave Rolle",
        "username": "miridius",
        "avatar_template": "/user_avatar/forums.foundationdb.org/miridius/{size}/1500_2.png",
        "created_at": "2023-02-06T15:09:39.769Z",
        "cooked": "<blockquote>\n<p>However, if I include versionstamps whose version is <em>equal to</em> the current read version, I\u2019m back to \u201cread or wrote an unreadable key\u201d.</p>\n</blockquote>\n<p>Looking into this more, I believe this to be a bug.</p>\n<p>In the developer guide under <a href=\"https://apple.github.io/foundationdb/developer-guide.html#how-versions-are-generated-and-assigned\" rel=\"noopener nofollow ugc\">How Versions are Generated and Assigned</a>, it states that:</p>\n<ul>\n<li>The read version is equal to \u201cthe last committed version as of the time it received the request\u201d.</li>\n<li>On commit, \u201cthe commit proxy will ask for a new version from the master\u201d</li>\n<li>\u201cFoundationDB guarantees that no version will be generated twice and that the versions are monotonically increasing.\u201d</li>\n</ul>\n<p>Since the read version is an existing version and the commit version is a new version, it follows that the commit version must always be strictly greater than the read version.</p>\n<p>However, the FDB client includes the read version as part of the range marked as unreadable when setting a versionstamped key: <a href=\"https://github.com/apple/foundationdb/blob/d47a2ab60fe145da8a779a9c6812dca0cc3aad39/fdbclient/ReadYourWrites.actor.cpp#L2195-L2201\" rel=\"noopener nofollow ugc\">https://github.com/apple/foundationdb/blob/d47a2ab60fe145da8a779a9c6812dca0cc3aad39/fdbclient/ReadYourWrites.actor.cpp#L2195-L2201</a></p>\n<p>Since the read version <em>is</em> the last committed version, it means this range overlaps with versionstamps added in the previous transaction, preventing you from reading them.</p>\n<p>I think if the code that calls <code>getVersionstampKeyRange</code> (or that function itself) were updated to add 1 to the read version, it would solve this.</p>",
        "post_number": 11,
        "post_type": 1,
        "posts_count": 12,
        "updated_at": "2023-02-06T15:09:39.769Z",
        "reply_count": 1,
        "reply_to_post_number": 10,
        "quote_count": 0,
        "incoming_link_count": 4,
        "reads": 16,
        "readers_count": 15,
        "score": 28.2,
        "yours": false,
        "topic_id": 3753,
        "topic_slug": "why-is-read-or-wrote-unreadable-key-necessary",
        "display_username": "Dave Rolle",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/blob/d47a2ab60fe145da8a779a9c6812dca0cc3aad39/fdbclient/ReadYourWrites.actor.cpp#L2195-L2201",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/ReadYourWrites.actor.cpp at d47a2ab60fe145da8a779a9c6812dca0cc3aad39 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 4
          },
          {
            "url": "https://apple.github.io/foundationdb/developer-guide.html#how-versions-are-generated-and-assigned",
            "internal": false,
            "reflection": false,
            "title": "Developer Guide \u2014 FoundationDB 7.2",
            "clicks": 2
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 1205,
          "username": "miridius",
          "name": "Dave Rolle",
          "avatar_template": "/user_avatar/forums.foundationdb.org/miridius/{size}/1500_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1205,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/why-is-read-or-wrote-unreadable-key-necessary/3753/11",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 12359,
        "name": "Andrew Noyes",
        "username": "atn34",
        "avatar_template": "/user_avatar/forums.foundationdb.org/atn34/{size}/617_2.png",
        "created_at": "2023-02-06T17:02:41.055Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"miridius\" data-post=\"11\" data-topic=\"3753\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/miridius/48/1500_2.png\" class=\"avatar\"> miridius:</div>\n<blockquote>\n<p>I think if the code that calls <code>getVersionstampKeyRange</code> (or that function itself) were updated to add 1 to the read version, it would solve this.</p>\n</blockquote>\n</aside>\n<p>I think you\u2019re right. I think a PR for that would be probably be welcome. I would approve it myself but I recently made a career change and I don\u2019t have merge capabilities anymore.</p>",
        "post_number": 12,
        "post_type": 1,
        "posts_count": 12,
        "updated_at": "2023-02-06T17:02:41.055Z",
        "reply_count": 0,
        "reply_to_post_number": 11,
        "quote_count": 1,
        "incoming_link_count": 1,
        "reads": 15,
        "readers_count": 14,
        "score": 8.0,
        "yours": false,
        "topic_id": 3753,
        "topic_slug": "why-is-read-or-wrote-unreadable-key-necessary",
        "display_username": "Andrew Noyes",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 569,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/why-is-read-or-wrote-unreadable-key-necessary/3753/12",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      12264,
      12270,
      12271,
      12273,
      12274,
      12276,
      12277,
      12299,
      12301,
      12331,
      12358,
      12359
    ]
  },
  "timeline_lookup": [
    [
      1,
      1005
    ],
    [
      8,
      999
    ],
    [
      10,
      993
    ],
    [
      11,
      988
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Why is &ldquo;Read or wrote unreadable key&rdquo; necessary?",
  "id": 3753,
  "title": "Why is \"Read or wrote unreadable key\" necessary?",
  "posts_count": 12,
  "created_at": "2023-01-20T13:23:59.444Z",
  "views": 580,
  "reply_count": 9,
  "like_count": 1,
  "last_posted_at": "2023-02-06T17:02:41.055Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "why-is-read-or-wrote-unreadable-key-necessary",
  "category_id": 7,
  "word_count": 1292,
  "deleted_at": null,
  "user_id": 1191,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_3753",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 12,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 5,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "&ldquo;Read or wrote an unreadable key&rdquo; when read and then write versionstamp value",
      "id": 2301,
      "title": "\"Read or wrote an unreadable key\" when read and then write versionstamp value",
      "slug": "read-or-wrote-an-unreadable-key-when-read-and-then-write-versionstamp-value",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2020-08-22T22:36:53.054Z",
      "last_posted_at": "2020-08-23T00:50:06.076Z",
      "bumped": true,
      "bumped_at": "2020-08-23T00:50:06.076Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "bindings"
      ],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 706,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest single",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 393,
            "username": "ex3ndr",
            "name": "Steve Korshakov",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Cannot commit transaction that reads the metadataVersion key after changing it",
      "id": 1833,
      "title": "Cannot commit transaction that reads the metadataVersion key after changing it",
      "slug": "cannot-commit-transaction-that-reads-the-metadataversion-key-after-changing-it",
      "posts_count": 7,
      "reply_count": 3,
      "highest_post_number": 7,
      "image_url": null,
      "created_at": "2019-12-11T22:52:33.816Z",
      "last_posted_at": "2019-12-13T13:23:15.818Z",
      "bumped": true,
      "bumped_at": "2019-12-13T14:11:35.389Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1297,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "VersionStamp vs CommittedVersion",
      "id": 600,
      "title": "VersionStamp vs CommittedVersion",
      "slug": "versionstamp-vs-committedversion",
      "posts_count": 7,
      "reply_count": 3,
      "highest_post_number": 7,
      "image_url": null,
      "created_at": "2018-07-30T06:50:38.826Z",
      "last_posted_at": "2018-09-17T19:43:14.827Z",
      "bumped": true,
      "bumped_at": "2018-09-17T19:43:14.827Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 3916,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 41,
            "username": "amirouche",
            "name": "Amirouche",
            "avatar_template": "/user_avatar/forums.foundationdb.org/amirouche/{size}/1911_2.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Reading your own write conflict range",
      "id": 2097,
      "title": "Reading your own write conflict range",
      "slug": "reading-your-own-write-conflict-range",
      "posts_count": 6,
      "reply_count": 4,
      "highest_post_number": 6,
      "image_url": null,
      "created_at": "2020-05-01T17:01:26.015Z",
      "last_posted_at": "2020-05-04T16:53:08.629Z",
      "bumped": true,
      "bumped_at": "2020-05-04T16:53:08.629Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 1180,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 14,
            "username": "andrew.noyes",
            "name": "",
            "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 337,
            "username": "mengxu",
            "name": "Meng Xu",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "SET_VERSIONSTAMPED_KEY and READ_YOUR_WRITES_DISABLE",
      "id": 1443,
      "title": "SET_VERSIONSTAMPED_KEY and READ_YOUR_WRITES_DISABLE",
      "slug": "set-versionstamped-key-and-read-your-writes-disable",
      "posts_count": 3,
      "reply_count": 1,
      "highest_post_number": 3,
      "image_url": null,
      "created_at": "2019-06-12T09:54:14.489Z",
      "last_posted_at": "2019-06-14T00:33:51.058Z",
      "bumped": true,
      "bumped_at": "2019-06-14T00:33:51.058Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "bindings"
      ],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 735,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 605,
            "username": "russell",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/50afbb/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 14,
        "username": "andrew.noyes",
        "name": "",
        "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
        "post_count": 4,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 1191,
        "username": "arohner",
        "name": "Allen Rohner",
        "avatar_template": "/user_avatar/forums.foundationdb.org/arohner/{size}/1475_2.png",
        "post_count": 3,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      },
      {
        "id": 1205,
        "username": "miridius",
        "name": "Dave Rolle",
        "avatar_template": "/user_avatar/forums.foundationdb.org/miridius/{size}/1500_2.png",
        "post_count": 3,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      },
      {
        "id": 454,
        "username": "jzhou",
        "name": "Jingyu Zhou",
        "avatar_template": "/user_avatar/forums.foundationdb.org/jzhou/{size}/445_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "moderator": true,
        "trust_level": 2
      },
      {
        "id": 569,
        "username": "atn34",
        "name": "Andrew Noyes",
        "avatar_template": "/user_avatar/forums.foundationdb.org/atn34/{size}/617_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 4
      }
    ],
    "created_by": {
      "id": 1191,
      "username": "arohner",
      "name": "Allen Rohner",
      "avatar_template": "/user_avatar/forums.foundationdb.org/arohner/{size}/1475_2.png"
    },
    "last_poster": {
      "id": 569,
      "username": "atn34",
      "name": "Andrew Noyes",
      "avatar_template": "/user_avatar/forums.foundationdb.org/atn34/{size}/617_2.png"
    },
    "links": [
      {
        "url": "https://github.com/apple/foundationdb/blob/d47a2ab60fe145da8a779a9c6812dca0cc3aad39/fdbclient/ReadYourWrites.actor.cpp#L2195-L2201",
        "title": "foundationdb/ReadYourWrites.actor.cpp at d47a2ab60fe145da8a779a9c6812dca0cc3aad39 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 4,
        "user_id": 1205,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://apple.github.io/foundationdb/developer-guide.html#how-versions-are-generated-and-assigned",
        "title": "Developer Guide \u2014 FoundationDB 7.2",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 2,
        "user_id": 1205,
        "domain": "apple.github.io",
        "root_domain": "apple.github.io"
      }
    ]
  },
  "bookmarks": []
}