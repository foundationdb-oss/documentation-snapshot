{
  "post_stream": {
    "posts": [
      {
        "id": 63,
        "name": "Alec Grieser",
        "username": "alloc",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
        "created_at": "2018-04-13T18:03:39.200Z",
        "cooked": "<p>The <code>ReadTransaction</code> interface currently only offers methods that allow the user to read data. However, it doesn\u2019t offer any control over which conflict ranges get added. I propose that the <code>ReadTransaction</code> interface should offer the following additional methods:</p>\n<ul>\n<li>\n<code>snapshot()</code> - This would allow the user to get a snapshot view of the database, i.e., one that doesn\u2019t add any read conflict ranges automatically. This method currently exists in the <code>Transaction</code> interface, and read-write transactions implement this by producing a new <code>ReadTransaction</code> that doesn\u2019t add read conflict ranges. That implementation could stay the same, but snapshot transactions would implement it by returning <code>this</code>. The benefit, though, is that the user could call <code>snapshot</code> on a <code>ReadTransaction</code> and know that they are getting a version of the transaction that doesn\u2019t add conflicts.</li>\n<li>\n<code>addReadConflictRange()</code> and <code>addReadConflictKey()</code> - These methods already exist in the transaction interface. In a <code>ReadTransaction</code>, I would think that they should only add a conflict range if the transaction is not actually a snapshot transaction. It\u2019s also possible that the <code>ReadTransaction</code> interface should have a method that is called something like <code>addReadConflictRangeIfNotSnapshot</code> or something more verbose so that it is explicit what\u2019s going on, though it would add cruft. Regular transactions would implement that to add the conflict range. Snapshot transactions would not.</li>\n<li>\n<code>isSnapshot()</code> - This probably isn\u2019t strictly necessary, but it would be nice to have. It would let the user make decisions about whether they are going to manually add conflict ranges before having to go and compute them.</li>\n</ul>\n<p>If one wanted to get into the weeds of the type system, one might be able to do something better with something like a <code>SnapshotTransaction</code> interface. But I think the thing that we actually want to support at the end of the day is for someone to write a method that looks like:</p>\n<pre><code class=\"lang-java\">void doFoo(ReadTransaction rtr) {\n   // logic\n}\n</code></pre>\n<p>Then the \u201cright\u201d conflict ranges get added by the <code>doFoo</code> method, whatever that means for the application. Like, in theory, you could imagine a method that is something like:</p>\n<pre><code class=\"lang-java\">CompletableFuture&lt;Optional&lt;KeyValue&gt;&gt; getRandomKey(ReadTransaction rtr, Subspace subspace, int limit) {\n    return rtr.snapshot().getRange(subspace.range(), limit).asList().thenApply(list -&gt; {\n        it (list.isEmpty()) return Optional.empty();\n        int index = (int)(Math.random() * list.size());\n        KeyValue kv = list.get(index);\n        rtr.addReadConflictKey(kv.getKey());  // or addReadConflictKeyIfNotSnapshot\n        return Optional.of(kv.getKey());\n    });\n}\n</code></pre>\n<p>This would then let someone pick a random element from a subspace and only add a read conflict key on the one that they actually got. (This is essentially our canonical example of why someone would manually add a read conflict range.) But this has the added benefit that if someone wants to read that key at snapshot isolation level, they can do so by just passing in a snapshot transaction. For example, the user might grab this random key and then check to see if some other thing in the database is still at work, and then want to add a read conflict key only if that second operation returns a particular result. (Maybe this is a little contrived.)</p>\n<p>One other benefit of this interface change is that, right now, if the user wants to be particular about conflict ranges, then they have to declare that their functions take <code>Transaction</code>s (or <code>TransactionContext</code>s), which means that there are no compiler-enforced guarantees about whether the operation can (incidentally) perform a mutation, which might be bad for users who are sensitive to what can turn a read-only transaction into a read-write transaction.</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 1,
        "updated_at": "2018-04-13T18:08:43.880Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 13,
        "reads": 44,
        "readers_count": 43,
        "score": 88.8,
        "yours": false,
        "topic_id": 37,
        "topic_slug": "java-bindings-additional-methods-on-the-readtransaction-interface-to-manage-read-conflict-ranges",
        "display_username": "Alec Grieser",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 3,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 8,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/java-bindings-additional-methods-on-the-readtransaction-interface-to-manage-read-conflict-ranges/37/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      }
    ],
    "stream": [
      63
    ]
  },
  "timeline_lookup": [
    [
      1,
      2748
    ]
  ],
  "suggested_topics": [],
  "tags": [
    "bindings"
  ],
  "tags_descriptions": {},
  "fancy_title": "Java Bindings: Additional methods on the ReadTransaction interface to manage read conflict ranges",
  "id": 37,
  "title": "Java Bindings: Additional methods on the ReadTransaction interface to manage read conflict ranges",
  "posts_count": 1,
  "created_at": "2018-04-13T18:03:39.089Z",
  "views": 879,
  "reply_count": 0,
  "like_count": 1,
  "last_posted_at": "2018-04-13T18:03:39.200Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "java-bindings-additional-methods-on-the-readtransaction-interface-to-manage-read-conflict-ranges",
  "category_id": 8,
  "word_count": 590,
  "deleted_at": null,
  "user_id": 8,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_37",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 1,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 1,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "[Java] why is setReadVersion not part of ReadTransaction/ReadSnapshot",
      "id": 646,
      "title": "[Java] why is setReadVersion not part of ReadTransaction/ReadSnapshot",
      "slug": "java-why-is-setreadversion-not-part-of-readtransaction-readsnapshot",
      "posts_count": 15,
      "reply_count": 12,
      "highest_post_number": 15,
      "image_url": null,
      "created_at": "2018-08-19T08:03:20.405Z",
      "last_posted_at": "2018-08-22T02:19:45.224Z",
      "bumped": true,
      "bumped_at": "2018-08-22T02:19:45.224Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 983,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Read-only operations on FDBTransaction vs ReadSnapshot",
      "id": 616,
      "title": "Read-only operations on FDBTransaction vs ReadSnapshot",
      "slug": "read-only-operations-on-fdbtransaction-vs-readsnapshot",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2018-08-08T04:10:24.449Z",
      "last_posted_at": "2018-08-08T16:36:57.441Z",
      "bumped": true,
      "bumped_at": "2018-08-08T16:36:57.441Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 687,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Does .snapshot() provide Snapshot Level Isolation?",
      "id": 301,
      "title": "Does .snapshot() provide Snapshot Level Isolation?",
      "slug": "does-snapshot-provide-snapshot-level-isolation",
      "posts_count": 3,
      "reply_count": 0,
      "highest_post_number": 3,
      "image_url": null,
      "created_at": "2018-04-29T05:48:23.491Z",
      "last_posted_at": "2018-04-29T11:02:05.975Z",
      "bumped": true,
      "bumped_at": "2018-04-29T11:02:05.975Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 774,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "ReadConflict vs WriteConflict for locking a range?",
      "id": 1070,
      "title": "ReadConflict vs WriteConflict for locking a range?",
      "slug": "readconflict-vs-writeconflict-for-locking-a-range",
      "posts_count": 7,
      "reply_count": 3,
      "highest_post_number": 7,
      "image_url": null,
      "created_at": "2019-01-26T13:26:56.674Z",
      "last_posted_at": "2019-02-02T05:07:53.900Z",
      "bumped": true,
      "bumped_at": "2019-02-02T05:07:53.900Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1354,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 308,
            "username": "ananthakumaran",
            "name": "Anantha Kumaran",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ananthakumaran/{size}/526_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 173,
            "username": "jkominek",
            "name": "Jay Kominek",
            "avatar_template": "/user_avatar/forums.foundationdb.org/jkominek/{size}/140_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Reading your own write conflict range",
      "id": 2097,
      "title": "Reading your own write conflict range",
      "slug": "reading-your-own-write-conflict-range",
      "posts_count": 6,
      "reply_count": 4,
      "highest_post_number": 6,
      "image_url": null,
      "created_at": "2020-05-01T17:01:26.015Z",
      "last_posted_at": "2020-05-04T16:53:08.629Z",
      "bumped": true,
      "bumped_at": "2020-05-04T16:53:08.629Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 1180,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 14,
            "username": "andrew.noyes",
            "name": "",
            "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 337,
            "username": "mengxu",
            "name": "Meng Xu",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 8,
        "username": "alloc",
        "name": "Alec Grieser",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 4
      }
    ],
    "created_by": {
      "id": 8,
      "username": "alloc",
      "name": "Alec Grieser",
      "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png"
    },
    "last_poster": {
      "id": 8,
      "username": "alloc",
      "name": "Alec Grieser",
      "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png"
    }
  },
  "bookmarks": []
}