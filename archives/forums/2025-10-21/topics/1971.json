{
  "post_stream": {
    "posts": [
      {
        "id": 6277,
        "name": "Lars Hagen",
        "username": "larshagen",
        "avatar_template": "/user_avatar/forums.foundationdb.org/larshagen/{size}/776_2.png",
        "created_at": "2020-02-20T07:53:36.139Z",
        "cooked": "<p>We have been experimenting with the kubernetes operator in GCP, and it works great without TLS. When trying to follow the guidelines on setting up TLS, the controller ends up in a error loop, only logging</p>\n<pre><code>2020-02-19T19:44:31.149Z        ERROR   controller-runtime.controller   Reconciler error        {\"controller\": \"foundationdbcluster\", \"request\": \"default/&lt;cluster-name&gt;\", \"error\": \"open : no such file or directory\"}\ngithub.com/go-logr/zapr.(*zapLogger).Error\n    /go/pkg/mod/github.com/go-logr/zapr@v0.1.0/zapr.go:128\nsigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).reconcileHandler\n    /go/pkg/mod/sigs.k8s.io/controller-runtime@v0.4.0/pkg/internal/controller/controller.go:258\nsigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).processNextWorkItem\n    /go/pkg/mod/sigs.k8s.io/controller-runtime@v0.4.0/pkg/internal/controller/controller.go:232\nsigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).worker\n    /go/pkg/mod/sigs.k8s.io/controller-runtime@v0.4.0/pkg/internal/controller/controller.go:211\nk8s.io/apimachinery/pkg/util/wait.JitterUntil.func1\n    /go/pkg/mod/k8s.io/apimachinery@v0.0.0-20190913080033-27d36303b655/pkg/util/wait/wait.go:152\nk8s.io/apimachinery/pkg/util/wait.JitterUntil\n    /go/pkg/mod/k8s.io/apimachinery@v0.0.0-20190913080033-27d36303b655/pkg/util/wait/wait.go:153\nk8s.io/apimachinery/pkg/util/wait.Until\n    /go/pkg/mod/k8s.io/apimachinery@v0.0.0-20190913080033-27d36303b655/pkg/util/wait/wait.go:88\n</code></pre>\n<p>This happens as long as the sidecar is happy with its TLS parameters (otherwise the sidecar fails and the controller never gets to this point). We would like to help out on the operator if possible, but it\u2019s a complicating factor that the error gives no indication on where in the controller the error happened, the stack trace seems to be entirely from the k8s controller framework.</p>\n<p>Any hints on what could be the reason, or how to efficiently investigate this would be appreciated.</p>\n<p>EDIT: I forked the operator and added some stack traces to the errors, using the package <a href=\"https://github.com/pkg/errors\" rel=\"nofollow noopener\">https://github.com/pkg/errors</a>. So far this has told me that the operator is failing to get pod clients in <a href=\"https://github.com/FoundationDB/fdb-kubernetes-operator/blob/9c2cd190c88e4eae10e9a5bc4cab4fb50f66b0d4/controllers/generate_initial_cluster_file.go#L67\" rel=\"nofollow noopener\">https://github.com/FoundationDB/fdb-kubernetes-operator/blob/9c2cd190c88e4eae10e9a5bc4cab4fb50f66b0d4/controllers/generate_initial_cluster_file.go#L67</a></p>\n<p>EDIT2: The reason it failed was that the controller needs to have TLS environment variables set up when talking to a TLS enabled cluster, it failed here:<a href=\"https://github.com/FoundationDB/fdb-kubernetes-operator/blob/9c2cd190c88e4eae10e9a5bc4cab4fb50f66b0d4/controllers/pod_client.go#L104\" rel=\"nofollow noopener\">https://github.com/FoundationDB/fdb-kubernetes-operator/blob/9c2cd190c88e4eae10e9a5bc4cab4fb50f66b0d4/controllers/pod_client.go#L104</a> Maybe I missed something, but I can\u2019t remember seeing any documentation that the controller needs to be able to talk to the pods over TLS, though in hindsight it seems obvious. I think improving the error messages here could go a long way to reduce debug time.</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2020-02-20T14:23:48.134Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 343,
        "reads": 29,
        "readers_count": 28,
        "score": 1715.8,
        "yours": false,
        "topic_id": 1971,
        "topic_slug": "controller-errors-when-enabling-tls-with-the-kubernetes-operator",
        "display_username": "Lars Hagen",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 5,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/FoundationDB/fdb-kubernetes-operator/blob/9c2cd190c88e4eae10e9a5bc4cab4fb50f66b0d4/controllers/pod_client.go#L104",
            "internal": false,
            "reflection": false,
            "title": "fdb-kubernetes-operator/pod_client.go at 9c2cd190c88e4eae10e9a5bc4cab4fb50f66b0d4 \u00b7 FoundationDB/fdb-kubernetes-operator \u00b7 GitHub",
            "clicks": 11
          },
          {
            "url": "https://github.com/FoundationDB/fdb-kubernetes-operator/blob/9c2cd190c88e4eae10e9a5bc4cab4fb50f66b0d4/controllers/generate_initial_cluster_file.go#L67",
            "internal": false,
            "reflection": false,
            "title": "fdb-kubernetes-operator/generate_initial_cluster_file.go at 9c2cd190c88e4eae10e9a5bc4cab4fb50f66b0d4 \u00b7 FoundationDB/fdb-kubernetes-operator \u00b7 GitHub",
            "clicks": 3
          },
          {
            "url": "https://github.com/pkg/errors",
            "internal": false,
            "reflection": false,
            "title": "GitHub - pkg/errors: Simple error handling primitives",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 724,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/controller-errors-when-enabling-tls-with-the-kubernetes-operator/1971/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 6371,
        "name": "John Brownlee",
        "username": "john_brownlee",
        "avatar_template": "/user_avatar/forums.foundationdb.org/john_brownlee/{size}/22_2.png",
        "created_at": "2020-02-28T15:32:16.464Z",
        "cooked": "<p>Thanks for that feedback. I agree that we should make the error messages clearer, and also make the documentation clearer. We set the TLS environment variables up in the development environment, but not in the samples for running the operator in a real environment. The reason for that is that I don\u2019t know of a general-purpose solution for getting the certs set up in a way that is secure and provides appropriate fields for restricting access to a cluster. It\u2019s a big gap in our solution that we should make clear, since it\u2019ll be common for people to want to run with TLS.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2020-02-28T15:32:16.464Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 6,
        "reads": 20,
        "readers_count": 19,
        "score": 34.0,
        "yours": false,
        "topic_id": 1971,
        "topic_slug": "controller-errors-when-enabling-tls-with-the-kubernetes-operator",
        "display_username": "John Brownlee",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 3,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/controller-errors-when-enabling-tls-with-the-kubernetes-operator/1971/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      6277,
      6371
    ]
  },
  "timeline_lookup": [
    [
      1,
      2071
    ],
    [
      2,
      2062
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Controller errors when enabling tls with the kubernetes operator",
  "id": 1971,
  "title": "Controller errors when enabling tls with the kubernetes operator",
  "posts_count": 2,
  "created_at": "2020-02-20T07:53:36.075Z",
  "views": 1374,
  "reply_count": 0,
  "like_count": 0,
  "last_posted_at": "2020-02-28T15:32:16.464Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "controller-errors-when-enabling-tls-with-the-kubernetes-operator",
  "category_id": 16,
  "word_count": 566,
  "deleted_at": null,
  "user_id": 724,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_1971",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 2,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Running backups on tls-enabled cluster",
      "id": 2036,
      "title": "Running backups on tls-enabled cluster",
      "slug": "running-backups-on-tls-enabled-cluster",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2020-03-30T15:38:49.682Z",
      "last_posted_at": "2020-04-01T10:14:45.052Z",
      "bumped": true,
      "bumped_at": "2020-04-01T10:14:45.052Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 776,
      "category_id": 16,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest single",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 746,
            "username": "matiasholte",
            "name": "Matias Holte",
            "avatar_template": "/user_avatar/forums.foundationdb.org/matiasholte/{size}/1124_2.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "TLS changes, would it need manual restart or automatic restart of operator?",
      "id": 3968,
      "title": "TLS changes, would it need manual restart or automatic restart of operator?",
      "slug": "tls-changes-would-it-need-manual-restart-or-automatic-restart-of-operator",
      "posts_count": 5,
      "reply_count": 3,
      "highest_post_number": 5,
      "image_url": null,
      "created_at": "2023-05-17T13:02:34.036Z",
      "last_posted_at": "2023-05-23T14:44:50.310Z",
      "bumped": true,
      "bumped_at": "2023-05-23T14:44:50.310Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 320,
      "category_id": 16,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 890,
            "username": "tangerine",
            "name": "",
            "avatar_template": "/user_avatar/forums.foundationdb.org/tangerine/{size}/1084_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 849,
            "username": "johscheuer",
            "name": "Johannes Scheuermann",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/j/f475e1/{size}.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Cannot enable TLS without DISABLE_SIDECAR_TLS_CHECK=1",
      "id": 2804,
      "title": "Cannot enable TLS without DISABLE_SIDECAR_TLS_CHECK=1",
      "slug": "cannot-enable-tls-without-disable-sidecar-tls-check-1",
      "posts_count": 9,
      "reply_count": 7,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2021-07-17T13:03:31.166Z",
      "last_posted_at": "2022-02-22T15:35:23.417Z",
      "bumped": true,
      "bumped_at": "2022-02-22T15:35:23.417Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 827,
      "category_id": 16,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 970,
            "username": "mason",
            "name": "mason",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mason/{size}/1145_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 849,
            "username": "johscheuer",
            "name": "Johannes Scheuermann",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/j/f475e1/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 890,
            "username": "tangerine",
            "name": "",
            "avatar_template": "/user_avatar/forums.foundationdb.org/tangerine/{size}/1084_2.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "How to configure TLS with EKS fdb",
      "id": 4003,
      "title": "How to configure TLS with EKS fdb",
      "slug": "how-to-configure-tls-with-eks-fdb",
      "posts_count": 2,
      "reply_count": 1,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2023-06-09T16:03:38.235Z",
      "last_posted_at": "2023-06-10T10:07:01.144Z",
      "bumped": true,
      "bumped_at": "2023-08-08T18:35:59.524Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "operator"
      ],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 388,
      "category_id": 16,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 604,
            "username": "Minaxi",
            "name": "meenakshi subramanyam",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/m/2bfe46/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 1128,
            "username": "manfontan",
            "name": "Manuel Fontan",
            "avatar_template": "/user_avatar/forums.foundationdb.org/manfontan/{size}/1370_2.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Issues with V6.2 TLS Cluster",
      "id": 1904,
      "title": "Issues with V6.2 TLS Cluster",
      "slug": "issues-with-v6-2-tls-cluster",
      "posts_count": 12,
      "reply_count": 8,
      "highest_post_number": 12,
      "image_url": null,
      "created_at": "2020-01-23T17:31:13.342Z",
      "last_posted_at": "2020-01-28T16:35:52.821Z",
      "bumped": true,
      "bumped_at": "2020-01-28T16:35:52.821Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1620,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 643,
            "username": "lehu",
            "name": "Leo Hu",
            "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 3,
        "username": "john_brownlee",
        "name": "John Brownlee",
        "avatar_template": "/user_avatar/forums.foundationdb.org/john_brownlee/{size}/22_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      },
      {
        "id": 724,
        "username": "larshagen",
        "name": "Lars Hagen",
        "avatar_template": "/user_avatar/forums.foundationdb.org/larshagen/{size}/776_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      }
    ],
    "created_by": {
      "id": 724,
      "username": "larshagen",
      "name": "Lars Hagen",
      "avatar_template": "/user_avatar/forums.foundationdb.org/larshagen/{size}/776_2.png"
    },
    "last_poster": {
      "id": 3,
      "username": "john_brownlee",
      "name": "John Brownlee",
      "avatar_template": "/user_avatar/forums.foundationdb.org/john_brownlee/{size}/22_2.png"
    },
    "links": [
      {
        "url": "https://github.com/FoundationDB/fdb-kubernetes-operator/blob/9c2cd190c88e4eae10e9a5bc4cab4fb50f66b0d4/controllers/pod_client.go#L104",
        "title": "fdb-kubernetes-operator/pod_client.go at 9c2cd190c88e4eae10e9a5bc4cab4fb50f66b0d4 \u00b7 FoundationDB/fdb-kubernetes-operator \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 11,
        "user_id": 724,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/FoundationDB/fdb-kubernetes-operator/blob/9c2cd190c88e4eae10e9a5bc4cab4fb50f66b0d4/controllers/generate_initial_cluster_file.go#L67",
        "title": "fdb-kubernetes-operator/generate_initial_cluster_file.go at 9c2cd190c88e4eae10e9a5bc4cab4fb50f66b0d4 \u00b7 FoundationDB/fdb-kubernetes-operator \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 3,
        "user_id": 724,
        "domain": "github.com",
        "root_domain": "github.com"
      }
    ]
  },
  "bookmarks": []
}