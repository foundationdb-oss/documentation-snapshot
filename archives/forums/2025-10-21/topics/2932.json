{
  "post_stream": {
    "posts": [
      {
        "id": 10082,
        "name": "Alan Muhammad",
        "username": "superhail",
        "avatar_template": "/user_avatar/forums.foundationdb.org/superhail/{size}/1191_2.png",
        "created_at": "2021-10-07T08:47:55.395Z",
        "cooked": "<p>As I read the source code of MasterProxy.actor.cpp, it seems that the logic of get commit version is like</p>\n<pre><code class=\"lang-auto\">wait(self-&gt;latestLocalCommitBatchResolving.whenAtLeast(localBatchNumber - 1));\nsome codes\nsend the commit version request\nwait for commit version reply\nsend resolving requests\nupdate latestLocalCommitBatchResolving to localBatchNumber asynchronously\nwait for resolving replies\n</code></pre>\n<aside class=\"onebox githubblob\" data-onebox-src=\"https://github.com/apple/foundationdb/blob/ddf85af360c8e38dc454dbd8c481ef2a7efddacb/fdbserver/MasterProxyServer.actor.cpp#L1056-L1233\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/apple/foundationdb/blob/ddf85af360c8e38dc454dbd8c481ef2a7efddacb/fdbserver/MasterProxyServer.actor.cpp#L1056-L1233\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <h4><a href=\"https://github.com/apple/foundationdb/blob/ddf85af360c8e38dc454dbd8c481ef2a7efddacb/fdbserver/MasterProxyServer.actor.cpp#L1056-L1233\" target=\"_blank\" rel=\"noopener nofollow ugc\">apple/foundationdb/blob/ddf85af360c8e38dc454dbd8c481ef2a7efddacb/fdbserver/MasterProxyServer.actor.cpp#L1056-L1233</a></h4>\n\n\n\n  <pre class=\"onebox\">    <code class=\"lang-cpp\">\n      <ol class=\"start lines\" start=\"1056\" style=\"counter-reset: li-counter 1055 ;\">\n          <li>ACTOR Future&lt;Void&gt; commitBatch(ProxyCommitData* self,</li>\n          <li>                               vector&lt;CommitTransactionRequest&gt; trs,</li>\n          <li>                               int currentBatchMemBytesCount) {</li>\n          <li>\t// WARNING: this code is run at a high priority (until the first delay(0)), so it needs to do as little work as</li>\n          <li>\t// possible</li>\n          <li>\tstate int64_t localBatchNumber = ++self-&gt;localCommitBatchesStarted;</li>\n          <li>\tstate LogPushData toCommit(self-&gt;logSystem);</li>\n          <li>\tstate double t1 = now();</li>\n          <li>\tstate Optional&lt;UID&gt; debugID;</li>\n          <li>\tstate bool forceRecovery = false;</li>\n          <li>\tstate int batchOperations = 0;</li>\n          <li>\tint64_t batchBytes = 0;</li>\n          <li>\tfor (int t = 0; t &lt; trs.size(); t++) {</li>\n          <li>\t\tbatchOperations += trs[t].transaction.mutations.size();</li>\n          <li>\t\tbatchBytes += trs[t].transaction.mutations.expectedSize();</li>\n          <li>\t}</li>\n          <li>\tstate int latencyBucket =</li>\n          <li>\t    batchOperations == 0</li>\n          <li>\t        ? 0</li>\n          <li>\t        : std::min&lt;int&gt;(SERVER_KNOBS-&gt;PROXY_COMPUTE_BUCKETS - 1,</li>\n      </ol>\n    </code>\n  </pre>\n\n  This file has been truncated. <a href=\"https://github.com/apple/foundationdb/blob/ddf85af360c8e38dc454dbd8c481ef2a7efddacb/fdbserver/MasterProxyServer.actor.cpp#L1056-L1233\" target=\"_blank\" rel=\"noopener nofollow ugc\">show original</a>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n<p>\nSo it seems to my for each proxy, there can be at most one get commit version request on the fly, as all the othe ones are queued by latestLocalCommitBatchResolving, so why is request number still necessary? I really don\u2019t get it.</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2021-10-07T08:51:00.464Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 8,
        "reads": 17,
        "readers_count": 16,
        "score": 43.4,
        "yours": false,
        "topic_id": 2932,
        "topic_slug": "questions-getcommitversionrequest-request-number-necessity",
        "display_username": "Alan Muhammad",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/blob/ddf85af360c8e38dc454dbd8c481ef2a7efddacb/fdbserver/MasterProxyServer.actor.cpp#L1056-L1233",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/MasterProxyServer.actor.cpp at ddf85af360c8e38dc454dbd8c481ef2a7efddacb \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 2
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 1006,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/questions-getcommitversionrequest-request-number-necessity/2932/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 10090,
        "name": "Markus Pilman",
        "username": "markus.pilman",
        "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
        "created_at": "2021-10-08T16:48:36.443Z",
        "cooked": "<p>Because we\u2019re sending this request at least once\u2026 Basically, if you call <code>send</code> or <code>getReply</code> on a <code>RequestStream&lt;T&gt;</code> we\u2019re in fact calling <code>sendReliable</code>. So if the connection to the master/sequencer is closed after we sent the request but before we received a response, we will automatically retry (send this request again).</p>\n<p>So the sequencer might get both (we don\u2019t know whether the first one was lost or not). Giving out two versions would cause problems (specifically, we would now create a hole in the version stream and at the resolve-step the resolver would block all transaction waiting for this hole to be filled). You can find the code that handles this in the master <a href=\"https://github.com/apple/foundationdb/blob/645cfc85a089e6aed62d274fdaca4f1a37be6d7e/fdbserver/masterserver.actor.cpp#L1154\">here</a>.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 2,
        "updated_at": "2021-10-08T16:48:36.443Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 13,
        "readers_count": 12,
        "score": 32.6,
        "yours": false,
        "topic_id": 2932,
        "topic_slug": "questions-getcommitversionrequest-request-number-necessity",
        "display_username": "Markus Pilman",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/blob/645cfc85a089e6aed62d274fdaca4f1a37be6d7e/fdbserver/masterserver.actor.cpp#L1154",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/masterserver.actor.cpp at 645cfc85a089e6aed62d274fdaca4f1a37be6d7e \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 3
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 2
          }
        ],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 15,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/questions-getcommitversionrequest-request-number-necessity/2932/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      10082,
      10090
    ]
  },
  "timeline_lookup": [
    [
      1,
      1476
    ],
    [
      2,
      1474
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Questions GetCommitVersionRequest request number necessity",
  "id": 2932,
  "title": "Questions GetCommitVersionRequest request number necessity",
  "posts_count": 2,
  "created_at": "2021-10-07T08:47:55.338Z",
  "views": 377,
  "reply_count": 0,
  "like_count": 2,
  "last_posted_at": "2021-10-08T16:48:36.443Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "questions-getcommitversionrequest-request-number-necessity",
  "category_id": 8,
  "word_count": 240,
  "deleted_at": null,
  "user_id": 1006,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_2932",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 2,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Questions on SERVER_KNOBS-&gt;MAX_COMMIT_BATCH_INTERVAL",
      "id": 2918,
      "title": "Questions on SERVER_KNOBS->MAX_COMMIT_BATCH_INTERVAL",
      "slug": "questions-on-server-knobs-max-commit-batch-interval",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2021-09-29T11:37:08.255Z",
      "last_posted_at": "2021-10-05T11:58:33.212Z",
      "bumped": true,
      "bumped_at": "2021-10-05T11:58:33.212Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 425,
      "category_id": 8,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest single",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 1006,
            "username": "superhail",
            "name": "Alan Muhammad",
            "avatar_template": "/user_avatar/forums.foundationdb.org/superhail/{size}/1191_2.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Understanding inter communication",
      "id": 745,
      "title": "Understanding inter communication",
      "slug": "understanding-inter-communication",
      "posts_count": 12,
      "reply_count": 7,
      "highest_post_number": 12,
      "image_url": null,
      "created_at": "2018-10-05T00:51:33.531Z",
      "last_posted_at": "2018-10-11T17:16:52.613Z",
      "bumped": true,
      "bumped_at": "2018-10-11T17:16:52.613Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 10,
      "views": 3588,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 384,
            "username": "Chandru4u",
            "name": "Chandrashekar",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/c/b487fb/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "VersionStamp vs CommittedVersion",
      "id": 600,
      "title": "VersionStamp vs CommittedVersion",
      "slug": "versionstamp-vs-committedversion",
      "posts_count": 7,
      "reply_count": 3,
      "highest_post_number": 7,
      "image_url": null,
      "created_at": "2018-07-30T06:50:38.826Z",
      "last_posted_at": "2018-09-17T19:43:14.827Z",
      "bumped": true,
      "bumped_at": "2018-09-17T19:43:14.827Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 3916,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 41,
            "username": "amirouche",
            "name": "Amirouche",
            "avatar_template": "/user_avatar/forums.foundationdb.org/amirouche/{size}/1911_2.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Implementing VersionStamps in bindings",
      "id": 250,
      "title": "Implementing VersionStamps in bindings",
      "slug": "implementing-versionstamps-in-bindings",
      "posts_count": 25,
      "reply_count": 18,
      "highest_post_number": 25,
      "image_url": null,
      "created_at": "2018-04-24T19:05:11.830Z",
      "last_posted_at": "2018-05-09T18:14:10.990Z",
      "bumped": true,
      "bumped_at": "2018-05-09T18:14:10.990Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 5417,
      "category_id": 8,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 156,
            "username": "spullara",
            "name": "Sam Pullara",
            "avatar_template": "/user_avatar/forums.foundationdb.org/spullara/{size}/125_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 120,
            "username": "josephg",
            "name": "Seph Gentle",
            "avatar_template": "/user_avatar/forums.foundationdb.org/josephg/{size}/84_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Java API Future patterns",
      "id": 596,
      "title": "Java API Future patterns",
      "slug": "java-api-future-patterns",
      "posts_count": 3,
      "reply_count": 0,
      "highest_post_number": 3,
      "image_url": null,
      "created_at": "2018-07-27T17:42:24.016Z",
      "last_posted_at": "2018-07-28T15:55:46.319Z",
      "bumped": true,
      "bumped_at": "2018-07-28T15:55:46.319Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 700,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 15,
        "username": "markus.pilman",
        "name": "Markus Pilman",
        "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      },
      {
        "id": 1006,
        "username": "superhail",
        "name": "Alan Muhammad",
        "avatar_template": "/user_avatar/forums.foundationdb.org/superhail/{size}/1191_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      }
    ],
    "created_by": {
      "id": 1006,
      "username": "superhail",
      "name": "Alan Muhammad",
      "avatar_template": "/user_avatar/forums.foundationdb.org/superhail/{size}/1191_2.png"
    },
    "last_poster": {
      "id": 15,
      "username": "markus.pilman",
      "name": "Markus Pilman",
      "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png"
    },
    "links": [
      {
        "url": "https://github.com/apple/foundationdb/blob/645cfc85a089e6aed62d274fdaca4f1a37be6d7e/fdbserver/masterserver.actor.cpp#L1154",
        "title": "foundationdb/masterserver.actor.cpp at 645cfc85a089e6aed62d274fdaca4f1a37be6d7e \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 3,
        "user_id": 15,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/apple/foundationdb/blob/ddf85af360c8e38dc454dbd8c481ef2a7efddacb/fdbserver/MasterProxyServer.actor.cpp#L1056-L1233",
        "title": "foundationdb/MasterProxyServer.actor.cpp at ddf85af360c8e38dc454dbd8c481ef2a7efddacb \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 2,
        "user_id": 1006,
        "domain": "github.com",
        "root_domain": "github.com"
      }
    ]
  },
  "bookmarks": []
}