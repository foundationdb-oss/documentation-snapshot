{
  "post_stream": {
    "posts": [
      {
        "id": 9031,
        "name": "Ashish Gupta",
        "username": "ashishgupta",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/a/c67d28/{size}.png",
        "created_at": "2021-02-01T09:27:01.662Z",
        "cooked": "<p>We run a cluster population automation that does the following -</p>\n<ol>\n<li>Starts a new, triple-replicated cluster on 5 machines (1 coordinator per machine).</li>\n<li>Transacts a custom metadata key into the database.</li>\n<li>Sets the replication factor to single.</li>\n<li>Populates the cluster using a number of clients transacting objects simultaneously in a loop.</li>\n<li>Once populated, we move it back to triple replication.</li>\n</ol>\n<p>We\u2019ve been facing issues where clients timeout in a read operation right at the beginning of step 4. The read operation is on the same key that was transacted in step 2. We dump the cluster status at such a time, and get the following -</p>\n<pre><code>fdbcli --exec \"status details\"\n\nLocking coordination state. Verify that a majority of coordination server\nprocesses are active.\n\n10.134.188.8:4271  (reachable)\n10.134.188.9:4271  (reachable)\n10.134.188.109:4271  (reachable)\n10.134.188.116:4271  (reachable)\n10.134.188.119:4271  (reachable)\n</code></pre>\n<p>Any insights into why the cluster might be stuck? This happens only sometimes, so hard to repro the exact scenario.</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 3,
        "updated_at": "2021-02-01T09:27:01.662Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 105,
        "reads": 42,
        "readers_count": 41,
        "score": 533.4,
        "yours": false,
        "topic_id": 2537,
        "topic_slug": "cluster-stuck-with-status-locked-coordination-state-even-when-all-coordination-servers-available",
        "display_username": "Ashish Gupta",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 747,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/cluster-stuck-with-status-locked-coordination-state-even-when-all-coordination-servers-available/2537/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 9033,
        "name": "",
        "username": "andrew.noyes",
        "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
        "created_at": "2021-02-01T17:28:58.858Z",
        "cooked": "<p>Can you look in the trace logs and see if there are any \u201cseverity 40\u201d events?</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 3,
        "updated_at": "2021-02-01T17:28:58.858Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 41,
        "readers_count": 40,
        "score": 18.2,
        "yours": false,
        "topic_id": 2537,
        "topic_slug": "cluster-stuck-with-status-locked-coordination-state-even-when-all-coordination-servers-available",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 14,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/cluster-stuck-with-status-locked-coordination-state-even-when-all-coordination-servers-available/2537/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 9045,
        "name": "Oleg Samarin",
        "username": "osamarin",
        "avatar_template": "/user_avatar/forums.foundationdb.org/osamarin/{size}/905_2.png",
        "created_at": "2021-02-04T12:29:32.253Z",
        "cooked": "<p><code>Locking coordination state</code> message means that FDB recovery is in progress. See</p><aside class=\"onebox githubblob\">\n  <header class=\"source\">\n      <a href=\"https://github.com/apple/foundationdb/blob/master/design/recovery-internals.md\" target=\"_blank\" rel=\"noopener nofollow ugc\">github.com</a>\n  </header>\n  <article class=\"onebox-body\">\n    <h4><a href=\"https://github.com/apple/foundationdb/blob/master/design/recovery-internals.md\" target=\"_blank\" rel=\"noopener nofollow ugc\">apple/foundationdb/blob/master/design/recovery-internals.md</a></h4>\n<pre><code class=\"lang-md\"># FDB Recovery Internals\n\nFDB uses recovery to handle various failures, such as hardware and network failures. When the current transaction system no longer works properly due to failures, recovery is automatically triggered to create a new generation of the transaction system.\n\nThis document explains at the high level how the recovery works in a single cluster. The audience of this document includes both FDB developers who want to have a basic understanding of the recovery process and database administrators who need to understand why a cluster fails to recover. This document does not discuss the complexity introduced to the recovery process by the multi-region configuration.\n\n## Background\n\n## `ServerDBInfo` data structure\n\nThis data structure contains transient information which is broadcast to all workers for a database, permitting them to communicate with each other. It contains, for example, the interfaces for cluster controller (CC), master, ratekeeper, and resolver, and holds the log system's configuration. Only part of the data structure, such as `ClientDBInfo` that contains the list of GRV proxies and commit proxies, is available to the client.\n\nWhenever a field of the `ServerDBInfo`is changed, the new value of the field, say new master's interface, will be sent to the CC and CC will propagate the new `ServerDBInfo` to all workers in the cluster.\n\n## When will recovery happen?\nFailure of certain roles in FDB can cause recovery. Those roles are cluster controller, master, GRV proxy, commit proxy, transaction logs (tLog), resolvers, log router, and backup workers.\n\nNetwork partition or failures can make CC unable to reach some roles, treating those roles as dead and causing recovery. If CC cannot connect to a majority of coordinators, it will be treated as dead by coordinators and recovery will happen.\n\nBetter master exists event can trigger recoveries. Better master exists event is the cluster changes such that there is a better location for some already recruited processes (say master role).\n</code></pre>\n\n  This file has been truncated. <a href=\"https://github.com/apple/foundationdb/blob/master/design/recovery-internals.md\" target=\"_blank\" rel=\"noopener nofollow ugc\">show original</a>\n\n  </article>\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n  <div style=\"clear: both\"></div>\n</aside>\n<p>\nfor details.</p>\n<p>Unfortunally, there is no any troubleshooting guide on the recovery stuck.</p>\n<p>Some similar issue that causes the same result is <a href=\"https://github.com/apple/foundationdb/issues/3925\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">The database gets unavailable after changing usable_regions \u00b7 Issue #3925 \u00b7 apple/foundationdb \u00b7 GitHub</a></p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 3,
        "updated_at": "2021-02-04T12:33:27.074Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 7,
        "reads": 39,
        "readers_count": 38,
        "score": 57.8,
        "yours": false,
        "topic_id": 2537,
        "topic_slug": "cluster-stuck-with-status-locked-coordination-state-even-when-all-coordination-servers-available",
        "display_username": "Oleg Samarin",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/issues/3925",
            "internal": false,
            "reflection": false,
            "title": "The database gets unavailable after changing usable_regions \u00b7 Issue #3925 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 21
          },
          {
            "url": "https://github.com/apple/foundationdb/blob/master/design/recovery-internals.md",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/recovery-internals.md at master \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 15
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 711,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/cluster-stuck-with-status-locked-coordination-state-even-when-all-coordination-servers-available/2537/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      9031,
      9033,
      9045
    ]
  },
  "timeline_lookup": [
    [
      1,
      1724
    ],
    [
      2,
      1723
    ],
    [
      3,
      1720
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Cluster stuck with status &ldquo;Locked coordination state&rdquo; even when all coordination servers available",
  "id": 2537,
  "title": "Cluster stuck with status \"Locked coordination state\" even when all coordination servers available",
  "posts_count": 3,
  "created_at": "2021-02-01T09:27:01.598Z",
  "views": 722,
  "reply_count": 0,
  "like_count": 1,
  "last_posted_at": "2021-02-04T12:29:32.253Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "cluster-stuck-with-status-locked-coordination-state-even-when-all-coordination-servers-available",
  "category_id": 7,
  "word_count": 246,
  "deleted_at": null,
  "user_id": 747,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_2537",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 3,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 3,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "&ldquo;Locking coordination state&rdquo; after losing a AZ on three_data_hall",
      "id": 4255,
      "title": "\"Locking coordination state\" after losing a AZ on three_data_hall",
      "slug": "locking-coordination-state-after-losing-a-az-on-three-data-hall",
      "posts_count": 2,
      "reply_count": 0,
      "highest_post_number": 2,
      "image_url": null,
      "created_at": "2023-11-27T08:56:37.616Z",
      "last_posted_at": "2024-02-28T10:03:14.406Z",
      "bumped": true,
      "bumped_at": "2024-02-28T10:03:14.406Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 241,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest single",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 872,
            "username": "COran",
            "name": "Carlito",
            "avatar_template": "/user_avatar/forums.foundationdb.org/coran/{size}/1006_2.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Locking coordination state. Verify that a majority of coordinattion server process are active. Single machine",
      "id": 2560,
      "title": "Locking coordination state. Verify that a majority of coordinattion server process are active. Single machine",
      "slug": "locking-coordination-state-verify-that-a-majority-of-coordinattion-server-process-are-active-single-machine",
      "posts_count": 5,
      "reply_count": 2,
      "highest_post_number": 5,
      "image_url": null,
      "created_at": "2021-02-16T23:20:12.154Z",
      "last_posted_at": "2021-03-08T20:52:08.046Z",
      "bumped": true,
      "bumped_at": "2021-03-08T20:52:08.046Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1182,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 885,
            "username": "jds",
            "name": "JD S",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/j/b19c9b/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 448,
            "username": "dongxinEric",
            "name": "Xin Dong",
            "avatar_template": "/user_avatar/forums.foundationdb.org/dongxineric/{size}/434_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 14,
            "username": "andrew.noyes",
            "name": "",
            "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Locking coordination state with DR",
      "id": 3330,
      "title": "Locking coordination state with DR",
      "slug": "locking-coordination-state-with-dr",
      "posts_count": 4,
      "reply_count": 1,
      "highest_post_number": 4,
      "image_url": null,
      "created_at": "2022-05-17T17:06:10.234Z",
      "last_posted_at": "2022-05-18T19:52:46.276Z",
      "bumped": true,
      "bumped_at": "2022-05-18T19:52:46.276Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 515,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 643,
            "username": "lehu",
            "name": "Leo Hu",
            "avatar_template": "/user_avatar/forums.foundationdb.org/lehu/{size}/995_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 711,
            "username": "osamarin",
            "name": "Oleg Samarin",
            "avatar_template": "/user_avatar/forums.foundationdb.org/osamarin/{size}/905_2.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Could not communicate with a quorum of coordination servers",
      "id": 2000,
      "title": "Could not communicate with a quorum of coordination servers",
      "slug": "could-not-communicate-with-a-quorum-of-coordination-servers",
      "posts_count": 3,
      "reply_count": 0,
      "highest_post_number": 3,
      "image_url": null,
      "created_at": "2020-03-03T22:43:21.635Z",
      "last_posted_at": "2020-03-05T16:51:23.670Z",
      "bumped": true,
      "bumped_at": "2020-03-05T16:51:23.670Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 2251,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 550,
            "username": "ntrhieu89",
            "name": "Hieu Nguyen",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ntrhieu89/{size}/587_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "&lsquo;Locking coordination&rsquo; state after process removal",
      "id": 1512,
      "title": "'Locking coordination' state after process removal",
      "slug": "locking-coordination-state-after-process-removal",
      "posts_count": 8,
      "reply_count": 6,
      "highest_post_number": 8,
      "image_url": null,
      "created_at": "2019-07-10T07:07:29.075Z",
      "last_posted_at": "2019-07-11T09:56:41.581Z",
      "bumped": true,
      "bumped_at": "2019-07-11T09:56:41.581Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 2124,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 410,
            "username": "Meai1",
            "name": "Meai1",
            "avatar_template": "/user_avatar/forums.foundationdb.org/meai1/{size}/541_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 81,
            "username": "ryanworl",
            "name": "Ryan Worl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
            "trust_level": 3
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 14,
        "username": "andrew.noyes",
        "name": "",
        "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 711,
        "username": "osamarin",
        "name": "Oleg Samarin",
        "avatar_template": "/user_avatar/forums.foundationdb.org/osamarin/{size}/905_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 747,
        "username": "ashishgupta",
        "name": "Ashish Gupta",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/a/c67d28/{size}.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      }
    ],
    "created_by": {
      "id": 747,
      "username": "ashishgupta",
      "name": "Ashish Gupta",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/a/c67d28/{size}.png"
    },
    "last_poster": {
      "id": 711,
      "username": "osamarin",
      "name": "Oleg Samarin",
      "avatar_template": "/user_avatar/forums.foundationdb.org/osamarin/{size}/905_2.png"
    },
    "links": [
      {
        "url": "https://github.com/apple/foundationdb/issues/3925",
        "title": "The database gets unavailable after changing usable_regions \u00b7 Issue #3925 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 21,
        "user_id": 711,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/apple/foundationdb/blob/master/design/recovery-internals.md",
        "title": "foundationdb/recovery-internals.md at master \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 15,
        "user_id": 711,
        "domain": "github.com",
        "root_domain": "github.com"
      }
    ]
  },
  "bookmarks": []
}