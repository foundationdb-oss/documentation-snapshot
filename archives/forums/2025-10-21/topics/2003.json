{
  "post_stream": {
    "posts": [
      {
        "id": 6416,
        "name": "Dmitri G",
        "username": "dmitrig01",
        "avatar_template": "/user_avatar/forums.foundationdb.org/dmitrig01/{size}/791_2.png",
        "created_at": "2020-03-04T21:02:28.451Z",
        "cooked": "<p>We\u2019re using FDB with the FDB record layer, though this question isn\u2019t specific to the record layer.</p>\n<p>We recently ran a large data job that made a lot of FDB calls. Our monitoring saw that the storage_server_durability_lag was going up. In the past, when this has happened for a sustained period of time, it\u2019s caused the cluster to become unhealthy. This time, luckily we were able to catch it and stop the job.</p>\n<p>In the future, we\u2019d like to have whatever is doing transactions against FDB be able to auto-detect this kind of situation, and slow down the data load, so it doesn\u2019t put too much load on FoundationDB. It seems right now, the client is just going as fast as it can, without regard for server health. We\u2019d like to be able to limit the client\u2019s interactions with the server to a healthy level. Ideally, not fail, but just slow things down to a manageable level.</p>\n<p>Is there a recommended way to do this?</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2020-03-04T21:02:28.451Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 170,
        "reads": 49,
        "readers_count": 48,
        "score": 874.8,
        "yours": false,
        "topic_id": 2003,
        "topic_slug": "backpressure-against-data-pipelines",
        "display_username": "Dmitri G",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 735,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/backpressure-against-data-pipelines/2003/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 6421,
        "name": "gaurav",
        "username": "gaurav",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
        "created_at": "2020-03-05T12:50:57.406Z",
        "cooked": "<p>There are two ways in which clients can adjust transaction rate in face of cluster saturation:</p>\n<ol>\n<li>\n<p>FDB <code>Ratekeeper</code> keeps track of different buffers and lags in the cluster and influences <code>proxies</code> to increase the latency in handing out <code>ReadVersion</code> as part of starting new transactions. This results in automatic throttling of transactions and thereby reducing cluster load.</p>\n</li>\n<li>\n<p>Clients can periodically (every minute or so) query the cluster status (<code>\\xff\\xff/status/json</code>) and then throttle their activity workload if the status indicates possibility of cluster saturation.</p>\n</li>\n</ol>\n<p>You mentioned that in past a sustained high transaction rate caused cluster to become unhealthy - what was the issue observed? Was it just that new transaction took significantly longer to start (due to proxy throttling), or was it some other issue?</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2020-03-06T02:24:40.918Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 4,
        "reads": 47,
        "readers_count": 46,
        "score": 29.4,
        "yours": false,
        "topic_id": 2003,
        "topic_slug": "backpressure-against-data-pipelines",
        "display_username": "gaurav",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 166,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/backpressure-against-data-pipelines/2003/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 6425,
        "name": "",
        "username": "rcbranch",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/82dd89/{size}.png",
        "created_at": "2020-03-05T21:16:15.304Z",
        "cooked": "<p><a class=\"mention\" href=\"/u/gaurav\">@gaurav</a> We are running FDB version 6.1.8 with RF=3 and the main impact that we are seeing, when the cluster is running a heavy workload, is that the storage &amp; transaction log queues continue to grow in size and the clients don\u2019t seem to be throttling. The storage durability lag increases to the order of minutes and the database becomes unhealthy.</p>\n<p>My understanding is that the ratekeeper should kick in and the clients should be throttling before the database becomes unhealthy but that never seems to happen.</p>\n<p>As far as I know we run our transactions with default priority &amp; are not seeing any impact to default transaction latencies.</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2020-03-05T21:16:15.304Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 43,
        "readers_count": 42,
        "score": 28.6,
        "yours": false,
        "topic_id": 2003,
        "topic_slug": "backpressure-against-data-pipelines",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 622,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/backpressure-against-data-pipelines/2003/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 6426,
        "name": "Alex Miller",
        "username": "alexmiller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "created_at": "2020-03-06T01:46:42.486Z",
        "cooked": "<p>Yeah\u2026 Ratekeeper is supposed to be kicking in exactly in that circumstance\u2026</p>\n<ul>\n<li>Could you hunt down and post some RkUpdate trace events from when your cluster is unhealthy and it should be throttled?</li>\n<li>Are you doing any sort of read version caching in your clients that would cause you to potentially bypass ratekeeper?</li>\n<li>Do you know if this is a read-heavy workload or a write heavy workload?</li>\n</ul>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2020-03-06T01:47:27.716Z",
        "reply_count": 0,
        "reply_to_post_number": 3,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 42,
        "readers_count": 41,
        "score": 23.4,
        "yours": false,
        "topic_id": 2003,
        "topic_slug": "backpressure-against-data-pipelines",
        "display_username": "Alex Miller",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 622,
          "username": "rcbranch",
          "name": "",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/82dd89/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 13,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/backpressure-against-data-pipelines/2003/4",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 6428,
        "name": "",
        "username": "rcbranch",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/82dd89/{size}.png",
        "created_at": "2020-03-06T03:45:36.649Z",
        "cooked": "<p>Hi <a class=\"mention\" href=\"/u/alexmiller\">@alexmiller</a>,</p>\n<ol>\n<li>\n<p>I dug through the available trace logs from when our database was unhealthy but couldn\u2019t find  any RkUpdate events during that period. The only RkUpdate trace events that I could find are from trace logs when I first brought up the cluster. We will try to simulate the condition again and I\u2019ll try to collect any events.</p>\n</li>\n<li>\n<p>Afaik, we aren\u2019t doing anything special client-side for read version caching.</p>\n</li>\n<li>\n<p>We have a read-then-write workload but the read-to-write ratio is 4:1.</p>\n</li>\n</ol>\n<p>One thing that I learned here: <a href=\"https://forums.foundationdb.org/t/what-do-you-monitor/184/21\" class=\"inline-onebox\">What do you monitor?</a> is this: <code>When the queues reach a certain threshold (currently 900 MB on storage, 1.6GB on logs), ratekeeper will slowly start to throttle transactions. If the queue continues to grow, the throttling becomes more aggressive, attempting to achieve certain limits (1GB on storage, 2GB on logs). It may be worth noting, though, that ratekeeper will let 1 fault domain\u2019s worth of storage servers fall arbitrarily far behind without throttling, in which case the storage server will eventually stop trying to fetch new data when it reaches what we call the e-brake (1.5GB).</code></p>\n<p>For us when the database was unhealthy, one of our storage processes had peak queue size at 1.08GB but the rest of storage processes were &lt;560MB and all tx log processes had a queue size at ~515MB. Could it be that because of these conditions, while suboptimal but not critical, the RK throttling never kicked in?</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2020-03-06T04:19:54.125Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 41,
        "readers_count": 40,
        "score": 13.2,
        "yours": false,
        "topic_id": 2003,
        "topic_slug": "backpressure-against-data-pipelines",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://forums.foundationdb.org/t/what-do-you-monitor/184/21",
            "internal": true,
            "reflection": false,
            "title": "What do you monitor?",
            "clicks": 5
          }
        ],
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 622,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/backpressure-against-data-pipelines/2003/5",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 6429,
        "name": "Alex Miller",
        "username": "alexmiller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "created_at": "2020-03-06T09:40:58.507Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"rcbranch\" data-post=\"5\" data-topic=\"2003\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/rcbranch/48/782_2.png\" class=\"avatar\"> rcbranch:</div>\n<blockquote>\n<p>but couldn\u2019t find any RkUpdate events during that period</p>\n</blockquote>\n</aside>\n<p>You <em>should</em> be getting an RkUpdate trace event every 5 seconds.  You can <code>grep -P 'Roles=.*?RK.*?' trace.xml</code> to scrape to make sure you\u2019re collecting traces from that process at all.  If not, then that seems like a suspicious gap.  Either you\u2019re somehow missing the process\u2019s logs, or your FDB cluster is completely unavailable during that time and I\u2019m going to want to peek at all trace events that match <code>Type=\"MasterRecover.*\"</code> to figure out where in recovery you\u2019re stuck.</p>\n<aside class=\"quote no-group\" data-username=\"rcbranch\" data-post=\"5\" data-topic=\"2003\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/rcbranch/48/782_2.png\" class=\"avatar\"> rcbranch:</div>\n<blockquote>\n<p>For us when the database was unhealthy, one of our storage processes had peak queue size at 1.08GB but the rest of storage processes were &lt;560MB and all tx log processes had a queue size at ~515MB. Could it be that because of these conditions, while suboptimal but not critical, the RK throttling never kicked in?</p>\n</blockquote>\n</aside>\n<p>Yes, it sounds like Ratekeeper wouldn\u2019t be limiting due to storage or log queues.  However, you mentioned that storage servers were minutes behind, and Ratekeeper will also limit based on how far your storage servers are behind in terms of versions (and thus time).  So if you do have more than one storage server per team that\u2019s minutes behind in applying mutations, then that should also cause the cluster to be heavily throttled.  I\u2019m still struggling to figure out how your cluster would be unhealthy in a way that Ratekeeper wouldn\u2019t catch.</p>\n<p>If you can share a small window of some TLogMetrics and StorageMetrics from the unhealthy time along with the RkUpdate logs, that\u2019d be great.</p>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2020-03-06T09:40:58.507Z",
        "reply_count": 0,
        "reply_to_post_number": 5,
        "quote_count": 1,
        "incoming_link_count": 4,
        "reads": 39,
        "readers_count": 38,
        "score": 27.8,
        "yours": false,
        "topic_id": 2003,
        "topic_slug": "backpressure-against-data-pipelines",
        "display_username": "Alex Miller",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 13,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/backpressure-against-data-pipelines/2003/6",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 6431,
        "name": "",
        "username": "rcbranch",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/82dd89/{size}.png",
        "created_at": "2020-03-06T21:50:41.088Z",
        "cooked": "<p><a class=\"mention\" href=\"/u/alexmiller\">@alexmiller</a> I increased the log file sizes for our cluster as it was at the default sizes and I think the original logs got rotated. We were able to recreate the situation and I have <code>RkUpdate</code> trace logs &amp; observed tx log &amp; storage metrics here: <a href=\"https://gist.github.com/rclerk-branch/a77edcef6256598b8bfb2823a70e5224\" rel=\"nofollow noopener\">https://gist.github.com/rclerk-branch/a77edcef6256598b8bfb2823a70e5224</a>. I\u2019ve also attached observed metrics for TLog &amp; storage queues.</p>\n<p>While monitoring live, it seems that Ratekeeper does kick in when FDB is unhealthy and the storage durability lag is climbing, but it seems to be more relaxed and doesn\u2019t try to be very aggressive. It seems to be happy with the suboptimal perf and doesn\u2019t think it\u2019s critical.</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2020-03-06T21:50:41.088Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 36,
        "readers_count": 35,
        "score": 27.2,
        "yours": false,
        "topic_id": 2003,
        "topic_slug": "backpressure-against-data-pipelines",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://gist.github.com/rclerk-branch/a77edcef6256598b8bfb2823a70e5224",
            "internal": false,
            "reflection": false,
            "title": "fdb_rkupdate_logs.txt \u00b7 GitHub",
            "clicks": 6
          }
        ],
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 622,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/backpressure-against-data-pipelines/2003/7",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 6433,
        "name": "Alex Miller",
        "username": "alexmiller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "created_at": "2020-03-07T02:01:03.526Z",
        "cooked": "<p>Looking at all of this\u2026 I\u2019m not\u2026 actually sure what is unhealthy?  Your RkUpdate says that your storage servers are keeping up in fetching data from the transaction logs, so your clients should still be able to do reads just fine.  Which appears to be true, as your read and write latencies don\u2019t look impacted.  I\u2019ll agree that that you have storage servers with a large queue of data to write to disk, but they\u2019re not yet at the point where we\u2019ll limit based on that, and the only thing that should be impacting is storage queue size and transaction log queue size, (due to buffering the data in memory on the storage, and not popping it from TLogs, respectively).</p>\n<p>So, I\u2019ll agree that this cluster doesn\u2019t look like it\u2019s the happiest, but I also don\u2019t see any signs of it being bad in any way that should impact your workload?  Could you expand on what sort of unhealthyness that you\u2019re seeing?</p>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2020-03-07T02:01:03.526Z",
        "reply_count": 1,
        "reply_to_post_number": 7,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 36,
        "readers_count": 35,
        "score": 12.2,
        "yours": false,
        "topic_id": 2003,
        "topic_slug": "backpressure-against-data-pipelines",
        "display_username": "Alex Miller",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 622,
          "username": "rcbranch",
          "name": "",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/82dd89/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 13,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/backpressure-against-data-pipelines/2003/8",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 6443,
        "name": "",
        "username": "rcbranch",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/82dd89/{size}.png",
        "created_at": "2020-03-09T15:19:54.676Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"alexmiller\" data-post=\"8\" data-topic=\"2003\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/alexmiller/48/326_2.png\" class=\"avatar\"> alexmiller:</div>\n<blockquote>\n<p>Looking at all of this\u2026 I\u2019m not\u2026 actually sure what is unhealthy? Your RkUpdate says that your storage servers are keeping up in fetching data from the transaction logs, so your clients should still be able to do reads just fine. Which appears to be true, as your read and write latencies don\u2019t look impacted. I\u2019ll agree that that you have storage servers with a large queue of data to write to disk, but they\u2019re not yet at the point where we\u2019ll limit based on that, and the only thing that should be impacting is storage queue size and transaction log queue size, (due to buffering the data in memory on the storage, and not popping it from TLogs, respectively).</p>\n</blockquote>\n</aside>\n<p>Thanks for the insight. This is helpful to understand. Given that this is my first time operating FDB, I wasn\u2019t certain as to whether this is healthy behavior or a concerning pattern.</p>\n<aside class=\"quote no-group\" data-username=\"alexmiller\" data-post=\"8\" data-topic=\"2003\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/alexmiller/48/326_2.png\" class=\"avatar\"> alexmiller:</div>\n<blockquote>\n<p>Could you expand on what sort of unhealthyness that you\u2019re seeing?</p>\n</blockquote>\n</aside>\n<p>Since <code>fdbmonitor</code> reports the database status being unhealthy, there was a concern whether this pattern of suboptimal perf is concerning over long periods of time. Also, given that we weren\u2019t seeing Ratekeeper in action very often, likely because we are under the ops threshold when it really kicks in, it caused confusion as to whether we need to implement some application logic to do so.</p>\n<p>After conducting more experiments last week, we did see Ratekeeper kick in actively as we continued to push the write workload. The only thing we noticed, as we left the heavy write workload running for a longer period of time, is that Ratekeeper keeps the storage &amp; tlog queues at manageable levels but doesn\u2019t aggressively try to bring them down, which might be expected behavior but not something that I was aware of beforehand.</p>\n<p>We have a better understanding of the Ratekeeper thresholds and patterns now. Appreciate your patience and guidance!</p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 9,
        "updated_at": "2020-03-09T15:19:54.676Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 1,
        "incoming_link_count": 3,
        "reads": 35,
        "readers_count": 34,
        "score": 37.0,
        "yours": false,
        "topic_id": 2003,
        "topic_slug": "backpressure-against-data-pipelines",
        "display_username": "",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": "",
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 622,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/backpressure-against-data-pipelines/2003/9",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      6416,
      6421,
      6425,
      6426,
      6428,
      6429,
      6431,
      6433,
      6443
    ]
  },
  "timeline_lookup": [
    [
      1,
      2057
    ],
    [
      2,
      2056
    ],
    [
      7,
      2055
    ],
    [
      9,
      2052
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Backpressure against data pipelines",
  "id": 2003,
  "title": "Backpressure against data pipelines",
  "posts_count": 9,
  "created_at": "2020-03-04T21:02:28.384Z",
  "views": 1548,
  "reply_count": 3,
  "like_count": 3,
  "last_posted_at": "2020-03-09T15:19:54.676Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "backpressure-against-data-pipelines",
  "category_id": 7,
  "word_count": 1658,
  "deleted_at": null,
  "user_id": 735,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_2003",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 9,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 4,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "How does Ratekeeper actually _work_, and can I tune it?",
      "id": 3616,
      "title": "How does Ratekeeper actually _work_, and can I tune it?",
      "slug": "how-does-ratekeeper-actually-work-and-can-i-tune-it",
      "posts_count": 7,
      "reply_count": 3,
      "highest_post_number": 7,
      "image_url": null,
      "created_at": "2022-10-21T12:03:45.959Z",
      "last_posted_at": "2022-10-27T22:18:55.325Z",
      "bumped": true,
      "bumped_at": "2022-10-27T22:18:55.325Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 612,
      "category_id": 17,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 1142,
            "username": "danm",
            "name": "Dan Meyers",
            "avatar_template": "/user_avatar/forums.foundationdb.org/danm/{size}/1393_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 14,
            "username": "andrew.noyes",
            "name": "",
            "avatar_template": "/user_avatar/forums.foundationdb.org/andrew.noyes/{size}/443_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 156,
            "username": "spullara",
            "name": "Sam Pullara",
            "avatar_template": "/user_avatar/forums.foundationdb.org/spullara/{size}/125_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Best strategy to handle client overload",
      "id": 2281,
      "title": "Best strategy to handle client overload",
      "slug": "best-strategy-to-handle-client-overload",
      "posts_count": 10,
      "reply_count": 7,
      "highest_post_number": 10,
      "image_url": null,
      "created_at": "2020-08-07T11:19:41.205Z",
      "last_posted_at": "2020-08-11T17:36:09.721Z",
      "bumped": true,
      "bumped_at": "2020-08-12T17:48:54.031Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "bindings",
        "performance"
      ],
      "tags_descriptions": {},
      "like_count": 4,
      "views": 1238,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 393,
            "username": "ex3ndr",
            "name": "Steve Korshakov",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 337,
            "username": "mengxu",
            "name": "Meng Xu",
            "avatar_template": "/user_avatar/forums.foundationdb.org/mengxu/{size}/893_2.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "FDB cluster freeze",
      "id": 3862,
      "title": "FDB cluster freeze",
      "slug": "fdb-cluster-freeze",
      "posts_count": 13,
      "reply_count": 5,
      "highest_post_number": 13,
      "image_url": null,
      "created_at": "2023-03-18T00:41:44.956Z",
      "last_posted_at": "2023-03-22T16:47:58.611Z",
      "bumped": true,
      "bumped_at": "2023-03-22T16:47:58.611Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 448,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 1104,
            "username": "chetan_pg",
            "name": "chetan",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/c/d6d6ee/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 454,
            "username": "jzhou",
            "name": "Jingyu Zhou",
            "avatar_template": "/user_avatar/forums.foundationdb.org/jzhou/{size}/445_2.png",
            "admin": true,
            "moderator": true,
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 164,
            "username": "Imperatorx",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/i/d2c977/{size}.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Storage Server CPU bottleneck - Growing data lag",
      "id": 2234,
      "title": "Storage Server CPU bottleneck - Growing data lag",
      "slug": "storage-server-cpu-bottleneck-growing-data-lag",
      "posts_count": 23,
      "reply_count": 18,
      "highest_post_number": 23,
      "image_url": "https://global.discourse-cdn.com/foundationdb/optimized/1X/e472648513de0e881bd62213804d5e43f9510ace_2_1023x568.png",
      "created_at": "2020-07-08T13:46:58.378Z",
      "last_posted_at": "2021-12-13T09:55:15.976Z",
      "bumped": true,
      "bumped_at": "2021-12-13T10:47:15.543Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "performance"
      ],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 3083,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 744,
            "username": "v-pap",
            "name": "",
            "avatar_template": "/user_avatar/forums.foundationdb.org/v-pap/{size}/936_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 7,
            "username": "SteavedHams",
            "name": "Steve Atherton",
            "avatar_template": "/user_avatar/forums.foundationdb.org/steavedhams/{size}/18_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 711,
            "username": "osamarin",
            "name": "Oleg Samarin",
            "avatar_template": "/user_avatar/forums.foundationdb.org/osamarin/{size}/905_2.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Troubles scaling up the cluster",
      "id": 751,
      "title": "Troubles scaling up the cluster",
      "slug": "troubles-scaling-up-the-cluster",
      "posts_count": 32,
      "reply_count": 26,
      "highest_post_number": 32,
      "image_url": null,
      "created_at": "2018-10-08T03:24:54.004Z",
      "last_posted_at": "2018-11-01T16:26:01.527Z",
      "bumped": true,
      "bumped_at": "2018-11-01T16:26:01.527Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 3747,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 311,
            "username": "ThomasJ",
            "name": "Thomas Johson",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/t/6f9a4e/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 15,
            "username": "markus.pilman",
            "name": "Markus Pilman",
            "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 255,
            "username": "aqua",
            "name": "Matt Lohier",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/a/b9bd4f/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 622,
        "username": "rcbranch",
        "name": "",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/82dd89/{size}.png",
        "post_count": 4,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      },
      {
        "id": 13,
        "username": "alexmiller",
        "name": "Alex Miller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "post_count": 3,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 4
      },
      {
        "id": 166,
        "username": "gaurav",
        "name": "gaurav",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 3
      },
      {
        "id": 735,
        "username": "dmitrig01",
        "name": "Dmitri G",
        "avatar_template": "/user_avatar/forums.foundationdb.org/dmitrig01/{size}/791_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      }
    ],
    "created_by": {
      "id": 735,
      "username": "dmitrig01",
      "name": "Dmitri G",
      "avatar_template": "/user_avatar/forums.foundationdb.org/dmitrig01/{size}/791_2.png"
    },
    "last_poster": {
      "id": 622,
      "username": "rcbranch",
      "name": "",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/82dd89/{size}.png"
    },
    "links": [
      {
        "url": "https://gist.github.com/rclerk-branch/a77edcef6256598b8bfb2823a70e5224",
        "title": "fdb_rkupdate_logs.txt \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 6,
        "user_id": 622,
        "domain": "gist.github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://forums.foundationdb.org/t/what-do-you-monitor/184/21",
        "title": "What do you monitor?",
        "internal": true,
        "attachment": false,
        "reflection": false,
        "clicks": 5,
        "user_id": 622,
        "domain": "forums.foundationdb.org",
        "root_domain": "foundationdb.org"
      }
    ]
  },
  "bookmarks": []
}