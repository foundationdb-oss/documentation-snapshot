{
  "post_stream": {
    "posts": [
      {
        "id": 4229,
        "name": "Ricky Saltzer",
        "username": "ricky.saltzer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png",
        "created_at": "2019-05-30T20:58:21.179Z",
        "cooked": "<p>Hi!</p>\n<p>I\u2019m currently running a POC for a new project that will use FoundationDB as its backend. The workload is inherently bursty and has a mix of read and write workload (20/80 I\u2019d say).</p>\n<p>My current configuration is the following</p>\n<pre><code>Configuration:\nRedundancy mode        - triple\nStorage engine         - ssd-2\nCoordinators           - 7\nDesired Proxies        - 7\nDesired Resolvers      - 3\nDesired Logs           - 3\n\nCluster:\nFoundationDB processes - 72\nMachines               - 18\nMemory availability    - 3.7 GB per process on machine with least available\n                       &gt;&gt;&gt;&gt;&gt; (WARNING: 4.0 GB recommended) &lt;&lt;&lt;&lt;&lt;\nRetransmissions rate   - 0 Hz\nFault Tolerance        - 2 machines\nServer time            - 05/30/19 16:46:55\n</code></pre>\n<p>Each of machines are running on <code>c5d.2xlarge</code> instance types. I currently have three dedicated machines (4 processes on each) dedicated to the <code>stateless</code> class. So, 12 <code>stateless</code> processes in total.</p>\n<p>My <strong>issue</strong> is the following:</p>\n<p>I cannot get the cluster to recruit more than one resolver. I\u2019ve set the desired amount to 3. I\u2019ve even gone as far as to manually <code>setclass &lt;ip:port&gt; resolution</code>, but for some reason FDB is refusing to recruit any additional process as a <code>resolver</code>.</p>\n<p>The odd part is, some of my <code>stateless</code> processes have <strong>zero</strong> roles assigned to them. So you\u2019d think they\u2019d be perfect candidates for the role.</p>\n<p>Normally this wouldn\u2019t be an issue, but it seems that the <code>resolver</code> is in fact becoming my bottleneck. My write throughput starts hitting a ceiling at around 250k Hz with my <code>resolver</code> process\u2019s CPU maxed out at 100%.</p>\n<p>I\u2019ve attached a recent [1] <code>status json</code> report for anybody who is willing to help <img src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=9\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"></p>\n<p>Most notably, if you search for <code>10.49.58.119:4503</code> you will see that the class type is set to <code>resolution</code>, yet the process has <strong>zero</strong> roles assigned to it.</p>\n<p>[1] <a href=\"https://gist.github.com/rickysaltzer/cf6327a26a7fc45a553253f1ed51e19a\" rel=\"nofollow noopener\">https://gist.github.com/rickysaltzer/cf6327a26a7fc45a553253f1ed51e19a</a></p>\n<p>Ricky</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-05-30T20:58:21.179Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 527,
        "reads": 123,
        "readers_count": 122,
        "score": 2664.6,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ricky Saltzer",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://gist.github.com/rickysaltzer/cf6327a26a7fc45a553253f1ed51e19a",
            "internal": false,
            "reflection": false,
            "title": "status.json \u00b7 GitHub",
            "clicks": 12
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 369,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 4231,
        "name": "Bhaskar Muppana",
        "username": "mbhaskar",
        "avatar_template": "/user_avatar/forums.foundationdb.org/mbhaskar/{size}/277_2.png",
        "created_at": "2019-05-30T22:46:12.186Z",
        "cooked": "<p>I don\u2019t know much about increasing resolvers, I will let someone else answer that.</p>\n<p>But, if the resolver is the only process CPU bound and all other processes are doing good, probably it\u2019s worth reviewing the data model. You should check and make sure you are not generating too many conflict ranges.</p>\n<p>If you have too many point-gets or sets, that could cause too many conflict ranges. Then, resolvers have to do too many range comparisons. Instead, if you find a smallest overlapping range and add that as the conflict range that would be better for resolver performance.</p>\n<p>Document Layer inserts can be a very good example here. Document Layer stores each JSON field in a different FDB key with the same prefix. For example, let\u2019s say I have a document in the collection <code>employee</code> looking like</p>\n<pre><code class=\"lang-json\">{\n  \"_id\": 345,\n  \"name\": \"Eric\",\n  \"marks\": 90,\n  \"grade\": A\n}\n</code></pre>\n<p>Note that <code>_id</code> is the primary key. So, the document is stored with key <code>_id</code>. This would be stored under 4 different keys</p>\n<pre><code class=\"lang-auto\">employee:345: -&gt; _\nemployee:345:name -&gt; Eric\nemployee:345:marks -&gt; 90\nemployee:345:grade -&gt; A\n</code></pre>\n<p>When you insert these keys, it will create 4 write conflict ranges, one per each key. If my document can have embedded documents with deep arrays, this could get much worse. This keeps resolver super busy. To avoid this document layer explicitly adds a write conflict range covering all keys. In this case, adds the conflict range for prefix <code>employee:345:</code>. That would reduce the work for resolver 4 times, depending on the document size this could make or break.</p>\n<p>If you already made sure that\u2019s not the case, just ignore this <img src=\"https://emoji.discourse-cdn.com/twitter/slight_smile.png?v=9\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\"></p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-05-30T22:46:12.186Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 259,
        "reads": 108,
        "readers_count": 107,
        "score": 1331.6,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Bhaskar Muppana",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 9,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4232,
        "name": "Ricky Saltzer",
        "username": "ricky.saltzer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png",
        "created_at": "2019-05-30T22:58:42.298Z",
        "cooked": "<p>Hey thanks for your response.</p>\n<p>To be transparent, I am using RecordLayer for the workload.</p>\n<p>I designed the model to have as few conflicts as possible. Last time I looked during the peak of the workload there was maybe 1-3Hz of conflicts.</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-05-30T22:58:42.298Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 104,
        "readers_count": 103,
        "score": 20.8,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ricky Saltzer",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 369,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4234,
        "name": "Alex Miller",
        "username": "alexmiller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "created_at": "2019-05-31T00:54:11.829Z",
        "cooked": "<p>Can you <code>fdbcli&gt; kill; kill all</code> and see if you get a second resolver?  (or, really, anything to cause a recovery)</p>\n<p>My suspicion is that BetterMasterExists didn\u2019t catch that <code>set_class</code> changing a storage server to a resolver generates a cluster layout that better fits your desired configuration, and thus didn\u2019t cause a recovery to trigger recruiting a second resolver.  Otherwise, Evan and I don\u2019t see anything in the recruitment logic that would explain why you aren\u2019t getting a second resolver recruited.  Admittedly, our operational tooling doesn\u2019t use <code>set_class</code>, so it wouldn\u2019t entirely surprise me if there was some small bug/bad interaction like this lurking.</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-05-31T00:54:30.874Z",
        "reply_count": 2,
        "reply_to_post_number": 1,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 102,
        "readers_count": 101,
        "score": 60.4,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Alex Miller",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 369,
          "username": "ricky.saltzer",
          "name": "Ricky Saltzer",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 13,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/4",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4235,
        "name": "Ryan Worl",
        "username": "ryanworl",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
        "created_at": "2019-05-31T01:00:57.356Z",
        "cooked": "<p>This is what I recommended yesterday when this issue first came up for them, but not with that exact syntax. I just said kill -9 a proxy to trigger a recovery. They were on the three_datacenter config (and now changed to triple) which may be related (not sure how that interacts with recruitment).</p>\n<p>Is there anything that would be exposed in the logs to help diagnose this?</p>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-05-31T01:01:27.039Z",
        "reply_count": 2,
        "reply_to_post_number": 4,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 101,
        "readers_count": 100,
        "score": 40.2,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ryan Worl",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 13,
          "username": "alexmiller",
          "name": "Alex Miller",
          "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 81,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/5",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4236,
        "name": "Ricky Saltzer",
        "username": "ricky.saltzer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png",
        "created_at": "2019-05-31T03:35:14.506Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"alexmiller\" data-post=\"4\" data-topic=\"1414\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/alexmiller/48/326_2.png\" class=\"avatar\"> alexmiller:</div>\n<blockquote>\n<p>Can you <code>fdbcli&gt; kill; kill all</code> and see if you get a second resolver</p>\n</blockquote>\n</aside>\n<p>That\u2019s a neat trick for force reinitializing the database topology! Unfortunately, it doesn\u2019t seem to solve the predicament I\u2019m currently in.</p>\n<pre><code class=\"lang-auto\">&gt;&gt;&gt; kill all\nAttempted to kill 72 processes\n...\n$ fdbcli -C /tmp/fdb.cluster.grants --exec \"status json\" | grep -B3 '\\\"role\\\" : \\\"resolver\\\"'\n                \"roles\" : [\n                    {\n                        \"id\" : \"bc51311e0dedf06f\",\n                        \"role\" : \"resolver\"\n</code></pre>\n<p>Since this is becoming more and more likely attributed to a bug, I think it might be worth mentioning the origin of this database\u2019s topology.</p>\n<p>Back when we first started using FoundationDB for other use cases, we created a terraform script that orchestrated everything. Unfortunately, we didn\u2019t fully understand the best way to deploy a cluster, and so, every node was homogeneous with the same configuration.</p>\n<ul>\n<li><strong>4 processes per machine</strong> (three_datacenter mode)</li>\n<li>\n<ul>\n<li>(2) storage processes</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>(1) transaction process</li>\n</ul>\n</li>\n<li>\n<ul>\n<li>(1) stateless process</li>\n</ul>\n</li>\n</ul>\n<p>With that being said\u2026with 18 machines, we originally, we had <strong>18</strong> <code>stateless</code>,  <strong>18</strong> <code>transaction</code> processes, and <strong>36</strong> <code>storage</code> processes.</p>\n<p>We\u2019ve since learned we don\u2019t need so many <code>transaction</code> and <code>stateless</code> processes. And so, we downgraded to running only <strong>7</strong> <code>stateless</code> and <strong>3</strong> <code>transaction</code> processes.</p>\n<p>Some of this was done via the <code>foundationdb.conf</code> and some were through the <code>setclass</code> command.</p>\n<p>FWIW - Our other cluster which uses <code>three_datacenter</code> mode, and has 56 machines / 216 processes <strong>still</strong> only has <strong>ONE</strong> resolver. This cluster still uses our old topology, and so, there are a total of <strong>54</strong> <code>stateless</code> processes running inside it.</p>\n<p>Thank you so much for your help!<br>\nRicky</p>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-05-31T03:35:14.506Z",
        "reply_count": 0,
        "reply_to_post_number": 4,
        "quote_count": 1,
        "incoming_link_count": 7,
        "reads": 100,
        "readers_count": 99,
        "score": 55.0,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ricky Saltzer",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 369,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/6",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4237,
        "name": "Ricky Saltzer",
        "username": "ricky.saltzer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png",
        "created_at": "2019-05-31T03:39:54.415Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ryanworl\" data-post=\"5\" data-topic=\"1414\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ryanworl/48/440_2.png\" class=\"avatar\"> ryanworl:</div>\n<blockquote>\n<p>They were on the three_datacenter config (and now changed to triple) which may be related (not sure how that interacts with recruitment)</p>\n</blockquote>\n</aside>\n<p>To be fair, we were having the same issue when in <code>three_datacenter</code> mode. However, changing to <code>triple</code> did increase our write throughput. As you pointed out (off thread), this was due to the replication factor being decreased from <code>6x</code> to <code>3x</code>.  Although, our issue remains the same\u2026that is, our write throughput is bottlenecked at the resolver before anything else.</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-05-31T03:39:54.415Z",
        "reply_count": 0,
        "reply_to_post_number": 5,
        "quote_count": 1,
        "incoming_link_count": 1,
        "reads": 94,
        "readers_count": 93,
        "score": 23.8,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ricky Saltzer",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 369,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/7",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4238,
        "name": "Ricky Saltzer",
        "username": "ricky.saltzer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png",
        "created_at": "2019-05-31T03:49:00.664Z",
        "cooked": "<p>Since I\u2019ve manually set some processes as a <code>resolution</code> class, I should set the record straight. Here is the final listing of the <code>setclass</code> (minus <code>storage</code> processes).</p>\n<pre><code class=\"lang-auto\">\u279c  /tmp fdbcli -C fdb.cluster.grants --exec \"setclass\" | grep -v 'storage'\nThere are currently 72 processes in the database:\n  10.49.58.58:4500: stateless (set_class)\n  10.49.58.58:4501: resolution (set_class)\n  10.49.58.58:4502: transaction (command_line)\n  10.49.58.58:4503: stateless (command_line)\n  10.49.58.119:4500: stateless (set_class)\n  10.49.58.119:4501: stateless (set_class)\n  10.49.58.119:4502: transaction (command_line)\n  10.49.58.119:4503: resolution (set_class)\n  10.49.58.190:4500: stateless (set_class)\n  10.49.58.190:4501: stateless (set_class)\n  10.49.58.190:4502: transaction (command_line)\n  10.49.58.190:4503: stateless (command_line)\n</code></pre>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-05-31T03:49:00.664Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 6,
        "reads": 93,
        "readers_count": 92,
        "score": 48.6,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ricky Saltzer",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 369,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/8",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4239,
        "name": "Ryan Worl",
        "username": "ryanworl",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
        "created_at": "2019-05-31T13:31:00.912Z",
        "cooked": "<p>I did some investigation myself this morning with a 3 node cluster (each 2 cores). Spun it up, got coordinators into a good state, ran <code>configure triple memory</code> and verified transactions worked.</p>\n<p>When I ran <code>configure resolvers=2; kill; kill all</code> with <code>unset</code> as the process class in a 3 process cluster, I only ever got one resolver.</p>\n<p>When I ran <code>configure resolvers=2; kill; kill all</code> with <code>unset</code> as the process class for 3 processes and 1 additional process set as <code>resolution</code> (each VM is 2 cores), I still only ever got one resolver. The one chosen is the one process set to resolution class, thankfully.</p>\n<p>When I ran <code>configure resolvers=2; kill; kill all</code> with <code>unset</code> as the process class for 3 processes and 2 process set as <code>resolution</code>, I finally got 2 resolvers.</p>\n<p>I understand \u201cDesired Resolvers\u201d is not \u201cMust Set This Number Resolvers\u201d, but that behavior is not what I would have expected.</p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-05-31T15:26:35.907Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 88,
        "readers_count": 87,
        "score": 27.6,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ryan Worl",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 81,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/9",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4240,
        "name": "Ricky Saltzer",
        "username": "ricky.saltzer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png",
        "created_at": "2019-05-31T14:19:17.305Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ryanworl\" data-post=\"9\" data-topic=\"1414\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ryanworl/48/440_2.png\" class=\"avatar\"> ryanworl:</div>\n<blockquote>\n<p>When I ran <code>configure resolvers=2; kill; kill all</code> with <code>unset</code> as the process class for 3 processes and 2 process set as <code>resolution</code> , I finally got 2 resolvers.</p>\n</blockquote>\n</aside>\n<p>I\u2019m having trouble reproducing this result.</p>\n<p>[1]</p>\n<pre><code class=\"lang-auto\">\u279c  /tmp fdbcli -C fdb.cluster.grants --exec \"setclass\" | egrep 'resolution|unset'\n  10.49.58.58:4500: unset (set_class)\n  10.49.58.58:4501: resolution (set_class)\n  10.49.58.58:4503: unset (set_class)\n  10.49.58.119:4500: unset (set_class)\n  10.49.58.119:4501: unset (set_class)\n  10.49.58.119:4503: resolution (set_class)\n  10.49.58.190:4500: unset (set_class)\n  10.49.58.190:4501: unset (set_class)\n  10.49.58.190:4503: unset (set_class)\n</code></pre>\n<p>[2]</p>\n<pre><code class=\"lang-auto\">\u279c  /tmp fdbcli -C fdb.cluster.grants --exec \"configure resolvers=2; kill; kill all;\"\n&gt;&gt;&gt; configure resolvers=2\nConfiguration changed\n&gt;&gt;&gt; kill\n...\n...\n&gt;&gt;&gt; kill all\nAttempted to kill 72 processes\n</code></pre>\n<p>[3]</p>\n<pre><code class=\"lang-auto\">Configuration:\n  Redundancy mode        - triple\n  Storage engine         - ssd-2\n  Coordinators           - 7\n  Desired Resolvers      - 2\n\nCluster:\n  FoundationDB processes - 72\n  Machines               - 18\n  Memory availability    - 3.7 GB per process on machine with least available\n                           &gt;&gt;&gt;&gt;&gt; (WARNING: 4.0 GB recommended) &lt;&lt;&lt;&lt;&lt;\n  Retransmissions rate   - 8 Hz\n  Fault Tolerance        - 2 machines\n  Server time            - 05/31/19 10:18:16\n\nData:\n  Replication health     - Healthy (Rebalancing)\n  Moving data            - 0.000 GB\n  Sum of key-value sizes - 3 MB\n  Disk space used        - 20.265 GB\n\nOperating space:\n  Storage server         - 174.6 GB free on most full server\n  Log server             - 174.6 GB free on most full server\n\nWorkload:\n  Read rate              - 32 Hz\n  Write rate             - 1 Hz\n  Transactions started   - 6 Hz\n  Transactions committed - 1 Hz\n  Conflict rate          - 0 Hz\n\nBackup and DR:\n  Running backups        - 0\n  Running DRs            - 0\n</code></pre>\n<p>[4]</p>\n<pre><code class=\"lang-auto\">\u279c  /tmp fdbcli -C fdb.cluster.grants --exec \"status json\" | grep resolver\n            \"resolvers\" : 2,\n                        \"role\" : \"resolver\"\n</code></pre>",
        "post_number": 10,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-05-31T14:19:17.305Z",
        "reply_count": 1,
        "reply_to_post_number": 9,
        "quote_count": 1,
        "incoming_link_count": 3,
        "reads": 88,
        "readers_count": 87,
        "score": 37.6,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ricky Saltzer",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 369,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/10",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4241,
        "name": "Ryan Worl",
        "username": "ryanworl",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
        "created_at": "2019-05-31T14:29:31.606Z",
        "cooked": "<p>Yes, I assume we\u2019d already tried something equivalent to that previously. I just wanted to start from zero and see if I could actually make two resolvers happen. Still, very strange.</p>\n<p>Edit: For anyone interested in investigating this as well, Ricky is on 6.0.15 and I just tested 6.1.8. If there are differences in how recruitment works introduced between those two that would be helpful to know.</p>",
        "post_number": 11,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-05-31T14:53:21.953Z",
        "reply_count": 1,
        "reply_to_post_number": 10,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 84,
        "readers_count": 83,
        "score": 41.8,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ryan Worl",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 2,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 369,
          "username": "ricky.saltzer",
          "name": "Ricky Saltzer",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 81,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/11",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4244,
        "name": "Ricky Saltzer",
        "username": "ricky.saltzer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png",
        "created_at": "2019-05-31T19:28:02.864Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ryanworl\" data-post=\"11\" data-topic=\"1414\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ryanworl/48/440_2.png\" class=\"avatar\"> ryanworl:</div>\n<blockquote>\n<p>Ricky is on 6.0.15 and I just tested 6.1.8</p>\n</blockquote>\n</aside>\n<p>I upgraded the cluster but still stuck with one resolver <img src=\"https://emoji.discourse-cdn.com/twitter/frowning.png?v=12\" title=\":frowning:\" class=\"emoji\" alt=\":frowning:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
        "post_number": 12,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-05-31T19:28:02.864Z",
        "reply_count": 0,
        "reply_to_post_number": 11,
        "quote_count": 1,
        "incoming_link_count": 2,
        "reads": 82,
        "readers_count": 81,
        "score": 26.4,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ricky Saltzer",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 369,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/12",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4250,
        "name": "Alex Miller",
        "username": "alexmiller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "created_at": "2019-06-01T00:16:31.353Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ryanworl\" data-post=\"5\" data-topic=\"1414\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ryanworl/48/440_2.png\" class=\"avatar\"> ryanworl:</div>\n<blockquote>\n<p>They were on the three_datacenter config (and now changed to triple) which may be related (not sure how that interacts with recruitment).</p>\n</blockquote>\n</aside>\n<p>Ah, I had missed this.</p>\n<p>You have the cluster controller and proxy recruited in one process that is</p>\n<pre><code class=\"lang-auto\">                \"locality\" : {\n                    \"dcid\" : \"7df98dcf291d4eed3c4e863c2f07a715\",\n                    \"machineid\" : \"1e1b5d03332c24896d2abc1f03f83657\",\n                    \"processid\" : \"99ac06f627656fe6f4d6aa05a69d0d7b\",\n                    \"zoneid\" : \"1e1b5d03332c24896d2abc1f03f83657\"\n                },\n</code></pre>\n<p>your master and proxy are in</p>\n<pre><code class=\"lang-auto\">                \"locality\" : {\n                    \"dcid\" : \"7df98dcf291d4eed3c4e863c2f07a715\",\n                    \"machineid\" : \"1e1b5d03332c24896d2abc1f03f83657\",\n                    \"processid\" : \"8be186ec55e0f9cf9a2f0847ee08631b\",\n                    \"zoneid\" : \"1e1b5d03332c24896d2abc1f03f83657\"\n                },\n</code></pre>\n<p>Your unused resolution class process is:</p>\n<pre><code class=\"lang-auto\">                \"locality\" : {\n                    \"dcid\" : \"643df5d94568f2f25772668935e05cf1\",\n                    \"machineid\" : \"f942a3745a0086b2d1926a3bde011a2d\",\n                    \"processid\" : \"411d623bf96e44b31c6516b87138e8a2\",\n                    \"zoneid\" : \"f942a3745a0086b2d1926a3bde011a2d\"\n                },\n</code></pre>\n<p>and your used one is</p>\n<pre><code class=\"lang-auto\">                \"locality\" : {\n                    \"dcid\" : \"7df98dcf291d4eed3c4e863c2f07a715\",\n                    \"machineid\" : \"1e1b5d03332c24896d2abc1f03f83657\",\n                    \"processid\" : \"7b0abba967dd30eb4e86fbdaec217086\",\n                    \"zoneid\" : \"1e1b5d03332c24896d2abc1f03f83657\"\n                },\n</code></pre>\n<p>So, everything that\u2019s getting recruited is in dcid 7df98dcf291d4eed3c4e863c2f07a715</p>\n<p>Which is intended.  Definitely so for <code>three_datacenter</code>.  I\u2019m not actually sure how <code>triple</code> behaves with multiple <code>dcId</code>s specified, but apparently \u201clike the above\u201d is the answer.  Recruiting proxies and resolvers across multiple datacenters would only increase latency (and likely decrease throughput) with little gain.</p>\n<p>I\u2019ll strongly suspect that if you take another dcId 7df98dcf291d4eed3c4e863c2f07a715 process and mark it as resolution, that you\u2019ll get a second resolver.  You would need to mark it as resolution and not stateless, because recruitment won\u2019t let the process fit degrade with additional recruitments, so you\u2019d either need to have multiple resolution processes or only stateless processes.</p>\n<p>Relevant recruitment code: <a href=\"https://github.com/apple/foundationdb/blob/b30fe29c9fc2ea23d679bf4fdc88daaea067a346/fdbserver/ClusterController.actor.cpp#L675\">https://github.com/apple/foundationdb/blob/b30fe29c9fc2ea23d679bf4fdc88daaea067a346/fdbserver/ClusterController.actor.cpp#L675</a></p>",
        "post_number": 13,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-06-01T00:16:31.353Z",
        "reply_count": 1,
        "reply_to_post_number": 5,
        "quote_count": 1,
        "incoming_link_count": 5,
        "reads": 81,
        "readers_count": 80,
        "score": 61.2,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Alex Miller",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://github.com/apple/foundationdb/blob/b30fe29c9fc2ea23d679bf4fdc88daaea067a346/fdbserver/ClusterController.actor.cpp#L675",
            "internal": false,
            "reflection": false,
            "title": "foundationdb/ClusterController.actor.cpp at b30fe29c9fc2ea23d679bf4fdc88daaea067a346 \u00b7 apple/foundationdb \u00b7 GitHub",
            "clicks": 2
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 13,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/13",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4251,
        "name": "Ricky Saltzer",
        "username": "ricky.saltzer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png",
        "created_at": "2019-06-01T00:29:57.403Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"alexmiller\" data-post=\"13\" data-topic=\"1414\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/alexmiller/48/326_2.png\" class=\"avatar\"> alexmiller:</div>\n<blockquote>\n<p>I\u2019ll strongly suspect that if you take another dcId 7df98dcf291d4eed3c4e863c2f07a715 process and mark it as resolution, that you\u2019ll get a second resolver.</p>\n</blockquote>\n</aside>\n<p>Totally worked!!!</p>\n<pre><code class=\"lang-auto\">\u279c  /tmp fdbcli -C fdb.cluster.grants --exec \"status json\" | grep 'resolution'\n                \"class_type\" : \"resolution\",\n                \"class_type\" : \"resolution\",\n</code></pre>\n<p>I guess this begs the question\u2026why am I not able to have a resolver in each datacenter?</p>",
        "post_number": 14,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-06-01T00:29:57.403Z",
        "reply_count": 1,
        "reply_to_post_number": 13,
        "quote_count": 1,
        "incoming_link_count": 1,
        "reads": 77,
        "readers_count": 76,
        "score": 25.4,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ricky Saltzer",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 369,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/14",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4253,
        "name": "Alex Miller",
        "username": "alexmiller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "created_at": "2019-06-01T00:35:38.249Z",
        "cooked": "<p>I\u2026 don\u2019t think you\u2019d want a resolver in each datacenter?</p>\n<p>In your cluster, you have your master, proxies, and resolver in the same datacenter.  You\u2019ll only incur a WAN round trip as part of writing to the TLogs, but that\u2019s unavoidable, because the entire point of three_datacenter mode is to have writes durably stored in two geographically distributed locations.  Resolvers are stateless, so you gain no fault tolerance properties by having them geographically distributed.</p>\n<p>If you added a resolver to another DC, then you\u2019d have to doing a broadcast and waiting for replies to the resolvers would be one WAN roundtrip, and then you\u2019d pay a second for the WAN TLog roundtrip.</p>\n<p>I mean, yeah, maybe it\u2019d be nice if somewhere a message was surfaced for the administrator that says \u201cActual resolvers less than desired resolvers.  Please add more resolution/stateless processes to dcId NNN\u201d.  But I\u2019m still of the opinion that automatically including resolvers in far away DCs for the transaction system isn\u2019t universally desirable.</p>",
        "post_number": 15,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-06-01T00:35:38.249Z",
        "reply_count": 2,
        "reply_to_post_number": 14,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 72,
        "readers_count": 71,
        "score": 59.4,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Alex Miller",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 369,
          "username": "ricky.saltzer",
          "name": "Ricky Saltzer",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 2
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 13,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/15",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4254,
        "name": "Ryan Worl",
        "username": "ryanworl",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
        "created_at": "2019-06-01T00:36:58.186Z",
        "cooked": "<p>This cluster is deployed with three AZs in one region as the \u201cdatacenters\u201d. That is why he was hoping to recruit resolvers in each datacenter, but I don\u2019t think three_datacenter was intended for that use case.</p>",
        "post_number": 16,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-06-01T00:36:58.186Z",
        "reply_count": 1,
        "reply_to_post_number": 15,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 71,
        "readers_count": 70,
        "score": 34.2,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ryan Worl",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 13,
          "username": "alexmiller",
          "name": "Alex Miller",
          "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png"
        },
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 81,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/16",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4255,
        "name": "Ricky Saltzer",
        "username": "ricky.saltzer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png",
        "created_at": "2019-06-01T00:39:23.530Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"alexmiller\" data-post=\"15\" data-topic=\"1414\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/alexmiller/48/326_2.png\" class=\"avatar\"> alexmiller:</div>\n<blockquote>\n<p>You\u2019ll only incur a WAN round trip as part of writing to the TLogs, but that\u2019s unavoidable, because the entire point of three_datacenter mode is to have writes durably stored in two geographically distributed locations. Resolvers are stateless, so you gain no fault tolerance properties by having them geographically distributed.</p>\n</blockquote>\n</aside>\n<p>Totally makes sense. Thank you for clearing this up for me.</p>",
        "post_number": 17,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-06-01T00:39:23.530Z",
        "reply_count": 1,
        "reply_to_post_number": 15,
        "quote_count": 1,
        "incoming_link_count": 2,
        "reads": 73,
        "readers_count": 72,
        "score": 29.6,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ricky Saltzer",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 369,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/17",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4256,
        "name": "Ricky Saltzer",
        "username": "ricky.saltzer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png",
        "created_at": "2019-06-01T00:40:12.799Z",
        "cooked": "<p>Do we think there is a bug where triple replication respects the <code>dcid</code> when it really shouldn\u2019t?</p>",
        "post_number": 18,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-06-01T00:40:12.799Z",
        "reply_count": 1,
        "reply_to_post_number": 17,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 73,
        "readers_count": 72,
        "score": 19.6,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ricky Saltzer",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 369,
          "username": "ricky.saltzer",
          "name": "Ricky Saltzer",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 369,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/18",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4257,
        "name": "Alex Miller",
        "username": "alexmiller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "created_at": "2019-06-01T00:51:10.490Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"ryanworl\" data-post=\"16\" data-topic=\"1414\" data-full=\"true\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ryanworl/48/440_2.png\" class=\"avatar\"> ryanworl:</div>\n<blockquote>\n<p>This cluster is deployed with three AZs in one region as the \u201cdatacenters\u201d. That is why he was hoping to recruit resolvers in each datacenter, but I don\u2019t think three_datacenter was intended for that use case.</p>\n</blockquote>\n</aside>\n<p>With the goal of making the process layout on each AZ more symmetric?  IIRC, AZ to AZ communication has a slightly higher price and latency, so my point still somewhat stands.</p>\n<p>If the concern is about reserving two resolution processes in each AZ when you\u2019d only ever use 1/3 of that, then I don\u2019t have a great answer to that.  You can run <code>stateless</code> processes instead of <code>resolution</code>, with likely no meaningful change to the resulting cluster\u2019s behavior as long as you supply enough stateless processes so that proxies and resolvers don\u2019t share.  You can also technically not run stateless or resolution class processes in one of the three AZs, because if you lose one AZ you\u2019d still be assured to have one left that can run your transaction subsystem.</p>\n<p>\u2026 we\u2019ve also totally talked through Ricky\u2019s deployment before, and apparently all the details had left my head.  Maybe I should go change my logo to a goldfish\u2026</p>\n<aside class=\"quote no-group\" data-username=\"ricky.saltzer\" data-post=\"18\" data-topic=\"1414\" data-full=\"true\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://avatars.discourse-cdn.com/v4/letter/r/f17d59/48.png\" class=\"avatar\"> ricky.saltzer:</div>\n<blockquote>\n<p>Do we think there is a bug where triple replication respects the <code>dcid</code> when it really shouldn\u2019t?</p>\n</blockquote>\n</aside>\n<p>That\u2019s what I\u2019ve been thinking through now, and I haven\u2019t come to a conclusion.  My mental model of <code>triple</code> is that it should only care about <code>zoneId</code>, so I\u2019m assuming that this was accidentally introduced when adding <code>three_datacenter</code> or multi-region, and they assumed that you wouldn\u2019t specify dcId for a cluster that\u2019s triple replicated.  On the other hand, I feel like <code>triple</code> sort of did the \u201cright\u201d thing here, in that it \u201chelped\u201d you avoid a potentially sub-optimal database configuration.  My idiomatic and pragmatic sides are at war.</p>",
        "post_number": 19,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-06-01T00:51:10.490Z",
        "reply_count": 1,
        "reply_to_post_number": 16,
        "quote_count": 2,
        "incoming_link_count": 3,
        "reads": 75,
        "readers_count": 74,
        "score": 50.0,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Alex Miller",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 13,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/19",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 4261,
        "name": "Ricky Saltzer",
        "username": "ricky.saltzer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png",
        "created_at": "2019-06-01T15:32:50.483Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"alexmiller\" data-post=\"19\" data-topic=\"1414\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/alexmiller/48/326_2.png\" class=\"avatar\"> alexmiller:</div>\n<blockquote>\n<p>On the other hand, I feel like <code>triple</code> sort of did the \u201cright\u201d thing here, in that it \u201chelped\u201d you avoid a potentially sub-optimal database configuration.</p>\n</blockquote>\n</aside>\n<p>That\u2019s interesting. I wonder if <code>triple</code> replication ensures that the other two replicas are stored in separate <code>dcId</code> storage processes.</p>",
        "post_number": 20,
        "post_type": 1,
        "posts_count": 24,
        "updated_at": "2019-06-01T15:32:50.483Z",
        "reply_count": 1,
        "reply_to_post_number": 19,
        "quote_count": 1,
        "incoming_link_count": 0,
        "reads": 72,
        "readers_count": 71,
        "score": 19.4,
        "yours": false,
        "topic_id": 1414,
        "topic_slug": "configuring-foundationdb-to-use-more-than-one-resolver",
        "display_username": "Ricky Saltzer",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 369,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/configuring-foundationdb-to-use-more-than-one-resolver/1414/20",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      4229,
      4231,
      4232,
      4234,
      4235,
      4236,
      4237,
      4238,
      4239,
      4240,
      4241,
      4244,
      4250,
      4251,
      4253,
      4254,
      4255,
      4256,
      4257,
      4261,
      4262,
      4263,
      4936,
      4938
    ]
  },
  "timeline_lookup": [
    [
      1,
      2336
    ],
    [
      9,
      2335
    ],
    [
      20,
      2334
    ],
    [
      23,
      2254
    ]
  ],
  "tags": [
    "performance"
  ],
  "tags_descriptions": {},
  "fancy_title": "Configuring FoundationDB to Use More Than One Resolver",
  "id": 1414,
  "title": "Configuring FoundationDB to Use More Than One Resolver",
  "posts_count": 24,
  "created_at": "2019-05-30T20:58:21.102Z",
  "views": 2574,
  "reply_count": 18,
  "like_count": 8,
  "last_posted_at": "2019-08-21T08:48:24.207Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "configuring-foundationdb-to-use-more-than-one-resolver",
  "category_id": 7,
  "word_count": 2977,
  "deleted_at": null,
  "user_id": 369,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_1414",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 24,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 5,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": null,
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 369,
        "username": "ricky.saltzer",
        "name": "Ricky Saltzer",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png",
        "post_count": 12,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      },
      {
        "id": 81,
        "username": "ryanworl",
        "name": "Ryan Worl",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
        "post_count": 6,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 3
      },
      {
        "id": 13,
        "username": "alexmiller",
        "name": "Alex Miller",
        "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
        "post_count": 4,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 4
      },
      {
        "id": 9,
        "username": "mbhaskar",
        "name": "Bhaskar Muppana",
        "avatar_template": "/user_avatar/forums.foundationdb.org/mbhaskar/{size}/277_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 4
      },
      {
        "id": 641,
        "username": "smithclarkson01",
        "name": "Smith Clarkson",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/s/977dab/{size}.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 0
      }
    ],
    "created_by": {
      "id": 369,
      "username": "ricky.saltzer",
      "name": "Ricky Saltzer",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/f17d59/{size}.png"
    },
    "last_poster": {
      "id": 81,
      "username": "ryanworl",
      "name": "Ryan Worl",
      "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png"
    },
    "links": [
      {
        "url": "https://gist.github.com/rickysaltzer/cf6327a26a7fc45a553253f1ed51e19a",
        "title": "status.json \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 12,
        "user_id": 369,
        "domain": "gist.github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://github.com/apple/foundationdb/blob/1190f2f33d7345104e17e2a638ed67b4b82c60c8/fdbclient/ManagementAPI.actor.cpp#L126",
        "title": "foundationdb/ManagementAPI.actor.cpp at 1190f2f33d7345104e17e2a638ed67b4b82c60c8 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 4,
        "user_id": 81,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://9appsapk.com",
        "title": "9Apps -\u3010 Download 9Apps APK AppStore for Android Free \u3011- 2019",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 2,
        "user_id": 641,
        "domain": "9appsapk.com",
        "root_domain": "9appsapk.com"
      },
      {
        "url": "https://github.com/apple/foundationdb/blob/b30fe29c9fc2ea23d679bf4fdc88daaea067a346/fdbserver/ClusterController.actor.cpp#L675",
        "title": "foundationdb/ClusterController.actor.cpp at b30fe29c9fc2ea23d679bf4fdc88daaea067a346 \u00b7 apple/foundationdb \u00b7 GitHub",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 2,
        "user_id": 13,
        "domain": "github.com",
        "root_domain": "github.com"
      },
      {
        "url": "https://vidmate.vin",
        "title": null,
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 2,
        "user_id": 641,
        "domain": "vidmate.vin",
        "root_domain": "vidmate.vin"
      }
    ]
  },
  "bookmarks": []
}