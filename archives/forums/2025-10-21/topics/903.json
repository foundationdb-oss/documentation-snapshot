{
  "post_stream": {
    "posts": [
      {
        "id": 2712,
        "name": "Mansur Ashraf",
        "username": "MansurAshraf",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/m/b9bd4f/{size}.png",
        "created_at": "2018-11-26T17:28:09.360Z",
        "cooked": "<p>I am trying to understand watches by creating a toy service discover layer in Java. Basic idea is as follow</p>\n<p>I have a <code>Subspace(service, ip)</code>, when instances of service come up they will register themselves by doing a set on the subspace</p>\n<blockquote>\n<p>t.set(example_service,127.0.0.1)<br>\nt.set(example_service,127.0.0.2)<br>\nt.set(example_service,127.0.0.2)</p>\n</blockquote>\n<p>Any process that needs to discover how many instances of a particular service are up and running will put a watch on the service and when watch is trigger do a range query to get all the ips</p>\n<pre><code class=\"lang-auto\">t.watch(example_service)\nt.getRange(example,service)\n</code></pre>\n<p>I am running into following issues when trying to implement this in Java.</p>\n<ol>\n<li>\n<p>It seems like I cannot put watch on parent subspace (example_service in this case). I have to put watch on exact key<br>\n`example_service,127.0.0.1</p>\n</li>\n<li>\n<p>In java binding result of the watch in a Future, and watch is trigger when future completes. Which means that I only get notified of the first  change on that key. In my usecase I want to get notified everytime a new ip  in added under example_service. Not sure if its possible to accomplish that?</p>\n</li>\n<li>\n<p>Finally, to mimic this example on my laptop I had two different transaction, one starting the watch and second triggering the watch by updating the key. This doesnt seem to work as the future from the watch never completes. Only way i got it to work is when both watch is created and key is updated in the same transaction. How would this work when in real application when watch and update will happen on different machines?</p>\n</li>\n</ol>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 10,
        "updated_at": "2018-11-26T17:28:09.360Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1227,
        "reads": 89,
        "readers_count": 88,
        "score": 6134.8,
        "yours": false,
        "topic_id": 903,
        "topic_slug": "understanding-watches",
        "display_username": "Mansur Ashraf",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://forums.foundationdb.org/t/multiple-questions-about-indexes-functions-and-watches-to-implement-etcd-layer/2047/3",
            "internal": true,
            "reflection": true,
            "title": "Multiple questions about Indexes, functions and watches to implement etcd-layer",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 437,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/understanding-watches/903/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 2719,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2018-11-26T18:43:23.745Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"MansurAshraf\" data-post=\"1\" data-topic=\"903\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://avatars.discourse-cdn.com/v4/letter/m/b9bd4f/48.png\" class=\"avatar\"> MansurAshraf:</div>\n<blockquote>\n<p>It seems like I cannot put watch on parent subspace (example_service in this case). I have to put watch on exact key<br>\n`example_service,127.0.0.1</p>\n</blockquote>\n</aside>\n<p>Watches are only supported on individual keys, not on ranges. If you want to track changes to a range, one way is to have a separate key that you modify every time the range gets modified. This key could store a value that\u2019s incremented with atomic adds or that includes a versionstamp. Then you could watch this key to know when the range is updated. There\u2019s a good bit of discussion about this in <a href=\"https://forums.foundationdb.org/t/changefeeds-watching-and-getting-updates-on-ranges-of-keys/511\">this thread</a>.</p>\n<aside class=\"quote no-group\" data-username=\"MansurAshraf\" data-post=\"1\" data-topic=\"903\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://avatars.discourse-cdn.com/v4/letter/m/b9bd4f/48.png\" class=\"avatar\"> MansurAshraf:</div>\n<blockquote>\n<p>In java binding result of the watch in a Future, and watch is trigger when future completes. Which means that I only get notified of the first change on that key. In my usecase I want to get notified everytime a new ip in added under example_service. Not sure if its possible to accomplish that?</p>\n</blockquote>\n</aside>\n<p>The contract is a little different than this. Instead of the first change, you\u2019ll be notified when the key has changed, assuming it stays changed. It\u2019s possible the key may have undergone multiple changes by the time you are notified, and it\u2019s also possible in the case of an ABA update (one where the value changes from A to B and then back to A) that you may not be notified at all. If you use atomic add or versionstamps as I described above, though, then you don\u2019t have to worry about the ABA problem.</p>\n<p>In order to be notified about future changes after a watch fires, you\u2019ll want to set a new watch in the same transaction as the one where you read the range of keys being watched.</p>\n<aside class=\"quote no-group\" data-username=\"MansurAshraf\" data-post=\"1\" data-topic=\"903\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://avatars.discourse-cdn.com/v4/letter/m/b9bd4f/48.png\" class=\"avatar\"> MansurAshraf:</div>\n<blockquote>\n<p>Finally, to mimic this example on my laptop I had two different transaction, one starting the watch and second triggering the watch by updating the key. This doesnt seem to work as the future from the watch never completes. Only way i got it to work is when both watch is created and key is updated in the same transaction. How would this work when in real application when watch and update will happen on different machines?</p>\n</blockquote>\n</aside>\n<p>The transaction that creates a watch needs to be committed in order for the watch to be set. A watch that isn\u2019t committed can only be triggered by modifications that happen in the same transaction as the watch. Is your watch transaction being committed?</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 10,
        "updated_at": "2018-11-26T18:43:23.745Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 1,
        "incoming_link_count": 39,
        "reads": 82,
        "readers_count": 81,
        "score": 211.4,
        "yours": false,
        "topic_id": 903,
        "topic_slug": "understanding-watches",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://forums.foundationdb.org/t/changefeeds-watching-and-getting-updates-on-ranges-of-keys/511",
            "internal": true,
            "reflection": false,
            "title": "Changefeeds (watching and getting updates on ranges of keys)",
            "clicks": 75
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/understanding-watches/903/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2721,
        "name": "Arthur Kushka",
        "username": "ArchDev",
        "avatar_template": "/user_avatar/forums.foundationdb.org/archdev/{size}/425_2.png",
        "created_at": "2018-11-26T22:12:37.813Z",
        "cooked": "<p>Hello, also I would like to ask my question about watches, I got a problem when watch is never fires, I explained it in stack overflow <a href=\"https://stackoverflow.com/questions/53415446/watches-never-trigger-in-foundationdb\" rel=\"nofollow noopener\">https://stackoverflow.com/questions/53415446/watches-never-trigger-in-foundationdb</a>, is anybody have an idea about it? Thanks.</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 10,
        "updated_at": "2018-11-26T22:12:37.813Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 1,
        "reads": 73,
        "readers_count": 72,
        "score": 19.6,
        "yours": false,
        "topic_id": 903,
        "topic_slug": "understanding-watches",
        "display_username": "Arthur Kushka",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://stackoverflow.com/questions/53415446/watches-never-trigger-in-foundationdb",
            "internal": false,
            "reflection": false,
            "title": "Watches never trigger in FoundationDB - Stack Overflow",
            "clicks": 34
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 435,
        "hidden": false,
        "trust_level": 0,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/understanding-watches/903/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2722,
        "name": "Mansur Ashraf",
        "username": "MansurAshraf",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/m/b9bd4f/{size}.png",
        "created_at": "2018-11-26T22:30:27.756Z",
        "cooked": "<p>I have the exact same problem as <a class=\"mention\" href=\"/u/archdev\">@ArchDev</a>. I assume that when we can db.runAsync(\u2026) it will take care of committing the transaction however the future return by watch never finishes</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 10,
        "updated_at": "2018-11-26T22:30:27.756Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 68,
        "readers_count": 67,
        "score": 33.6,
        "yours": false,
        "topic_id": 903,
        "topic_slug": "understanding-watches",
        "display_username": "Mansur Ashraf",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 437,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/understanding-watches/903/4",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2723,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2018-11-26T22:43:53.733Z",
        "cooked": "<p>Ok, I see. I just replied to his question on stack overflow, but I can duplicate the answer here as well:</p>\n<p>I think what\u2019s going on here is that your transaction creating the watch is never completing. It\u2019s maybe not obvious from the documentation, but <code>runAsync</code> won\u2019t return until the <code>CompletableFuture</code> returned in your function is ready. Because you are returning the watch future and not changing the value until after the transaction, it\u2019s never becoming ready and the transaction never ends.</p>\n<p>If you replaced <code>runAsync</code> with <code>run</code>, I think it would work:</p>\n<pre><code>   CompletableFuture&lt;Void&gt; watchExecuted = db.run(tr -&gt; {\n      tr.set(key, new Tuple().add(1).pack());\n      return tr.watch(key);\n    });\n</code></pre>\n<p>If you wanted to use <code>runAsync</code>, then you would need to return your watch future wrapped in another object.</p>\n<p>EDIT: or rather, if you want to use <code>runAsync</code>, you could return a <code>CompletableFuture&lt;CompletableFuture&lt;Void&gt;&gt;</code>:</p>\n<pre><code>CompletableFuture&lt;CompletableFuture&lt;Void&gt;&gt; watch = db.runAsync(tr -&gt; {\n  tr.set(key, new Tuple().add(1).pack());\n  return CompletableFuture.completedFuture(tr.watch(key));\n});</code></pre>",
        "post_number": 5,
        "post_type": 1,
        "posts_count": 10,
        "updated_at": "2018-11-27T16:12:47.436Z",
        "reply_count": 1,
        "reply_to_post_number": 4,
        "quote_count": 0,
        "incoming_link_count": 8,
        "reads": 70,
        "readers_count": 69,
        "score": 59.0,
        "yours": false,
        "topic_id": 903,
        "topic_slug": "understanding-watches",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 3,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 437,
          "username": "MansurAshraf",
          "name": "Mansur Ashraf",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/m/b9bd4f/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/understanding-watches/903/5",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2724,
        "name": "Mansur Ashraf",
        "username": "MansurAshraf",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/m/b9bd4f/{size}.png",
        "created_at": "2018-11-27T00:13:59.802Z",
        "cooked": "<p>If i return <code>CompletableFuture&lt;CompletableFuture&lt;Void&gt;&gt;</code>, I get the exception below when I try to complete the inner future. I guess it sort of make sense since by returning <code>CompletableFuture&lt;CompletableFuture&lt;Void&gt;&gt;</code>  we are forcing <code>db.runAsync(..)</code> to commit the transaction however inner future still have reference to now closed transaction?</p>\n<pre><code class=\"lang-auto\">java.lang.IllegalStateException: Cannot access closed object\n\tat com.apple.foundationdb.NativeObjectWrapper.getPtr(NativeObjectWrapper.java:85)\n\tat com.apple.foundationdb.FDBTransaction.getPtr(FDBTransaction.java:554)\n\tat com.apple.foundationdb.FDBTransaction.watch(FDBTransaction.java:477)\n</code></pre>",
        "post_number": 6,
        "post_type": 1,
        "posts_count": 10,
        "updated_at": "2018-11-27T00:15:00.254Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 0,
        "reads": 69,
        "readers_count": 68,
        "score": 18.8,
        "yours": false,
        "topic_id": 903,
        "topic_slug": "understanding-watches",
        "display_username": "Mansur Ashraf",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 437,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/understanding-watches/903/6",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2726,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2018-11-27T05:40:28.628Z",
        "cooked": "<p>Would you mind posting a snippet of code for your transaction? That might make it easier to see what\u2019s going on.</p>",
        "post_number": 7,
        "post_type": 1,
        "posts_count": 10,
        "updated_at": "2018-11-27T05:40:28.628Z",
        "reply_count": 0,
        "reply_to_post_number": 6,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 63,
        "readers_count": 62,
        "score": 27.6,
        "yours": false,
        "topic_id": 903,
        "topic_slug": "understanding-watches",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 437,
          "username": "MansurAshraf",
          "name": "Mansur Ashraf",
          "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/m/b9bd4f/{size}.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/understanding-watches/903/7",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2727,
        "name": "gaurav",
        "username": "gaurav",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
        "created_at": "2018-11-27T14:30:50.922Z",
        "cooked": "<aside class=\"quote no-group quote-modified\" data-username=\"ajbeamon\" data-post=\"5\" data-topic=\"903\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://sea1.discourse-cdn.com/foundationdb/user_avatar/forums.foundationdb.org/ajbeamon/48/13_2.png\" class=\"avatar\"> ajbeamon:</div>\n<blockquote>\n<p>EDIT: or rather, if you want to use <code>runAsync</code> , you could return a <code>CompletableFuture&lt;CompletableFuture&lt;Void&gt;&gt;</code> :</p>\n<pre><code class=\"lang-auto\">CompletableFuture&lt;Void&gt; watchExecuted = db.run(tr -&gt; {\n  tr.set(key, new Tuple().add(1).pack());\n  return CompletableFuture.completedFuture(tr.watch(key));\n});\n</code></pre>\n</blockquote>\n</aside>\n<p>Is there a typo in the edited code snippet: should it be <code>runAsync</code> instead of <code>run</code> ?</p>",
        "post_number": 8,
        "post_type": 1,
        "posts_count": 10,
        "updated_at": "2018-11-27T14:30:50.922Z",
        "reply_count": 1,
        "reply_to_post_number": 5,
        "quote_count": 1,
        "incoming_link_count": 3,
        "reads": 62,
        "readers_count": 61,
        "score": 32.4,
        "yours": false,
        "topic_id": 903,
        "topic_slug": "understanding-watches",
        "display_username": "gaurav",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 166,
        "hidden": false,
        "trust_level": 3,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/understanding-watches/903/8",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2728,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2018-11-27T16:12:20.525Z",
        "cooked": "<aside class=\"quote no-group\" data-username=\"gaurav\" data-post=\"8\" data-topic=\"903\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://avatars.discourse-cdn.com/v4/letter/g/b487fb/48.png\" class=\"avatar\"> gaurav:</div>\n<blockquote>\n<p>Is there a typo in the edited code snippet: should it be <code>runAsync</code> instead of <code>run</code> ?</p>\n</blockquote>\n</aside>\n<p>Yeah, I should have used <code>runAsync</code> and also changed the return type. I\u2019ve fixed it now.</p>",
        "post_number": 9,
        "post_type": 1,
        "posts_count": 10,
        "updated_at": "2018-11-27T16:12:20.525Z",
        "reply_count": 0,
        "reply_to_post_number": 8,
        "quote_count": 1,
        "incoming_link_count": 4,
        "reads": 60,
        "readers_count": 59,
        "score": 32.0,
        "yours": false,
        "topic_id": 903,
        "topic_slug": "understanding-watches",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/understanding-watches/903/9",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 2729,
        "name": "Mansur Ashraf",
        "username": "MansurAshraf",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/m/b9bd4f/{size}.png",
        "created_at": "2018-11-27T17:28:33.763Z",
        "cooked": "<p>So the code below works. My actual code is in Scala in which i transform the future returned from watch to Scala concurrency primitive and thats whats resulting in the error i posted. I will dig into that more myself as its unlikely related to FDB</p>\n<pre><code class=\"lang-auto\">import com.apple.foundationdb.Database;\nimport com.apple.foundationdb.FDB;\nimport com.apple.foundationdb.tuple.Tuple;\n\nimport java.util.concurrent.CompletableFuture;\n\npublic class WatchTest {\n\n    public static void main(String[] args)  {\n        final Database db = FDB.selectAPIVersion(600).open();\n\n        final CompletableFuture&lt;CompletableFuture&lt;Void&gt;&gt; future = db.runAsync(t -&gt; {\n            t.set(Tuple.from(\"key\").pack(), Tuple.from(\"value\").pack());\n            CompletableFuture&lt;Void&gt; watch = t.watch(Tuple.from(\"key\").pack()).thenAccept(u -&gt; System.out.println(\"watch fired\"));\n\n            return CompletableFuture.completedFuture(watch);\n        });\n\n\n        db.run(t -&gt; {\n            t.set(Tuple.from(\"key\").pack(), Tuple.from(\"value2\").pack());\n            return null;\n        });\n\n        final CompletableFuture&lt;Void&gt; watch = future.join(); //outer future completes\n        watch.join(); \n\n    }\n}\n</code></pre>",
        "post_number": 10,
        "post_type": 1,
        "posts_count": 10,
        "updated_at": "2018-11-27T17:28:33.763Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 9,
        "reads": 61,
        "readers_count": 60,
        "score": 57.2,
        "yours": false,
        "topic_id": 903,
        "topic_slug": "understanding-watches",
        "display_username": "Mansur Ashraf",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 437,
        "hidden": false,
        "trust_level": 1,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/understanding-watches/903/10",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      2712,
      2719,
      2721,
      2722,
      2723,
      2724,
      2726,
      2727,
      2728,
      2729
    ]
  },
  "timeline_lookup": [
    [
      1,
      2521
    ],
    [
      8,
      2520
    ]
  ],
  "suggested_topics": [],
  "tags": [],
  "tags_descriptions": {},
  "fancy_title": "Understanding &ldquo;Watches&rdquo;",
  "id": 903,
  "title": "Understanding \"Watches\"",
  "posts_count": 10,
  "created_at": "2018-11-26T17:28:09.202Z",
  "views": 3295,
  "reply_count": 4,
  "like_count": 0,
  "last_posted_at": "2018-11-27T17:28:33.763Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "understanding-watches",
  "category_id": 7,
  "word_count": 1337,
  "deleted_at": null,
  "user_id": 437,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_903",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 10,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 4,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Watchers and not missing changes",
      "id": 474,
      "title": "Watchers and not missing changes",
      "slug": "watchers-and-not-missing-changes",
      "posts_count": 14,
      "reply_count": 6,
      "highest_post_number": 14,
      "image_url": null,
      "created_at": "2018-05-25T13:29:22.034Z",
      "last_posted_at": "2018-06-05T23:23:48.371Z",
      "bumped": true,
      "bumped_at": "2018-06-05T23:23:48.371Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 3,
      "views": 1999,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 289,
            "username": "rowanG",
            "name": "Rowan Goemans",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/r/8baadc/{size}.png",
            "trust_level": 0
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 81,
            "username": "ryanworl",
            "name": "Ryan Worl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 298,
            "username": "gwillis12",
            "name": "Geo",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/ed655f/{size}.png",
            "trust_level": 0
          }
        }
      ]
    },
    {
      "fancy_title": "Changefeeds (watching and getting updates on ranges of keys)",
      "id": 511,
      "title": "Changefeeds (watching and getting updates on ranges of keys)",
      "slug": "changefeeds-watching-and-getting-updates-on-ranges-of-keys",
      "posts_count": 9,
      "reply_count": 7,
      "highest_post_number": 9,
      "image_url": null,
      "created_at": "2018-06-16T12:26:34.710Z",
      "last_posted_at": "2018-07-06T14:46:54.646Z",
      "bumped": true,
      "bumped_at": "2018-07-06T14:46:54.646Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 4221,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 307,
            "username": "jwr",
            "name": "Jan Rychter",
            "avatar_template": "/user_avatar/forums.foundationdb.org/jwr/{size}/302_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 22,
            "username": "dave",
            "name": "David Scherer",
            "avatar_template": "/user_avatar/forums.foundationdb.org/dave/{size}/89_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Transaction.Watch Examples?",
      "id": 257,
      "title": "Transaction.Watch Examples?",
      "slug": "transaction-watch-examples",
      "posts_count": 6,
      "reply_count": 2,
      "highest_post_number": 6,
      "image_url": null,
      "created_at": "2018-04-25T03:34:54.216Z",
      "last_posted_at": "2018-10-23T12:05:15.737Z",
      "bumped": true,
      "bumped_at": "2018-10-23T12:05:15.737Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 2822,
      "category_id": 5,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 174,
            "username": "seddonm1",
            "name": "seddonm1",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/s/e274bd/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 8,
            "username": "alloc",
            "name": "Alec Grieser",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alloc/{size}/9_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 22,
            "username": "dave",
            "name": "David Scherer",
            "avatar_template": "/user_avatar/forums.foundationdb.org/dave/{size}/89_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 265,
            "username": "brainfucker",
            "name": "Illarionov Oleg",
            "avatar_template": "/user_avatar/forums.foundationdb.org/brainfucker/{size}/237_2.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Changes feed without hot keys",
      "id": 1057,
      "title": "Changes feed without hot keys",
      "slug": "changes-feed-without-hot-keys",
      "posts_count": 8,
      "reply_count": 4,
      "highest_post_number": 8,
      "image_url": null,
      "created_at": "2019-01-24T21:54:58.266Z",
      "last_posted_at": "2019-01-25T20:22:00.709Z",
      "bumped": true,
      "bumped_at": "2019-01-25T20:22:00.709Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 1474,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 491,
            "username": "iilyak",
            "name": "Iilyak",
            "avatar_template": "/user_avatar/forums.foundationdb.org/iilyak/{size}/1073_2.png",
            "trust_level": 1
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 81,
            "username": "ryanworl",
            "name": "Ryan Worl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 308,
            "username": "ananthakumaran",
            "name": "Anantha Kumaran",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ananthakumaran/{size}/526_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 423,
            "username": "kocolosk",
            "name": "Adam Kocoloski",
            "avatar_template": "/user_avatar/forums.foundationdb.org/kocolosk/{size}/412_2.png",
            "trust_level": 2
          }
        }
      ]
    },
    {
      "fancy_title": "Performance characteristics of using Watches for Distributed Task Scheduling",
      "id": 471,
      "title": "Performance characteristics of using Watches for Distributed Task Scheduling",
      "slug": "performance-characteristics-of-using-watches-for-distributed-task-scheduling",
      "posts_count": 28,
      "reply_count": 13,
      "highest_post_number": 28,
      "image_url": "https://global.discourse-cdn.com/foundationdb/original/1X/0819f4ad7c04fe7d847b2f33824849dc70ee6a0c.png",
      "created_at": "2018-05-24T13:42:28.764Z",
      "last_posted_at": "2018-08-16T03:57:50.737Z",
      "bumped": true,
      "bumped_at": "2018-08-16T03:57:50.737Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [
        "performance"
      ],
      "tags_descriptions": {},
      "like_count": 15,
      "views": 5180,
      "category_id": 9,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 53,
            "username": "KrzysFR",
            "name": "Christophe Chevalier",
            "avatar_template": "/user_avatar/forums.foundationdb.org/krzysfr/{size}/43_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 13,
            "username": "alexmiller",
            "name": "Alex Miller",
            "avatar_template": "/user_avatar/forums.foundationdb.org/alexmiller/{size}/326_2.png",
            "trust_level": 4
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 118,
            "username": "abdullin",
            "name": "Rinat Abdullin",
            "avatar_template": "/user_avatar/forums.foundationdb.org/abdullin/{size}/83_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 68,
            "username": "daverosenthal",
            "name": "Dave Rosenthal",
            "avatar_template": "/user_avatar/forums.foundationdb.org/daverosenthal/{size}/51_2.png",
            "trust_level": 2
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 12,
        "username": "ajbeamon",
        "name": "A.J. Beamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "post_count": 4,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      },
      {
        "id": 437,
        "username": "MansurAshraf",
        "name": "Mansur Ashraf",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/m/b9bd4f/{size}.png",
        "post_count": 4,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 1
      },
      {
        "id": 166,
        "username": "gaurav",
        "name": "gaurav",
        "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 3
      },
      {
        "id": 435,
        "username": "ArchDev",
        "name": "Arthur Kushka",
        "avatar_template": "/user_avatar/forums.foundationdb.org/archdev/{size}/425_2.png",
        "post_count": 1,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 0
      }
    ],
    "created_by": {
      "id": 437,
      "username": "MansurAshraf",
      "name": "Mansur Ashraf",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/m/b9bd4f/{size}.png"
    },
    "last_poster": {
      "id": 437,
      "username": "MansurAshraf",
      "name": "Mansur Ashraf",
      "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/m/b9bd4f/{size}.png"
    },
    "links": [
      {
        "url": "https://forums.foundationdb.org/t/changefeeds-watching-and-getting-updates-on-ranges-of-keys/511",
        "title": "Changefeeds (watching and getting updates on ranges of keys)",
        "internal": true,
        "attachment": false,
        "reflection": false,
        "clicks": 75,
        "user_id": 12,
        "domain": "forums.foundationdb.org",
        "root_domain": "foundationdb.org"
      },
      {
        "url": "https://stackoverflow.com/questions/53415446/watches-never-trigger-in-foundationdb",
        "title": "Watches never trigger in FoundationDB - Stack Overflow",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 34,
        "user_id": 435,
        "domain": "stackoverflow.com",
        "root_domain": "stackoverflow.com"
      }
    ]
  },
  "bookmarks": []
}