{
  "post_stream": {
    "posts": [
      {
        "id": 9776,
        "name": "Steve Korshakov",
        "username": "ex3ndr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
        "created_at": "2021-08-01T23:56:56.849Z",
        "cooked": "<p>I am trying to figure out where all disk gone and built simple cli app to measure size of the keys in each directory. It is very naive - simply range read all keys in all directories and values are not matching fdbcli output at all. I tried to check if there anything else in database and I measured size by simply iterating of all keys.</p>\n<p>Currently fdbclu returns <code>940.289 GB</code>, but my cli reports only <code>4.73 GB</code> of keys and <code>57.52 GB</code> of values overall.</p>\n<p>Are there any magic in cli calculation? Any possible delayed cleanups? We are not writing too much.</p>\n<p>My code is very naive - I simply range read all keys while transaction is timeouted and then simply continue from last read key until it is done. Also this anomaly is seen only in production database.</p>",
        "post_number": 1,
        "post_type": 1,
        "posts_count": 4,
        "updated_at": "2021-08-01T23:56:56.849Z",
        "reply_count": 0,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 169,
        "reads": 54,
        "readers_count": 53,
        "score": 855.8,
        "yours": false,
        "topic_id": 2829,
        "topic_slug": "sum-of-key-value-sizes-seems-incorrect",
        "display_username": "Steve Korshakov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://forums.foundationdb.org/t/xff-0x02-blog-range-is-heavily-queried/4711",
            "internal": true,
            "reflection": true,
            "title": "\\xff\\0x02/blog range is heavily queried",
            "clicks": 0
          }
        ],
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 393,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/sum-of-key-value-sizes-seems-incorrect/2829/1",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null,
        "can_vote": false
      },
      {
        "id": 9784,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2021-08-02T18:34:55.937Z",
        "cooked": "<p>The number in <code>fdbcli</code> comes from a sample of the key-space, but it should be reasonably accurate. I believe it is fairly responsive to changes in the data, so I wouldn\u2019t expect cleanup to be a major factor.</p>\n<p>One thing that it does that you may not be is that it includes the system key-space. Usually the system key-space doesn\u2019t get particularly large, but it sometimes can as a consequence of backup and/or DR being enabled but not actually making progress or falling behind. You could check this by running <code>fdbbackup&gt; status</code> or <code>fdbdr&gt; status</code>.</p>\n<p>Also, if you are using directories to measure space, then it\u2019s possible that there exists data outside of the current directory prefixes. You may have accounted for that, but if not that could explain it.</p>\n<p>One option if you have a lot of unaccounted for space is to look at the cluster shard map. Since shards are generally divided by space, you can kind of get a sense where space is being used in your cluster by doing looking at these shards. One easy way to do this is to use the locality API, such as this call in Python:</p>\n<pre><code class=\"lang-auto\">db = fdb.open()\nboundaries = list(fdb.locality.get_boundary_keys(db, b'' , b'\\xff\\xff\\xff'))\n</code></pre>\n<p>If you see some prefix show up a lot in there, then that might give you a clue where to look.</p>",
        "post_number": 2,
        "post_type": 1,
        "posts_count": 4,
        "updated_at": "2021-08-02T18:34:55.937Z",
        "reply_count": 1,
        "reply_to_post_number": null,
        "quote_count": 0,
        "incoming_link_count": 14,
        "reads": 52,
        "readers_count": 51,
        "score": 85.4,
        "yours": false,
        "topic_id": 2829,
        "topic_slug": "sum-of-key-value-sizes-seems-incorrect",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/sum-of-key-value-sizes-seems-incorrect/2829/2",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 9785,
        "name": "Steve Korshakov",
        "username": "ex3ndr",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
        "created_at": "2021-08-02T19:58:35.333Z",
        "cooked": "<p>You were right, something is odd in system space!</p>\n<p>I have thousands of such lines:</p>\n<pre><code class=\"lang-auto\">\\xff\\x02/blog/I\\xd0\\xa7\\xb9T\\x01h\\x8fo\\x86d]\\xc1\\xa4\\x19\\x87\\x00\\x00\\x00H\n</code></pre>\n<p>What could it be? There are no DR or Backup active.</p>\n<p>How to delete this?</p>",
        "post_number": 3,
        "post_type": 1,
        "posts_count": 4,
        "updated_at": "2021-08-02T19:58:35.333Z",
        "reply_count": 1,
        "reply_to_post_number": 2,
        "quote_count": 0,
        "incoming_link_count": 3,
        "reads": 51,
        "readers_count": 50,
        "score": 30.2,
        "yours": false,
        "topic_id": 2829,
        "topic_slug": "sum-of-key-value-sizes-seems-incorrect",
        "display_username": "Steve Korshakov",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 12,
          "username": "ajbeamon",
          "name": "A.J. Beamon",
          "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png"
        },
        "bookmarked": false,
        "actions_summary": [],
        "moderator": false,
        "admin": false,
        "staff": false,
        "user_id": 393,
        "hidden": false,
        "trust_level": 2,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/sum-of-key-value-sizes-seems-incorrect/2829/3",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      },
      {
        "id": 9786,
        "name": "A.J. Beamon",
        "username": "ajbeamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "created_at": "2021-08-02T20:24:48.701Z",
        "cooked": "<p><code>blog</code> is backup data. My first suggestion would be to do a <a href=\"https://apple.github.io/foundationdb/backups.html#status\">status check</a> with <code>fdbbackup</code> and <code>fdbdr</code> for whichever of those you\u2019ve ever used. If it shows any entries, you can <a href=\"https://apple.github.io/foundationdb/backups.html#abort\">abort</a> them. If there\u2019s nothing to abort or abort doesn\u2019t help, there is also the <a href=\"https://apple.github.io/foundationdb/backups.html#cleanup\">cleanup command</a> that can be used to git rid of orphaned data.</p>",
        "post_number": 4,
        "post_type": 1,
        "posts_count": 4,
        "updated_at": "2021-08-02T20:24:48.701Z",
        "reply_count": 0,
        "reply_to_post_number": 3,
        "quote_count": 0,
        "incoming_link_count": 2,
        "reads": 48,
        "readers_count": 47,
        "score": 34.6,
        "yours": false,
        "topic_id": 2829,
        "topic_slug": "sum-of-key-value-sizes-seems-incorrect",
        "display_username": "A.J. Beamon",
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_bg_color": null,
        "flair_color": null,
        "flair_group_id": null,
        "badges_granted": [],
        "version": 1,
        "can_edit": false,
        "can_delete": false,
        "can_recover": false,
        "can_see_hidden_post": false,
        "can_wiki": false,
        "link_counts": [
          {
            "url": "https://apple.github.io/foundationdb/backups.html#cleanup",
            "internal": false,
            "reflection": false,
            "title": "Backup, Restore, and Replication for Disaster Recovery \u2014 FoundationDB 6.3",
            "clicks": 19
          },
          {
            "url": "https://apple.github.io/foundationdb/backups.html#status",
            "internal": false,
            "reflection": false,
            "title": "Backup, Restore, and Replication for Disaster Recovery \u2014 FoundationDB 6.3",
            "clicks": 6
          },
          {
            "url": "https://apple.github.io/foundationdb/backups.html#abort",
            "internal": false,
            "reflection": false,
            "title": "Backup, Restore, and Replication for Disaster Recovery \u2014 FoundationDB 6.3",
            "clicks": 2
          }
        ],
        "read": true,
        "user_title": null,
        "reply_to_user": {
          "id": 393,
          "username": "ex3ndr",
          "name": "Steve Korshakov",
          "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png"
        },
        "bookmarked": false,
        "actions_summary": [
          {
            "id": 2,
            "count": 1
          }
        ],
        "moderator": false,
        "admin": true,
        "staff": true,
        "user_id": 12,
        "hidden": false,
        "trust_level": 4,
        "deleted_at": null,
        "user_deleted": false,
        "edit_reason": null,
        "can_view_edit_history": true,
        "wiki": false,
        "post_url": "/t/sum-of-key-value-sizes-seems-incorrect/2829/4",
        "can_accept_answer": false,
        "can_unaccept_answer": false,
        "accepted_answer": false,
        "topic_accepted_answer": null
      }
    ],
    "stream": [
      9776,
      9784,
      9785,
      9786
    ]
  },
  "timeline_lookup": [
    [
      1,
      1542
    ],
    [
      2,
      1541
    ]
  ],
  "suggested_topics": [],
  "tags": [
    "performance"
  ],
  "tags_descriptions": {},
  "fancy_title": "Sum of key-value sizes seems incorrect",
  "id": 2829,
  "title": "Sum of key-value sizes seems incorrect",
  "posts_count": 4,
  "created_at": "2021-08-01T23:56:56.791Z",
  "views": 919,
  "reply_count": 2,
  "like_count": 1,
  "last_posted_at": "2021-08-02T20:24:48.701Z",
  "visible": true,
  "closed": false,
  "archived": false,
  "has_summary": false,
  "archetype": "regular",
  "slug": "sum-of-key-value-sizes-seems-incorrect",
  "category_id": 7,
  "word_count": 511,
  "deleted_at": null,
  "user_id": 393,
  "featured_link": null,
  "pinned_globally": false,
  "pinned_at": null,
  "pinned_until": null,
  "image_url": null,
  "slow_mode_seconds": 0,
  "draft": null,
  "draft_key": "topic_2829",
  "draft_sequence": null,
  "unpinned": null,
  "pinned": false,
  "current_post_number": 1,
  "highest_post_number": 4,
  "deleted_by": null,
  "actions_summary": [
    {
      "id": 4,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 8,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 10,
      "count": 0,
      "hidden": false,
      "can_act": false
    },
    {
      "id": 7,
      "count": 0,
      "hidden": false,
      "can_act": false
    }
  ],
  "chunk_size": 20,
  "bookmarked": false,
  "topic_timer": null,
  "message_bus_last_id": 0,
  "participant_count": 2,
  "show_read_indicator": false,
  "thumbnails": null,
  "slow_mode_enabled_until": null,
  "tags_disable_ads": false,
  "related_topics": [
    {
      "fancy_title": "Understand sum of key-value sizes",
      "id": 4264,
      "title": "Understand sum of key-value sizes",
      "slug": "understand-sum-of-key-value-sizes",
      "posts_count": 1,
      "reply_count": 0,
      "highest_post_number": 1,
      "image_url": null,
      "created_at": "2023-11-29T13:45:25.381Z",
      "last_posted_at": "2023-11-29T13:45:25.438Z",
      "bumped": true,
      "bumped_at": "2023-11-29T13:45:25.438Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 219,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest single",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 1353,
            "username": "yarinh",
            "name": "yarinh",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/y/a9adbd/{size}.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Tools to estimate size per directory",
      "id": 2216,
      "title": "Tools to estimate size per directory",
      "slug": "tools-to-estimate-size-per-directory",
      "posts_count": 3,
      "reply_count": 1,
      "highest_post_number": 3,
      "image_url": null,
      "created_at": "2020-06-30T01:13:00.037Z",
      "last_posted_at": "2020-06-30T02:15:22.705Z",
      "bumped": true,
      "bumped_at": "2020-06-30T02:15:22.705Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 496,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 260,
            "username": "jared2501",
            "name": "Jared2501",
            "avatar_template": "/user_avatar/forums.foundationdb.org/jared2501/{size}/266_2.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        }
      ]
    },
    {
      "fancy_title": "Moving Data more than double the key-value size stored",
      "id": 1006,
      "title": "Moving Data more than double the key-value size stored",
      "slug": "moving-data-more-than-double-the-key-value-size-stored",
      "posts_count": 1,
      "reply_count": 0,
      "highest_post_number": 1,
      "image_url": null,
      "created_at": "2019-01-11T14:25:18.665Z",
      "last_posted_at": "2019-01-11T14:25:18.879Z",
      "bumped": true,
      "bumped_at": "2019-01-11T14:25:18.879Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 0,
      "views": 472,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": "latest single",
          "description": "Original Poster, Most Recent Poster",
          "user": {
            "id": 332,
            "username": "wmd",
            "name": "William Dowling",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/w/fbc32d/{size}.png",
            "trust_level": 1
          }
        }
      ]
    },
    {
      "fancy_title": "Cannot clear all keys by &ldquo;clearrange \\x00 \\xff&rdquo;",
      "id": 1578,
      "title": "Cannot clear all keys by \"clearrange \\x00 \\xff\"",
      "slug": "cannot-clear-all-keys-by-clearrange-x00-xff",
      "posts_count": 16,
      "reply_count": 10,
      "highest_post_number": 18,
      "image_url": null,
      "created_at": "2019-08-10T05:44:48.247Z",
      "last_posted_at": "2022-07-03T22:20:16.158Z",
      "bumped": true,
      "bumped_at": "2022-07-03T22:20:16.158Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 2,
      "views": 2970,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 629,
            "username": "Sraw",
            "name": "",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/s/a88e57/{size}.png",
            "trust_level": 2
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 81,
            "username": "ryanworl",
            "name": "Ryan Worl",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ryanworl/{size}/440_2.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 166,
            "username": "gaurav",
            "name": "gaurav",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/g/b487fb/{size}.png",
            "trust_level": 3
          }
        },
        {
          "extras": null,
          "description": "Frequent Poster",
          "user": {
            "id": 15,
            "username": "markus.pilman",
            "name": "Markus Pilman",
            "avatar_template": "/user_avatar/forums.foundationdb.org/markus.pilman/{size}/379_2.png",
            "admin": true,
            "trust_level": 4
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    },
    {
      "fancy_title": "Used disk space dramatically increases while sum of key-value sizes is constant",
      "id": 644,
      "title": "Used disk space dramatically increases while sum of key-value sizes is constant",
      "slug": "used-disk-space-dramatically-increases-while-sum-of-key-value-sizes-is-constant",
      "posts_count": 6,
      "reply_count": 4,
      "highest_post_number": 7,
      "image_url": null,
      "created_at": "2018-08-17T14:38:26.479Z",
      "last_posted_at": "2018-09-04T16:08:07.423Z",
      "bumped": true,
      "bumped_at": "2018-09-04T16:08:07.423Z",
      "archetype": "regular",
      "unseen": false,
      "pinned": false,
      "unpinned": null,
      "visible": true,
      "closed": false,
      "archived": false,
      "bookmarked": null,
      "liked": null,
      "tags": [],
      "tags_descriptions": {},
      "like_count": 1,
      "views": 2087,
      "category_id": 7,
      "featured_link": null,
      "has_accepted_answer": false,
      "posters": [
        {
          "extras": null,
          "description": "Original Poster",
          "user": {
            "id": 297,
            "username": "imukhin",
            "name": "Ivan Mukhin",
            "avatar_template": "https://avatars.discourse-cdn.com/v4/letter/i/b19c9b/{size}.png",
            "trust_level": 1
          }
        },
        {
          "extras": "latest",
          "description": "Most Recent Poster",
          "user": {
            "id": 12,
            "username": "ajbeamon",
            "name": "A.J. Beamon",
            "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
            "admin": true,
            "trust_level": 4
          }
        }
      ]
    }
  ],
  "summarizable": false,
  "can_vote": false,
  "vote_count": 0,
  "user_voted": false,
  "discourse_zendesk_plugin_zendesk_id": null,
  "discourse_zendesk_plugin_zendesk_url": "https://your-url.zendesk.com/agent/tickets/",
  "details": {
    "can_edit": false,
    "notification_level": 1,
    "participants": [
      {
        "id": 12,
        "username": "ajbeamon",
        "name": "A.J. Beamon",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png",
        "post_count": 2,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "admin": true,
        "trust_level": 4
      },
      {
        "id": 393,
        "username": "ex3ndr",
        "name": "Steve Korshakov",
        "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png",
        "post_count": 2,
        "primary_group_name": null,
        "flair_name": null,
        "flair_url": null,
        "flair_color": null,
        "flair_bg_color": null,
        "flair_group_id": null,
        "trust_level": 2
      }
    ],
    "created_by": {
      "id": 393,
      "username": "ex3ndr",
      "name": "Steve Korshakov",
      "avatar_template": "/user_avatar/forums.foundationdb.org/ex3ndr/{size}/389_2.png"
    },
    "last_poster": {
      "id": 12,
      "username": "ajbeamon",
      "name": "A.J. Beamon",
      "avatar_template": "/user_avatar/forums.foundationdb.org/ajbeamon/{size}/13_2.png"
    },
    "links": [
      {
        "url": "https://apple.github.io/foundationdb/backups.html#cleanup",
        "title": "Backup, Restore, and Replication for Disaster Recovery \u2014 FoundationDB 6.3",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 19,
        "user_id": 12,
        "domain": "apple.github.io",
        "root_domain": "apple.github.io"
      },
      {
        "url": "https://apple.github.io/foundationdb/backups.html#status",
        "title": "Backup, Restore, and Replication for Disaster Recovery \u2014 FoundationDB 6.3",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 6,
        "user_id": 12,
        "domain": "apple.github.io",
        "root_domain": "apple.github.io"
      },
      {
        "url": "https://apple.github.io/foundationdb/backups.html#abort",
        "title": "Backup, Restore, and Replication for Disaster Recovery \u2014 FoundationDB 6.3",
        "internal": false,
        "attachment": false,
        "reflection": false,
        "clicks": 2,
        "user_id": 12,
        "domain": "apple.github.io",
        "root_domain": "apple.github.io"
      }
    ]
  },
  "bookmarks": []
}